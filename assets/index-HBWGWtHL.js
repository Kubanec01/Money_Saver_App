const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage-DXI_Uhko.js","assets/proxy-BCJFbgpL.js","assets/iconBase-B_N169y-.js","assets/auth-ReaH29Pt.js","assets/HomePage-DVIl79yb.css","assets/InfoPage-BNnvH7Vu.js","assets/LoginPage-BZ61SxH2.js","assets/authLabels-Dya7UeM3.js","assets/inputStyles-B86mgJ2n.js","assets/ShowAndHidePasswordBtn-D8If8PT2.js","assets/LoginPage-x1-_xglj.css","assets/RegisterPage-BtbOYOEu.js","assets/ForgotPasswordPage-CUWA0ci8.js","assets/SetNewPassword-CoBpU-3P.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var b1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function YF(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var RE={exports:{}},zg={},OE={exports:{}},xi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AO;function t8(){if(AO)return xi;AO=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),c=Symbol.iterator;function f(V){return V===null||typeof V!="object"?null:(V=c&&V[c]||V["@@iterator"],typeof V=="function"?V:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={};function v(V,X,ue){this.props=V,this.context=X,this.refs=y,this.updater=ue||m}v.prototype.isReactComponent={},v.prototype.setState=function(V,X){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,X,"setState")},v.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function b(){}b.prototype=v.prototype;function S(V,X,ue){this.props=V,this.context=X,this.refs=y,this.updater=ue||m}var _=S.prototype=new b;_.constructor=S,g(_,v.prototype),_.isPureReactComponent=!0;var T=Array.isArray,M=Object.prototype.hasOwnProperty,C={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function E(V,X,ue){var ne,he={},te=null,me=null;if(X!=null)for(ne in X.ref!==void 0&&(me=X.ref),X.key!==void 0&&(te=""+X.key),X)M.call(X,ne)&&!P.hasOwnProperty(ne)&&(he[ne]=X[ne]);var de=arguments.length-2;if(de===1)he.children=ue;else if(1<de){for(var fe=Array(de),ye=0;ye<de;ye++)fe[ye]=arguments[ye+2];he.children=fe}if(V&&V.defaultProps)for(ne in de=V.defaultProps,de)he[ne]===void 0&&(he[ne]=de[ne]);return{$$typeof:e,type:V,key:te,ref:me,props:he,_owner:C.current}}function D(V,X){return{$$typeof:e,type:V.type,key:X,ref:V.ref,props:V.props,_owner:V._owner}}function I(V){return typeof V=="object"&&V!==null&&V.$$typeof===e}function O(V){var X={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(ue){return X[ue]})}var N=/\/+/g;function k(V,X){return typeof V=="object"&&V!==null&&V.key!=null?O(""+V.key):X.toString(36)}function U(V,X,ue,ne,he){var te=typeof V;(te==="undefined"||te==="boolean")&&(V=null);var me=!1;if(V===null)me=!0;else switch(te){case"string":case"number":me=!0;break;case"object":switch(V.$$typeof){case e:case t:me=!0}}if(me)return me=V,he=he(me),V=ne===""?"."+k(me,0):ne,T(he)?(ue="",V!=null&&(ue=V.replace(N,"$&/")+"/"),U(he,X,ue,"",function(ye){return ye})):he!=null&&(I(he)&&(he=D(he,ue+(!he.key||me&&me.key===he.key?"":(""+he.key).replace(N,"$&/")+"/")+V)),X.push(he)),1;if(me=0,ne=ne===""?".":ne+":",T(V))for(var de=0;de<V.length;de++){te=V[de];var fe=ne+k(te,de);me+=U(te,X,ue,fe,he)}else if(fe=f(V),typeof fe=="function")for(V=fe.call(V),de=0;!(te=V.next()).done;)te=te.value,fe=ne+k(te,de++),me+=U(te,X,ue,fe,he);else if(te==="object")throw X=String(V),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.");return me}function Q(V,X,ue){if(V==null)return V;var ne=[],he=0;return U(V,ne,"","",function(te){return X.call(ue,te,he++)}),ne}function se(V){if(V._status===-1){var X=V._result;X=X(),X.then(function(ue){(V._status===0||V._status===-1)&&(V._status=1,V._result=ue)},function(ue){(V._status===0||V._status===-1)&&(V._status=2,V._result=ue)}),V._status===-1&&(V._status=0,V._result=X)}if(V._status===1)return V._result.default;throw V._result}var K={current:null},H={transition:null},ie={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:H,ReactCurrentOwner:C};function $(){throw Error("act(...) is not supported in production builds of React.")}return xi.Children={map:Q,forEach:function(V,X,ue){Q(V,function(){X.apply(this,arguments)},ue)},count:function(V){var X=0;return Q(V,function(){X++}),X},toArray:function(V){return Q(V,function(X){return X})||[]},only:function(V){if(!I(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},xi.Component=v,xi.Fragment=i,xi.Profiler=n,xi.PureComponent=S,xi.StrictMode=r,xi.Suspense=l,xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,xi.act=$,xi.cloneElement=function(V,X,ue){if(V==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+V+".");var ne=g({},V.props),he=V.key,te=V.ref,me=V._owner;if(X!=null){if(X.ref!==void 0&&(te=X.ref,me=C.current),X.key!==void 0&&(he=""+X.key),V.type&&V.type.defaultProps)var de=V.type.defaultProps;for(fe in X)M.call(X,fe)&&!P.hasOwnProperty(fe)&&(ne[fe]=X[fe]===void 0&&de!==void 0?de[fe]:X[fe])}var fe=arguments.length-2;if(fe===1)ne.children=ue;else if(1<fe){de=Array(fe);for(var ye=0;ye<fe;ye++)de[ye]=arguments[ye+2];ne.children=de}return{$$typeof:e,type:V.type,key:he,ref:te,props:ne,_owner:me}},xi.createContext=function(V){return V={$$typeof:a,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},V.Provider={$$typeof:s,_context:V},V.Consumer=V},xi.createElement=E,xi.createFactory=function(V){var X=E.bind(null,V);return X.type=V,X},xi.createRef=function(){return{current:null}},xi.forwardRef=function(V){return{$$typeof:o,render:V}},xi.isValidElement=I,xi.lazy=function(V){return{$$typeof:h,_payload:{_status:-1,_result:V},_init:se}},xi.memo=function(V,X){return{$$typeof:u,type:V,compare:X===void 0?null:X}},xi.startTransition=function(V){var X=H.transition;H.transition={};try{V()}finally{H.transition=X}},xi.unstable_act=$,xi.useCallback=function(V,X){return K.current.useCallback(V,X)},xi.useContext=function(V){return K.current.useContext(V)},xi.useDebugValue=function(){},xi.useDeferredValue=function(V){return K.current.useDeferredValue(V)},xi.useEffect=function(V,X){return K.current.useEffect(V,X)},xi.useId=function(){return K.current.useId()},xi.useImperativeHandle=function(V,X,ue){return K.current.useImperativeHandle(V,X,ue)},xi.useInsertionEffect=function(V,X){return K.current.useInsertionEffect(V,X)},xi.useLayoutEffect=function(V,X){return K.current.useLayoutEffect(V,X)},xi.useMemo=function(V,X){return K.current.useMemo(V,X)},xi.useReducer=function(V,X,ue){return K.current.useReducer(V,X,ue)},xi.useRef=function(V){return K.current.useRef(V)},xi.useState=function(V){return K.current.useState(V)},xi.useSyncExternalStore=function(V,X,ue){return K.current.useSyncExternalStore(V,X,ue)},xi.useTransition=function(){return K.current.useTransition()},xi.version="18.3.1",xi}var CO;function NP(){return CO||(CO=1,OE.exports=t8()),OE.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TO;function i8(){if(TO)return zg;TO=1;var e=NP(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var h,c={},f=null,m=null;u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(m=l.ref);for(h in l)r.call(l,h)&&!s.hasOwnProperty(h)&&(c[h]=l[h]);if(o&&o.defaultProps)for(h in l=o.defaultProps,l)c[h]===void 0&&(c[h]=l[h]);return{$$typeof:t,type:o,key:f,ref:m,props:c,_owner:n.current}}return zg.Fragment=i,zg.jsx=a,zg.jsxs=a,zg}var PO;function r8(){return PO||(PO=1,RE.exports=i8()),RE.exports}var Jt=r8(),Ae=NP();const Fi=YF(Ae);var w1={},kE={exports:{}},Js={},LE={exports:{}},zE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MO;function n8(){return MO||(MO=1,function(e){function t(H,ie){var $=H.length;H.push(ie);e:for(;0<$;){var V=$-1>>>1,X=H[V];if(0<n(X,ie))H[V]=ie,H[$]=X,$=V;else break e}}function i(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var ie=H[0],$=H.pop();if($!==ie){H[0]=$;e:for(var V=0,X=H.length,ue=X>>>1;V<ue;){var ne=2*(V+1)-1,he=H[ne],te=ne+1,me=H[te];if(0>n(he,$))te<X&&0>n(me,he)?(H[V]=me,H[te]=$,V=te):(H[V]=he,H[ne]=$,V=ne);else if(te<X&&0>n(me,$))H[V]=me,H[te]=$,V=te;else break e}}return ie}function n(H,ie){var $=H.sortIndex-ie.sortIndex;return $!==0?$:H.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,c=null,f=3,m=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(H){for(var ie=i(u);ie!==null;){if(ie.callback===null)r(u);else if(ie.startTime<=H)r(u),ie.sortIndex=ie.expirationTime,t(l,ie);else break;ie=i(u)}}function T(H){if(y=!1,_(H),!g)if(i(l)!==null)g=!0,se(M);else{var ie=i(u);ie!==null&&K(T,ie.startTime-H)}}function M(H,ie){g=!1,y&&(y=!1,b(E),E=-1),m=!0;var $=f;try{for(_(ie),c=i(l);c!==null&&(!(c.expirationTime>ie)||H&&!O());){var V=c.callback;if(typeof V=="function"){c.callback=null,f=c.priorityLevel;var X=V(c.expirationTime<=ie);ie=e.unstable_now(),typeof X=="function"?c.callback=X:c===i(l)&&r(l),_(ie)}else r(l);c=i(l)}if(c!==null)var ue=!0;else{var ne=i(u);ne!==null&&K(T,ne.startTime-ie),ue=!1}return ue}finally{c=null,f=$,m=!1}}var C=!1,P=null,E=-1,D=5,I=-1;function O(){return!(e.unstable_now()-I<D)}function N(){if(P!==null){var H=e.unstable_now();I=H;var ie=!0;try{ie=P(!0,H)}finally{ie?k():(C=!1,P=null)}}else C=!1}var k;if(typeof S=="function")k=function(){S(N)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,Q=U.port2;U.port1.onmessage=N,k=function(){Q.postMessage(null)}}else k=function(){v(N,0)};function se(H){P=H,C||(C=!0,k())}function K(H,ie){E=v(function(){H(e.unstable_now())},ie)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,se(M))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(H){switch(f){case 1:case 2:case 3:var ie=3;break;default:ie=f}var $=f;f=ie;try{return H()}finally{f=$}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,ie){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var $=f;f=H;try{return ie()}finally{f=$}},e.unstable_scheduleCallback=function(H,ie,$){var V=e.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?V+$:V):$=V,H){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=$+X,H={id:h++,callback:ie,priorityLevel:H,startTime:$,expirationTime:X,sortIndex:-1},$>V?(H.sortIndex=$,t(u,H),i(l)===null&&H===i(u)&&(y?(b(E),E=-1):y=!0,K(T,$-V))):(H.sortIndex=X,t(l,H),g||m||(g=!0,se(M))),H},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(H){var ie=f;return function(){var $=f;f=ie;try{return H.apply(this,arguments)}finally{f=$}}}}(zE)),zE}var DO;function s8(){return DO||(DO=1,LE.exports=n8()),LE.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IO;function a8(){if(IO)return Js;IO=1;var e=NP(),t=s8();function i(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,x=1;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function s(d,p){a(d,p),a(d+"Capture",p)}function a(d,p){for(n[d]=p,d=0;d<p.length;d++)r.add(p[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},c={};function f(d){return l.call(c,d)?!0:l.call(h,d)?!1:u.test(d)?c[d]=!0:(h[d]=!0,!1)}function m(d,p,x,A){if(x!==null&&x.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return A?!1:x!==null?!x.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function g(d,p,x,A){if(p===null||typeof p>"u"||m(d,p,x,A))return!0;if(A)return!1;if(x!==null)switch(x.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function y(d,p,x,A,R,B,G){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=A,this.attributeNamespace=R,this.mustUseProperty=x,this.propertyName=d,this.type=p,this.sanitizeURL=B,this.removeEmptyString=G}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){v[d]=new y(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var p=d[0];v[p]=new y(p,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){v[d]=new y(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){v[d]=new y(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){v[d]=new y(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){v[d]=new y(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){v[d]=new y(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){v[d]=new y(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){v[d]=new y(d,5,!1,d.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function S(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var p=d.replace(b,S);v[p]=new y(p,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var p=d.replace(b,S);v[p]=new y(p,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var p=d.replace(b,S);v[p]=new y(p,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){v[d]=new y(d,1,!1,d.toLowerCase(),null,!1,!1)}),v.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){v[d]=new y(d,1,!1,d.toLowerCase(),null,!0,!0)});function _(d,p,x,A){var R=v.hasOwnProperty(p)?v[p]:null;(R!==null?R.type!==0:A||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(g(p,x,R,A)&&(x=null),A||R===null?f(p)&&(x===null?d.removeAttribute(p):d.setAttribute(p,""+x)):R.mustUseProperty?d[R.propertyName]=x===null?R.type===3?!1:"":x:(p=R.attributeName,A=R.attributeNamespace,x===null?d.removeAttribute(p):(R=R.type,x=R===3||R===4&&x===!0?"":""+x,A?d.setAttributeNS(A,p,x):d.setAttribute(p,x))))}var T=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),C=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),O=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),H=Symbol.iterator;function ie(d){return d===null||typeof d!="object"?null:(d=H&&d[H]||d["@@iterator"],typeof d=="function"?d:null)}var $=Object.assign,V;function X(d){if(V===void 0)try{throw Error()}catch(x){var p=x.stack.trim().match(/\n( *(at )?)/);V=p&&p[1]||""}return`
`+V+d}var ue=!1;function ne(d,p){if(!d||ue)return"";ue=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(Pe){var A=Pe}Reflect.construct(d,[],p)}else{try{p.call()}catch(Pe){A=Pe}d.call(p.prototype)}else{try{throw Error()}catch(Pe){A=Pe}d()}}catch(Pe){if(Pe&&A&&typeof Pe.stack=="string"){for(var R=Pe.stack.split(`
`),B=A.stack.split(`
`),G=R.length-1,ae=B.length-1;1<=G&&0<=ae&&R[G]!==B[ae];)ae--;for(;1<=G&&0<=ae;G--,ae--)if(R[G]!==B[ae]){if(G!==1||ae!==1)do if(G--,ae--,0>ae||R[G]!==B[ae]){var ce=`
`+R[G].replace(" at new "," at ");return d.displayName&&ce.includes("<anonymous>")&&(ce=ce.replace("<anonymous>",d.displayName)),ce}while(1<=G&&0<=ae);break}}}finally{ue=!1,Error.prepareStackTrace=x}return(d=d?d.displayName||d.name:"")?X(d):""}function he(d){switch(d.tag){case 5:return X(d.type);case 16:return X("Lazy");case 13:return X("Suspense");case 19:return X("SuspenseList");case 0:case 2:case 15:return d=ne(d.type,!1),d;case 11:return d=ne(d.type.render,!1),d;case 1:return d=ne(d.type,!0),d;default:return""}}function te(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case P:return"Fragment";case C:return"Portal";case D:return"Profiler";case E:return"StrictMode";case k:return"Suspense";case U:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case O:return(d.displayName||"Context")+".Consumer";case I:return(d._context.displayName||"Context")+".Provider";case N:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Q:return p=d.displayName||null,p!==null?p:te(d.type)||"Memo";case se:p=d._payload,d=d._init;try{return te(d(p))}catch{}}return null}function me(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return te(p);case 8:return p===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function de(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function fe(d){var p=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function ye(d){var p=fe(d)?"checked":"value",x=Object.getOwnPropertyDescriptor(d.constructor.prototype,p),A=""+d[p];if(!d.hasOwnProperty(p)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var R=x.get,B=x.set;return Object.defineProperty(d,p,{configurable:!0,get:function(){return R.call(this)},set:function(G){A=""+G,B.call(this,G)}}),Object.defineProperty(d,p,{enumerable:x.enumerable}),{getValue:function(){return A},setValue:function(G){A=""+G},stopTracking:function(){d._valueTracker=null,delete d[p]}}}}function Te(d){d._valueTracker||(d._valueTracker=ye(d))}function Ie(d){if(!d)return!1;var p=d._valueTracker;if(!p)return!0;var x=p.getValue(),A="";return d&&(A=fe(d)?d.checked?"true":"false":d.value),d=A,d!==x?(p.setValue(d),!0):!1}function Ne(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function st(d,p){var x=p.checked;return $({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:x??d._wrapperState.initialChecked})}function We(d,p){var x=p.defaultValue==null?"":p.defaultValue,A=p.checked!=null?p.checked:p.defaultChecked;x=de(p.value!=null?p.value:x),d._wrapperState={initialChecked:A,initialValue:x,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function ct(d,p){p=p.checked,p!=null&&_(d,"checked",p,!1)}function ut(d,p){ct(d,p);var x=de(p.value),A=p.type;if(x!=null)A==="number"?(x===0&&d.value===""||d.value!=x)&&(d.value=""+x):d.value!==""+x&&(d.value=""+x);else if(A==="submit"||A==="reset"){d.removeAttribute("value");return}p.hasOwnProperty("value")?Ye(d,p.type,x):p.hasOwnProperty("defaultValue")&&Ye(d,p.type,de(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(d.defaultChecked=!!p.defaultChecked)}function Ke(d,p,x){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var A=p.type;if(!(A!=="submit"&&A!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+d._wrapperState.initialValue,x||p===d.value||(d.value=p),d.defaultValue=p}x=d.name,x!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,x!==""&&(d.name=x)}function Ye(d,p,x){(p!=="number"||Ne(d.ownerDocument)!==d)&&(x==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+x&&(d.defaultValue=""+x))}var yt=Array.isArray;function pt(d,p,x,A){if(d=d.options,p){p={};for(var R=0;R<x.length;R++)p["$"+x[R]]=!0;for(x=0;x<d.length;x++)R=p.hasOwnProperty("$"+d[x].value),d[x].selected!==R&&(d[x].selected=R),R&&A&&(d[x].defaultSelected=!0)}else{for(x=""+de(x),p=null,R=0;R<d.length;R++){if(d[R].value===x){d[R].selected=!0,A&&(d[R].defaultSelected=!0);return}p!==null||d[R].disabled||(p=d[R])}p!==null&&(p.selected=!0)}}function re(d,p){if(p.dangerouslySetInnerHTML!=null)throw Error(i(91));return $({},p,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Y(d,p){var x=p.value;if(x==null){if(x=p.children,p=p.defaultValue,x!=null){if(p!=null)throw Error(i(92));if(yt(x)){if(1<x.length)throw Error(i(93));x=x[0]}p=x}p==null&&(p=""),x=p}d._wrapperState={initialValue:de(x)}}function Ee(d,p){var x=de(p.value),A=de(p.defaultValue);x!=null&&(x=""+x,x!==d.value&&(d.value=x),p.defaultValue==null&&d.defaultValue!==x&&(d.defaultValue=x)),A!=null&&(d.defaultValue=""+A)}function Ve(d){var p=d.textContent;p===d._wrapperState.initialValue&&p!==""&&p!==null&&(d.value=p)}function W(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ge(d,p){return d==null||d==="http://www.w3.org/1999/xhtml"?W(p):d==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var lt,it=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,x,A,R){MSApp.execUnsafeLocalFunction(function(){return d(p,x,A,R)})}:d}(function(d,p){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=p;else{for(lt=lt||document.createElement("div"),lt.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=lt.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;p.firstChild;)d.appendChild(p.firstChild)}});function De(d,p){if(p){var x=d.firstChild;if(x&&x===d.lastChild&&x.nodeType===3){x.nodeValue=p;return}}d.textContent=p}var dt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},at=["Webkit","ms","Moz","O"];Object.keys(dt).forEach(function(d){at.forEach(function(p){p=p+d.charAt(0).toUpperCase()+d.substring(1),dt[p]=dt[d]})});function bt(d,p,x){return p==null||typeof p=="boolean"||p===""?"":x||typeof p!="number"||p===0||dt.hasOwnProperty(d)&&dt[d]?(""+p).trim():p+"px"}function Dt(d,p){d=d.style;for(var x in p)if(p.hasOwnProperty(x)){var A=x.indexOf("--")===0,R=bt(x,p[x],A);x==="float"&&(x="cssFloat"),A?d.setProperty(x,R):d[x]=R}}var Ct=$({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pt(d,p){if(p){if(Ct[d]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(i(137,d));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(i(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(i(61))}if(p.style!=null&&typeof p.style!="object")throw Error(i(62))}}function Oi(d,p){if(d.indexOf("-")===-1)return typeof p.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ji=null;function pe(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Oe=null,Be=null,et=null;function Ot(d){if(d=wg(d)){if(typeof Oe!="function")throw Error(i(280));var p=d.stateNode;p&&(p=L0(p),Oe(d.stateNode,d.type,p))}}function ti(d){Be?et?et.push(d):et=[d]:Be=d}function rr(){if(Be){var d=Be,p=et;if(et=Be=null,Ot(d),p)for(d=0;d<p.length;d++)Ot(p[d])}}function or(d,p){return d(p)}function os(){}var Ei=!1;function Un(d,p,x){if(Ei)return d(p,x);Ei=!0;try{return or(d,p,x)}finally{Ei=!1,(Be!==null||et!==null)&&(os(),rr())}}function Ai(d,p){var x=d.stateNode;if(x===null)return null;var A=L0(x);if(A===null)return null;x=A[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(d=d.type,A=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!A;break e;default:d=!1}if(d)return null;if(x&&typeof x!="function")throw Error(i(231,p,typeof x));return x}var ca=!1;if(o)try{var Ts={};Object.defineProperty(Ts,"passive",{get:function(){ca=!0}}),window.addEventListener("test",Ts,Ts),window.removeEventListener("test",Ts,Ts)}catch{ca=!1}function so(d,p,x,A,R,B,G,ae,ce){var Pe=Array.prototype.slice.call(arguments,3);try{p.apply(x,Pe)}catch(Qe){this.onError(Qe)}}var da=!1,ee=null,we=!1,ke=null,xe={onError:function(d){da=!0,ee=d}};function ze(d,p,x,A,R,B,G,ae,ce){da=!1,ee=null,so.apply(xe,arguments)}function vt(d,p,x,A,R,B,G,ae,ce){if(ze.apply(this,arguments),da){if(da){var Pe=ee;da=!1,ee=null}else throw Error(i(198));we||(we=!0,ke=Pe)}}function It(d){var p=d,x=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(x=p.return),d=p.return;while(d)}return p.tag===3?x:null}function Lt(d){if(d.tag===13){var p=d.memoizedState;if(p===null&&(d=d.alternate,d!==null&&(p=d.memoizedState)),p!==null)return p.dehydrated}return null}function wt(d){if(It(d)!==d)throw Error(i(188))}function wi(d){var p=d.alternate;if(!p){if(p=It(d),p===null)throw Error(i(188));return p!==d?null:d}for(var x=d,A=p;;){var R=x.return;if(R===null)break;var B=R.alternate;if(B===null){if(A=R.return,A!==null){x=A;continue}break}if(R.child===B.child){for(B=R.child;B;){if(B===x)return wt(R),d;if(B===A)return wt(R),p;B=B.sibling}throw Error(i(188))}if(x.return!==A.return)x=R,A=B;else{for(var G=!1,ae=R.child;ae;){if(ae===x){G=!0,x=R,A=B;break}if(ae===A){G=!0,A=R,x=B;break}ae=ae.sibling}if(!G){for(ae=B.child;ae;){if(ae===x){G=!0,x=B,A=R;break}if(ae===A){G=!0,A=B,x=R;break}ae=ae.sibling}if(!G)throw Error(i(189))}}if(x.alternate!==A)throw Error(i(190))}if(x.tag!==3)throw Error(i(188));return x.stateNode.current===x?d:p}function ni(d){return d=wi(d),d!==null?ii(d):null}function ii(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=ii(d);if(p!==null)return p;d=d.sibling}return null}var Xt=t.unstable_scheduleCallback,dr=t.unstable_cancelCallback,Vn=t.unstable_shouldYield,fa=t.unstable_requestPaint,Zt=t.unstable_now,mi=t.unstable_getCurrentPriorityLevel,rn=t.unstable_ImmediatePriority,$t=t.unstable_UserBlockingPriority,Tr=t.unstable_NormalPriority,pa=t.unstable_LowPriority,ma=t.unstable_IdlePriority,_n=null,j=null;function q(d){if(j&&typeof j.onCommitFiberRoot=="function")try{j.onCommitFiberRoot(_n,d,void 0,(d.current.flags&128)===128)}catch{}}var le=Math.clz32?Math.clz32:qe,J=Math.log,ve=Math.LN2;function qe(d){return d>>>=0,d===0?32:31-(J(d)/ve|0)|0}var ls=64,Zo=4194304;function ga(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function ao(d,p){var x=d.pendingLanes;if(x===0)return 0;var A=0,R=d.suspendedLanes,B=d.pingedLanes,G=x&268435455;if(G!==0){var ae=G&~R;ae!==0?A=ga(ae):(B&=G,B!==0&&(A=ga(B)))}else G=x&~R,G!==0?A=ga(G):B!==0&&(A=ga(B));if(A===0)return 0;if(p!==0&&p!==A&&(p&R)===0&&(R=A&-A,B=p&-p,R>=B||R===16&&(B&4194240)!==0))return p;if((A&4)!==0&&(A|=x&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=A;0<p;)x=31-le(p),R=1<<x,A|=d[x],p&=~R;return A}function sh(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function va(d,p){for(var x=d.suspendedLanes,A=d.pingedLanes,R=d.expirationTimes,B=d.pendingLanes;0<B;){var G=31-le(B),ae=1<<G,ce=R[G];ce===-1?((ae&x)===0||(ae&A)!==0)&&(R[G]=sh(ae,p)):ce<=p&&(d.expiredLanes|=ae),B&=~ae}}function ya(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Bc(){var d=ls;return ls<<=1,(ls&4194240)===0&&(ls=64),d}function ah(d){for(var p=[],x=0;31>x;x++)p.push(d);return p}function oh(d,p,x){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-le(p),d[p]=x}function nr(d,p){var x=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var A=d.eventTimes;for(d=d.expirationTimes;0<x;){var R=31-le(x),B=1<<R;p[R]=0,A[R]=-1,d[R]=-1,x&=~B}}function lh(d,p){var x=d.entangledLanes|=p;for(d=d.entanglements;x;){var A=31-le(x),R=1<<A;R&p|d[A]&p&&(d[A]|=p),x&=~R}}var Di=0;function uh(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var p0,cf,m0,g0,v0,ag=!1,Jo=[],jn=null,oo=null,lo=null,hh=new Map,Da=new Map,$o=[],uS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function y0(d,p){switch(d){case"focusin":case"focusout":jn=null;break;case"dragenter":case"dragleave":oo=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":hh.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":Da.delete(p.pointerId)}}function Ws(d,p,x,A,R,B){return d===null||d.nativeEvent!==B?(d={blockedOn:p,domEventName:x,eventSystemFlags:A,nativeEvent:B,targetContainers:[R]},p!==null&&(p=wg(p),p!==null&&cf(p)),d):(d.eventSystemFlags|=A,p=d.targetContainers,R!==null&&p.indexOf(R)===-1&&p.push(R),d)}function hS(d,p,x,A,R){switch(p){case"focusin":return jn=Ws(jn,d,p,x,A,R),!0;case"dragenter":return oo=Ws(oo,d,p,x,A,R),!0;case"mouseover":return lo=Ws(lo,d,p,x,A,R),!0;case"pointerover":var B=R.pointerId;return hh.set(B,Ws(hh.get(B)||null,d,p,x,A,R)),!0;case"gotpointercapture":return B=R.pointerId,Da.set(B,Ws(Da.get(B)||null,d,p,x,A,R)),!0}return!1}function x0(d){var p=Hc(d.target);if(p!==null){var x=It(p);if(x!==null){if(p=x.tag,p===13){if(p=Lt(x),p!==null){d.blockedOn=p,v0(d.priority,function(){m0(x)});return}}else if(p===3&&x.stateNode.current.memoizedState.isDehydrated){d.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Kl(d){if(d.blockedOn!==null)return!1;for(var p=d.targetContainers;0<p.length;){var x=df(d.domEventName,d.eventSystemFlags,p[0],d.nativeEvent);if(x===null){x=d.nativeEvent;var A=new x.constructor(x.type,x);ji=A,x.target.dispatchEvent(A),ji=null}else return p=wg(x),p!==null&&cf(p),d.blockedOn=x,!1;p.shift()}return!0}function Fc(d,p,x){Kl(d)&&x.delete(p)}function b0(){ag=!1,jn!==null&&Kl(jn)&&(jn=null),oo!==null&&Kl(oo)&&(oo=null),lo!==null&&Kl(lo)&&(lo=null),hh.forEach(Fc),Da.forEach(Fc)}function uo(d,p){d.blockedOn===p&&(d.blockedOn=null,ag||(ag=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,b0)))}function ho(d){function p(R){return uo(R,d)}if(0<Jo.length){uo(Jo[0],d);for(var x=1;x<Jo.length;x++){var A=Jo[x];A.blockedOn===d&&(A.blockedOn=null)}}for(jn!==null&&uo(jn,d),oo!==null&&uo(oo,d),lo!==null&&uo(lo,d),hh.forEach(p),Da.forEach(p),x=0;x<$o.length;x++)A=$o[x],A.blockedOn===d&&(A.blockedOn=null);for(;0<$o.length&&(x=$o[0],x.blockedOn===null);)x0(x),x.blockedOn===null&&$o.shift()}var Zl=T.ReactCurrentBatchConfig,ch=!0;function vr(d,p,x,A){var R=Di,B=Zl.transition;Zl.transition=null;try{Di=1,og(d,p,x,A)}finally{Di=R,Zl.transition=B}}function cS(d,p,x,A){var R=Di,B=Zl.transition;Zl.transition=null;try{Di=4,og(d,p,x,A)}finally{Di=R,Zl.transition=B}}function og(d,p,x,A){if(ch){var R=df(d,p,x,A);if(R===null)_S(d,p,A,Uc,x),y0(d,A);else if(hS(R,d,p,x,A))A.stopPropagation();else if(y0(d,A),p&4&&-1<uS.indexOf(d)){for(;R!==null;){var B=wg(R);if(B!==null&&p0(B),B=df(d,p,x,A),B===null&&_S(d,p,A,Uc,x),B===R)break;R=B}R!==null&&A.stopPropagation()}else _S(d,p,A,null,x)}}var Uc=null;function df(d,p,x,A){if(Uc=null,d=pe(A),d=Hc(d),d!==null)if(p=It(d),p===null)d=null;else if(x=p.tag,x===13){if(d=Lt(p),d!==null)return d;d=null}else if(x===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;d=null}else p!==d&&(d=null);return Uc=d,null}function lg(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mi()){case rn:return 1;case $t:return 4;case Tr:case pa:return 16;case ma:return 536870912;default:return 16}default:return 16}}var xa=null,ff=null,qs=null;function ug(){if(qs)return qs;var d,p=ff,x=p.length,A,R="value"in xa?xa.value:xa.textContent,B=R.length;for(d=0;d<x&&p[d]===R[d];d++);var G=x-d;for(A=1;A<=G&&p[x-A]===R[B-A];A++);return qs=R.slice(d,1<A?1-A:void 0)}function pf(d){var p=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&p===13&&(d=13)):d=p,d===10&&(d=13),32<=d||d===13?d:0}function el(){return!0}function hg(){return!1}function Hn(d){function p(x,A,R,B,G){this._reactName=x,this._targetInst=R,this.type=A,this.nativeEvent=B,this.target=G,this.currentTarget=null;for(var ae in d)d.hasOwnProperty(ae)&&(x=d[ae],this[ae]=x?x(B):B[ae]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?el:hg,this.isPropagationStopped=hg,this}return $(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),p}var co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mf=Hn(co),tl=$({},co,{view:0,detail:0}),dS=Hn(tl),gf,Jl,dh,Vc=$({},tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:il,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==dh&&(dh&&d.type==="mousemove"?(gf=d.screenX-dh.screenX,Jl=d.screenY-dh.screenY):Jl=gf=0,dh=d),gf)},movementY:function(d){return"movementY"in d?d.movementY:Jl}}),vf=Hn(Vc),cg=$({},Vc,{dataTransfer:0}),w0=Hn(cg),yf=$({},tl,{relatedTarget:0}),xf=Hn(yf),_0=$({},co,{animationName:0,elapsedTime:0,pseudoElement:0}),$l=Hn(_0),S0=$({},co,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),E0=Hn(S0),A0=$({},co,{data:0}),dg=Hn(A0),bf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ps={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},C0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function T0(d){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(d):(d=C0[d])?!!p[d]:!1}function il(){return T0}var w=$({},tl,{key:function(d){if(d.key){var p=bf[d.key]||d.key;if(p!=="Unidentified")return p}return d.type==="keypress"?(d=pf(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Ps[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:il,charCode:function(d){return d.type==="keypress"?pf(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?pf(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),z=Hn(w),F=$({},Vc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Z=Hn(F),be=$({},tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:il}),Re=Hn(be),nt=$({},co,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yi=Hn(nt),nn=$({},Vc,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),ki=Hn(nn),Sn=[9,13,27,32],Gr=o&&"CompositionEvent"in window,Ia=null;o&&"documentMode"in document&&(Ia=document.documentMode);var ba=o&&"TextEvent"in window&&!Ia,jc=o&&(!Gr||Ia&&8<Ia&&11>=Ia),wf=" ",xI=!1;function bI(d,p){switch(d){case"keyup":return Sn.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wI(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var _f=!1;function $9(d,p){switch(d){case"compositionend":return wI(p);case"keypress":return p.which!==32?null:(xI=!0,wf);case"textInput":return d=p.data,d===wf&&xI?null:d;default:return null}}function eW(d,p){if(_f)return d==="compositionend"||!Gr&&bI(d,p)?(d=ug(),qs=ff=xa=null,_f=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return jc&&p.locale!=="ko"?null:p.data;default:return null}}var tW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _I(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p==="input"?!!tW[d.type]:p==="textarea"}function SI(d,p,x,A){ti(A),p=R0(p,"onChange"),0<p.length&&(x=new mf("onChange","change",null,x,A),d.push({event:x,listeners:p}))}var fg=null,pg=null;function iW(d){VI(d,0)}function P0(d){var p=Tf(d);if(Ie(p))return d}function rW(d,p){if(d==="change")return p}var EI=!1;if(o){var fS;if(o){var pS="oninput"in document;if(!pS){var AI=document.createElement("div");AI.setAttribute("oninput","return;"),pS=typeof AI.oninput=="function"}fS=pS}else fS=!1;EI=fS&&(!document.documentMode||9<document.documentMode)}function CI(){fg&&(fg.detachEvent("onpropertychange",TI),pg=fg=null)}function TI(d){if(d.propertyName==="value"&&P0(pg)){var p=[];SI(p,pg,d,pe(d)),Un(iW,p)}}function nW(d,p,x){d==="focusin"?(CI(),fg=p,pg=x,fg.attachEvent("onpropertychange",TI)):d==="focusout"&&CI()}function sW(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return P0(pg)}function aW(d,p){if(d==="click")return P0(p)}function oW(d,p){if(d==="input"||d==="change")return P0(p)}function lW(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var fo=typeof Object.is=="function"?Object.is:lW;function mg(d,p){if(fo(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var x=Object.keys(d),A=Object.keys(p);if(x.length!==A.length)return!1;for(A=0;A<x.length;A++){var R=x[A];if(!l.call(p,R)||!fo(d[R],p[R]))return!1}return!0}function PI(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function MI(d,p){var x=PI(d);d=0;for(var A;x;){if(x.nodeType===3){if(A=d+x.textContent.length,d<=p&&A>=p)return{node:x,offset:p-d};d=A}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=PI(x)}}function DI(d,p){return d&&p?d===p?!0:d&&d.nodeType===3?!1:p&&p.nodeType===3?DI(d,p.parentNode):"contains"in d?d.contains(p):d.compareDocumentPosition?!!(d.compareDocumentPosition(p)&16):!1:!1}function II(){for(var d=window,p=Ne();p instanceof d.HTMLIFrameElement;){try{var x=typeof p.contentWindow.location.href=="string"}catch{x=!1}if(x)d=p.contentWindow;else break;p=Ne(d.document)}return p}function mS(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p&&(p==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||p==="textarea"||d.contentEditable==="true")}function uW(d){var p=II(),x=d.focusedElem,A=d.selectionRange;if(p!==x&&x&&x.ownerDocument&&DI(x.ownerDocument.documentElement,x)){if(A!==null&&mS(x)){if(p=A.start,d=A.end,d===void 0&&(d=p),"selectionStart"in x)x.selectionStart=p,x.selectionEnd=Math.min(d,x.value.length);else if(d=(p=x.ownerDocument||document)&&p.defaultView||window,d.getSelection){d=d.getSelection();var R=x.textContent.length,B=Math.min(A.start,R);A=A.end===void 0?B:Math.min(A.end,R),!d.extend&&B>A&&(R=A,A=B,B=R),R=MI(x,B);var G=MI(x,A);R&&G&&(d.rangeCount!==1||d.anchorNode!==R.node||d.anchorOffset!==R.offset||d.focusNode!==G.node||d.focusOffset!==G.offset)&&(p=p.createRange(),p.setStart(R.node,R.offset),d.removeAllRanges(),B>A?(d.addRange(p),d.extend(G.node,G.offset)):(p.setEnd(G.node,G.offset),d.addRange(p)))}}for(p=[],d=x;d=d.parentNode;)d.nodeType===1&&p.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<p.length;x++)d=p[x],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var hW=o&&"documentMode"in document&&11>=document.documentMode,Sf=null,gS=null,gg=null,vS=!1;function RI(d,p,x){var A=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;vS||Sf==null||Sf!==Ne(A)||(A=Sf,"selectionStart"in A&&mS(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),gg&&mg(gg,A)||(gg=A,A=R0(gS,"onSelect"),0<A.length&&(p=new mf("onSelect","select",null,p,x),d.push({event:p,listeners:A}),p.target=Sf)))}function M0(d,p){var x={};return x[d.toLowerCase()]=p.toLowerCase(),x["Webkit"+d]="webkit"+p,x["Moz"+d]="moz"+p,x}var Ef={animationend:M0("Animation","AnimationEnd"),animationiteration:M0("Animation","AnimationIteration"),animationstart:M0("Animation","AnimationStart"),transitionend:M0("Transition","TransitionEnd")},yS={},OI={};o&&(OI=document.createElement("div").style,"AnimationEvent"in window||(delete Ef.animationend.animation,delete Ef.animationiteration.animation,delete Ef.animationstart.animation),"TransitionEvent"in window||delete Ef.transitionend.transition);function D0(d){if(yS[d])return yS[d];if(!Ef[d])return d;var p=Ef[d],x;for(x in p)if(p.hasOwnProperty(x)&&x in OI)return yS[d]=p[x];return d}var kI=D0("animationend"),LI=D0("animationiteration"),zI=D0("animationstart"),NI=D0("transitionend"),BI=new Map,FI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fh(d,p){BI.set(d,p),s(p,[d])}for(var xS=0;xS<FI.length;xS++){var bS=FI[xS],cW=bS.toLowerCase(),dW=bS[0].toUpperCase()+bS.slice(1);fh(cW,"on"+dW)}fh(kI,"onAnimationEnd"),fh(LI,"onAnimationIteration"),fh(zI,"onAnimationStart"),fh("dblclick","onDoubleClick"),fh("focusin","onFocus"),fh("focusout","onBlur"),fh(NI,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fW=new Set("cancel close invalid load scroll toggle".split(" ").concat(vg));function UI(d,p,x){var A=d.type||"unknown-event";d.currentTarget=x,vt(A,p,void 0,d),d.currentTarget=null}function VI(d,p){p=(p&4)!==0;for(var x=0;x<d.length;x++){var A=d[x],R=A.event;A=A.listeners;e:{var B=void 0;if(p)for(var G=A.length-1;0<=G;G--){var ae=A[G],ce=ae.instance,Pe=ae.currentTarget;if(ae=ae.listener,ce!==B&&R.isPropagationStopped())break e;UI(R,ae,Pe),B=ce}else for(G=0;G<A.length;G++){if(ae=A[G],ce=ae.instance,Pe=ae.currentTarget,ae=ae.listener,ce!==B&&R.isPropagationStopped())break e;UI(R,ae,Pe),B=ce}}}if(we)throw d=ke,we=!1,ke=null,d}function fr(d,p){var x=p[PS];x===void 0&&(x=p[PS]=new Set);var A=d+"__bubble";x.has(A)||(jI(p,d,2,!1),x.add(A))}function wS(d,p,x){var A=0;p&&(A|=4),jI(x,d,A,p)}var I0="_reactListening"+Math.random().toString(36).slice(2);function yg(d){if(!d[I0]){d[I0]=!0,r.forEach(function(x){x!=="selectionchange"&&(fW.has(x)||wS(x,!1,d),wS(x,!0,d))});var p=d.nodeType===9?d:d.ownerDocument;p===null||p[I0]||(p[I0]=!0,wS("selectionchange",!1,p))}}function jI(d,p,x,A){switch(lg(p)){case 1:var R=vr;break;case 4:R=cS;break;default:R=og}x=R.bind(null,p,x,d),R=void 0,!ca||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(R=!0),A?R!==void 0?d.addEventListener(p,x,{capture:!0,passive:R}):d.addEventListener(p,x,!0):R!==void 0?d.addEventListener(p,x,{passive:R}):d.addEventListener(p,x,!1)}function _S(d,p,x,A,R){var B=A;if((p&1)===0&&(p&2)===0&&A!==null)e:for(;;){if(A===null)return;var G=A.tag;if(G===3||G===4){var ae=A.stateNode.containerInfo;if(ae===R||ae.nodeType===8&&ae.parentNode===R)break;if(G===4)for(G=A.return;G!==null;){var ce=G.tag;if((ce===3||ce===4)&&(ce=G.stateNode.containerInfo,ce===R||ce.nodeType===8&&ce.parentNode===R))return;G=G.return}for(;ae!==null;){if(G=Hc(ae),G===null)return;if(ce=G.tag,ce===5||ce===6){A=B=G;continue e}ae=ae.parentNode}}A=A.return}Un(function(){var Pe=B,Qe=pe(x),Ze=[];e:{var Xe=BI.get(d);if(Xe!==void 0){var gt=mf,Et=d;switch(d){case"keypress":if(pf(x)===0)break e;case"keydown":case"keyup":gt=z;break;case"focusin":Et="focus",gt=xf;break;case"focusout":Et="blur",gt=xf;break;case"beforeblur":case"afterblur":gt=xf;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gt=vf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gt=w0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gt=Re;break;case kI:case LI:case zI:gt=$l;break;case NI:gt=Yi;break;case"scroll":gt=dS;break;case"wheel":gt=ki;break;case"copy":case"cut":case"paste":gt=E0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gt=Z}var Tt=(p&4)!==0,Lr=!Tt&&d==="scroll",_e=Tt?Xe!==null?Xe+"Capture":null:Xe;Tt=[];for(var ge=Pe,Ce;ge!==null;){Ce=ge;var $e=Ce.stateNode;if(Ce.tag===5&&$e!==null&&(Ce=$e,_e!==null&&($e=Ai(ge,_e),$e!=null&&Tt.push(xg(ge,$e,Ce)))),Lr)break;ge=ge.return}0<Tt.length&&(Xe=new gt(Xe,Et,null,x,Qe),Ze.push({event:Xe,listeners:Tt}))}}if((p&7)===0){e:{if(Xe=d==="mouseover"||d==="pointerover",gt=d==="mouseout"||d==="pointerout",Xe&&x!==ji&&(Et=x.relatedTarget||x.fromElement)&&(Hc(Et)||Et[eu]))break e;if((gt||Xe)&&(Xe=Qe.window===Qe?Qe:(Xe=Qe.ownerDocument)?Xe.defaultView||Xe.parentWindow:window,gt?(Et=x.relatedTarget||x.toElement,gt=Pe,Et=Et?Hc(Et):null,Et!==null&&(Lr=It(Et),Et!==Lr||Et.tag!==5&&Et.tag!==6)&&(Et=null)):(gt=null,Et=Pe),gt!==Et)){if(Tt=vf,$e="onMouseLeave",_e="onMouseEnter",ge="mouse",(d==="pointerout"||d==="pointerover")&&(Tt=Z,$e="onPointerLeave",_e="onPointerEnter",ge="pointer"),Lr=gt==null?Xe:Tf(gt),Ce=Et==null?Xe:Tf(Et),Xe=new Tt($e,ge+"leave",gt,x,Qe),Xe.target=Lr,Xe.relatedTarget=Ce,$e=null,Hc(Qe)===Pe&&(Tt=new Tt(_e,ge+"enter",Et,x,Qe),Tt.target=Ce,Tt.relatedTarget=Lr,$e=Tt),Lr=$e,gt&&Et)t:{for(Tt=gt,_e=Et,ge=0,Ce=Tt;Ce;Ce=Af(Ce))ge++;for(Ce=0,$e=_e;$e;$e=Af($e))Ce++;for(;0<ge-Ce;)Tt=Af(Tt),ge--;for(;0<Ce-ge;)_e=Af(_e),Ce--;for(;ge--;){if(Tt===_e||_e!==null&&Tt===_e.alternate)break t;Tt=Af(Tt),_e=Af(_e)}Tt=null}else Tt=null;gt!==null&&HI(Ze,Xe,gt,Tt,!1),Et!==null&&Lr!==null&&HI(Ze,Lr,Et,Tt,!0)}}e:{if(Xe=Pe?Tf(Pe):window,gt=Xe.nodeName&&Xe.nodeName.toLowerCase(),gt==="select"||gt==="input"&&Xe.type==="file")var Rt=rW;else if(_I(Xe))if(EI)Rt=oW;else{Rt=sW;var jt=nW}else(gt=Xe.nodeName)&&gt.toLowerCase()==="input"&&(Xe.type==="checkbox"||Xe.type==="radio")&&(Rt=aW);if(Rt&&(Rt=Rt(d,Pe))){SI(Ze,Rt,x,Qe);break e}jt&&jt(d,Xe,Pe),d==="focusout"&&(jt=Xe._wrapperState)&&jt.controlled&&Xe.type==="number"&&Ye(Xe,"number",Xe.value)}switch(jt=Pe?Tf(Pe):window,d){case"focusin":(_I(jt)||jt.contentEditable==="true")&&(Sf=jt,gS=Pe,gg=null);break;case"focusout":gg=gS=Sf=null;break;case"mousedown":vS=!0;break;case"contextmenu":case"mouseup":case"dragend":vS=!1,RI(Ze,x,Qe);break;case"selectionchange":if(hW)break;case"keydown":case"keyup":RI(Ze,x,Qe)}var Ht;if(Gr)e:{switch(d){case"compositionstart":var si="onCompositionStart";break e;case"compositionend":si="onCompositionEnd";break e;case"compositionupdate":si="onCompositionUpdate";break e}si=void 0}else _f?bI(d,x)&&(si="onCompositionEnd"):d==="keydown"&&x.keyCode===229&&(si="onCompositionStart");si&&(jc&&x.locale!=="ko"&&(_f||si!=="onCompositionStart"?si==="onCompositionEnd"&&_f&&(Ht=ug()):(xa=Qe,ff="value"in xa?xa.value:xa.textContent,_f=!0)),jt=R0(Pe,si),0<jt.length&&(si=new dg(si,d,null,x,Qe),Ze.push({event:si,listeners:jt}),Ht?si.data=Ht:(Ht=wI(x),Ht!==null&&(si.data=Ht)))),(Ht=ba?$9(d,x):eW(d,x))&&(Pe=R0(Pe,"onBeforeInput"),0<Pe.length&&(Qe=new dg("onBeforeInput","beforeinput",null,x,Qe),Ze.push({event:Qe,listeners:Pe}),Qe.data=Ht))}VI(Ze,p)})}function xg(d,p,x){return{instance:d,listener:p,currentTarget:x}}function R0(d,p){for(var x=p+"Capture",A=[];d!==null;){var R=d,B=R.stateNode;R.tag===5&&B!==null&&(R=B,B=Ai(d,x),B!=null&&A.unshift(xg(d,B,R)),B=Ai(d,p),B!=null&&A.push(xg(d,B,R))),d=d.return}return A}function Af(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function HI(d,p,x,A,R){for(var B=p._reactName,G=[];x!==null&&x!==A;){var ae=x,ce=ae.alternate,Pe=ae.stateNode;if(ce!==null&&ce===A)break;ae.tag===5&&Pe!==null&&(ae=Pe,R?(ce=Ai(x,B),ce!=null&&G.unshift(xg(x,ce,ae))):R||(ce=Ai(x,B),ce!=null&&G.push(xg(x,ce,ae)))),x=x.return}G.length!==0&&d.push({event:p,listeners:G})}var pW=/\r\n?/g,mW=/\u0000|\uFFFD/g;function GI(d){return(typeof d=="string"?d:""+d).replace(pW,`
`).replace(mW,"")}function O0(d,p,x){if(p=GI(p),GI(d)!==p&&x)throw Error(i(425))}function k0(){}var SS=null,ES=null;function AS(d,p){return d==="textarea"||d==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var CS=typeof setTimeout=="function"?setTimeout:void 0,gW=typeof clearTimeout=="function"?clearTimeout:void 0,WI=typeof Promise=="function"?Promise:void 0,vW=typeof queueMicrotask=="function"?queueMicrotask:typeof WI<"u"?function(d){return WI.resolve(null).then(d).catch(yW)}:CS;function yW(d){setTimeout(function(){throw d})}function TS(d,p){var x=p,A=0;do{var R=x.nextSibling;if(d.removeChild(x),R&&R.nodeType===8)if(x=R.data,x==="/$"){if(A===0){d.removeChild(R),ho(p);return}A--}else x!=="$"&&x!=="$?"&&x!=="$!"||A++;x=R}while(x);ho(p)}function ph(d){for(;d!=null;d=d.nextSibling){var p=d.nodeType;if(p===1||p===3)break;if(p===8){if(p=d.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return d}function qI(d){d=d.previousSibling;for(var p=0;d;){if(d.nodeType===8){var x=d.data;if(x==="$"||x==="$!"||x==="$?"){if(p===0)return d;p--}else x==="/$"&&p++}d=d.previousSibling}return null}var Cf=Math.random().toString(36).slice(2),rl="__reactFiber$"+Cf,bg="__reactProps$"+Cf,eu="__reactContainer$"+Cf,PS="__reactEvents$"+Cf,xW="__reactListeners$"+Cf,bW="__reactHandles$"+Cf;function Hc(d){var p=d[rl];if(p)return p;for(var x=d.parentNode;x;){if(p=x[eu]||x[rl]){if(x=p.alternate,p.child!==null||x!==null&&x.child!==null)for(d=qI(d);d!==null;){if(x=d[rl])return x;d=qI(d)}return p}d=x,x=d.parentNode}return null}function wg(d){return d=d[rl]||d[eu],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Tf(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(i(33))}function L0(d){return d[bg]||null}var MS=[],Pf=-1;function mh(d){return{current:d}}function pr(d){0>Pf||(d.current=MS[Pf],MS[Pf]=null,Pf--)}function lr(d,p){Pf++,MS[Pf]=d.current,d.current=p}var gh={},us=mh(gh),Xs=mh(!1),Gc=gh;function Mf(d,p){var x=d.type.contextTypes;if(!x)return gh;var A=d.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===p)return A.__reactInternalMemoizedMaskedChildContext;var R={},B;for(B in x)R[B]=p[B];return A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=R),R}function Ys(d){return d=d.childContextTypes,d!=null}function z0(){pr(Xs),pr(us)}function XI(d,p,x){if(us.current!==gh)throw Error(i(168));lr(us,p),lr(Xs,x)}function YI(d,p,x){var A=d.stateNode;if(p=p.childContextTypes,typeof A.getChildContext!="function")return x;A=A.getChildContext();for(var R in A)if(!(R in p))throw Error(i(108,me(d)||"Unknown",R));return $({},x,A)}function N0(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||gh,Gc=us.current,lr(us,d),lr(Xs,Xs.current),!0}function QI(d,p,x){var A=d.stateNode;if(!A)throw Error(i(169));x?(d=YI(d,p,Gc),A.__reactInternalMemoizedMergedChildContext=d,pr(Xs),pr(us),lr(us,d)):pr(Xs),lr(Xs,x)}var tu=null,B0=!1,DS=!1;function KI(d){tu===null?tu=[d]:tu.push(d)}function wW(d){B0=!0,KI(d)}function vh(){if(!DS&&tu!==null){DS=!0;var d=0,p=Di;try{var x=tu;for(Di=1;d<x.length;d++){var A=x[d];do A=A(!0);while(A!==null)}tu=null,B0=!1}catch(R){throw tu!==null&&(tu=tu.slice(d+1)),Xt(rn,vh),R}finally{Di=p,DS=!1}}return null}var Df=[],If=0,F0=null,U0=0,Ra=[],Oa=0,Wc=null,iu=1,ru="";function qc(d,p){Df[If++]=U0,Df[If++]=F0,F0=d,U0=p}function ZI(d,p,x){Ra[Oa++]=iu,Ra[Oa++]=ru,Ra[Oa++]=Wc,Wc=d;var A=iu;d=ru;var R=32-le(A)-1;A&=~(1<<R),x+=1;var B=32-le(p)+R;if(30<B){var G=R-R%5;B=(A&(1<<G)-1).toString(32),A>>=G,R-=G,iu=1<<32-le(p)+R|x<<R|A,ru=B+d}else iu=1<<B|x<<R|A,ru=d}function IS(d){d.return!==null&&(qc(d,1),ZI(d,1,0))}function RS(d){for(;d===F0;)F0=Df[--If],Df[If]=null,U0=Df[--If],Df[If]=null;for(;d===Wc;)Wc=Ra[--Oa],Ra[Oa]=null,ru=Ra[--Oa],Ra[Oa]=null,iu=Ra[--Oa],Ra[Oa]=null}var wa=null,_a=null,yr=!1,po=null;function JI(d,p){var x=Na(5,null,null,0);x.elementType="DELETED",x.stateNode=p,x.return=d,p=d.deletions,p===null?(d.deletions=[x],d.flags|=16):p.push(x)}function $I(d,p){switch(d.tag){case 5:var x=d.type;return p=p.nodeType!==1||x.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(d.stateNode=p,wa=d,_a=ph(p.firstChild),!0):!1;case 6:return p=d.pendingProps===""||p.nodeType!==3?null:p,p!==null?(d.stateNode=p,wa=d,_a=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(x=Wc!==null?{id:iu,overflow:ru}:null,d.memoizedState={dehydrated:p,treeContext:x,retryLane:1073741824},x=Na(18,null,null,0),x.stateNode=p,x.return=d,d.child=x,wa=d,_a=null,!0):!1;default:return!1}}function OS(d){return(d.mode&1)!==0&&(d.flags&128)===0}function kS(d){if(yr){var p=_a;if(p){var x=p;if(!$I(d,p)){if(OS(d))throw Error(i(418));p=ph(x.nextSibling);var A=wa;p&&$I(d,p)?JI(A,x):(d.flags=d.flags&-4097|2,yr=!1,wa=d)}}else{if(OS(d))throw Error(i(418));d.flags=d.flags&-4097|2,yr=!1,wa=d}}}function eR(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;wa=d}function V0(d){if(d!==wa)return!1;if(!yr)return eR(d),yr=!0,!1;var p;if((p=d.tag!==3)&&!(p=d.tag!==5)&&(p=d.type,p=p!=="head"&&p!=="body"&&!AS(d.type,d.memoizedProps)),p&&(p=_a)){if(OS(d))throw tR(),Error(i(418));for(;p;)JI(d,p),p=ph(p.nextSibling)}if(eR(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));e:{for(d=d.nextSibling,p=0;d;){if(d.nodeType===8){var x=d.data;if(x==="/$"){if(p===0){_a=ph(d.nextSibling);break e}p--}else x!=="$"&&x!=="$!"&&x!=="$?"||p++}d=d.nextSibling}_a=null}}else _a=wa?ph(d.stateNode.nextSibling):null;return!0}function tR(){for(var d=_a;d;)d=ph(d.nextSibling)}function Rf(){_a=wa=null,yr=!1}function LS(d){po===null?po=[d]:po.push(d)}var _W=T.ReactCurrentBatchConfig;function _g(d,p,x){if(d=x.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(x._owner){if(x=x._owner,x){if(x.tag!==1)throw Error(i(309));var A=x.stateNode}if(!A)throw Error(i(147,d));var R=A,B=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===B?p.ref:(p=function(G){var ae=R.refs;G===null?delete ae[B]:ae[B]=G},p._stringRef=B,p)}if(typeof d!="string")throw Error(i(284));if(!x._owner)throw Error(i(290,d))}return d}function j0(d,p){throw d=Object.prototype.toString.call(p),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function iR(d){var p=d._init;return p(d._payload)}function rR(d){function p(_e,ge){if(d){var Ce=_e.deletions;Ce===null?(_e.deletions=[ge],_e.flags|=16):Ce.push(ge)}}function x(_e,ge){if(!d)return null;for(;ge!==null;)p(_e,ge),ge=ge.sibling;return null}function A(_e,ge){for(_e=new Map;ge!==null;)ge.key!==null?_e.set(ge.key,ge):_e.set(ge.index,ge),ge=ge.sibling;return _e}function R(_e,ge){return _e=Ah(_e,ge),_e.index=0,_e.sibling=null,_e}function B(_e,ge,Ce){return _e.index=Ce,d?(Ce=_e.alternate,Ce!==null?(Ce=Ce.index,Ce<ge?(_e.flags|=2,ge):Ce):(_e.flags|=2,ge)):(_e.flags|=1048576,ge)}function G(_e){return d&&_e.alternate===null&&(_e.flags|=2),_e}function ae(_e,ge,Ce,$e){return ge===null||ge.tag!==6?(ge=CE(Ce,_e.mode,$e),ge.return=_e,ge):(ge=R(ge,Ce),ge.return=_e,ge)}function ce(_e,ge,Ce,$e){var Rt=Ce.type;return Rt===P?Qe(_e,ge,Ce.props.children,$e,Ce.key):ge!==null&&(ge.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===se&&iR(Rt)===ge.type)?($e=R(ge,Ce.props),$e.ref=_g(_e,ge,Ce),$e.return=_e,$e):($e=d1(Ce.type,Ce.key,Ce.props,null,_e.mode,$e),$e.ref=_g(_e,ge,Ce),$e.return=_e,$e)}function Pe(_e,ge,Ce,$e){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ce.containerInfo||ge.stateNode.implementation!==Ce.implementation?(ge=TE(Ce,_e.mode,$e),ge.return=_e,ge):(ge=R(ge,Ce.children||[]),ge.return=_e,ge)}function Qe(_e,ge,Ce,$e,Rt){return ge===null||ge.tag!==7?(ge=ed(Ce,_e.mode,$e,Rt),ge.return=_e,ge):(ge=R(ge,Ce),ge.return=_e,ge)}function Ze(_e,ge,Ce){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=CE(""+ge,_e.mode,Ce),ge.return=_e,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case M:return Ce=d1(ge.type,ge.key,ge.props,null,_e.mode,Ce),Ce.ref=_g(_e,null,ge),Ce.return=_e,Ce;case C:return ge=TE(ge,_e.mode,Ce),ge.return=_e,ge;case se:var $e=ge._init;return Ze(_e,$e(ge._payload),Ce)}if(yt(ge)||ie(ge))return ge=ed(ge,_e.mode,Ce,null),ge.return=_e,ge;j0(_e,ge)}return null}function Xe(_e,ge,Ce,$e){var Rt=ge!==null?ge.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Rt!==null?null:ae(_e,ge,""+Ce,$e);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case M:return Ce.key===Rt?ce(_e,ge,Ce,$e):null;case C:return Ce.key===Rt?Pe(_e,ge,Ce,$e):null;case se:return Rt=Ce._init,Xe(_e,ge,Rt(Ce._payload),$e)}if(yt(Ce)||ie(Ce))return Rt!==null?null:Qe(_e,ge,Ce,$e,null);j0(_e,Ce)}return null}function gt(_e,ge,Ce,$e,Rt){if(typeof $e=="string"&&$e!==""||typeof $e=="number")return _e=_e.get(Ce)||null,ae(ge,_e,""+$e,Rt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case M:return _e=_e.get($e.key===null?Ce:$e.key)||null,ce(ge,_e,$e,Rt);case C:return _e=_e.get($e.key===null?Ce:$e.key)||null,Pe(ge,_e,$e,Rt);case se:var jt=$e._init;return gt(_e,ge,Ce,jt($e._payload),Rt)}if(yt($e)||ie($e))return _e=_e.get(Ce)||null,Qe(ge,_e,$e,Rt,null);j0(ge,$e)}return null}function Et(_e,ge,Ce,$e){for(var Rt=null,jt=null,Ht=ge,si=ge=0,Cn=null;Ht!==null&&si<Ce.length;si++){Ht.index>si?(Cn=Ht,Ht=null):Cn=Ht.sibling;var Ui=Xe(_e,Ht,Ce[si],$e);if(Ui===null){Ht===null&&(Ht=Cn);break}d&&Ht&&Ui.alternate===null&&p(_e,Ht),ge=B(Ui,ge,si),jt===null?Rt=Ui:jt.sibling=Ui,jt=Ui,Ht=Cn}if(si===Ce.length)return x(_e,Ht),yr&&qc(_e,si),Rt;if(Ht===null){for(;si<Ce.length;si++)Ht=Ze(_e,Ce[si],$e),Ht!==null&&(ge=B(Ht,ge,si),jt===null?Rt=Ht:jt.sibling=Ht,jt=Ht);return yr&&qc(_e,si),Rt}for(Ht=A(_e,Ht);si<Ce.length;si++)Cn=gt(Ht,_e,si,Ce[si],$e),Cn!==null&&(d&&Cn.alternate!==null&&Ht.delete(Cn.key===null?si:Cn.key),ge=B(Cn,ge,si),jt===null?Rt=Cn:jt.sibling=Cn,jt=Cn);return d&&Ht.forEach(function(Ch){return p(_e,Ch)}),yr&&qc(_e,si),Rt}function Tt(_e,ge,Ce,$e){var Rt=ie(Ce);if(typeof Rt!="function")throw Error(i(150));if(Ce=Rt.call(Ce),Ce==null)throw Error(i(151));for(var jt=Rt=null,Ht=ge,si=ge=0,Cn=null,Ui=Ce.next();Ht!==null&&!Ui.done;si++,Ui=Ce.next()){Ht.index>si?(Cn=Ht,Ht=null):Cn=Ht.sibling;var Ch=Xe(_e,Ht,Ui.value,$e);if(Ch===null){Ht===null&&(Ht=Cn);break}d&&Ht&&Ch.alternate===null&&p(_e,Ht),ge=B(Ch,ge,si),jt===null?Rt=Ch:jt.sibling=Ch,jt=Ch,Ht=Cn}if(Ui.done)return x(_e,Ht),yr&&qc(_e,si),Rt;if(Ht===null){for(;!Ui.done;si++,Ui=Ce.next())Ui=Ze(_e,Ui.value,$e),Ui!==null&&(ge=B(Ui,ge,si),jt===null?Rt=Ui:jt.sibling=Ui,jt=Ui);return yr&&qc(_e,si),Rt}for(Ht=A(_e,Ht);!Ui.done;si++,Ui=Ce.next())Ui=gt(Ht,_e,si,Ui.value,$e),Ui!==null&&(d&&Ui.alternate!==null&&Ht.delete(Ui.key===null?si:Ui.key),ge=B(Ui,ge,si),jt===null?Rt=Ui:jt.sibling=Ui,jt=Ui);return d&&Ht.forEach(function(e8){return p(_e,e8)}),yr&&qc(_e,si),Rt}function Lr(_e,ge,Ce,$e){if(typeof Ce=="object"&&Ce!==null&&Ce.type===P&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case M:e:{for(var Rt=Ce.key,jt=ge;jt!==null;){if(jt.key===Rt){if(Rt=Ce.type,Rt===P){if(jt.tag===7){x(_e,jt.sibling),ge=R(jt,Ce.props.children),ge.return=_e,_e=ge;break e}}else if(jt.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===se&&iR(Rt)===jt.type){x(_e,jt.sibling),ge=R(jt,Ce.props),ge.ref=_g(_e,jt,Ce),ge.return=_e,_e=ge;break e}x(_e,jt);break}else p(_e,jt);jt=jt.sibling}Ce.type===P?(ge=ed(Ce.props.children,_e.mode,$e,Ce.key),ge.return=_e,_e=ge):($e=d1(Ce.type,Ce.key,Ce.props,null,_e.mode,$e),$e.ref=_g(_e,ge,Ce),$e.return=_e,_e=$e)}return G(_e);case C:e:{for(jt=Ce.key;ge!==null;){if(ge.key===jt)if(ge.tag===4&&ge.stateNode.containerInfo===Ce.containerInfo&&ge.stateNode.implementation===Ce.implementation){x(_e,ge.sibling),ge=R(ge,Ce.children||[]),ge.return=_e,_e=ge;break e}else{x(_e,ge);break}else p(_e,ge);ge=ge.sibling}ge=TE(Ce,_e.mode,$e),ge.return=_e,_e=ge}return G(_e);case se:return jt=Ce._init,Lr(_e,ge,jt(Ce._payload),$e)}if(yt(Ce))return Et(_e,ge,Ce,$e);if(ie(Ce))return Tt(_e,ge,Ce,$e);j0(_e,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"?(Ce=""+Ce,ge!==null&&ge.tag===6?(x(_e,ge.sibling),ge=R(ge,Ce),ge.return=_e,_e=ge):(x(_e,ge),ge=CE(Ce,_e.mode,$e),ge.return=_e,_e=ge),G(_e)):x(_e,ge)}return Lr}var Of=rR(!0),nR=rR(!1),H0=mh(null),G0=null,kf=null,zS=null;function NS(){zS=kf=G0=null}function BS(d){var p=H0.current;pr(H0),d._currentValue=p}function FS(d,p,x){for(;d!==null;){var A=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,A!==null&&(A.childLanes|=p)):A!==null&&(A.childLanes&p)!==p&&(A.childLanes|=p),d===x)break;d=d.return}}function Lf(d,p){G0=d,zS=kf=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(Qs=!0),d.firstContext=null)}function ka(d){var p=d._currentValue;if(zS!==d)if(d={context:d,memoizedValue:p,next:null},kf===null){if(G0===null)throw Error(i(308));kf=d,G0.dependencies={lanes:0,firstContext:d}}else kf=kf.next=d;return p}var Xc=null;function US(d){Xc===null?Xc=[d]:Xc.push(d)}function sR(d,p,x,A){var R=p.interleaved;return R===null?(x.next=x,US(p)):(x.next=R.next,R.next=x),p.interleaved=x,nu(d,A)}function nu(d,p){d.lanes|=p;var x=d.alternate;for(x!==null&&(x.lanes|=p),x=d,d=d.return;d!==null;)d.childLanes|=p,x=d.alternate,x!==null&&(x.childLanes|=p),x=d,d=d.return;return x.tag===3?x.stateNode:null}var yh=!1;function VS(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aR(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function su(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function xh(d,p,x){var A=d.updateQueue;if(A===null)return null;if(A=A.shared,(Bi&2)!==0){var R=A.pending;return R===null?p.next=p:(p.next=R.next,R.next=p),A.pending=p,nu(d,x)}return R=A.interleaved,R===null?(p.next=p,US(A)):(p.next=R.next,R.next=p),A.interleaved=p,nu(d,x)}function W0(d,p,x){if(p=p.updateQueue,p!==null&&(p=p.shared,(x&4194240)!==0)){var A=p.lanes;A&=d.pendingLanes,x|=A,p.lanes=x,lh(d,x)}}function oR(d,p){var x=d.updateQueue,A=d.alternate;if(A!==null&&(A=A.updateQueue,x===A)){var R=null,B=null;if(x=x.firstBaseUpdate,x!==null){do{var G={eventTime:x.eventTime,lane:x.lane,tag:x.tag,payload:x.payload,callback:x.callback,next:null};B===null?R=B=G:B=B.next=G,x=x.next}while(x!==null);B===null?R=B=p:B=B.next=p}else R=B=p;x={baseState:A.baseState,firstBaseUpdate:R,lastBaseUpdate:B,shared:A.shared,effects:A.effects},d.updateQueue=x;return}d=x.lastBaseUpdate,d===null?x.firstBaseUpdate=p:d.next=p,x.lastBaseUpdate=p}function q0(d,p,x,A){var R=d.updateQueue;yh=!1;var B=R.firstBaseUpdate,G=R.lastBaseUpdate,ae=R.shared.pending;if(ae!==null){R.shared.pending=null;var ce=ae,Pe=ce.next;ce.next=null,G===null?B=Pe:G.next=Pe,G=ce;var Qe=d.alternate;Qe!==null&&(Qe=Qe.updateQueue,ae=Qe.lastBaseUpdate,ae!==G&&(ae===null?Qe.firstBaseUpdate=Pe:ae.next=Pe,Qe.lastBaseUpdate=ce))}if(B!==null){var Ze=R.baseState;G=0,Qe=Pe=ce=null,ae=B;do{var Xe=ae.lane,gt=ae.eventTime;if((A&Xe)===Xe){Qe!==null&&(Qe=Qe.next={eventTime:gt,lane:0,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null});e:{var Et=d,Tt=ae;switch(Xe=p,gt=x,Tt.tag){case 1:if(Et=Tt.payload,typeof Et=="function"){Ze=Et.call(gt,Ze,Xe);break e}Ze=Et;break e;case 3:Et.flags=Et.flags&-65537|128;case 0:if(Et=Tt.payload,Xe=typeof Et=="function"?Et.call(gt,Ze,Xe):Et,Xe==null)break e;Ze=$({},Ze,Xe);break e;case 2:yh=!0}}ae.callback!==null&&ae.lane!==0&&(d.flags|=64,Xe=R.effects,Xe===null?R.effects=[ae]:Xe.push(ae))}else gt={eventTime:gt,lane:Xe,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},Qe===null?(Pe=Qe=gt,ce=Ze):Qe=Qe.next=gt,G|=Xe;if(ae=ae.next,ae===null){if(ae=R.shared.pending,ae===null)break;Xe=ae,ae=Xe.next,Xe.next=null,R.lastBaseUpdate=Xe,R.shared.pending=null}}while(!0);if(Qe===null&&(ce=Ze),R.baseState=ce,R.firstBaseUpdate=Pe,R.lastBaseUpdate=Qe,p=R.shared.interleaved,p!==null){R=p;do G|=R.lane,R=R.next;while(R!==p)}else B===null&&(R.shared.lanes=0);Kc|=G,d.lanes=G,d.memoizedState=Ze}}function lR(d,p,x){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var A=d[p],R=A.callback;if(R!==null){if(A.callback=null,A=x,typeof R!="function")throw Error(i(191,R));R.call(A)}}}var Sg={},nl=mh(Sg),Eg=mh(Sg),Ag=mh(Sg);function Yc(d){if(d===Sg)throw Error(i(174));return d}function jS(d,p){switch(lr(Ag,p),lr(Eg,d),lr(nl,Sg),d=p.nodeType,d){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:Ge(null,"");break;default:d=d===8?p.parentNode:p,p=d.namespaceURI||null,d=d.tagName,p=Ge(p,d)}pr(nl),lr(nl,p)}function zf(){pr(nl),pr(Eg),pr(Ag)}function uR(d){Yc(Ag.current);var p=Yc(nl.current),x=Ge(p,d.type);p!==x&&(lr(Eg,d),lr(nl,x))}function HS(d){Eg.current===d&&(pr(nl),pr(Eg))}var _r=mh(0);function X0(d){for(var p=d;p!==null;){if(p.tag===13){var x=p.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||x.data==="$?"||x.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var GS=[];function WS(){for(var d=0;d<GS.length;d++)GS[d]._workInProgressVersionPrimary=null;GS.length=0}var Y0=T.ReactCurrentDispatcher,qS=T.ReactCurrentBatchConfig,Qc=0,Sr=null,sn=null,En=null,Q0=!1,Cg=!1,Tg=0,SW=0;function hs(){throw Error(i(321))}function XS(d,p){if(p===null)return!1;for(var x=0;x<p.length&&x<d.length;x++)if(!fo(d[x],p[x]))return!1;return!0}function YS(d,p,x,A,R,B){if(Qc=B,Sr=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Y0.current=d===null||d.memoizedState===null?TW:PW,d=x(A,R),Cg){B=0;do{if(Cg=!1,Tg=0,25<=B)throw Error(i(301));B+=1,En=sn=null,p.updateQueue=null,Y0.current=MW,d=x(A,R)}while(Cg)}if(Y0.current=J0,p=sn!==null&&sn.next!==null,Qc=0,En=sn=Sr=null,Q0=!1,p)throw Error(i(300));return d}function QS(){var d=Tg!==0;return Tg=0,d}function sl(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?Sr.memoizedState=En=d:En=En.next=d,En}function La(){if(sn===null){var d=Sr.alternate;d=d!==null?d.memoizedState:null}else d=sn.next;var p=En===null?Sr.memoizedState:En.next;if(p!==null)En=p,sn=d;else{if(d===null)throw Error(i(310));sn=d,d={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},En===null?Sr.memoizedState=En=d:En=En.next=d}return En}function Pg(d,p){return typeof p=="function"?p(d):p}function KS(d){var p=La(),x=p.queue;if(x===null)throw Error(i(311));x.lastRenderedReducer=d;var A=sn,R=A.baseQueue,B=x.pending;if(B!==null){if(R!==null){var G=R.next;R.next=B.next,B.next=G}A.baseQueue=R=B,x.pending=null}if(R!==null){B=R.next,A=A.baseState;var ae=G=null,ce=null,Pe=B;do{var Qe=Pe.lane;if((Qc&Qe)===Qe)ce!==null&&(ce=ce.next={lane:0,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null}),A=Pe.hasEagerState?Pe.eagerState:d(A,Pe.action);else{var Ze={lane:Qe,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null};ce===null?(ae=ce=Ze,G=A):ce=ce.next=Ze,Sr.lanes|=Qe,Kc|=Qe}Pe=Pe.next}while(Pe!==null&&Pe!==B);ce===null?G=A:ce.next=ae,fo(A,p.memoizedState)||(Qs=!0),p.memoizedState=A,p.baseState=G,p.baseQueue=ce,x.lastRenderedState=A}if(d=x.interleaved,d!==null){R=d;do B=R.lane,Sr.lanes|=B,Kc|=B,R=R.next;while(R!==d)}else R===null&&(x.lanes=0);return[p.memoizedState,x.dispatch]}function ZS(d){var p=La(),x=p.queue;if(x===null)throw Error(i(311));x.lastRenderedReducer=d;var A=x.dispatch,R=x.pending,B=p.memoizedState;if(R!==null){x.pending=null;var G=R=R.next;do B=d(B,G.action),G=G.next;while(G!==R);fo(B,p.memoizedState)||(Qs=!0),p.memoizedState=B,p.baseQueue===null&&(p.baseState=B),x.lastRenderedState=B}return[B,A]}function hR(){}function cR(d,p){var x=Sr,A=La(),R=p(),B=!fo(A.memoizedState,R);if(B&&(A.memoizedState=R,Qs=!0),A=A.queue,JS(pR.bind(null,x,A,d),[d]),A.getSnapshot!==p||B||En!==null&&En.memoizedState.tag&1){if(x.flags|=2048,Mg(9,fR.bind(null,x,A,R,p),void 0,null),An===null)throw Error(i(349));(Qc&30)!==0||dR(x,p,R)}return R}function dR(d,p,x){d.flags|=16384,d={getSnapshot:p,value:x},p=Sr.updateQueue,p===null?(p={lastEffect:null,stores:null},Sr.updateQueue=p,p.stores=[d]):(x=p.stores,x===null?p.stores=[d]:x.push(d))}function fR(d,p,x,A){p.value=x,p.getSnapshot=A,mR(p)&&gR(d)}function pR(d,p,x){return x(function(){mR(p)&&gR(d)})}function mR(d){var p=d.getSnapshot;d=d.value;try{var x=p();return!fo(d,x)}catch{return!0}}function gR(d){var p=nu(d,1);p!==null&&yo(p,d,1,-1)}function vR(d){var p=sl();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pg,lastRenderedState:d},p.queue=d,d=d.dispatch=CW.bind(null,Sr,d),[p.memoizedState,d]}function Mg(d,p,x,A){return d={tag:d,create:p,destroy:x,deps:A,next:null},p=Sr.updateQueue,p===null?(p={lastEffect:null,stores:null},Sr.updateQueue=p,p.lastEffect=d.next=d):(x=p.lastEffect,x===null?p.lastEffect=d.next=d:(A=x.next,x.next=d,d.next=A,p.lastEffect=d)),d}function yR(){return La().memoizedState}function K0(d,p,x,A){var R=sl();Sr.flags|=d,R.memoizedState=Mg(1|p,x,void 0,A===void 0?null:A)}function Z0(d,p,x,A){var R=La();A=A===void 0?null:A;var B=void 0;if(sn!==null){var G=sn.memoizedState;if(B=G.destroy,A!==null&&XS(A,G.deps)){R.memoizedState=Mg(p,x,B,A);return}}Sr.flags|=d,R.memoizedState=Mg(1|p,x,B,A)}function xR(d,p){return K0(8390656,8,d,p)}function JS(d,p){return Z0(2048,8,d,p)}function bR(d,p){return Z0(4,2,d,p)}function wR(d,p){return Z0(4,4,d,p)}function _R(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function SR(d,p,x){return x=x!=null?x.concat([d]):null,Z0(4,4,_R.bind(null,p,d),x)}function $S(){}function ER(d,p){var x=La();p=p===void 0?null:p;var A=x.memoizedState;return A!==null&&p!==null&&XS(p,A[1])?A[0]:(x.memoizedState=[d,p],d)}function AR(d,p){var x=La();p=p===void 0?null:p;var A=x.memoizedState;return A!==null&&p!==null&&XS(p,A[1])?A[0]:(d=d(),x.memoizedState=[d,p],d)}function CR(d,p,x){return(Qc&21)===0?(d.baseState&&(d.baseState=!1,Qs=!0),d.memoizedState=x):(fo(x,p)||(x=Bc(),Sr.lanes|=x,Kc|=x,d.baseState=!0),p)}function EW(d,p){var x=Di;Di=x!==0&&4>x?x:4,d(!0);var A=qS.transition;qS.transition={};try{d(!1),p()}finally{Di=x,qS.transition=A}}function TR(){return La().memoizedState}function AW(d,p,x){var A=Sh(d);if(x={lane:A,action:x,hasEagerState:!1,eagerState:null,next:null},PR(d))MR(p,x);else if(x=sR(d,p,x,A),x!==null){var R=Ds();yo(x,d,A,R),DR(x,p,A)}}function CW(d,p,x){var A=Sh(d),R={lane:A,action:x,hasEagerState:!1,eagerState:null,next:null};if(PR(d))MR(p,R);else{var B=d.alternate;if(d.lanes===0&&(B===null||B.lanes===0)&&(B=p.lastRenderedReducer,B!==null))try{var G=p.lastRenderedState,ae=B(G,x);if(R.hasEagerState=!0,R.eagerState=ae,fo(ae,G)){var ce=p.interleaved;ce===null?(R.next=R,US(p)):(R.next=ce.next,ce.next=R),p.interleaved=R;return}}catch{}finally{}x=sR(d,p,R,A),x!==null&&(R=Ds(),yo(x,d,A,R),DR(x,p,A))}}function PR(d){var p=d.alternate;return d===Sr||p!==null&&p===Sr}function MR(d,p){Cg=Q0=!0;var x=d.pending;x===null?p.next=p:(p.next=x.next,x.next=p),d.pending=p}function DR(d,p,x){if((x&4194240)!==0){var A=p.lanes;A&=d.pendingLanes,x|=A,p.lanes=x,lh(d,x)}}var J0={readContext:ka,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useInsertionEffect:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useMutableSource:hs,useSyncExternalStore:hs,useId:hs,unstable_isNewReconciler:!1},TW={readContext:ka,useCallback:function(d,p){return sl().memoizedState=[d,p===void 0?null:p],d},useContext:ka,useEffect:xR,useImperativeHandle:function(d,p,x){return x=x!=null?x.concat([d]):null,K0(4194308,4,_R.bind(null,p,d),x)},useLayoutEffect:function(d,p){return K0(4194308,4,d,p)},useInsertionEffect:function(d,p){return K0(4,2,d,p)},useMemo:function(d,p){var x=sl();return p=p===void 0?null:p,d=d(),x.memoizedState=[d,p],d},useReducer:function(d,p,x){var A=sl();return p=x!==void 0?x(p):p,A.memoizedState=A.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},A.queue=d,d=d.dispatch=AW.bind(null,Sr,d),[A.memoizedState,d]},useRef:function(d){var p=sl();return d={current:d},p.memoizedState=d},useState:vR,useDebugValue:$S,useDeferredValue:function(d){return sl().memoizedState=d},useTransition:function(){var d=vR(!1),p=d[0];return d=EW.bind(null,d[1]),sl().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,x){var A=Sr,R=sl();if(yr){if(x===void 0)throw Error(i(407));x=x()}else{if(x=p(),An===null)throw Error(i(349));(Qc&30)!==0||dR(A,p,x)}R.memoizedState=x;var B={value:x,getSnapshot:p};return R.queue=B,xR(pR.bind(null,A,B,d),[d]),A.flags|=2048,Mg(9,fR.bind(null,A,B,x,p),void 0,null),x},useId:function(){var d=sl(),p=An.identifierPrefix;if(yr){var x=ru,A=iu;x=(A&~(1<<32-le(A)-1)).toString(32)+x,p=":"+p+"R"+x,x=Tg++,0<x&&(p+="H"+x.toString(32)),p+=":"}else x=SW++,p=":"+p+"r"+x.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},PW={readContext:ka,useCallback:ER,useContext:ka,useEffect:JS,useImperativeHandle:SR,useInsertionEffect:bR,useLayoutEffect:wR,useMemo:AR,useReducer:KS,useRef:yR,useState:function(){return KS(Pg)},useDebugValue:$S,useDeferredValue:function(d){var p=La();return CR(p,sn.memoizedState,d)},useTransition:function(){var d=KS(Pg)[0],p=La().memoizedState;return[d,p]},useMutableSource:hR,useSyncExternalStore:cR,useId:TR,unstable_isNewReconciler:!1},MW={readContext:ka,useCallback:ER,useContext:ka,useEffect:JS,useImperativeHandle:SR,useInsertionEffect:bR,useLayoutEffect:wR,useMemo:AR,useReducer:ZS,useRef:yR,useState:function(){return ZS(Pg)},useDebugValue:$S,useDeferredValue:function(d){var p=La();return sn===null?p.memoizedState=d:CR(p,sn.memoizedState,d)},useTransition:function(){var d=ZS(Pg)[0],p=La().memoizedState;return[d,p]},useMutableSource:hR,useSyncExternalStore:cR,useId:TR,unstable_isNewReconciler:!1};function mo(d,p){if(d&&d.defaultProps){p=$({},p),d=d.defaultProps;for(var x in d)p[x]===void 0&&(p[x]=d[x]);return p}return p}function eE(d,p,x,A){p=d.memoizedState,x=x(A,p),x=x==null?p:$({},p,x),d.memoizedState=x,d.lanes===0&&(d.updateQueue.baseState=x)}var $0={isMounted:function(d){return(d=d._reactInternals)?It(d)===d:!1},enqueueSetState:function(d,p,x){d=d._reactInternals;var A=Ds(),R=Sh(d),B=su(A,R);B.payload=p,x!=null&&(B.callback=x),p=xh(d,B,R),p!==null&&(yo(p,d,R,A),W0(p,d,R))},enqueueReplaceState:function(d,p,x){d=d._reactInternals;var A=Ds(),R=Sh(d),B=su(A,R);B.tag=1,B.payload=p,x!=null&&(B.callback=x),p=xh(d,B,R),p!==null&&(yo(p,d,R,A),W0(p,d,R))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var x=Ds(),A=Sh(d),R=su(x,A);R.tag=2,p!=null&&(R.callback=p),p=xh(d,R,A),p!==null&&(yo(p,d,A,x),W0(p,d,A))}};function IR(d,p,x,A,R,B,G){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(A,B,G):p.prototype&&p.prototype.isPureReactComponent?!mg(x,A)||!mg(R,B):!0}function RR(d,p,x){var A=!1,R=gh,B=p.contextType;return typeof B=="object"&&B!==null?B=ka(B):(R=Ys(p)?Gc:us.current,A=p.contextTypes,B=(A=A!=null)?Mf(d,R):gh),p=new p(x,B),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=$0,d.stateNode=p,p._reactInternals=d,A&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=R,d.__reactInternalMemoizedMaskedChildContext=B),p}function OR(d,p,x,A){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(x,A),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(x,A),p.state!==d&&$0.enqueueReplaceState(p,p.state,null)}function tE(d,p,x,A){var R=d.stateNode;R.props=x,R.state=d.memoizedState,R.refs={},VS(d);var B=p.contextType;typeof B=="object"&&B!==null?R.context=ka(B):(B=Ys(p)?Gc:us.current,R.context=Mf(d,B)),R.state=d.memoizedState,B=p.getDerivedStateFromProps,typeof B=="function"&&(eE(d,p,B,x),R.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(p=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),p!==R.state&&$0.enqueueReplaceState(R,R.state,null),q0(d,x,R,A),R.state=d.memoizedState),typeof R.componentDidMount=="function"&&(d.flags|=4194308)}function Nf(d,p){try{var x="",A=p;do x+=he(A),A=A.return;while(A);var R=x}catch(B){R=`
Error generating stack: `+B.message+`
`+B.stack}return{value:d,source:p,stack:R,digest:null}}function iE(d,p,x){return{value:d,source:null,stack:x??null,digest:p??null}}function rE(d,p){try{console.error(p.value)}catch(x){setTimeout(function(){throw x})}}var DW=typeof WeakMap=="function"?WeakMap:Map;function kR(d,p,x){x=su(-1,x),x.tag=3,x.payload={element:null};var A=p.value;return x.callback=function(){a1||(a1=!0,yE=A),rE(d,p)},x}function LR(d,p,x){x=su(-1,x),x.tag=3;var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var R=p.value;x.payload=function(){return A(R)},x.callback=function(){rE(d,p)}}var B=d.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(x.callback=function(){rE(d,p),typeof A!="function"&&(wh===null?wh=new Set([this]):wh.add(this));var G=p.stack;this.componentDidCatch(p.value,{componentStack:G!==null?G:""})}),x}function zR(d,p,x){var A=d.pingCache;if(A===null){A=d.pingCache=new DW;var R=new Set;A.set(p,R)}else R=A.get(p),R===void 0&&(R=new Set,A.set(p,R));R.has(x)||(R.add(x),d=GW.bind(null,d,p,x),p.then(d,d))}function NR(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function BR(d,p,x,A,R){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,x.flags|=131072,x.flags&=-52805,x.tag===1&&(x.alternate===null?x.tag=17:(p=su(-1,1),p.tag=2,xh(x,p,1))),x.lanes|=1),d):(d.flags|=65536,d.lanes=R,d)}var IW=T.ReactCurrentOwner,Qs=!1;function Ms(d,p,x,A){p.child=d===null?nR(p,null,x,A):Of(p,d.child,x,A)}function FR(d,p,x,A,R){x=x.render;var B=p.ref;return Lf(p,R),A=YS(d,p,x,A,B,R),x=QS(),d!==null&&!Qs?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~R,au(d,p,R)):(yr&&x&&IS(p),p.flags|=1,Ms(d,p,A,R),p.child)}function UR(d,p,x,A,R){if(d===null){var B=x.type;return typeof B=="function"&&!AE(B)&&B.defaultProps===void 0&&x.compare===null&&x.defaultProps===void 0?(p.tag=15,p.type=B,VR(d,p,B,A,R)):(d=d1(x.type,null,A,p,p.mode,R),d.ref=p.ref,d.return=p,p.child=d)}if(B=d.child,(d.lanes&R)===0){var G=B.memoizedProps;if(x=x.compare,x=x!==null?x:mg,x(G,A)&&d.ref===p.ref)return au(d,p,R)}return p.flags|=1,d=Ah(B,A),d.ref=p.ref,d.return=p,p.child=d}function VR(d,p,x,A,R){if(d!==null){var B=d.memoizedProps;if(mg(B,A)&&d.ref===p.ref)if(Qs=!1,p.pendingProps=A=B,(d.lanes&R)!==0)(d.flags&131072)!==0&&(Qs=!0);else return p.lanes=d.lanes,au(d,p,R)}return nE(d,p,x,A,R)}function jR(d,p,x){var A=p.pendingProps,R=A.children,B=d!==null?d.memoizedState:null;if(A.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},lr(Ff,Sa),Sa|=x;else{if((x&1073741824)===0)return d=B!==null?B.baseLanes|x:x,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null,transitions:null},p.updateQueue=null,lr(Ff,Sa),Sa|=d,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=B!==null?B.baseLanes:x,lr(Ff,Sa),Sa|=A}else B!==null?(A=B.baseLanes|x,p.memoizedState=null):A=x,lr(Ff,Sa),Sa|=A;return Ms(d,p,R,x),p.child}function HR(d,p){var x=p.ref;(d===null&&x!==null||d!==null&&d.ref!==x)&&(p.flags|=512,p.flags|=2097152)}function nE(d,p,x,A,R){var B=Ys(x)?Gc:us.current;return B=Mf(p,B),Lf(p,R),x=YS(d,p,x,A,B,R),A=QS(),d!==null&&!Qs?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~R,au(d,p,R)):(yr&&A&&IS(p),p.flags|=1,Ms(d,p,x,R),p.child)}function GR(d,p,x,A,R){if(Ys(x)){var B=!0;N0(p)}else B=!1;if(Lf(p,R),p.stateNode===null)t1(d,p),RR(p,x,A),tE(p,x,A,R),A=!0;else if(d===null){var G=p.stateNode,ae=p.memoizedProps;G.props=ae;var ce=G.context,Pe=x.contextType;typeof Pe=="object"&&Pe!==null?Pe=ka(Pe):(Pe=Ys(x)?Gc:us.current,Pe=Mf(p,Pe));var Qe=x.getDerivedStateFromProps,Ze=typeof Qe=="function"||typeof G.getSnapshotBeforeUpdate=="function";Ze||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(ae!==A||ce!==Pe)&&OR(p,G,A,Pe),yh=!1;var Xe=p.memoizedState;G.state=Xe,q0(p,A,G,R),ce=p.memoizedState,ae!==A||Xe!==ce||Xs.current||yh?(typeof Qe=="function"&&(eE(p,x,Qe,A),ce=p.memoizedState),(ae=yh||IR(p,x,ae,A,Xe,ce,Pe))?(Ze||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(p.flags|=4194308)):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=A,p.memoizedState=ce),G.props=A,G.state=ce,G.context=Pe,A=ae):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),A=!1)}else{G=p.stateNode,aR(d,p),ae=p.memoizedProps,Pe=p.type===p.elementType?ae:mo(p.type,ae),G.props=Pe,Ze=p.pendingProps,Xe=G.context,ce=x.contextType,typeof ce=="object"&&ce!==null?ce=ka(ce):(ce=Ys(x)?Gc:us.current,ce=Mf(p,ce));var gt=x.getDerivedStateFromProps;(Qe=typeof gt=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(ae!==Ze||Xe!==ce)&&OR(p,G,A,ce),yh=!1,Xe=p.memoizedState,G.state=Xe,q0(p,A,G,R);var Et=p.memoizedState;ae!==Ze||Xe!==Et||Xs.current||yh?(typeof gt=="function"&&(eE(p,x,gt,A),Et=p.memoizedState),(Pe=yh||IR(p,x,Pe,A,Xe,Et,ce)||!1)?(Qe||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(A,Et,ce),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(A,Et,ce)),typeof G.componentDidUpdate=="function"&&(p.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof G.componentDidUpdate!="function"||ae===d.memoizedProps&&Xe===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ae===d.memoizedProps&&Xe===d.memoizedState||(p.flags|=1024),p.memoizedProps=A,p.memoizedState=Et),G.props=A,G.state=Et,G.context=ce,A=Pe):(typeof G.componentDidUpdate!="function"||ae===d.memoizedProps&&Xe===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ae===d.memoizedProps&&Xe===d.memoizedState||(p.flags|=1024),A=!1)}return sE(d,p,x,A,B,R)}function sE(d,p,x,A,R,B){HR(d,p);var G=(p.flags&128)!==0;if(!A&&!G)return R&&QI(p,x,!1),au(d,p,B);A=p.stateNode,IW.current=p;var ae=G&&typeof x.getDerivedStateFromError!="function"?null:A.render();return p.flags|=1,d!==null&&G?(p.child=Of(p,d.child,null,B),p.child=Of(p,null,ae,B)):Ms(d,p,ae,B),p.memoizedState=A.state,R&&QI(p,x,!0),p.child}function WR(d){var p=d.stateNode;p.pendingContext?XI(d,p.pendingContext,p.pendingContext!==p.context):p.context&&XI(d,p.context,!1),jS(d,p.containerInfo)}function qR(d,p,x,A,R){return Rf(),LS(R),p.flags|=256,Ms(d,p,x,A),p.child}var aE={dehydrated:null,treeContext:null,retryLane:0};function oE(d){return{baseLanes:d,cachePool:null,transitions:null}}function XR(d,p,x){var A=p.pendingProps,R=_r.current,B=!1,G=(p.flags&128)!==0,ae;if((ae=G)||(ae=d!==null&&d.memoizedState===null?!1:(R&2)!==0),ae?(B=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(R|=1),lr(_r,R&1),d===null)return kS(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:d.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(G=A.children,d=A.fallback,B?(A=p.mode,B=p.child,G={mode:"hidden",children:G},(A&1)===0&&B!==null?(B.childLanes=0,B.pendingProps=G):B=f1(G,A,0,null),d=ed(d,A,x,null),B.return=p,d.return=p,B.sibling=d,p.child=B,p.child.memoizedState=oE(x),p.memoizedState=aE,d):lE(p,G));if(R=d.memoizedState,R!==null&&(ae=R.dehydrated,ae!==null))return RW(d,p,G,A,ae,R,x);if(B){B=A.fallback,G=p.mode,R=d.child,ae=R.sibling;var ce={mode:"hidden",children:A.children};return(G&1)===0&&p.child!==R?(A=p.child,A.childLanes=0,A.pendingProps=ce,p.deletions=null):(A=Ah(R,ce),A.subtreeFlags=R.subtreeFlags&14680064),ae!==null?B=Ah(ae,B):(B=ed(B,G,x,null),B.flags|=2),B.return=p,A.return=p,A.sibling=B,p.child=A,A=B,B=p.child,G=d.child.memoizedState,G=G===null?oE(x):{baseLanes:G.baseLanes|x,cachePool:null,transitions:G.transitions},B.memoizedState=G,B.childLanes=d.childLanes&~x,p.memoizedState=aE,A}return B=d.child,d=B.sibling,A=Ah(B,{mode:"visible",children:A.children}),(p.mode&1)===0&&(A.lanes=x),A.return=p,A.sibling=null,d!==null&&(x=p.deletions,x===null?(p.deletions=[d],p.flags|=16):x.push(d)),p.child=A,p.memoizedState=null,A}function lE(d,p){return p=f1({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function e1(d,p,x,A){return A!==null&&LS(A),Of(p,d.child,null,x),d=lE(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function RW(d,p,x,A,R,B,G){if(x)return p.flags&256?(p.flags&=-257,A=iE(Error(i(422))),e1(d,p,G,A)):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(B=A.fallback,R=p.mode,A=f1({mode:"visible",children:A.children},R,0,null),B=ed(B,R,G,null),B.flags|=2,A.return=p,B.return=p,A.sibling=B,p.child=A,(p.mode&1)!==0&&Of(p,d.child,null,G),p.child.memoizedState=oE(G),p.memoizedState=aE,B);if((p.mode&1)===0)return e1(d,p,G,null);if(R.data==="$!"){if(A=R.nextSibling&&R.nextSibling.dataset,A)var ae=A.dgst;return A=ae,B=Error(i(419)),A=iE(B,A,void 0),e1(d,p,G,A)}if(ae=(G&d.childLanes)!==0,Qs||ae){if(A=An,A!==null){switch(G&-G){case 4:R=2;break;case 16:R=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:R=32;break;case 536870912:R=268435456;break;default:R=0}R=(R&(A.suspendedLanes|G))!==0?0:R,R!==0&&R!==B.retryLane&&(B.retryLane=R,nu(d,R),yo(A,d,R,-1))}return EE(),A=iE(Error(i(421))),e1(d,p,G,A)}return R.data==="$?"?(p.flags|=128,p.child=d.child,p=WW.bind(null,d),R._reactRetry=p,null):(d=B.treeContext,_a=ph(R.nextSibling),wa=p,yr=!0,po=null,d!==null&&(Ra[Oa++]=iu,Ra[Oa++]=ru,Ra[Oa++]=Wc,iu=d.id,ru=d.overflow,Wc=p),p=lE(p,A.children),p.flags|=4096,p)}function YR(d,p,x){d.lanes|=p;var A=d.alternate;A!==null&&(A.lanes|=p),FS(d.return,p,x)}function uE(d,p,x,A,R){var B=d.memoizedState;B===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:A,tail:x,tailMode:R}:(B.isBackwards=p,B.rendering=null,B.renderingStartTime=0,B.last=A,B.tail=x,B.tailMode=R)}function QR(d,p,x){var A=p.pendingProps,R=A.revealOrder,B=A.tail;if(Ms(d,p,A.children,x),A=_r.current,(A&2)!==0)A=A&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&YR(d,x,p);else if(d.tag===19)YR(d,x,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}A&=1}if(lr(_r,A),(p.mode&1)===0)p.memoizedState=null;else switch(R){case"forwards":for(x=p.child,R=null;x!==null;)d=x.alternate,d!==null&&X0(d)===null&&(R=x),x=x.sibling;x=R,x===null?(R=p.child,p.child=null):(R=x.sibling,x.sibling=null),uE(p,!1,R,x,B);break;case"backwards":for(x=null,R=p.child,p.child=null;R!==null;){if(d=R.alternate,d!==null&&X0(d)===null){p.child=R;break}d=R.sibling,R.sibling=x,x=R,R=d}uE(p,!0,x,null,B);break;case"together":uE(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function t1(d,p){(p.mode&1)===0&&d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2)}function au(d,p,x){if(d!==null&&(p.dependencies=d.dependencies),Kc|=p.lanes,(x&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(i(153));if(p.child!==null){for(d=p.child,x=Ah(d,d.pendingProps),p.child=x,x.return=p;d.sibling!==null;)d=d.sibling,x=x.sibling=Ah(d,d.pendingProps),x.return=p;x.sibling=null}return p.child}function OW(d,p,x){switch(p.tag){case 3:WR(p),Rf();break;case 5:uR(p);break;case 1:Ys(p.type)&&N0(p);break;case 4:jS(p,p.stateNode.containerInfo);break;case 10:var A=p.type._context,R=p.memoizedProps.value;lr(H0,A._currentValue),A._currentValue=R;break;case 13:if(A=p.memoizedState,A!==null)return A.dehydrated!==null?(lr(_r,_r.current&1),p.flags|=128,null):(x&p.child.childLanes)!==0?XR(d,p,x):(lr(_r,_r.current&1),d=au(d,p,x),d!==null?d.sibling:null);lr(_r,_r.current&1);break;case 19:if(A=(x&p.childLanes)!==0,(d.flags&128)!==0){if(A)return QR(d,p,x);p.flags|=128}if(R=p.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),lr(_r,_r.current),A)break;return null;case 22:case 23:return p.lanes=0,jR(d,p,x)}return au(d,p,x)}var KR,hE,ZR,JR;KR=function(d,p){for(var x=p.child;x!==null;){if(x.tag===5||x.tag===6)d.appendChild(x.stateNode);else if(x.tag!==4&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===p)break;for(;x.sibling===null;){if(x.return===null||x.return===p)return;x=x.return}x.sibling.return=x.return,x=x.sibling}},hE=function(){},ZR=function(d,p,x,A){var R=d.memoizedProps;if(R!==A){d=p.stateNode,Yc(nl.current);var B=null;switch(x){case"input":R=st(d,R),A=st(d,A),B=[];break;case"select":R=$({},R,{value:void 0}),A=$({},A,{value:void 0}),B=[];break;case"textarea":R=re(d,R),A=re(d,A),B=[];break;default:typeof R.onClick!="function"&&typeof A.onClick=="function"&&(d.onclick=k0)}Pt(x,A);var G;x=null;for(Pe in R)if(!A.hasOwnProperty(Pe)&&R.hasOwnProperty(Pe)&&R[Pe]!=null)if(Pe==="style"){var ae=R[Pe];for(G in ae)ae.hasOwnProperty(G)&&(x||(x={}),x[G]="")}else Pe!=="dangerouslySetInnerHTML"&&Pe!=="children"&&Pe!=="suppressContentEditableWarning"&&Pe!=="suppressHydrationWarning"&&Pe!=="autoFocus"&&(n.hasOwnProperty(Pe)?B||(B=[]):(B=B||[]).push(Pe,null));for(Pe in A){var ce=A[Pe];if(ae=R!=null?R[Pe]:void 0,A.hasOwnProperty(Pe)&&ce!==ae&&(ce!=null||ae!=null))if(Pe==="style")if(ae){for(G in ae)!ae.hasOwnProperty(G)||ce&&ce.hasOwnProperty(G)||(x||(x={}),x[G]="");for(G in ce)ce.hasOwnProperty(G)&&ae[G]!==ce[G]&&(x||(x={}),x[G]=ce[G])}else x||(B||(B=[]),B.push(Pe,x)),x=ce;else Pe==="dangerouslySetInnerHTML"?(ce=ce?ce.__html:void 0,ae=ae?ae.__html:void 0,ce!=null&&ae!==ce&&(B=B||[]).push(Pe,ce)):Pe==="children"?typeof ce!="string"&&typeof ce!="number"||(B=B||[]).push(Pe,""+ce):Pe!=="suppressContentEditableWarning"&&Pe!=="suppressHydrationWarning"&&(n.hasOwnProperty(Pe)?(ce!=null&&Pe==="onScroll"&&fr("scroll",d),B||ae===ce||(B=[])):(B=B||[]).push(Pe,ce))}x&&(B=B||[]).push("style",x);var Pe=B;(p.updateQueue=Pe)&&(p.flags|=4)}},JR=function(d,p,x,A){x!==A&&(p.flags|=4)};function Dg(d,p){if(!yr)switch(d.tailMode){case"hidden":p=d.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?d.tail=null:x.sibling=null;break;case"collapsed":x=d.tail;for(var A=null;x!==null;)x.alternate!==null&&(A=x),x=x.sibling;A===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:A.sibling=null}}function cs(d){var p=d.alternate!==null&&d.alternate.child===d.child,x=0,A=0;if(p)for(var R=d.child;R!==null;)x|=R.lanes|R.childLanes,A|=R.subtreeFlags&14680064,A|=R.flags&14680064,R.return=d,R=R.sibling;else for(R=d.child;R!==null;)x|=R.lanes|R.childLanes,A|=R.subtreeFlags,A|=R.flags,R.return=d,R=R.sibling;return d.subtreeFlags|=A,d.childLanes=x,p}function kW(d,p,x){var A=p.pendingProps;switch(RS(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cs(p),null;case 1:return Ys(p.type)&&z0(),cs(p),null;case 3:return A=p.stateNode,zf(),pr(Xs),pr(us),WS(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(V0(p)?p.flags|=4:d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,po!==null&&(wE(po),po=null))),hE(d,p),cs(p),null;case 5:HS(p);var R=Yc(Ag.current);if(x=p.type,d!==null&&p.stateNode!=null)ZR(d,p,x,A,R),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!A){if(p.stateNode===null)throw Error(i(166));return cs(p),null}if(d=Yc(nl.current),V0(p)){A=p.stateNode,x=p.type;var B=p.memoizedProps;switch(A[rl]=p,A[bg]=B,d=(p.mode&1)!==0,x){case"dialog":fr("cancel",A),fr("close",A);break;case"iframe":case"object":case"embed":fr("load",A);break;case"video":case"audio":for(R=0;R<vg.length;R++)fr(vg[R],A);break;case"source":fr("error",A);break;case"img":case"image":case"link":fr("error",A),fr("load",A);break;case"details":fr("toggle",A);break;case"input":We(A,B),fr("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!B.multiple},fr("invalid",A);break;case"textarea":Y(A,B),fr("invalid",A)}Pt(x,B),R=null;for(var G in B)if(B.hasOwnProperty(G)){var ae=B[G];G==="children"?typeof ae=="string"?A.textContent!==ae&&(B.suppressHydrationWarning!==!0&&O0(A.textContent,ae,d),R=["children",ae]):typeof ae=="number"&&A.textContent!==""+ae&&(B.suppressHydrationWarning!==!0&&O0(A.textContent,ae,d),R=["children",""+ae]):n.hasOwnProperty(G)&&ae!=null&&G==="onScroll"&&fr("scroll",A)}switch(x){case"input":Te(A),Ke(A,B,!0);break;case"textarea":Te(A),Ve(A);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(A.onclick=k0)}A=R,p.updateQueue=A,A!==null&&(p.flags|=4)}else{G=R.nodeType===9?R:R.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=W(x)),d==="http://www.w3.org/1999/xhtml"?x==="script"?(d=G.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof A.is=="string"?d=G.createElement(x,{is:A.is}):(d=G.createElement(x),x==="select"&&(G=d,A.multiple?G.multiple=!0:A.size&&(G.size=A.size))):d=G.createElementNS(d,x),d[rl]=p,d[bg]=A,KR(d,p,!1,!1),p.stateNode=d;e:{switch(G=Oi(x,A),x){case"dialog":fr("cancel",d),fr("close",d),R=A;break;case"iframe":case"object":case"embed":fr("load",d),R=A;break;case"video":case"audio":for(R=0;R<vg.length;R++)fr(vg[R],d);R=A;break;case"source":fr("error",d),R=A;break;case"img":case"image":case"link":fr("error",d),fr("load",d),R=A;break;case"details":fr("toggle",d),R=A;break;case"input":We(d,A),R=st(d,A),fr("invalid",d);break;case"option":R=A;break;case"select":d._wrapperState={wasMultiple:!!A.multiple},R=$({},A,{value:void 0}),fr("invalid",d);break;case"textarea":Y(d,A),R=re(d,A),fr("invalid",d);break;default:R=A}Pt(x,R),ae=R;for(B in ae)if(ae.hasOwnProperty(B)){var ce=ae[B];B==="style"?Dt(d,ce):B==="dangerouslySetInnerHTML"?(ce=ce?ce.__html:void 0,ce!=null&&it(d,ce)):B==="children"?typeof ce=="string"?(x!=="textarea"||ce!=="")&&De(d,ce):typeof ce=="number"&&De(d,""+ce):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(n.hasOwnProperty(B)?ce!=null&&B==="onScroll"&&fr("scroll",d):ce!=null&&_(d,B,ce,G))}switch(x){case"input":Te(d),Ke(d,A,!1);break;case"textarea":Te(d),Ve(d);break;case"option":A.value!=null&&d.setAttribute("value",""+de(A.value));break;case"select":d.multiple=!!A.multiple,B=A.value,B!=null?pt(d,!!A.multiple,B,!1):A.defaultValue!=null&&pt(d,!!A.multiple,A.defaultValue,!0);break;default:typeof R.onClick=="function"&&(d.onclick=k0)}switch(x){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return cs(p),null;case 6:if(d&&p.stateNode!=null)JR(d,p,d.memoizedProps,A);else{if(typeof A!="string"&&p.stateNode===null)throw Error(i(166));if(x=Yc(Ag.current),Yc(nl.current),V0(p)){if(A=p.stateNode,x=p.memoizedProps,A[rl]=p,(B=A.nodeValue!==x)&&(d=wa,d!==null))switch(d.tag){case 3:O0(A.nodeValue,x,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&O0(A.nodeValue,x,(d.mode&1)!==0)}B&&(p.flags|=4)}else A=(x.nodeType===9?x:x.ownerDocument).createTextNode(A),A[rl]=p,p.stateNode=A}return cs(p),null;case 13:if(pr(_r),A=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(yr&&_a!==null&&(p.mode&1)!==0&&(p.flags&128)===0)tR(),Rf(),p.flags|=98560,B=!1;else if(B=V0(p),A!==null&&A.dehydrated!==null){if(d===null){if(!B)throw Error(i(318));if(B=p.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(i(317));B[rl]=p}else Rf(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;cs(p),B=!1}else po!==null&&(wE(po),po=null),B=!0;if(!B)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=x,p):(A=A!==null,A!==(d!==null&&d.memoizedState!==null)&&A&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(_r.current&1)!==0?an===0&&(an=3):EE())),p.updateQueue!==null&&(p.flags|=4),cs(p),null);case 4:return zf(),hE(d,p),d===null&&yg(p.stateNode.containerInfo),cs(p),null;case 10:return BS(p.type._context),cs(p),null;case 17:return Ys(p.type)&&z0(),cs(p),null;case 19:if(pr(_r),B=p.memoizedState,B===null)return cs(p),null;if(A=(p.flags&128)!==0,G=B.rendering,G===null)if(A)Dg(B,!1);else{if(an!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(G=X0(d),G!==null){for(p.flags|=128,Dg(B,!1),A=G.updateQueue,A!==null&&(p.updateQueue=A,p.flags|=4),p.subtreeFlags=0,A=x,x=p.child;x!==null;)B=x,d=A,B.flags&=14680066,G=B.alternate,G===null?(B.childLanes=0,B.lanes=d,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=G.childLanes,B.lanes=G.lanes,B.child=G.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=G.memoizedProps,B.memoizedState=G.memoizedState,B.updateQueue=G.updateQueue,B.type=G.type,d=G.dependencies,B.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),x=x.sibling;return lr(_r,_r.current&1|2),p.child}d=d.sibling}B.tail!==null&&Zt()>Uf&&(p.flags|=128,A=!0,Dg(B,!1),p.lanes=4194304)}else{if(!A)if(d=X0(G),d!==null){if(p.flags|=128,A=!0,x=d.updateQueue,x!==null&&(p.updateQueue=x,p.flags|=4),Dg(B,!0),B.tail===null&&B.tailMode==="hidden"&&!G.alternate&&!yr)return cs(p),null}else 2*Zt()-B.renderingStartTime>Uf&&x!==1073741824&&(p.flags|=128,A=!0,Dg(B,!1),p.lanes=4194304);B.isBackwards?(G.sibling=p.child,p.child=G):(x=B.last,x!==null?x.sibling=G:p.child=G,B.last=G)}return B.tail!==null?(p=B.tail,B.rendering=p,B.tail=p.sibling,B.renderingStartTime=Zt(),p.sibling=null,x=_r.current,lr(_r,A?x&1|2:x&1),p):(cs(p),null);case 22:case 23:return SE(),A=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==A&&(p.flags|=8192),A&&(p.mode&1)!==0?(Sa&1073741824)!==0&&(cs(p),p.subtreeFlags&6&&(p.flags|=8192)):cs(p),null;case 24:return null;case 25:return null}throw Error(i(156,p.tag))}function LW(d,p){switch(RS(p),p.tag){case 1:return Ys(p.type)&&z0(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return zf(),pr(Xs),pr(us),WS(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return HS(p),null;case 13:if(pr(_r),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(i(340));Rf()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return pr(_r),null;case 4:return zf(),null;case 10:return BS(p.type._context),null;case 22:case 23:return SE(),null;case 24:return null;default:return null}}var i1=!1,ds=!1,zW=typeof WeakSet=="function"?WeakSet:Set,_t=null;function Bf(d,p){var x=d.ref;if(x!==null)if(typeof x=="function")try{x(null)}catch(A){Pr(d,p,A)}else x.current=null}function cE(d,p,x){try{x()}catch(A){Pr(d,p,A)}}var $R=!1;function NW(d,p){if(SS=ch,d=II(),mS(d)){if("selectionStart"in d)var x={start:d.selectionStart,end:d.selectionEnd};else e:{x=(x=d.ownerDocument)&&x.defaultView||window;var A=x.getSelection&&x.getSelection();if(A&&A.rangeCount!==0){x=A.anchorNode;var R=A.anchorOffset,B=A.focusNode;A=A.focusOffset;try{x.nodeType,B.nodeType}catch{x=null;break e}var G=0,ae=-1,ce=-1,Pe=0,Qe=0,Ze=d,Xe=null;t:for(;;){for(var gt;Ze!==x||R!==0&&Ze.nodeType!==3||(ae=G+R),Ze!==B||A!==0&&Ze.nodeType!==3||(ce=G+A),Ze.nodeType===3&&(G+=Ze.nodeValue.length),(gt=Ze.firstChild)!==null;)Xe=Ze,Ze=gt;for(;;){if(Ze===d)break t;if(Xe===x&&++Pe===R&&(ae=G),Xe===B&&++Qe===A&&(ce=G),(gt=Ze.nextSibling)!==null)break;Ze=Xe,Xe=Ze.parentNode}Ze=gt}x=ae===-1||ce===-1?null:{start:ae,end:ce}}else x=null}x=x||{start:0,end:0}}else x=null;for(ES={focusedElem:d,selectionRange:x},ch=!1,_t=p;_t!==null;)if(p=_t,d=p.child,(p.subtreeFlags&1028)!==0&&d!==null)d.return=p,_t=d;else for(;_t!==null;){p=_t;try{var Et=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(Et!==null){var Tt=Et.memoizedProps,Lr=Et.memoizedState,_e=p.stateNode,ge=_e.getSnapshotBeforeUpdate(p.elementType===p.type?Tt:mo(p.type,Tt),Lr);_e.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Ce=p.stateNode.containerInfo;Ce.nodeType===1?Ce.textContent="":Ce.nodeType===9&&Ce.documentElement&&Ce.removeChild(Ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch($e){Pr(p,p.return,$e)}if(d=p.sibling,d!==null){d.return=p.return,_t=d;break}_t=p.return}return Et=$R,$R=!1,Et}function Ig(d,p,x){var A=p.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var R=A=A.next;do{if((R.tag&d)===d){var B=R.destroy;R.destroy=void 0,B!==void 0&&cE(p,x,B)}R=R.next}while(R!==A)}}function r1(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var x=p=p.next;do{if((x.tag&d)===d){var A=x.create;x.destroy=A()}x=x.next}while(x!==p)}}function dE(d){var p=d.ref;if(p!==null){var x=d.stateNode;switch(d.tag){case 5:d=x;break;default:d=x}typeof p=="function"?p(d):p.current=d}}function eO(d){var p=d.alternate;p!==null&&(d.alternate=null,eO(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&(delete p[rl],delete p[bg],delete p[PS],delete p[xW],delete p[bW])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function tO(d){return d.tag===5||d.tag===3||d.tag===4}function iO(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||tO(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function fE(d,p,x){var A=d.tag;if(A===5||A===6)d=d.stateNode,p?x.nodeType===8?x.parentNode.insertBefore(d,p):x.insertBefore(d,p):(x.nodeType===8?(p=x.parentNode,p.insertBefore(d,x)):(p=x,p.appendChild(d)),x=x._reactRootContainer,x!=null||p.onclick!==null||(p.onclick=k0));else if(A!==4&&(d=d.child,d!==null))for(fE(d,p,x),d=d.sibling;d!==null;)fE(d,p,x),d=d.sibling}function pE(d,p,x){var A=d.tag;if(A===5||A===6)d=d.stateNode,p?x.insertBefore(d,p):x.appendChild(d);else if(A!==4&&(d=d.child,d!==null))for(pE(d,p,x),d=d.sibling;d!==null;)pE(d,p,x),d=d.sibling}var Gn=null,go=!1;function bh(d,p,x){for(x=x.child;x!==null;)rO(d,p,x),x=x.sibling}function rO(d,p,x){if(j&&typeof j.onCommitFiberUnmount=="function")try{j.onCommitFiberUnmount(_n,x)}catch{}switch(x.tag){case 5:ds||Bf(x,p);case 6:var A=Gn,R=go;Gn=null,bh(d,p,x),Gn=A,go=R,Gn!==null&&(go?(d=Gn,x=x.stateNode,d.nodeType===8?d.parentNode.removeChild(x):d.removeChild(x)):Gn.removeChild(x.stateNode));break;case 18:Gn!==null&&(go?(d=Gn,x=x.stateNode,d.nodeType===8?TS(d.parentNode,x):d.nodeType===1&&TS(d,x),ho(d)):TS(Gn,x.stateNode));break;case 4:A=Gn,R=go,Gn=x.stateNode.containerInfo,go=!0,bh(d,p,x),Gn=A,go=R;break;case 0:case 11:case 14:case 15:if(!ds&&(A=x.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){R=A=A.next;do{var B=R,G=B.destroy;B=B.tag,G!==void 0&&((B&2)!==0||(B&4)!==0)&&cE(x,p,G),R=R.next}while(R!==A)}bh(d,p,x);break;case 1:if(!ds&&(Bf(x,p),A=x.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=x.memoizedProps,A.state=x.memoizedState,A.componentWillUnmount()}catch(ae){Pr(x,p,ae)}bh(d,p,x);break;case 21:bh(d,p,x);break;case 22:x.mode&1?(ds=(A=ds)||x.memoizedState!==null,bh(d,p,x),ds=A):bh(d,p,x);break;default:bh(d,p,x)}}function nO(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var x=d.stateNode;x===null&&(x=d.stateNode=new zW),p.forEach(function(A){var R=qW.bind(null,d,A);x.has(A)||(x.add(A),A.then(R,R))})}}function vo(d,p){var x=p.deletions;if(x!==null)for(var A=0;A<x.length;A++){var R=x[A];try{var B=d,G=p,ae=G;e:for(;ae!==null;){switch(ae.tag){case 5:Gn=ae.stateNode,go=!1;break e;case 3:Gn=ae.stateNode.containerInfo,go=!0;break e;case 4:Gn=ae.stateNode.containerInfo,go=!0;break e}ae=ae.return}if(Gn===null)throw Error(i(160));rO(B,G,R),Gn=null,go=!1;var ce=R.alternate;ce!==null&&(ce.return=null),R.return=null}catch(Pe){Pr(R,p,Pe)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)sO(p,d),p=p.sibling}function sO(d,p){var x=d.alternate,A=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(vo(p,d),al(d),A&4){try{Ig(3,d,d.return),r1(3,d)}catch(Tt){Pr(d,d.return,Tt)}try{Ig(5,d,d.return)}catch(Tt){Pr(d,d.return,Tt)}}break;case 1:vo(p,d),al(d),A&512&&x!==null&&Bf(x,x.return);break;case 5:if(vo(p,d),al(d),A&512&&x!==null&&Bf(x,x.return),d.flags&32){var R=d.stateNode;try{De(R,"")}catch(Tt){Pr(d,d.return,Tt)}}if(A&4&&(R=d.stateNode,R!=null)){var B=d.memoizedProps,G=x!==null?x.memoizedProps:B,ae=d.type,ce=d.updateQueue;if(d.updateQueue=null,ce!==null)try{ae==="input"&&B.type==="radio"&&B.name!=null&&ct(R,B),Oi(ae,G);var Pe=Oi(ae,B);for(G=0;G<ce.length;G+=2){var Qe=ce[G],Ze=ce[G+1];Qe==="style"?Dt(R,Ze):Qe==="dangerouslySetInnerHTML"?it(R,Ze):Qe==="children"?De(R,Ze):_(R,Qe,Ze,Pe)}switch(ae){case"input":ut(R,B);break;case"textarea":Ee(R,B);break;case"select":var Xe=R._wrapperState.wasMultiple;R._wrapperState.wasMultiple=!!B.multiple;var gt=B.value;gt!=null?pt(R,!!B.multiple,gt,!1):Xe!==!!B.multiple&&(B.defaultValue!=null?pt(R,!!B.multiple,B.defaultValue,!0):pt(R,!!B.multiple,B.multiple?[]:"",!1))}R[bg]=B}catch(Tt){Pr(d,d.return,Tt)}}break;case 6:if(vo(p,d),al(d),A&4){if(d.stateNode===null)throw Error(i(162));R=d.stateNode,B=d.memoizedProps;try{R.nodeValue=B}catch(Tt){Pr(d,d.return,Tt)}}break;case 3:if(vo(p,d),al(d),A&4&&x!==null&&x.memoizedState.isDehydrated)try{ho(p.containerInfo)}catch(Tt){Pr(d,d.return,Tt)}break;case 4:vo(p,d),al(d);break;case 13:vo(p,d),al(d),R=d.child,R.flags&8192&&(B=R.memoizedState!==null,R.stateNode.isHidden=B,!B||R.alternate!==null&&R.alternate.memoizedState!==null||(vE=Zt())),A&4&&nO(d);break;case 22:if(Qe=x!==null&&x.memoizedState!==null,d.mode&1?(ds=(Pe=ds)||Qe,vo(p,d),ds=Pe):vo(p,d),al(d),A&8192){if(Pe=d.memoizedState!==null,(d.stateNode.isHidden=Pe)&&!Qe&&(d.mode&1)!==0)for(_t=d,Qe=d.child;Qe!==null;){for(Ze=_t=Qe;_t!==null;){switch(Xe=_t,gt=Xe.child,Xe.tag){case 0:case 11:case 14:case 15:Ig(4,Xe,Xe.return);break;case 1:Bf(Xe,Xe.return);var Et=Xe.stateNode;if(typeof Et.componentWillUnmount=="function"){A=Xe,x=Xe.return;try{p=A,Et.props=p.memoizedProps,Et.state=p.memoizedState,Et.componentWillUnmount()}catch(Tt){Pr(A,x,Tt)}}break;case 5:Bf(Xe,Xe.return);break;case 22:if(Xe.memoizedState!==null){lO(Ze);continue}}gt!==null?(gt.return=Xe,_t=gt):lO(Ze)}Qe=Qe.sibling}e:for(Qe=null,Ze=d;;){if(Ze.tag===5){if(Qe===null){Qe=Ze;try{R=Ze.stateNode,Pe?(B=R.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(ae=Ze.stateNode,ce=Ze.memoizedProps.style,G=ce!=null&&ce.hasOwnProperty("display")?ce.display:null,ae.style.display=bt("display",G))}catch(Tt){Pr(d,d.return,Tt)}}}else if(Ze.tag===6){if(Qe===null)try{Ze.stateNode.nodeValue=Pe?"":Ze.memoizedProps}catch(Tt){Pr(d,d.return,Tt)}}else if((Ze.tag!==22&&Ze.tag!==23||Ze.memoizedState===null||Ze===d)&&Ze.child!==null){Ze.child.return=Ze,Ze=Ze.child;continue}if(Ze===d)break e;for(;Ze.sibling===null;){if(Ze.return===null||Ze.return===d)break e;Qe===Ze&&(Qe=null),Ze=Ze.return}Qe===Ze&&(Qe=null),Ze.sibling.return=Ze.return,Ze=Ze.sibling}}break;case 19:vo(p,d),al(d),A&4&&nO(d);break;case 21:break;default:vo(p,d),al(d)}}function al(d){var p=d.flags;if(p&2){try{e:{for(var x=d.return;x!==null;){if(tO(x)){var A=x;break e}x=x.return}throw Error(i(160))}switch(A.tag){case 5:var R=A.stateNode;A.flags&32&&(De(R,""),A.flags&=-33);var B=iO(d);pE(d,B,R);break;case 3:case 4:var G=A.stateNode.containerInfo,ae=iO(d);fE(d,ae,G);break;default:throw Error(i(161))}}catch(ce){Pr(d,d.return,ce)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function BW(d,p,x){_t=d,aO(d)}function aO(d,p,x){for(var A=(d.mode&1)!==0;_t!==null;){var R=_t,B=R.child;if(R.tag===22&&A){var G=R.memoizedState!==null||i1;if(!G){var ae=R.alternate,ce=ae!==null&&ae.memoizedState!==null||ds;ae=i1;var Pe=ds;if(i1=G,(ds=ce)&&!Pe)for(_t=R;_t!==null;)G=_t,ce=G.child,G.tag===22&&G.memoizedState!==null?uO(R):ce!==null?(ce.return=G,_t=ce):uO(R);for(;B!==null;)_t=B,aO(B),B=B.sibling;_t=R,i1=ae,ds=Pe}oO(d)}else(R.subtreeFlags&8772)!==0&&B!==null?(B.return=R,_t=B):oO(d)}}function oO(d){for(;_t!==null;){var p=_t;if((p.flags&8772)!==0){var x=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:ds||r1(5,p);break;case 1:var A=p.stateNode;if(p.flags&4&&!ds)if(x===null)A.componentDidMount();else{var R=p.elementType===p.type?x.memoizedProps:mo(p.type,x.memoizedProps);A.componentDidUpdate(R,x.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var B=p.updateQueue;B!==null&&lR(p,B,A);break;case 3:var G=p.updateQueue;if(G!==null){if(x=null,p.child!==null)switch(p.child.tag){case 5:x=p.child.stateNode;break;case 1:x=p.child.stateNode}lR(p,G,x)}break;case 5:var ae=p.stateNode;if(x===null&&p.flags&4){x=ae;var ce=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":ce.autoFocus&&x.focus();break;case"img":ce.src&&(x.src=ce.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var Pe=p.alternate;if(Pe!==null){var Qe=Pe.memoizedState;if(Qe!==null){var Ze=Qe.dehydrated;Ze!==null&&ho(Ze)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}ds||p.flags&512&&dE(p)}catch(Xe){Pr(p,p.return,Xe)}}if(p===d){_t=null;break}if(x=p.sibling,x!==null){x.return=p.return,_t=x;break}_t=p.return}}function lO(d){for(;_t!==null;){var p=_t;if(p===d){_t=null;break}var x=p.sibling;if(x!==null){x.return=p.return,_t=x;break}_t=p.return}}function uO(d){for(;_t!==null;){var p=_t;try{switch(p.tag){case 0:case 11:case 15:var x=p.return;try{r1(4,p)}catch(ce){Pr(p,x,ce)}break;case 1:var A=p.stateNode;if(typeof A.componentDidMount=="function"){var R=p.return;try{A.componentDidMount()}catch(ce){Pr(p,R,ce)}}var B=p.return;try{dE(p)}catch(ce){Pr(p,B,ce)}break;case 5:var G=p.return;try{dE(p)}catch(ce){Pr(p,G,ce)}}}catch(ce){Pr(p,p.return,ce)}if(p===d){_t=null;break}var ae=p.sibling;if(ae!==null){ae.return=p.return,_t=ae;break}_t=p.return}}var FW=Math.ceil,n1=T.ReactCurrentDispatcher,mE=T.ReactCurrentOwner,za=T.ReactCurrentBatchConfig,Bi=0,An=null,Wr=null,Wn=0,Sa=0,Ff=mh(0),an=0,Rg=null,Kc=0,s1=0,gE=0,Og=null,Ks=null,vE=0,Uf=1/0,ou=null,a1=!1,yE=null,wh=null,o1=!1,_h=null,l1=0,kg=0,xE=null,u1=-1,h1=0;function Ds(){return(Bi&6)!==0?Zt():u1!==-1?u1:u1=Zt()}function Sh(d){return(d.mode&1)===0?1:(Bi&2)!==0&&Wn!==0?Wn&-Wn:_W.transition!==null?(h1===0&&(h1=Bc()),h1):(d=Di,d!==0||(d=window.event,d=d===void 0?16:lg(d.type)),d)}function yo(d,p,x,A){if(50<kg)throw kg=0,xE=null,Error(i(185));oh(d,x,A),((Bi&2)===0||d!==An)&&(d===An&&((Bi&2)===0&&(s1|=x),an===4&&Eh(d,Wn)),Zs(d,A),x===1&&Bi===0&&(p.mode&1)===0&&(Uf=Zt()+500,B0&&vh()))}function Zs(d,p){var x=d.callbackNode;va(d,p);var A=ao(d,d===An?Wn:0);if(A===0)x!==null&&dr(x),d.callbackNode=null,d.callbackPriority=0;else if(p=A&-A,d.callbackPriority!==p){if(x!=null&&dr(x),p===1)d.tag===0?wW(cO.bind(null,d)):KI(cO.bind(null,d)),vW(function(){(Bi&6)===0&&vh()}),x=null;else{switch(uh(A)){case 1:x=rn;break;case 4:x=$t;break;case 16:x=Tr;break;case 536870912:x=ma;break;default:x=Tr}x=xO(x,hO.bind(null,d))}d.callbackPriority=p,d.callbackNode=x}}function hO(d,p){if(u1=-1,h1=0,(Bi&6)!==0)throw Error(i(327));var x=d.callbackNode;if(Vf()&&d.callbackNode!==x)return null;var A=ao(d,d===An?Wn:0);if(A===0)return null;if((A&30)!==0||(A&d.expiredLanes)!==0||p)p=c1(d,A);else{p=A;var R=Bi;Bi|=2;var B=fO();(An!==d||Wn!==p)&&(ou=null,Uf=Zt()+500,Jc(d,p));do try{jW();break}catch(ae){dO(d,ae)}while(!0);NS(),n1.current=B,Bi=R,Wr!==null?p=0:(An=null,Wn=0,p=an)}if(p!==0){if(p===2&&(R=ya(d),R!==0&&(A=R,p=bE(d,R))),p===1)throw x=Rg,Jc(d,0),Eh(d,A),Zs(d,Zt()),x;if(p===6)Eh(d,A);else{if(R=d.current.alternate,(A&30)===0&&!UW(R)&&(p=c1(d,A),p===2&&(B=ya(d),B!==0&&(A=B,p=bE(d,B))),p===1))throw x=Rg,Jc(d,0),Eh(d,A),Zs(d,Zt()),x;switch(d.finishedWork=R,d.finishedLanes=A,p){case 0:case 1:throw Error(i(345));case 2:$c(d,Ks,ou);break;case 3:if(Eh(d,A),(A&130023424)===A&&(p=vE+500-Zt(),10<p)){if(ao(d,0)!==0)break;if(R=d.suspendedLanes,(R&A)!==A){Ds(),d.pingedLanes|=d.suspendedLanes&R;break}d.timeoutHandle=CS($c.bind(null,d,Ks,ou),p);break}$c(d,Ks,ou);break;case 4:if(Eh(d,A),(A&4194240)===A)break;for(p=d.eventTimes,R=-1;0<A;){var G=31-le(A);B=1<<G,G=p[G],G>R&&(R=G),A&=~B}if(A=R,A=Zt()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*FW(A/1960))-A,10<A){d.timeoutHandle=CS($c.bind(null,d,Ks,ou),A);break}$c(d,Ks,ou);break;case 5:$c(d,Ks,ou);break;default:throw Error(i(329))}}}return Zs(d,Zt()),d.callbackNode===x?hO.bind(null,d):null}function bE(d,p){var x=Og;return d.current.memoizedState.isDehydrated&&(Jc(d,p).flags|=256),d=c1(d,p),d!==2&&(p=Ks,Ks=x,p!==null&&wE(p)),d}function wE(d){Ks===null?Ks=d:Ks.push.apply(Ks,d)}function UW(d){for(var p=d;;){if(p.flags&16384){var x=p.updateQueue;if(x!==null&&(x=x.stores,x!==null))for(var A=0;A<x.length;A++){var R=x[A],B=R.getSnapshot;R=R.value;try{if(!fo(B(),R))return!1}catch{return!1}}}if(x=p.child,p.subtreeFlags&16384&&x!==null)x.return=p,p=x;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Eh(d,p){for(p&=~gE,p&=~s1,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var x=31-le(p),A=1<<x;d[x]=-1,p&=~A}}function cO(d){if((Bi&6)!==0)throw Error(i(327));Vf();var p=ao(d,0);if((p&1)===0)return Zs(d,Zt()),null;var x=c1(d,p);if(d.tag!==0&&x===2){var A=ya(d);A!==0&&(p=A,x=bE(d,A))}if(x===1)throw x=Rg,Jc(d,0),Eh(d,p),Zs(d,Zt()),x;if(x===6)throw Error(i(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,$c(d,Ks,ou),Zs(d,Zt()),null}function _E(d,p){var x=Bi;Bi|=1;try{return d(p)}finally{Bi=x,Bi===0&&(Uf=Zt()+500,B0&&vh())}}function Zc(d){_h!==null&&_h.tag===0&&(Bi&6)===0&&Vf();var p=Bi;Bi|=1;var x=za.transition,A=Di;try{if(za.transition=null,Di=1,d)return d()}finally{Di=A,za.transition=x,Bi=p,(Bi&6)===0&&vh()}}function SE(){Sa=Ff.current,pr(Ff)}function Jc(d,p){d.finishedWork=null,d.finishedLanes=0;var x=d.timeoutHandle;if(x!==-1&&(d.timeoutHandle=-1,gW(x)),Wr!==null)for(x=Wr.return;x!==null;){var A=x;switch(RS(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&z0();break;case 3:zf(),pr(Xs),pr(us),WS();break;case 5:HS(A);break;case 4:zf();break;case 13:pr(_r);break;case 19:pr(_r);break;case 10:BS(A.type._context);break;case 22:case 23:SE()}x=x.return}if(An=d,Wr=d=Ah(d.current,null),Wn=Sa=p,an=0,Rg=null,gE=s1=Kc=0,Ks=Og=null,Xc!==null){for(p=0;p<Xc.length;p++)if(x=Xc[p],A=x.interleaved,A!==null){x.interleaved=null;var R=A.next,B=x.pending;if(B!==null){var G=B.next;B.next=R,A.next=G}x.pending=A}Xc=null}return d}function dO(d,p){do{var x=Wr;try{if(NS(),Y0.current=J0,Q0){for(var A=Sr.memoizedState;A!==null;){var R=A.queue;R!==null&&(R.pending=null),A=A.next}Q0=!1}if(Qc=0,En=sn=Sr=null,Cg=!1,Tg=0,mE.current=null,x===null||x.return===null){an=1,Rg=p,Wr=null;break}e:{var B=d,G=x.return,ae=x,ce=p;if(p=Wn,ae.flags|=32768,ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Pe=ce,Qe=ae,Ze=Qe.tag;if((Qe.mode&1)===0&&(Ze===0||Ze===11||Ze===15)){var Xe=Qe.alternate;Xe?(Qe.updateQueue=Xe.updateQueue,Qe.memoizedState=Xe.memoizedState,Qe.lanes=Xe.lanes):(Qe.updateQueue=null,Qe.memoizedState=null)}var gt=NR(G);if(gt!==null){gt.flags&=-257,BR(gt,G,ae,B,p),gt.mode&1&&zR(B,Pe,p),p=gt,ce=Pe;var Et=p.updateQueue;if(Et===null){var Tt=new Set;Tt.add(ce),p.updateQueue=Tt}else Et.add(ce);break e}else{if((p&1)===0){zR(B,Pe,p),EE();break e}ce=Error(i(426))}}else if(yr&&ae.mode&1){var Lr=NR(G);if(Lr!==null){(Lr.flags&65536)===0&&(Lr.flags|=256),BR(Lr,G,ae,B,p),LS(Nf(ce,ae));break e}}B=ce=Nf(ce,ae),an!==4&&(an=2),Og===null?Og=[B]:Og.push(B),B=G;do{switch(B.tag){case 3:B.flags|=65536,p&=-p,B.lanes|=p;var _e=kR(B,ce,p);oR(B,_e);break e;case 1:ae=ce;var ge=B.type,Ce=B.stateNode;if((B.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Ce!==null&&typeof Ce.componentDidCatch=="function"&&(wh===null||!wh.has(Ce)))){B.flags|=65536,p&=-p,B.lanes|=p;var $e=LR(B,ae,p);oR(B,$e);break e}}B=B.return}while(B!==null)}mO(x)}catch(Rt){p=Rt,Wr===x&&x!==null&&(Wr=x=x.return);continue}break}while(!0)}function fO(){var d=n1.current;return n1.current=J0,d===null?J0:d}function EE(){(an===0||an===3||an===2)&&(an=4),An===null||(Kc&268435455)===0&&(s1&268435455)===0||Eh(An,Wn)}function c1(d,p){var x=Bi;Bi|=2;var A=fO();(An!==d||Wn!==p)&&(ou=null,Jc(d,p));do try{VW();break}catch(R){dO(d,R)}while(!0);if(NS(),Bi=x,n1.current=A,Wr!==null)throw Error(i(261));return An=null,Wn=0,an}function VW(){for(;Wr!==null;)pO(Wr)}function jW(){for(;Wr!==null&&!Vn();)pO(Wr)}function pO(d){var p=yO(d.alternate,d,Sa);d.memoizedProps=d.pendingProps,p===null?mO(d):Wr=p,mE.current=null}function mO(d){var p=d;do{var x=p.alternate;if(d=p.return,(p.flags&32768)===0){if(x=kW(x,p,Sa),x!==null){Wr=x;return}}else{if(x=LW(x,p),x!==null){x.flags&=32767,Wr=x;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{an=6,Wr=null;return}}if(p=p.sibling,p!==null){Wr=p;return}Wr=p=d}while(p!==null);an===0&&(an=5)}function $c(d,p,x){var A=Di,R=za.transition;try{za.transition=null,Di=1,HW(d,p,x,A)}finally{za.transition=R,Di=A}return null}function HW(d,p,x,A){do Vf();while(_h!==null);if((Bi&6)!==0)throw Error(i(327));x=d.finishedWork;var R=d.finishedLanes;if(x===null)return null;if(d.finishedWork=null,d.finishedLanes=0,x===d.current)throw Error(i(177));d.callbackNode=null,d.callbackPriority=0;var B=x.lanes|x.childLanes;if(nr(d,B),d===An&&(Wr=An=null,Wn=0),(x.subtreeFlags&2064)===0&&(x.flags&2064)===0||o1||(o1=!0,xO(Tr,function(){return Vf(),null})),B=(x.flags&15990)!==0,(x.subtreeFlags&15990)!==0||B){B=za.transition,za.transition=null;var G=Di;Di=1;var ae=Bi;Bi|=4,mE.current=null,NW(d,x),sO(x,d),uW(ES),ch=!!SS,ES=SS=null,d.current=x,BW(x),fa(),Bi=ae,Di=G,za.transition=B}else d.current=x;if(o1&&(o1=!1,_h=d,l1=R),B=d.pendingLanes,B===0&&(wh=null),q(x.stateNode),Zs(d,Zt()),p!==null)for(A=d.onRecoverableError,x=0;x<p.length;x++)R=p[x],A(R.value,{componentStack:R.stack,digest:R.digest});if(a1)throw a1=!1,d=yE,yE=null,d;return(l1&1)!==0&&d.tag!==0&&Vf(),B=d.pendingLanes,(B&1)!==0?d===xE?kg++:(kg=0,xE=d):kg=0,vh(),null}function Vf(){if(_h!==null){var d=uh(l1),p=za.transition,x=Di;try{if(za.transition=null,Di=16>d?16:d,_h===null)var A=!1;else{if(d=_h,_h=null,l1=0,(Bi&6)!==0)throw Error(i(331));var R=Bi;for(Bi|=4,_t=d.current;_t!==null;){var B=_t,G=B.child;if((_t.flags&16)!==0){var ae=B.deletions;if(ae!==null){for(var ce=0;ce<ae.length;ce++){var Pe=ae[ce];for(_t=Pe;_t!==null;){var Qe=_t;switch(Qe.tag){case 0:case 11:case 15:Ig(8,Qe,B)}var Ze=Qe.child;if(Ze!==null)Ze.return=Qe,_t=Ze;else for(;_t!==null;){Qe=_t;var Xe=Qe.sibling,gt=Qe.return;if(eO(Qe),Qe===Pe){_t=null;break}if(Xe!==null){Xe.return=gt,_t=Xe;break}_t=gt}}}var Et=B.alternate;if(Et!==null){var Tt=Et.child;if(Tt!==null){Et.child=null;do{var Lr=Tt.sibling;Tt.sibling=null,Tt=Lr}while(Tt!==null)}}_t=B}}if((B.subtreeFlags&2064)!==0&&G!==null)G.return=B,_t=G;else e:for(;_t!==null;){if(B=_t,(B.flags&2048)!==0)switch(B.tag){case 0:case 11:case 15:Ig(9,B,B.return)}var _e=B.sibling;if(_e!==null){_e.return=B.return,_t=_e;break e}_t=B.return}}var ge=d.current;for(_t=ge;_t!==null;){G=_t;var Ce=G.child;if((G.subtreeFlags&2064)!==0&&Ce!==null)Ce.return=G,_t=Ce;else e:for(G=ge;_t!==null;){if(ae=_t,(ae.flags&2048)!==0)try{switch(ae.tag){case 0:case 11:case 15:r1(9,ae)}}catch(Rt){Pr(ae,ae.return,Rt)}if(ae===G){_t=null;break e}var $e=ae.sibling;if($e!==null){$e.return=ae.return,_t=$e;break e}_t=ae.return}}if(Bi=R,vh(),j&&typeof j.onPostCommitFiberRoot=="function")try{j.onPostCommitFiberRoot(_n,d)}catch{}A=!0}return A}finally{Di=x,za.transition=p}}return!1}function gO(d,p,x){p=Nf(x,p),p=kR(d,p,1),d=xh(d,p,1),p=Ds(),d!==null&&(oh(d,1,p),Zs(d,p))}function Pr(d,p,x){if(d.tag===3)gO(d,d,x);else for(;p!==null;){if(p.tag===3){gO(p,d,x);break}else if(p.tag===1){var A=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(wh===null||!wh.has(A))){d=Nf(x,d),d=LR(p,d,1),p=xh(p,d,1),d=Ds(),p!==null&&(oh(p,1,d),Zs(p,d));break}}p=p.return}}function GW(d,p,x){var A=d.pingCache;A!==null&&A.delete(p),p=Ds(),d.pingedLanes|=d.suspendedLanes&x,An===d&&(Wn&x)===x&&(an===4||an===3&&(Wn&130023424)===Wn&&500>Zt()-vE?Jc(d,0):gE|=x),Zs(d,p)}function vO(d,p){p===0&&((d.mode&1)===0?p=1:(p=Zo,Zo<<=1,(Zo&130023424)===0&&(Zo=4194304)));var x=Ds();d=nu(d,p),d!==null&&(oh(d,p,x),Zs(d,x))}function WW(d){var p=d.memoizedState,x=0;p!==null&&(x=p.retryLane),vO(d,x)}function qW(d,p){var x=0;switch(d.tag){case 13:var A=d.stateNode,R=d.memoizedState;R!==null&&(x=R.retryLane);break;case 19:A=d.stateNode;break;default:throw Error(i(314))}A!==null&&A.delete(p),vO(d,x)}var yO;yO=function(d,p,x){if(d!==null)if(d.memoizedProps!==p.pendingProps||Xs.current)Qs=!0;else{if((d.lanes&x)===0&&(p.flags&128)===0)return Qs=!1,OW(d,p,x);Qs=(d.flags&131072)!==0}else Qs=!1,yr&&(p.flags&1048576)!==0&&ZI(p,U0,p.index);switch(p.lanes=0,p.tag){case 2:var A=p.type;t1(d,p),d=p.pendingProps;var R=Mf(p,us.current);Lf(p,x),R=YS(null,p,A,d,R,x);var B=QS();return p.flags|=1,typeof R=="object"&&R!==null&&typeof R.render=="function"&&R.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,Ys(A)?(B=!0,N0(p)):B=!1,p.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,VS(p),R.updater=$0,p.stateNode=R,R._reactInternals=p,tE(p,A,d,x),p=sE(null,p,A,!0,B,x)):(p.tag=0,yr&&B&&IS(p),Ms(null,p,R,x),p=p.child),p;case 16:A=p.elementType;e:{switch(t1(d,p),d=p.pendingProps,R=A._init,A=R(A._payload),p.type=A,R=p.tag=YW(A),d=mo(A,d),R){case 0:p=nE(null,p,A,d,x);break e;case 1:p=GR(null,p,A,d,x);break e;case 11:p=FR(null,p,A,d,x);break e;case 14:p=UR(null,p,A,mo(A.type,d),x);break e}throw Error(i(306,A,""))}return p;case 0:return A=p.type,R=p.pendingProps,R=p.elementType===A?R:mo(A,R),nE(d,p,A,R,x);case 1:return A=p.type,R=p.pendingProps,R=p.elementType===A?R:mo(A,R),GR(d,p,A,R,x);case 3:e:{if(WR(p),d===null)throw Error(i(387));A=p.pendingProps,B=p.memoizedState,R=B.element,aR(d,p),q0(p,A,null,x);var G=p.memoizedState;if(A=G.element,B.isDehydrated)if(B={element:A,isDehydrated:!1,cache:G.cache,pendingSuspenseBoundaries:G.pendingSuspenseBoundaries,transitions:G.transitions},p.updateQueue.baseState=B,p.memoizedState=B,p.flags&256){R=Nf(Error(i(423)),p),p=qR(d,p,A,x,R);break e}else if(A!==R){R=Nf(Error(i(424)),p),p=qR(d,p,A,x,R);break e}else for(_a=ph(p.stateNode.containerInfo.firstChild),wa=p,yr=!0,po=null,x=nR(p,null,A,x),p.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling;else{if(Rf(),A===R){p=au(d,p,x);break e}Ms(d,p,A,x)}p=p.child}return p;case 5:return uR(p),d===null&&kS(p),A=p.type,R=p.pendingProps,B=d!==null?d.memoizedProps:null,G=R.children,AS(A,R)?G=null:B!==null&&AS(A,B)&&(p.flags|=32),HR(d,p),Ms(d,p,G,x),p.child;case 6:return d===null&&kS(p),null;case 13:return XR(d,p,x);case 4:return jS(p,p.stateNode.containerInfo),A=p.pendingProps,d===null?p.child=Of(p,null,A,x):Ms(d,p,A,x),p.child;case 11:return A=p.type,R=p.pendingProps,R=p.elementType===A?R:mo(A,R),FR(d,p,A,R,x);case 7:return Ms(d,p,p.pendingProps,x),p.child;case 8:return Ms(d,p,p.pendingProps.children,x),p.child;case 12:return Ms(d,p,p.pendingProps.children,x),p.child;case 10:e:{if(A=p.type._context,R=p.pendingProps,B=p.memoizedProps,G=R.value,lr(H0,A._currentValue),A._currentValue=G,B!==null)if(fo(B.value,G)){if(B.children===R.children&&!Xs.current){p=au(d,p,x);break e}}else for(B=p.child,B!==null&&(B.return=p);B!==null;){var ae=B.dependencies;if(ae!==null){G=B.child;for(var ce=ae.firstContext;ce!==null;){if(ce.context===A){if(B.tag===1){ce=su(-1,x&-x),ce.tag=2;var Pe=B.updateQueue;if(Pe!==null){Pe=Pe.shared;var Qe=Pe.pending;Qe===null?ce.next=ce:(ce.next=Qe.next,Qe.next=ce),Pe.pending=ce}}B.lanes|=x,ce=B.alternate,ce!==null&&(ce.lanes|=x),FS(B.return,x,p),ae.lanes|=x;break}ce=ce.next}}else if(B.tag===10)G=B.type===p.type?null:B.child;else if(B.tag===18){if(G=B.return,G===null)throw Error(i(341));G.lanes|=x,ae=G.alternate,ae!==null&&(ae.lanes|=x),FS(G,x,p),G=B.sibling}else G=B.child;if(G!==null)G.return=B;else for(G=B;G!==null;){if(G===p){G=null;break}if(B=G.sibling,B!==null){B.return=G.return,G=B;break}G=G.return}B=G}Ms(d,p,R.children,x),p=p.child}return p;case 9:return R=p.type,A=p.pendingProps.children,Lf(p,x),R=ka(R),A=A(R),p.flags|=1,Ms(d,p,A,x),p.child;case 14:return A=p.type,R=mo(A,p.pendingProps),R=mo(A.type,R),UR(d,p,A,R,x);case 15:return VR(d,p,p.type,p.pendingProps,x);case 17:return A=p.type,R=p.pendingProps,R=p.elementType===A?R:mo(A,R),t1(d,p),p.tag=1,Ys(A)?(d=!0,N0(p)):d=!1,Lf(p,x),RR(p,A,R),tE(p,A,R,x),sE(null,p,A,!0,d,x);case 19:return QR(d,p,x);case 22:return jR(d,p,x)}throw Error(i(156,p.tag))};function xO(d,p){return Xt(d,p)}function XW(d,p,x,A){this.tag=d,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Na(d,p,x,A){return new XW(d,p,x,A)}function AE(d){return d=d.prototype,!(!d||!d.isReactComponent)}function YW(d){if(typeof d=="function")return AE(d)?1:0;if(d!=null){if(d=d.$$typeof,d===N)return 11;if(d===Q)return 14}return 2}function Ah(d,p){var x=d.alternate;return x===null?(x=Na(d.tag,p,d.key,d.mode),x.elementType=d.elementType,x.type=d.type,x.stateNode=d.stateNode,x.alternate=d,d.alternate=x):(x.pendingProps=p,x.type=d.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=d.flags&14680064,x.childLanes=d.childLanes,x.lanes=d.lanes,x.child=d.child,x.memoizedProps=d.memoizedProps,x.memoizedState=d.memoizedState,x.updateQueue=d.updateQueue,p=d.dependencies,x.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},x.sibling=d.sibling,x.index=d.index,x.ref=d.ref,x}function d1(d,p,x,A,R,B){var G=2;if(A=d,typeof d=="function")AE(d)&&(G=1);else if(typeof d=="string")G=5;else e:switch(d){case P:return ed(x.children,R,B,p);case E:G=8,R|=8;break;case D:return d=Na(12,x,p,R|2),d.elementType=D,d.lanes=B,d;case k:return d=Na(13,x,p,R),d.elementType=k,d.lanes=B,d;case U:return d=Na(19,x,p,R),d.elementType=U,d.lanes=B,d;case K:return f1(x,R,B,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case I:G=10;break e;case O:G=9;break e;case N:G=11;break e;case Q:G=14;break e;case se:G=16,A=null;break e}throw Error(i(130,d==null?d:typeof d,""))}return p=Na(G,x,p,R),p.elementType=d,p.type=A,p.lanes=B,p}function ed(d,p,x,A){return d=Na(7,d,A,p),d.lanes=x,d}function f1(d,p,x,A){return d=Na(22,d,A,p),d.elementType=K,d.lanes=x,d.stateNode={isHidden:!1},d}function CE(d,p,x){return d=Na(6,d,null,p),d.lanes=x,d}function TE(d,p,x){return p=Na(4,d.children!==null?d.children:[],d.key,p),p.lanes=x,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function QW(d,p,x,A,R){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ah(0),this.expirationTimes=ah(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ah(0),this.identifierPrefix=A,this.onRecoverableError=R,this.mutableSourceEagerHydrationData=null}function PE(d,p,x,A,R,B,G,ae,ce){return d=new QW(d,p,x,ae,ce),p===1?(p=1,B===!0&&(p|=8)):p=0,B=Na(3,null,null,p),d.current=B,B.stateNode=d,B.memoizedState={element:A,isDehydrated:x,cache:null,transitions:null,pendingSuspenseBoundaries:null},VS(B),d}function KW(d,p,x){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:A==null?null:""+A,children:d,containerInfo:p,implementation:x}}function bO(d){if(!d)return gh;d=d._reactInternals;e:{if(It(d)!==d||d.tag!==1)throw Error(i(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(Ys(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(i(171))}if(d.tag===1){var x=d.type;if(Ys(x))return YI(d,x,p)}return p}function wO(d,p,x,A,R,B,G,ae,ce){return d=PE(x,A,!0,d,R,B,G,ae,ce),d.context=bO(null),x=d.current,A=Ds(),R=Sh(x),B=su(A,R),B.callback=p??null,xh(x,B,R),d.current.lanes=R,oh(d,R,A),Zs(d,A),d}function p1(d,p,x,A){var R=p.current,B=Ds(),G=Sh(R);return x=bO(x),p.context===null?p.context=x:p.pendingContext=x,p=su(B,G),p.payload={element:d},A=A===void 0?null:A,A!==null&&(p.callback=A),d=xh(R,p,G),d!==null&&(yo(d,R,G,B),W0(d,R,G)),G}function m1(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function _O(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var x=d.retryLane;d.retryLane=x!==0&&x<p?x:p}}function ME(d,p){_O(d,p),(d=d.alternate)&&_O(d,p)}var SO=typeof reportError=="function"?reportError:function(d){console.error(d)};function DE(d){this._internalRoot=d}g1.prototype.render=DE.prototype.render=function(d){var p=this._internalRoot;if(p===null)throw Error(i(409));p1(d,p,null,null)},g1.prototype.unmount=DE.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var p=d.containerInfo;Zc(function(){p1(null,d,null,null)}),p[eu]=null}};function g1(d){this._internalRoot=d}g1.prototype.unstable_scheduleHydration=function(d){if(d){var p=g0();d={blockedOn:null,target:d,priority:p};for(var x=0;x<$o.length&&p!==0&&p<$o[x].priority;x++);$o.splice(x,0,d),x===0&&x0(d)}};function IE(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function v1(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function EO(){}function ZW(d,p,x,A,R){if(R){if(typeof A=="function"){var B=A;A=function(){var Pe=m1(G);B.call(Pe)}}var G=wO(p,A,d,0,null,!1,!1,"",EO);return d._reactRootContainer=G,d[eu]=G.current,yg(d.nodeType===8?d.parentNode:d),Zc(),G}for(;R=d.lastChild;)d.removeChild(R);if(typeof A=="function"){var ae=A;A=function(){var Pe=m1(ce);ae.call(Pe)}}var ce=PE(d,0,!1,null,null,!1,!1,"",EO);return d._reactRootContainer=ce,d[eu]=ce.current,yg(d.nodeType===8?d.parentNode:d),Zc(function(){p1(p,ce,x,A)}),ce}function y1(d,p,x,A,R){var B=x._reactRootContainer;if(B){var G=B;if(typeof R=="function"){var ae=R;R=function(){var ce=m1(G);ae.call(ce)}}p1(p,G,d,R)}else G=ZW(x,p,d,R,A);return m1(G)}p0=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var x=ga(p.pendingLanes);x!==0&&(lh(p,x|1),Zs(p,Zt()),(Bi&6)===0&&(Uf=Zt()+500,vh()))}break;case 13:Zc(function(){var A=nu(d,1);if(A!==null){var R=Ds();yo(A,d,1,R)}}),ME(d,1)}},cf=function(d){if(d.tag===13){var p=nu(d,134217728);if(p!==null){var x=Ds();yo(p,d,134217728,x)}ME(d,134217728)}},m0=function(d){if(d.tag===13){var p=Sh(d),x=nu(d,p);if(x!==null){var A=Ds();yo(x,d,p,A)}ME(d,p)}},g0=function(){return Di},v0=function(d,p){var x=Di;try{return Di=d,p()}finally{Di=x}},Oe=function(d,p,x){switch(p){case"input":if(ut(d,x),p=x.name,x.type==="radio"&&p!=null){for(x=d;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<x.length;p++){var A=x[p];if(A!==d&&A.form===d.form){var R=L0(A);if(!R)throw Error(i(90));Ie(A),ut(A,R)}}}break;case"textarea":Ee(d,x);break;case"select":p=x.value,p!=null&&pt(d,!!x.multiple,p,!1)}},or=_E,os=Zc;var JW={usingClientEntryPoint:!1,Events:[wg,Tf,L0,ti,rr,_E]},Lg={findFiberByHostInstance:Hc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$W={bundleType:Lg.bundleType,version:Lg.version,rendererPackageName:Lg.rendererPackageName,rendererConfig:Lg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=ni(d),d===null?null:d.stateNode},findFiberByHostInstance:Lg.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var x1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!x1.isDisabled&&x1.supportsFiber)try{_n=x1.inject($W),j=x1}catch{}}return Js.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=JW,Js.createPortal=function(d,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!IE(p))throw Error(i(200));return KW(d,p,null,x)},Js.createRoot=function(d,p){if(!IE(d))throw Error(i(299));var x=!1,A="",R=SO;return p!=null&&(p.unstable_strictMode===!0&&(x=!0),p.identifierPrefix!==void 0&&(A=p.identifierPrefix),p.onRecoverableError!==void 0&&(R=p.onRecoverableError)),p=PE(d,1,!1,null,null,x,!1,A,R),d[eu]=p.current,yg(d.nodeType===8?d.parentNode:d),new DE(p)},Js.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=ni(p),d=d===null?null:d.stateNode,d},Js.flushSync=function(d){return Zc(d)},Js.hydrate=function(d,p,x){if(!v1(p))throw Error(i(200));return y1(null,d,p,!0,x)},Js.hydrateRoot=function(d,p,x){if(!IE(d))throw Error(i(405));var A=x!=null&&x.hydratedSources||null,R=!1,B="",G=SO;if(x!=null&&(x.unstable_strictMode===!0&&(R=!0),x.identifierPrefix!==void 0&&(B=x.identifierPrefix),x.onRecoverableError!==void 0&&(G=x.onRecoverableError)),p=wO(p,null,d,1,x??null,R,!1,B,G),d[eu]=p.current,yg(d),A)for(d=0;d<A.length;d++)x=A[d],R=x._getVersion,R=R(x._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[x,R]:p.mutableSourceEagerHydrationData.push(x,R);return new g1(p)},Js.render=function(d,p,x){if(!v1(p))throw Error(i(200));return y1(null,d,p,!1,x)},Js.unmountComponentAtNode=function(d){if(!v1(d))throw Error(i(40));return d._reactRootContainer?(Zc(function(){y1(null,null,d,!1,function(){d._reactRootContainer=null,d[eu]=null})}),!0):!1},Js.unstable_batchedUpdates=_E,Js.unstable_renderSubtreeIntoContainer=function(d,p,x,A){if(!v1(x))throw Error(i(200));if(d==null||d._reactInternals===void 0)throw Error(i(38));return y1(d,p,x,!1,A)},Js.version="18.3.1-next-f1338f8080-20240426",Js}var RO;function o8(){if(RO)return kE.exports;RO=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),kE.exports=a8(),kE.exports}var OO;function l8(){if(OO)return w1;OO=1;var e=o8();return w1.createRoot=e.createRoot,w1.hydrateRoot=e.hydrateRoot,w1}var u8=l8();const h8="modulepreload",c8=function(e){return"/Money_Saver_App/"+e},kO={},Es=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=c8(l),l in kO)return;kO[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":h8,u||(c.as="script"),c.crossOrigin="",c.href=l,o&&c.setAttribute("nonce",o),document.head.appendChild(c),u)return new Promise((f,m)=>{c.addEventListener("load",f),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var d8=Object.create,f_=Object.defineProperty,f8=Object.getOwnPropertyDescriptor,p8=Object.getOwnPropertyNames,m8=Object.getPrototypeOf,g8=Object.prototype.hasOwnProperty,v8=(e,t,i)=>t in e?f_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ef=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),y8=(e,t)=>{for(var i in t)f_(e,i,{get:t[i],enumerable:!0})},x8=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of p8(t))!g8.call(e,n)&&n!==i&&f_(e,n,{get:()=>t[n],enumerable:!(r=f8(t,n))||r.enumerable});return e},Oc=(e,t,i)=>(i=e!=null?d8(m8(e)):{},x8(t||!e||!e.__esModule?f_(i,"default",{value:e,enumerable:!0}):i,e)),wd=(e,t,i)=>(v8(e,typeof t!="symbol"?t+"":t,i),i),b8=ef((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var u=r();s=u(" "),a=u(" "),o=u(" ");for(var h=0;h<n.length;h++)s-=u(n[h]),s<0&&(s+=1),a-=u(n[h]),a<0&&(a+=1),o-=u(n[h]),o<0&&(o+=1);u=null;var c=function(){var f=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=f-(l=f|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=n,c.exportState=function(){return[s,a,o,l]},c.importState=function(f){s=+f[0]||0,a=+f[1]||0,o=+f[2]||0,l=+f[3]||0},c}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),QF=ef((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,u,h,c,f,m,g,y,v,b,S,_,T=r[0].length,M=r.length;if(M<T)throw new TypeError("Invalid matrix: m < n");for(var C=[],P=[],E=[],D=n==="f"?M:T,I=b=g=0;I<M;I++)P[I]=new Array(D).fill(0);for(I=0;I<T;I++)E[I]=new Array(T).fill(0);var O,N=new Array(T).fill(0);for(I=0;I<M;I++)for(l=0;l<T;l++)P[I][l]=r[I][l];for(I=0;I<T;I++){for(C[I]=g,v=0,h=I+1,l=I;l<M;l++)v+=Math.pow(P[l][I],2);if(v<o)g=0;else for(y=(m=P[I][I])*(g=m<0?Math.sqrt(v):-Math.sqrt(v))-v,P[I][I]=m-g,l=h;l<T;l++){for(v=0,u=I;u<M;u++)v+=P[u][I]*P[u][l];for(m=v/y,u=I;u<M;u++)P[u][l]=P[u][l]+m*P[u][I]}for(N[I]=g,v=0,l=h;l<T;l++)v+=Math.pow(P[I][l],2);if(v<o)g=0;else{for(y=(m=P[I][I+1])*(g=m<0?Math.sqrt(v):-Math.sqrt(v))-v,P[I][I+1]=m-g,l=h;l<T;l++)C[l]=P[I][l]/y;for(l=h;l<M;l++){for(v=0,u=h;u<T;u++)v+=P[l][u]*P[I][u];for(u=h;u<T;u++)P[l][u]=P[l][u]+v*C[u]}}b<(S=Math.abs(N[I])+Math.abs(C[I]))&&(b=S)}if(s)for(I=T-1;0<=I;I--){if(g!==0){for(y=P[I][I+1]*g,l=h;l<T;l++)E[l][I]=P[I][l]/y;for(l=h;l<T;l++){for(v=0,u=h;u<T;u++)v+=P[I][u]*E[u][l];for(u=h;u<T;u++)E[u][l]=E[u][l]+v*E[u][I]}}for(l=h;l<T;l++)E[I][l]=0,E[l][I]=0;E[I][I]=1,g=C[I],h=I}if(n){if(n==="f")for(I=T;I<M;I++){for(l=T;l<M;l++)P[I][l]=0;P[I][I]=1}for(I=T-1;0<=I;I--){for(h=I+1,g=N[I],l=h;l<D;l++)P[I][l]=0;if(g!==0){for(y=P[I][I]*g,l=h;l<D;l++){for(v=0,u=h;u<M;u++)v+=P[u][I]*P[u][l];for(m=v/y,u=I;u<M;u++)P[u][l]=P[u][l]+m*P[u][I]}for(l=I;l<M;l++)P[l][I]=P[l][I]/g}else for(l=I;l<M;l++)P[l][I]=0;P[I][I]=P[I][I]+1}}for(a*=b,u=T-1;0<=u;u--)for(var k=0;k<50;k++){for(O=!1,h=u;0<=h;h--){if(Math.abs(C[h])<=a){O=!0;break}if(Math.abs(N[h-1])<=a)break}if(!O){for(f=0,c=h-(v=1),I=h;I<u+1&&(m=v*C[I],C[I]=f*C[I],!(Math.abs(m)<=a));I++)if(g=N[I],N[I]=Math.sqrt(m*m+g*g),f=g/(y=N[I]),v=-m/y,n)for(l=0;l<M;l++)S=P[l][c],_=P[l][I],P[l][c]=S*f+_*v,P[l][I]=-S*v+_*f}if(_=N[u],h===u){if(_<0&&(N[u]=-_,s))for(l=0;l<T;l++)E[l][u]=-E[l][u];break}for(b=N[h],m=(((S=N[u-1])-_)*(S+_)+((g=C[u-1])-(y=C[u]))*(g+y))/(2*y*S),g=Math.sqrt(m*m+1),m=((b-_)*(b+_)+y*(S/(m<0?m-g:m+g)-y))/b,I=h+(v=f=1);I<u+1;I++){if(g=C[I],S=N[I],y=v*g,g*=f,_=Math.sqrt(m*m+y*y),m=b*(f=m/(C[I-1]=_))+g*(v=y/_),g=-b*v+g*f,y=S*v,S*=f,s)for(l=0;l<T;l++)b=E[l][I-1],_=E[l][I],E[l][I-1]=b*f+_*v,E[l][I]=-b*v+_*f;if(_=Math.sqrt(m*m+y*y),m=(f=m/(N[I-1]=_))*g+(v=y/_)*S,b=-v*g+f*S,n)for(l=0;l<M;l++)S=P[l][I-1],_=P[l][I],P[l][I-1]=S*f+_*v,P[l][I]=-S*v+_*f}C[h]=0,C[u]=m,N[u]=b}for(I=0;I<T;I++)N[I]<a&&(N[I]=0);return{u:P,q:N,v:E}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),w8=ef((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),_8=ef((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),S8=ef((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(g){return'"'+u(g.text)+'"'},class:function(g){var y="",v;for(v=0;v<g.parts.length;v++)y+=g.parts[v]instanceof Array?h(g.parts[v][0])+"-"+h(g.parts[v][1]):h(g.parts[v]);return"["+(g.inverted?"^":"")+y+"]"},any:function(g){return"any character"},end:function(g){return"end of input"},other:function(g){return g.description}};function l(g){return g.charCodeAt(0).toString(16).toUpperCase()}function u(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+l(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+l(y)})}function h(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+l(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+l(y)})}function c(g){return o[g.type](g)}function f(g){var y=new Array(g.length),v,b;for(v=0;v<g.length;v++)y[v]=c(g[v]);if(y.sort(),y.length>0){for(v=1,b=1;v<y.length;v++)y[v-1]!==y[v]&&(y[b]=y[v],b++);y.length=b}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function m(g){return g?'"'+u(g)+'"':"end of input"}return"Expected "+f(s)+" but "+m(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:ji},u=ji,h=function(j){if(!j)return[];for(var q=[],le=0;le<j.length;le++)q=q.concat.apply(q,j[le]);var J=q[0];return J&&J.code=="m"&&(delete J.relative,J.code="M"),q},c=function(j,q){return Tr(j,q)},f=/^[Mm]/,m=at(["M","m"],!1,!1),g=function(j,q,le){var J=_n(j,[q]);return le&&(J=J.concat(_n(j=="M"?"L":"l",le[1]))),J},y=/^[Zz]/,v=at(["Z","z"],!1,!1),b=function(){return _n("Z")},S=/^[Ll]/,_=at(["L","l"],!1,!1),T=function(j,q){return _n(j,q)},M=/^[Hh]/,C=at(["H","h"],!1,!1),P=function(j,q){return _n(j,q.map(function(le){return{x:le}}))},E=/^[Vv]/,D=at(["V","v"],!1,!1),I=function(j,q){return _n(j,q.map(function(le){return{y:le}}))},O=/^[Cc]/,N=at(["C","c"],!1,!1),k=function(j,q,le){return{x1:j.x,y1:j.y,x2:q.x,y2:q.y,x:le.x,y:le.y}},U=/^[Ss]/,Q=at(["S","s"],!1,!1),se=function(j,q){return{x2:j.x,y2:j.y,x:q.x,y:q.y}},K=/^[Qq]/,H=at(["Q","q"],!1,!1),ie=function(j,q){return{x1:j.x,y1:j.y,x:q.x,y:q.y}},$=/^[Tt]/,V=at(["T","t"],!1,!1),X=/^[Aa]/,ue=at(["A","a"],!1,!1),ne=function(j,q,le,J,ve,qe){return{rx:j,ry:q,xAxisRotation:le,largeArc:J,sweep:ve,x:qe.x,y:qe.y}},he=function(j,q){return{x:j,y:q}},te=function(j){return j*1},me=function(j){return j.join("")*1},de=/^[01]/,fe=at(["0","1"],!1,!1),ye=function(j){return j=="1"},Te=function(){return""},Ie=",",Ne=dt(",",!1),st=function(j){return j.join("")},We=".",ct=dt(".",!1),ut=/^[eE]/,Ke=at(["e","E"],!1,!1),Ye=/^[+\-]/,yt=at(["+","-"],!1,!1),pt=/^[0-9]/,re=at([["0","9"]],!1,!1),Y=function(j){return j.join("")},Ee=/^[ \t\n\r]/,Ve=at([" ","	",`
`,"\r"],!1,!1),W=0,Ge=[{line:1,column:1}],lt=0,it=[],De;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');u=l[a.startRule]}function dt(j,q){return{type:"literal",text:j,ignoreCase:q}}function at(j,q,le){return{type:"class",parts:j,inverted:q,ignoreCase:le}}function bt(){return{type:"end"}}function Dt(j){var q=Ge[j],le;if(q)return q;for(le=j-1;!Ge[le];)le--;for(q=Ge[le],q={line:q.line,column:q.column};le<j;)s.charCodeAt(le)===10?(q.line++,q.column=1):q.column++,le++;return Ge[j]=q,q}function Ct(j,q){var le=Dt(j),J=Dt(q);return{start:{offset:j,line:le.line,column:le.column},end:{offset:q,line:J.line,column:J.column}}}function Pt(j){W<lt||(W>lt&&(lt=W,it=[]),it.push(j))}function Oi(j,q,le){return new r(r.buildMessage(j,q),j,q,le)}function ji(){var j,q,le,J,ve;for(j=W,q=[],le=$t();le!==o;)q.push(le),le=$t();if(q!==o)if(le=pe(),le===o&&(le=null),le!==o){for(J=[],ve=$t();ve!==o;)J.push(ve),ve=$t();J!==o?(q=h(le),j=q):(W=j,j=o)}else W=j,j=o;else W=j,j=o;return j}function pe(){var j,q,le,J,ve,qe;if(j=W,q=Oe(),q!==o){for(le=[],J=W,ve=[],qe=$t();qe!==o;)ve.push(qe),qe=$t();for(ve!==o?(qe=Oe(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;){for(le.push(J),J=W,ve=[],qe=$t();qe!==o;)ve.push(qe),qe=$t();ve!==o?(qe=Oe(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o)}le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function Oe(){var j,q,le,J,ve,qe;if(j=W,q=et(),q!==o){for(le=[],J=W,ve=[],qe=$t();qe!==o;)ve.push(qe),qe=$t();for(ve!==o?(qe=Be(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;){for(le.push(J),J=W,ve=[],qe=$t();qe!==o;)ve.push(qe),qe=$t();ve!==o?(qe=Be(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o)}le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function Be(){var j;return j=Ot(),j===o&&(j=ti(),j===o&&(j=or(),j===o&&(j=Ei(),j===o&&(j=Un(),j===o&&(j=Ts(),j===o&&(j=ee(),j===o&&(j=xe(),j===o&&(j=vt())))))))),j}function et(){var j,q,le,J,ve,qe,ls;if(j=W,f.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(m)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=wt(),J!==o?(ve=W,qe=Xt(),qe===o&&(qe=null),qe!==o?(ls=rr(),ls!==o?(qe=[qe,ls],ve=qe):(W=ve,ve=o)):(W=ve,ve=o),ve===o&&(ve=null),ve!==o?(q=g(q,J,ve),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function Ot(){var j,q;return j=W,y.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(v)),q!==o&&(q=b()),j=q,j}function ti(){var j,q,le,J;if(j=W,S.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(_)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=rr(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function rr(){var j,q,le,J,ve,qe;if(j=W,q=wt(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=wt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=wt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function or(){var j,q,le,J;if(j=W,M.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(C)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=os(),J!==o?(q=P(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function os(){var j,q,le,J,ve,qe;if(j=W,q=ni(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ni(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ni(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function Ei(){var j,q,le,J;if(j=W,E.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(D)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=os(),J!==o?(q=I(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function Un(){var j,q,le,J;if(j=W,O.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(N)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=Ai(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function Ai(){var j,q,le,J,ve,qe;if(j=W,q=ca(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ca(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ca(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function ca(){var j,q,le,J,ve,qe;return j=W,q=wt(),q!==o?(le=Xt(),le===o&&(le=null),le!==o?(J=wt(),J!==o?(ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=wt(),qe!==o?(q=k(q,J,qe),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o),j}function Ts(){var j,q,le,J;if(j=W,U.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(Q)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=so(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function so(){var j,q,le,J,ve,qe;if(j=W,q=da(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=da(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=da(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function da(){var j,q,le,J;return j=W,q=wt(),q!==o?(le=Xt(),le===o&&(le=null),le!==o?(J=wt(),J!==o?(q=se(q,J),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o),j}function ee(){var j,q,le,J;if(j=W,K.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(H)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=we(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function we(){var j,q,le,J,ve,qe;if(j=W,q=ke(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ke(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ke(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function ke(){var j,q,le,J;return j=W,q=wt(),q!==o?(le=Xt(),le===o&&(le=null),le!==o?(J=wt(),J!==o?(q=ie(q,J),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o),j}function xe(){var j,q,le,J;if(j=W,$.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(V)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=ze(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function ze(){var j,q,le,J,ve,qe;if(j=W,q=wt(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=wt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=wt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function vt(){var j,q,le,J;if(j=W,X.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(ue)),q!==o){for(le=[],J=$t();J!==o;)le.push(J),J=$t();le!==o?(J=It(),J!==o?(q=T(q,J),j=q):(W=j,j=o)):(W=j,j=o)}else W=j,j=o;return j}function It(){var j,q,le,J,ve,qe;if(j=W,q=Lt(),q!==o){for(le=[],J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=Lt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);J!==o;)le.push(J),J=W,ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=Lt(),qe!==o?(ve=[ve,qe],J=ve):(W=J,J=o)):(W=J,J=o);le!==o?(q=c(q,le),j=q):(W=j,j=o)}else W=j,j=o;return j}function Lt(){var j,q,le,J,ve,qe,ls,Zo,ga,ao,sh,va;return j=W,q=wi(),q!==o?(le=Xt(),le===o&&(le=null),le!==o?(J=wi(),J!==o?(ve=Xt(),ve===o&&(ve=null),ve!==o?(qe=ni(),qe!==o?(ls=Xt(),ls!==o?(Zo=ii(),Zo!==o?(ga=Xt(),ga===o&&(ga=null),ga!==o?(ao=ii(),ao!==o?(sh=Xt(),sh===o&&(sh=null),sh!==o?(va=wt(),va!==o?(q=ne(q,J,qe,Zo,ao,va),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o)):(W=j,j=o),j}function wt(){var j,q,le,J;return j=W,q=ni(),q!==o?(le=Xt(),le===o&&(le=null),le!==o?(J=ni(),J!==o?(q=he(q,J),j=q):(W=j,j=o)):(W=j,j=o)):(W=j,j=o),j}function wi(){var j,q;return j=W,q=Vn(),q===o&&(q=rn()),q!==o&&(q=te(q)),j=q,j}function ni(){var j,q,le,J;return j=W,q=W,le=mi(),le===o&&(le=null),le!==o?(J=Vn(),J!==o?(le=[le,J],q=le):(W=q,q=o)):(W=q,q=o),q===o&&(q=W,le=mi(),le===o&&(le=null),le!==o?(J=rn(),J!==o?(le=[le,J],q=le):(W=q,q=o)):(W=q,q=o)),q!==o&&(q=me(q)),j=q,j}function ii(){var j,q;return j=W,de.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(fe)),q!==o&&(q=ye(q)),j=q,j}function Xt(){var j,q,le,J,ve;if(j=W,q=[],le=$t(),le!==o)for(;le!==o;)q.push(le),le=$t();else q=o;if(q!==o)if(le=dr(),le===o&&(le=null),le!==o){for(J=[],ve=$t();ve!==o;)J.push(ve),ve=$t();J!==o?(q=[q,le,J],j=q):(W=j,j=o)}else W=j,j=o;else W=j,j=o;if(j===o){if(j=W,q=W,le=dr(),le!==o){for(J=[],ve=$t();ve!==o;)J.push(ve),ve=$t();J!==o?(le=[le,J],q=le):(W=q,q=o)}else W=q,q=o;q!==o&&(q=Te()),j=q}return j}function dr(){var j;return s.charCodeAt(W)===44?(j=Ie,W++):(j=o,Pt(Ne)),j}function Vn(){var j,q,le,J;return j=W,q=W,le=fa(),le!==o?(J=Zt(),J===o&&(J=null),J!==o?(le=[le,J],q=le):(W=q,q=o)):(W=q,q=o),q===o&&(q=W,le=rn(),le!==o?(J=Zt(),J!==o?(le=[le,J],q=le):(W=q,q=o)):(W=q,q=o)),q!==o&&(q=st(q)),j=q,j}function fa(){var j,q,le,J,ve;return j=W,q=W,le=rn(),le===o&&(le=null),le!==o?(s.charCodeAt(W)===46?(J=We,W++):(J=o,Pt(ct)),J!==o?(ve=rn(),ve!==o?(le=[le,J,ve],q=le):(W=q,q=o)):(W=q,q=o)):(W=q,q=o),q===o&&(q=W,le=rn(),le!==o?(s.charCodeAt(W)===46?(J=We,W++):(J=o,Pt(ct)),J!==o?(le=[le,J],q=le):(W=q,q=o)):(W=q,q=o)),q!==o&&(q=st(q)),j=q,j}function Zt(){var j,q,le,J,ve;return j=W,q=W,ut.test(s.charAt(W))?(le=s.charAt(W),W++):(le=o,Pt(Ke)),le!==o?(J=mi(),J===o&&(J=null),J!==o?(ve=rn(),ve!==o?(le=[le,J,ve],q=le):(W=q,q=o)):(W=q,q=o)):(W=q,q=o),q!==o&&(q=st(q)),j=q,j}function mi(){var j;return Ye.test(s.charAt(W))?(j=s.charAt(W),W++):(j=o,Pt(yt)),j}function rn(){var j,q,le;if(j=W,q=[],pt.test(s.charAt(W))?(le=s.charAt(W),W++):(le=o,Pt(re)),le!==o)for(;le!==o;)q.push(le),pt.test(s.charAt(W))?(le=s.charAt(W),W++):(le=o,Pt(re));else q=o;return q!==o&&(q=Y(q)),j=q,j}function $t(){var j,q;return j=W,Ee.test(s.charAt(W))?(q=s.charAt(W),W++):(q=o,Pt(Ve)),q!==o&&(q=Te()),j=q,j}function Tr(j,q){if(!q)return[j];for(var le=[j],J=0,ve=q.length;J<ve;J++)le[J+1]=q[J][1];return le}var pa={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ma in pa)pa[ma.toUpperCase()]=pa[ma];function _n(j,q){q||(q=[{}]);for(var le=q.length;le--;){var J={code:j,command:pa[j]};j==j.toLowerCase()&&(J.relative=!0);for(var ve in q[le])J[ve]=q[le][ve];q[le]=J}return q}if(De=u(),De!==o&&W===s.length)return De;throw De!==o&&W<s.length&&Pt(bt()),Oi(it,lt<s.length?s.charAt(lt):null,lt<s.length?Ct(lt,lt+1):Ct(lt,lt))}t.exports={SyntaxError:r,parse:n}}),KF=ef((e,t)=>{var i=S8().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var u in o)u in l&&(l[u]+=l.relative?l[o[u]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),E8=ef((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Dm="149",Ba={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},A8=0,LO=1,C8=2,BP=1,T8=2,yv=3,Uo=0,zn=1,bs=2,$r=0,Id=1,zO=2,NO=3,BO=4,P8=5,Ep=100,M8=101,D8=102,FO=103,UO=104,I8=200,R8=201,O8=202,k8=203,ZF=204,JF=205,L8=206,z8=207,N8=208,B8=209,F8=210,U8=0,V8=1,j8=2,sT=3,H8=4,G8=5,W8=6,q8=7,$F=0,X8=1,Y8=2,Ol=0,Q8=1,K8=2,Z8=3,J8=4,$8=5,e5=300,Bd=301,Fd=302,aT=303,oT=304,Fy=306,Iu=1e3,gr=1001,lT=1002,vi=1003,VO=1004,NE=1005,fi=1006,e7=1007,om=1008,_s=1009,t7=1010,i7=1011,t5=1012,r7=1013,Ru=1014,Ki=1015,Gu=1016,n7=1017,s7=1018,Rd=1020,a7=1021,br=1023,o7=1024,l7=1025,Od=1026,Ud=1027,ab=1028,u7=1029,Lb=1030,h7=1031,i5=1033,BE=33776,FE=33777,UE=33778,VE=33779,jO=35840,HO=35841,GO=35842,WO=35843,c7=36196,qO=37492,XO=37496,YO=37808,QO=37809,KO=37810,ZO=37811,JO=37812,$O=37813,e3=37814,t3=37815,i3=37816,r3=37817,n3=37818,s3=37819,a3=37820,o3=37821,jE=36492,d7=36283,l3=36284,u3=36285,h3=36286,r5=2200,n5=2201,FP=2202,zb=2300,Nb=2301,HE=2302,Lp=2400,zp=2401,Bb=2402,UP=2500,f7=2501,Vo=3e3,ui=3001,eh=3200,s5=3201,p7=0,m7=1,wl="srgb",Fb="srgb-linear",GE=7680,g7=519,uT=35044,v7=35048,hT="300 es",cT=1035,as=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},fs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],c3=1234567,kv=Math.PI/180,iy=180/Math.PI;function $a(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(fs[e&255]+fs[e>>8&255]+fs[e>>16&255]+fs[e>>24&255]+"-"+fs[t&255]+fs[t>>8&255]+"-"+fs[t>>16&15|64]+fs[t>>24&255]+"-"+fs[i&63|128]+fs[i>>8&255]+"-"+fs[i>>16&255]+fs[i>>24&255]+fs[r&255]+fs[r>>8&255]+fs[r>>16&255]+fs[r>>24&255]).toLowerCase()}function Qr(e,t,i){return Math.max(t,Math.min(i,e))}function VP(e,t){return(e%t+t)%t}function y7(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function x7(e,t,i){return e!==t?(i-e)/(t-e):0}function Lv(e,t,i){return(1-i)*e+i*t}function b7(e,t,i,r){return Lv(e,t,1-Math.exp(-i*r))}function w7(e,t=1){return t-Math.abs(VP(e,t*2)-t)}function _7(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function S7(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function E7(e,t){return e+Math.floor(Math.random()*(t-e+1))}function A7(e,t){return e+Math.random()*(t-e)}function C7(e){return e*(.5-Math.random())}function T7(e){e!==void 0&&(c3=e);let t=c3+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function P7(e){return e*kv}function M7(e){return e*iy}function dT(e){return(e&e-1)===0&&e!==0}function a5(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ub(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function D7(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),u=s((t+r)/2),h=a((t+r)/2),c=s((t-r)/2),f=a((t-r)/2),m=s((r-t)/2),g=a((r-t)/2);switch(n){case"XYX":e.set(o*h,l*c,l*f,o*u);break;case"YZY":e.set(l*f,o*h,l*c,o*u);break;case"ZXZ":e.set(l*c,l*f,o*h,o*u);break;case"XZX":e.set(o*h,l*g,l*m,o*u);break;case"YXY":e.set(l*m,o*h,l*g,o*u);break;case"ZYZ":e.set(l*g,l*m,o*h,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Ou(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function sr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var ht=Object.freeze({__proto__:null,DEG2RAD:kv,RAD2DEG:iy,ceilPowerOfTwo:a5,clamp:Qr,damp:b7,degToRad:P7,denormalize:Ou,euclideanModulo:VP,floorPowerOfTwo:Ub,generateUUID:$a,inverseLerp:x7,isPowerOfTwo:dT,lerp:Lv,mapLinear:y7,normalize:sr,pingpong:w7,radToDeg:M7,randFloat:A7,randFloatSpread:C7,randInt:E7,seededRandom:T7,setQuaternionFromProperEuler:D7,smootherstep:S7,smoothstep:_7}),oe=class{constructor(t=0,i=0){oe.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){let r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Zr=class{constructor(){Zr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=n,u[5]=o,u[6]=i,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],u=i[4],h=i[7],c=i[2],f=i[5],m=i[8],g=r[0],y=r[3],v=r[6],b=r[1],S=r[4],_=r[7],T=r[2],M=r[5],C=r[8];return n[0]=s*g+a*b+o*T,n[3]=s*y+a*S+o*M,n[6]=s*v+a*_+o*C,n[1]=l*g+u*b+h*T,n[4]=l*y+u*S+h*M,n[7]=l*v+u*_+h*C,n[2]=c*g+f*b+m*T,n[5]=c*y+f*S+m*M,n[8]=c*v+f*_+m*C,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8];return t*s*u-t*a*l-i*n*u+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],h=u*s-a*l,c=a*o-u*n,f=l*n-s*o,m=t*h+i*c+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/m;return e[0]=h*g,e[1]=(r*l-u*i)*g,e[2]=(a*i-r*s)*g,e[3]=c*g,e[4]=(u*t-r*o)*g,e[5]=(r*n-a*t)*g,e[6]=f*g,e[7]=(i*o-l*t)*g,e[8]=(s*t-i*n)*g,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(WE.makeScale(e,t)),this}rotate(e){return this.premultiply(WE.makeRotation(-e)),this}translate(e,t){return this.premultiply(WE.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},WE=new Zr;function o5(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var I7={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function _1(e,t){return new I7[e](t)}function ry(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function R7(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function kd(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function ob(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var qE={[wl]:{[Fb]:kd},[Fb]:{[wl]:ob}},Is={legacyMode:!0,get workingColorSpace(){return Fb},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(qE[t]&&qE[t][i]!==void 0){let r=qE[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},l5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},on={r:0,g:0,b:0},xo={h:0,s:0,l:0},S1={h:0,s:0,l:0};function XE(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function E1(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Nt=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=wl){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Is.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Is.workingColorSpace){return this.r=e,this.g=t,this.b=i,Is.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Is.workingColorSpace){if(e=VP(e,1),t=Qr(t,0,1),i=Qr(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=XE(s,n,e+1/3),this.g=XE(s,n,e),this.b=XE(s,n,e-1/3)}return Is.toWorkingColorSpace(this,r),this}setStyle(e,t=wl){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Is.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Is.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,u=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,u,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Is.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Is.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=wl){let i=l5[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=kd(e.r),this.g=kd(e.g),this.b=kd(e.b),this}copyLinearToSRGB(e){return this.r=ob(e.r),this.g=ob(e.g),this.b=ob(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=wl){return Is.fromWorkingColorSpace(E1(this,on),e),Qr(on.r*255,0,255)<<16^Qr(on.g*255,0,255)<<8^Qr(on.b*255,0,255)<<0}getHexString(e=wl){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Is.workingColorSpace){Is.fromWorkingColorSpace(E1(this,on),t);let i=on.r,r=on.g,n=on.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,u=(a+s)/2;if(a===s)o=0,l=0;else{let h=s-a;switch(l=u<=.5?h/(s+a):h/(2-s-a),s){case i:o=(r-n)/h+(r<n?6:0);break;case r:o=(n-i)/h+2;break;case n:o=(i-r)/h+4;break}o/=6}return e.h=o,e.s=l,e.l=u,e}getRGB(e,t=Is.workingColorSpace){return Is.fromWorkingColorSpace(E1(this,on),t),e.r=on.r,e.g=on.g,e.b=on.b,e}getStyle(e=wl){return Is.fromWorkingColorSpace(E1(this,on),e),e!==wl?`color(${e} ${on.r} ${on.g} ${on.b})`:`rgb(${on.r*255|0},${on.g*255|0},${on.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(xo),xo.h+=e,xo.s+=t,xo.l+=i,this.setHSL(xo.h,xo.s,xo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(xo),e.getHSL(S1);let i=Lv(xo.h,S1.h,t),r=Lv(xo.s,S1.s,t),n=Lv(xo.l,S1.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Nt.NAMES=l5;var jf,u5=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{jf===void 0&&(jf=ry("canvas")),jf.width=e.width,jf.height=e.height;let i=jf.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=jf}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=ry("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=kd(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(kd(t[i]/255)*255):t[i]=kd(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},h5=class{constructor(e=null){this.isSource=!0,this.uuid=$a(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(YE(r[s].image)):n.push(YE(r[s]))}else n=YE(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function YE(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?u5.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var O7=0,Ar=class extends as{constructor(e=Ar.DEFAULT_IMAGE,t=Ar.DEFAULT_MAPPING,i=gr,r=gr,n=fi,s=om,a=br,o=_s,l=Ar.DEFAULT_ANISOTROPY,u=Vo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:O7++}),this.uuid=$a(),this.name="",this.source=new h5(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new oe(0,0),this.repeat=new oe(1,1),this.center=new oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==e5)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Iu:e.x=e.x-Math.floor(e.x);break;case gr:e.x=e.x<0?0:1;break;case lT:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Iu:e.y=e.y-Math.floor(e.y);break;case gr:e.y=e.y<0?0:1;break;case lT:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Ar.DEFAULT_IMAGE=null;Ar.DEFAULT_MAPPING=e5;Ar.DEFAULT_ANISOTROPY=1;var Yt=class{constructor(e=0,t=0,i=0,r=1){Yt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],u=s[1],h=s[5],c=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(o-u)<.01&&Math.abs(l-f)<.01&&Math.abs(c-m)<.01){if(Math.abs(o+u)<.1&&Math.abs(l+f)<.1&&Math.abs(c+m)<.1&&Math.abs(a+h+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let v=(a+1)/2,b=(h+1)/2,S=(g+1)/2,_=(o+u)/4,T=(l+f)/4,M=(c+m)/4;return v>b&&v>S?v<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(v),r=_/i,n=T/i):b>S?b<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(b),i=_/r,n=M/r):S<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(S),i=T/n,r=M/n),this.set(i,r,n,t),this}let y=Math.sqrt((m-c)*(m-c)+(l-f)*(l-f)+(u-o)*(u-o));return Math.abs(y)<.001&&(y=1),this.x=(m-c)/y,this.y=(l-f)/y,this.z=(u-o)/y,this.w=Math.acos((a+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Pi=class extends as{constructor(t=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Yt(0,0,t,i),this.scissorTest=!1,this.viewport=new Yt(0,0,t,i);let n={width:t,height:i,depth:1};this.texture=new Ar(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:fi,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(t,i,r=1){(this.width!==t||this.height!==i||this.depth!==r)&&(this.width=t,this.height=i,this.depth=r,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let i=Object.assign({},t.texture.image);return this.texture.source=new h5(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},c5=class extends Ar{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=gr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},k7=class extends Ar{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=gr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},d5=class extends Pi{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},Wt=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],u=i[r+2],h=i[r+3],c=n[s+0],f=n[s+1],m=n[s+2],g=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=c,e[t+1]=f,e[t+2]=m,e[t+3]=g;return}if(h!==g||o!==c||l!==f||u!==m){let y=1-a,v=o*c+l*f+u*m+h*g,b=v>=0?1:-1,S=1-v*v;if(S>Number.EPSILON){let T=Math.sqrt(S),M=Math.atan2(T,v*b);y=Math.sin(y*M)/T,a=Math.sin(a*M)/T}let _=a*b;if(o=o*y+c*_,l=l*y+f*_,u=u*y+m*_,h=h*y+g*_,y===1-a){let T=1/Math.sqrt(o*o+l*l+u*u+h*h);o*=T,l*=T,u*=T,h*=T}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],u=i[r+3],h=n[s],c=n[s+1],f=n[s+2],m=n[s+3];return e[t]=a*m+u*h+o*f-l*c,e[t+1]=o*m+u*c+l*h-a*f,e[t+2]=l*m+u*f+a*c-o*h,e[t+3]=u*m-a*h-o*c-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),u=a(r/2),h=a(n/2),c=o(i/2),f=o(r/2),m=o(n/2);switch(s){case"XYZ":this._x=c*u*h+l*f*m,this._y=l*f*h-c*u*m,this._z=l*u*m+c*f*h,this._w=l*u*h-c*f*m;break;case"YXZ":this._x=c*u*h+l*f*m,this._y=l*f*h-c*u*m,this._z=l*u*m-c*f*h,this._w=l*u*h+c*f*m;break;case"ZXY":this._x=c*u*h-l*f*m,this._y=l*f*h+c*u*m,this._z=l*u*m+c*f*h,this._w=l*u*h-c*f*m;break;case"ZYX":this._x=c*u*h-l*f*m,this._y=l*f*h+c*u*m,this._z=l*u*m-c*f*h,this._w=l*u*h+c*f*m;break;case"YZX":this._x=c*u*h+l*f*m,this._y=l*f*h+c*u*m,this._z=l*u*m-c*f*h,this._w=l*u*h-c*f*m;break;case"XZY":this._x=c*u*h-l*f*m,this._y=l*f*h-c*u*m,this._z=l*u*m+c*f*h,this._w=l*u*h+c*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],u=t[6],h=t[10],c=i+a+h;if(c>0){let f=.5/Math.sqrt(c+1);this._w=.25/f,this._x=(u-o)*f,this._y=(n-l)*f,this._z=(s-r)*f}else if(i>a&&i>h){let f=2*Math.sqrt(1+i-a-h);this._w=(u-o)/f,this._x=.25*f,this._y=(r+s)/f,this._z=(n+l)/f}else if(a>h){let f=2*Math.sqrt(1+a-i-h);this._w=(n-l)/f,this._x=(r+s)/f,this._y=.25*f,this._z=(o+u)/f}else{let f=2*Math.sqrt(1+h-i-a);this._w=(s-r)/f,this._x=(n+l)/f,this._y=(o+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Qr(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,u=t._w;return this._x=i*u+s*a+r*l-n*o,this._y=r*u+s*o+n*a-i*l,this._z=n*u+s*l+i*o-r*a,this._w=s*u-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let f=1-t;return this._w=f*s+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,c=Math.sin(t*u)/l;return this._w=s*h+this._w*c,this._x=i*h+this._x*c,this._y=r*h+this._y*c,this._z=n*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},L=class{constructor(t=0,i=0,r=0){L.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(d3.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(d3.setFromAxisAngle(t,i))}applyMatrix3(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){let i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,u=l*i+a*n-o*r,h=l*r+o*i-s*n,c=l*n+s*r-a*i,f=-s*i-a*r-o*n;return this.x=u*l+f*-s+h*-o-c*-a,this.y=h*l+f*-a+c*-s-u*-o,this.z=c*l+f*-o+u*-a-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){let r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){let i=t.lengthSq();if(i===0)return this.set(0,0,0);let r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return QE.copy(this).projectOnVector(t),this.sub(QE)}reflect(t){return this.sub(QE.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(t)/i;return Math.acos(Qr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){let n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){let i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){let i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},QE=new L,d3=new Wt,jr=class{constructor(t=new L(1/0,1/0,1/0),i=new L(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,u=t.length;l<u;l+=3){let h=t[l],c=t[l+1],f=t[l+2];h<i&&(i=h),c<r&&(r=c),f<n&&(n=f),h>s&&(s=h),c>a&&(a=c),f>o&&(o=f)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromBufferAttribute(t){let i=1/0,r=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,u=t.count;l<u;l++){let h=t.getX(l),c=t.getY(l),f=t.getZ(l);h<i&&(i=h),c<r&&(r=c),f<n&&(n=f),h>s&&(s=h),c>a&&(a=c),f>o&&(o=f)}return this.min.set(i,r,n),this.max.set(s,a,o),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){let r=td.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);let r=t.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){let s=r.attributes.position;for(let a=0,o=s.count;a<o;a++)td.fromBufferAttribute(s,a).applyMatrix4(t.matrixWorld),this.expandByPoint(td)}else r.boundingBox===null&&r.computeBoundingBox(),KE.copy(r.boundingBox),KE.applyMatrix4(t.matrixWorld),this.union(KE);let n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,td),td.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ng),A1.subVectors(this.max,Ng),Hf.subVectors(t.a,Ng),Gf.subVectors(t.b,Ng),Wf.subVectors(t.c,Ng),Th.subVectors(Gf,Hf),Ph.subVectors(Wf,Gf),id.subVectors(Hf,Wf);let i=[0,-Th.z,Th.y,0,-Ph.z,Ph.y,0,-id.z,id.y,Th.z,0,-Th.x,Ph.z,0,-Ph.x,id.z,0,-id.x,-Th.y,Th.x,0,-Ph.y,Ph.x,0,-id.y,id.x,0];return!ZE(i,Hf,Gf,Wf,A1)||(i=[1,0,0,0,1,0,0,0,1],!ZE(i,Hf,Gf,Wf,A1))?!1:(C1.crossVectors(Th,Ph),i=[C1.x,C1.y,C1.z],ZE(i,Hf,Gf,Wf,A1))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return td.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(td).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(lu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),lu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),lu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),lu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),lu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),lu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),lu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),lu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(lu),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},lu=[new L,new L,new L,new L,new L,new L,new L,new L],td=new L,KE=new jr,Hf=new L,Gf=new L,Wf=new L,Th=new L,Ph=new L,id=new L,Ng=new L,A1=new L,C1=new L,rd=new L;function ZE(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){rd.fromArray(e,s);let o=n.x*Math.abs(rd.x)+n.y*Math.abs(rd.y)+n.z*Math.abs(rd.z),l=t.dot(rd),u=i.dot(rd),h=r.dot(rd);if(Math.max(-Math.max(l,u,h),Math.min(l,u,h))>o)return!1}return!0}var L7=new jr,Bg=new L,JE=new L,ua=class{constructor(e=new L,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):L7.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Bg.subVectors(e,this.center);let t=Bg.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Bg,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(JE.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Bg.copy(e.center).add(JE)),this.expandByPoint(Bg.copy(e.center).sub(JE))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},uu=new L,$E=new L,T1=new L,Mh=new L,eA=new L,P1=new L,tA=new L,Im=class{constructor(e=new L,t=new L(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,uu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=uu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(uu.copy(this.direction).multiplyScalar(t).add(this.origin),uu.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){$E.copy(e).add(t).multiplyScalar(.5),T1.copy(t).sub(e).normalize(),Mh.copy(this.origin).sub($E);let n=e.distanceTo(t)*.5,s=-this.direction.dot(T1),a=Mh.dot(this.direction),o=-Mh.dot(T1),l=Mh.lengthSq(),u=Math.abs(1-s*s),h,c,f,m;if(u>0)if(h=s*o-a,c=s*a-o,m=n*u,h>=0)if(c>=-m)if(c<=m){let g=1/u;h*=g,c*=g,f=h*(h+s*c+2*a)+c*(s*h+c+2*o)+l}else c=n,h=Math.max(0,-(s*c+a)),f=-h*h+c*(c+2*o)+l;else c=-n,h=Math.max(0,-(s*c+a)),f=-h*h+c*(c+2*o)+l;else c<=-m?(h=Math.max(0,-(-s*n+a)),c=h>0?-n:Math.min(Math.max(-n,-o),n),f=-h*h+c*(c+2*o)+l):c<=m?(h=0,c=Math.min(Math.max(-n,-o),n),f=c*(c+2*o)+l):(h=Math.max(0,-(s*n+a)),c=h>0?n:Math.min(Math.max(-n,-o),n),f=-h*h+c*(c+2*o)+l);else c=s>0?-n:n,h=Math.max(0,-(s*c+a)),f=-h*h+c*(c+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),r&&r.copy(T1).multiplyScalar(c).add($E),f}intersectSphere(e,t){uu.subVectors(e.center,this.origin);let i=uu.dot(this.direction),r=uu.dot(uu)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(i=(e.min.x-c.x)*l,r=(e.max.x-c.x)*l):(i=(e.max.x-c.x)*l,r=(e.min.x-c.x)*l),u>=0?(n=(e.min.y-c.y)*u,s=(e.max.y-c.y)*u):(n=(e.max.y-c.y)*u,s=(e.min.y-c.y)*u),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),h>=0?(a=(e.min.z-c.z)*h,o=(e.max.z-c.z)*h):(a=(e.max.z-c.z)*h,o=(e.min.z-c.z)*h),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,uu)!==null}intersectTriangle(e,t,i,r,n){eA.subVectors(t,e),P1.subVectors(i,e),tA.crossVectors(eA,P1);let s=this.direction.dot(tA),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Mh.subVectors(this.origin,e);let o=a*this.direction.dot(P1.crossVectors(Mh,P1));if(o<0)return null;let l=a*this.direction.dot(eA.cross(Mh));if(l<0||o+l>s)return null;let u=-a*Mh.dot(tA);return u<0?null:this.at(u/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},je=class{constructor(){je.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,a,o,l,u,h,c,f,m,g,y){let v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=r,v[1]=n,v[5]=s,v[9]=a,v[13]=o,v[2]=l,v[6]=u,v[10]=h,v[14]=c,v[3]=f,v[7]=m,v[11]=g,v[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new je().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/qf.setFromMatrixColumn(e,0).length(),n=1/qf.setFromMatrixColumn(e,1).length(),s=1/qf.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),u=Math.cos(n),h=Math.sin(n);if(e.order==="XYZ"){let c=s*u,f=s*h,m=a*u,g=a*h;t[0]=o*u,t[4]=-o*h,t[8]=l,t[1]=f+m*l,t[5]=c-g*l,t[9]=-a*o,t[2]=g-c*l,t[6]=m+f*l,t[10]=s*o}else if(e.order==="YXZ"){let c=o*u,f=o*h,m=l*u,g=l*h;t[0]=c+g*a,t[4]=m*a-f,t[8]=s*l,t[1]=s*h,t[5]=s*u,t[9]=-a,t[2]=f*a-m,t[6]=g+c*a,t[10]=s*o}else if(e.order==="ZXY"){let c=o*u,f=o*h,m=l*u,g=l*h;t[0]=c-g*a,t[4]=-s*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=s*u,t[9]=g-c*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let c=s*u,f=s*h,m=a*u,g=a*h;t[0]=o*u,t[4]=m*l-f,t[8]=c*l+g,t[1]=o*h,t[5]=g*l+c,t[9]=f*l-m,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let c=s*o,f=s*l,m=a*o,g=a*l;t[0]=o*u,t[4]=g-c*h,t[8]=m*h+f,t[1]=h,t[5]=s*u,t[9]=-a*u,t[2]=-l*u,t[6]=f*h+m,t[10]=c-g*h}else if(e.order==="XZY"){let c=s*o,f=s*l,m=a*o,g=a*l;t[0]=o*u,t[4]=-h,t[8]=l*u,t[1]=c*h+g,t[5]=s*u,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*u,t[10]=g*h+c}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(z7,e,N7)}lookAt(e,t,i){let r=this.elements;return Ea.subVectors(e,t),Ea.lengthSq()===0&&(Ea.z=1),Ea.normalize(),Dh.crossVectors(i,Ea),Dh.lengthSq()===0&&(Math.abs(i.z)===1?Ea.x+=1e-4:Ea.z+=1e-4,Ea.normalize(),Dh.crossVectors(i,Ea)),Dh.normalize(),M1.crossVectors(Ea,Dh),r[0]=Dh.x,r[4]=M1.x,r[8]=Ea.x,r[1]=Dh.y,r[5]=M1.y,r[9]=Ea.y,r[2]=Dh.z,r[6]=M1.z,r[10]=Ea.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],u=i[1],h=i[5],c=i[9],f=i[13],m=i[2],g=i[6],y=i[10],v=i[14],b=i[3],S=i[7],_=i[11],T=i[15],M=r[0],C=r[4],P=r[8],E=r[12],D=r[1],I=r[5],O=r[9],N=r[13],k=r[2],U=r[6],Q=r[10],se=r[14],K=r[3],H=r[7],ie=r[11],$=r[15];return n[0]=s*M+a*D+o*k+l*K,n[4]=s*C+a*I+o*U+l*H,n[8]=s*P+a*O+o*Q+l*ie,n[12]=s*E+a*N+o*se+l*$,n[1]=u*M+h*D+c*k+f*K,n[5]=u*C+h*I+c*U+f*H,n[9]=u*P+h*O+c*Q+f*ie,n[13]=u*E+h*N+c*se+f*$,n[2]=m*M+g*D+y*k+v*K,n[6]=m*C+g*I+y*U+v*H,n[10]=m*P+g*O+y*Q+v*ie,n[14]=m*E+g*N+y*se+v*$,n[3]=b*M+S*D+_*k+T*K,n[7]=b*C+S*I+_*U+T*H,n[11]=b*P+S*O+_*Q+T*ie,n[15]=b*E+S*N+_*se+T*$,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],u=e[2],h=e[6],c=e[10],f=e[14],m=e[3],g=e[7],y=e[11],v=e[15];return m*(+n*o*h-r*l*h-n*a*c+i*l*c+r*a*f-i*o*f)+g*(+t*o*f-t*l*c+n*s*c-r*s*f+r*l*u-n*o*u)+y*(+t*l*h-t*a*f-n*s*h+i*s*f+n*a*u-i*l*u)+v*(-r*a*u-t*o*h+t*a*c+r*s*h-i*s*c+i*o*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],h=e[9],c=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],b=h*y*l-g*c*l+g*o*f-a*y*f-h*o*v+a*c*v,S=m*c*l-u*y*l-m*o*f+s*y*f+u*o*v-s*c*v,_=u*g*l-m*h*l+m*a*f-s*g*f-u*a*v+s*h*v,T=m*h*o-u*g*o-m*a*c+s*g*c+u*a*y-s*h*y,M=t*b+i*S+r*_+n*T;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let C=1/M;return e[0]=b*C,e[1]=(g*c*n-h*y*n-g*r*f+i*y*f+h*r*v-i*c*v)*C,e[2]=(a*y*n-g*o*n+g*r*l-i*y*l-a*r*v+i*o*v)*C,e[3]=(h*o*n-a*c*n-h*r*l+i*c*l+a*r*f-i*o*f)*C,e[4]=S*C,e[5]=(u*y*n-m*c*n+m*r*f-t*y*f-u*r*v+t*c*v)*C,e[6]=(m*o*n-s*y*n-m*r*l+t*y*l+s*r*v-t*o*v)*C,e[7]=(s*c*n-u*o*n+u*r*l-t*c*l-s*r*f+t*o*f)*C,e[8]=_*C,e[9]=(m*h*n-u*g*n-m*i*f+t*g*f+u*i*v-t*h*v)*C,e[10]=(s*g*n-m*a*n+m*i*l-t*g*l-s*i*v+t*a*v)*C,e[11]=(u*a*n-s*h*n-u*i*l+t*h*l+s*i*f-t*a*f)*C,e[12]=T*C,e[13]=(u*g*r-m*h*r+m*i*c-t*g*c-u*i*y+t*h*y)*C,e[14]=(m*a*r-s*g*r-m*i*o+t*g*o+s*i*y-t*a*y)*C,e[15]=(s*h*r-u*a*r+u*i*o-t*h*o-s*i*c+t*a*c)*C,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,u=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,u*a+i,u*o-r*s,0,l*o-r*a,u*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,u=s+s,h=a+a,c=n*l,f=n*u,m=n*h,g=s*u,y=s*h,v=a*h,b=o*l,S=o*u,_=o*h,T=i.x,M=i.y,C=i.z;return r[0]=(1-(g+v))*T,r[1]=(f+_)*T,r[2]=(m-S)*T,r[3]=0,r[4]=(f-_)*M,r[5]=(1-(c+v))*M,r[6]=(y+b)*M,r[7]=0,r[8]=(m+S)*C,r[9]=(y-b)*C,r[10]=(1-(c+g))*C,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=qf.set(r[0],r[1],r[2]).length(),s=qf.set(r[4],r[5],r[6]).length(),a=qf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],bo.copy(this);let o=1/n,l=1/s,u=1/a;return bo.elements[0]*=o,bo.elements[1]*=o,bo.elements[2]*=o,bo.elements[4]*=l,bo.elements[5]*=l,bo.elements[6]*=l,bo.elements[8]*=u,bo.elements[9]*=u,bo.elements[10]*=u,t.setFromRotationMatrix(bo),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),h=(i+r)/(i-r),c=-(s+n)/(s-n),f=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),u=1/(s-n),h=(t+e)*o,c=(i+r)*l,f=(s+n)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},qf=new L,bo=new je,z7=new L(0,0,0),N7=new L(1,1,1),Dh=new L,M1=new L,Ea=new L,f3=new je,p3=new Wt,dn=class{constructor(e=0,t=0,i=0,r=dn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],u=r[9],h=r[2],c=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Qr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Qr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(Qr(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-Qr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,f),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Qr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Qr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return f3.makeRotationFromQuaternion(e),this.setFromRotationMatrix(f3,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return p3.setFromEuler(this),this.setFromQuaternion(p3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};dn.DEFAULT_ORDER="XYZ";var jP=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},B7=0,m3=new L,Xf=new Wt,hu=new je,D1=new L,Fg=new L,F7=new L,U7=new Wt,g3=new L(1,0,0),v3=new L(0,1,0),y3=new L(0,0,1),V7={type:"added"},x3={type:"removed"},qi=class extends as{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:B7++}),this.uuid=$a(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qi.DEFAULT_UP.clone();let t=new L,i=new dn,r=new Wt,n=new L(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new je},normalMatrix:{value:new Zr}}),this.matrix=new je,this.matrixWorld=new je,this.matrixAutoUpdate=qi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new jP,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Xf.setFromAxisAngle(t,i),this.quaternion.multiply(Xf),this}rotateOnWorldAxis(t,i){return Xf.setFromAxisAngle(t,i),this.quaternion.premultiply(Xf),this}rotateX(t){return this.rotateOnAxis(g3,t)}rotateY(t){return this.rotateOnAxis(v3,t)}rotateZ(t){return this.rotateOnAxis(y3,t)}translateOnAxis(t,i){return m3.copy(t).applyQuaternion(this.quaternion),this.position.add(m3.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(g3,t)}translateY(t){return this.translateOnAxis(v3,t)}translateZ(t){return this.translateOnAxis(y3,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(hu.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?D1.copy(t):D1.set(t,i,r);let n=this.parent;this.updateWorldMatrix(!0,!1),Fg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hu.lookAt(Fg,D1,this.up):hu.lookAt(D1,Fg,this.up),this.quaternion.setFromRotationMatrix(hu),n&&(hu.extractRotation(n.matrixWorld),Xf.setFromRotationMatrix(hu),this.quaternion.premultiply(Xf.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(V7)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(x3)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let i=this.children[t];i.parent=null,i.dispatchEvent(x3)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),hu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),hu.multiply(t.parent.matrixWorld)),t.applyMatrix4(hu),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectByProperty(t,i);if(s!==void 0)return s}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let n=0,s=this.children.length;n<s;n++){let a=this.children[n].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fg,t,F7),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fg,U7,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){let i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let i=this.children;for(let r=0,n=i.length;r<n;r++){let s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){let r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){let n=this.children;for(let s=0,a=n.length;s<a;s++){let o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){let i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let l=o.shapes;if(Array.isArray(l))for(let u=0,h=l.length;u<h;u++){let c=l[u];s(t.shapes,c)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){let l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){let o=a(t.geometries),l=a(t.materials),u=a(t.textures),h=a(t.images),c=a(t.shapes),f=a(t.skeletons),m=a(t.animations),g=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),h.length>0&&(r.images=h),c.length>0&&(r.shapes=c),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),g.length>0&&(r.nodes=g)}return r.object=n,r;function a(o){let l=[];for(let u in o){let h=o[u];delete h.metadata,l.push(h)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){let n=t.children[r];this.add(n.clone())}return this}};qi.DEFAULT_UP=new L(0,1,0);qi.DEFAULT_MATRIX_AUTO_UPDATE=!0;qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var wo=new L,cu=new L,iA=new L,du=new L,Yf=new L,Qf=new L,b3=new L,rA=new L,nA=new L,sA=new L,$n=class{constructor(e=new L,t=new L,i=new L){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),wo.subVectors(e,t),r.cross(wo);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){wo.subVectors(r,t),cu.subVectors(i,t),iA.subVectors(e,t);let s=wo.dot(wo),a=wo.dot(cu),o=wo.dot(iA),l=cu.dot(cu),u=cu.dot(iA),h=s*l-a*a;if(h===0)return n.set(-2,-1,-1);let c=1/h,f=(l*o-a*u)*c,m=(s*u-a*o)*c;return n.set(1-f-m,m,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,du),du.x>=0&&du.y>=0&&du.x+du.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,du),o.set(0,0),o.addScaledVector(n,du.x),o.addScaledVector(s,du.y),o.addScaledVector(a,du.z),o}static isFrontFacing(e,t,i,r){return wo.subVectors(i,t),cu.subVectors(e,t),wo.cross(cu).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wo.subVectors(this.c,this.b),cu.subVectors(this.a,this.b),wo.cross(cu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $n.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $n.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return $n.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return $n.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $n.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;Yf.subVectors(r,i),Qf.subVectors(n,i),rA.subVectors(e,i);let o=Yf.dot(rA),l=Qf.dot(rA);if(o<=0&&l<=0)return t.copy(i);nA.subVectors(e,r);let u=Yf.dot(nA),h=Qf.dot(nA);if(u>=0&&h<=u)return t.copy(r);let c=o*h-u*l;if(c<=0&&o>=0&&u<=0)return s=o/(o-u),t.copy(i).addScaledVector(Yf,s);sA.subVectors(e,n);let f=Yf.dot(sA),m=Qf.dot(sA);if(m>=0&&f<=m)return t.copy(n);let g=f*l-o*m;if(g<=0&&l>=0&&m<=0)return a=l/(l-m),t.copy(i).addScaledVector(Qf,a);let y=u*m-f*h;if(y<=0&&h-u>=0&&f-m>=0)return b3.subVectors(n,r),a=(h-u)/(h-u+(f-m)),t.copy(r).addScaledVector(b3,a);let v=1/(y+g+c);return s=g*v,a=c*v,t.copy(i).addScaledVector(Yf,s).addScaledVector(Qf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},j7=0,Uy=class extends as{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:j7++}),this.uuid=$a(),this.name="",this.type="Material",this.blending=Id,this.side=Uo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ZF,this.blendDst=JF,this.blendEquation=Ep,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=sT,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=g7,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=GE,this.stencilZFail=GE,this.stencilZPass=GE,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Id&&(i.blending=this.blending),this.side!==Uo&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Wu=class extends Uy{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Nt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$F,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},qr=new L,I1=new oe,Bt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=uT,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)I1.fromBufferAttribute(this,t),I1.applyMatrix3(e),this.setXY(t,I1.x,I1.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)qr.fromBufferAttribute(this,t),qr.applyMatrix3(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)qr.fromBufferAttribute(this,t),qr.applyMatrix4(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)qr.fromBufferAttribute(this,t),qr.applyNormalMatrix(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)qr.fromBufferAttribute(this,t),qr.transformDirection(e),this.setXYZ(t,qr.x,qr.y,qr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ou(t,this.array)),t}setX(e,t){return this.normalized&&(t=sr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ou(t,this.array)),t}setY(e,t){return this.normalized&&(t=sr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ou(t,this.array)),t}setZ(e,t){return this.normalized&&(t=sr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ou(t,this.array)),t}setW(e,t){return this.normalized&&(t=sr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array),r=sr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array),r=sr(r,this.array),n=sr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==uT&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},f5=class extends Bt{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Hp=class extends Bt{constructor(e,t,i){super(new Uint32Array(e),t,i)}},ot=class extends Bt{constructor(e,t,i){super(new Float32Array(e),t,i)}},H7=0,Fa=new je,aA=new qi,Kf=new L,Aa=new jr,Ug=new jr,Tn=new L,St=class extends as{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:H7++}),this.uuid=$a(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(o5(e)?Hp:f5)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Zr().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Fa.makeRotationFromQuaternion(e),this.applyMatrix4(Fa),this}rotateX(e){return Fa.makeRotationX(e),this.applyMatrix4(Fa),this}rotateY(e){return Fa.makeRotationY(e),this.applyMatrix4(Fa),this}rotateZ(e){return Fa.makeRotationZ(e),this.applyMatrix4(Fa),this}translate(e,t,i){return Fa.makeTranslation(e,t,i),this.applyMatrix4(Fa),this}scale(e,t,i){return Fa.makeScale(e,t,i),this.applyMatrix4(Fa),this}lookAt(e){return aA.lookAt(e),aA.updateMatrix(),this.applyMatrix4(aA.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Kf).negate(),this.translate(Kf.x,Kf.y,Kf.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new ot(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jr);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];Aa.setFromBufferAttribute(n),this.morphTargetsRelative?(Tn.addVectors(this.boundingBox.min,Aa.min),this.boundingBox.expandByPoint(Tn),Tn.addVectors(this.boundingBox.max,Aa.max),this.boundingBox.expandByPoint(Tn)):(this.boundingBox.expandByPoint(Aa.min),this.boundingBox.expandByPoint(Aa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ua);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new L,1/0);return}if(e){let i=this.boundingSphere.center;if(Aa.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];Ug.setFromBufferAttribute(a),this.morphTargetsRelative?(Tn.addVectors(Aa.min,Ug.min),Aa.expandByPoint(Tn),Tn.addVectors(Aa.max,Ug.max),Aa.expandByPoint(Tn)):(Aa.expandByPoint(Ug.min),Aa.expandByPoint(Ug.max))}Aa.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)Tn.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(Tn));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Tn.fromBufferAttribute(a,l),o&&(Kf.fromBufferAttribute(e,l),Tn.add(Kf)),r=Math.max(r,i.distanceToSquared(Tn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Bt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],u=[];for(let D=0;D<a;D++)l[D]=new L,u[D]=new L;let h=new L,c=new L,f=new L,m=new oe,g=new oe,y=new oe,v=new L,b=new L;function S(D,I,O){h.fromArray(r,D*3),c.fromArray(r,I*3),f.fromArray(r,O*3),m.fromArray(s,D*2),g.fromArray(s,I*2),y.fromArray(s,O*2),c.sub(h),f.sub(h),g.sub(m),y.sub(m);let N=1/(g.x*y.y-y.x*g.y);!isFinite(N)||(v.copy(c).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(N),b.copy(f).multiplyScalar(g.x).addScaledVector(c,-y.x).multiplyScalar(N),l[D].add(v),l[I].add(v),l[O].add(v),u[D].add(b),u[I].add(b),u[O].add(b))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let D=0,I=_.length;D<I;++D){let O=_[D],N=O.start,k=O.count;for(let U=N,Q=N+k;U<Q;U+=3)S(i[U+0],i[U+1],i[U+2])}let T=new L,M=new L,C=new L,P=new L;function E(D){C.fromArray(n,D*3),P.copy(C);let I=l[D];T.copy(I),T.sub(C.multiplyScalar(C.dot(I))).normalize(),M.crossVectors(P,I);let O=M.dot(u[D])<0?-1:1;o[D*4]=T.x,o[D*4+1]=T.y,o[D*4+2]=T.z,o[D*4+3]=O}for(let D=0,I=_.length;D<I;++D){let O=_[D],N=O.start,k=O.count;for(let U=N,Q=N+k;U<Q;U+=3)E(i[U+0]),E(i[U+1]),E(i[U+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Bt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let c=0,f=i.count;c<f;c++)i.setXYZ(c,0,0,0);let r=new L,n=new L,s=new L,a=new L,o=new L,l=new L,u=new L,h=new L;if(e)for(let c=0,f=e.count;c<f;c+=3){let m=e.getX(c+0),g=e.getX(c+1),y=e.getX(c+2);r.fromBufferAttribute(t,m),n.fromBufferAttribute(t,g),s.fromBufferAttribute(t,y),u.subVectors(s,n),h.subVectors(r,n),u.cross(h),a.fromBufferAttribute(i,m),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,y),a.add(u),o.add(u),l.add(u),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(y,l.x,l.y,l.z)}else for(let c=0,f=t.count;c<f;c+=3)r.fromBufferAttribute(t,c+0),n.fromBufferAttribute(t,c+1),s.fromBufferAttribute(t,c+2),u.subVectors(s,n),h.subVectors(r,n),u.cross(h),i.setXYZ(c+0,u.x,u.y,u.z),i.setXYZ(c+1,u.x,u.y,u.z),i.setXYZ(c+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Tn.fromBufferAttribute(e,t),Tn.normalize(),e.setXYZ(t,Tn.x,Tn.y,Tn.z)}toNonIndexed(){function e(a,o){let l=a.array,u=a.itemSize,h=a.normalized,c=new l.constructor(o.length*u),f=0,m=0;for(let g=0,y=o.length;g<y;g++){a.isInterleavedBufferAttribute?f=o[g]*a.data.stride+a.offset:f=o[g]*u;for(let v=0;v<u;v++)c[m++]=l[f++]}return new Bt(c,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new St,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let u=0,h=l.length;u<h;u++){let c=l[u],f=e(c,i);o.push(f)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],u=[];for(let h=0,c=l.length;h<c;h++){let f=l[h];u.push(f.toJSON(e.data))}u.length>0&&(r[o]=u,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let u=r[l];this.setAttribute(l,u.clone(t))}let n=e.morphAttributes;for(let l in n){let u=[],h=n[l];for(let c=0,f=h.length;c<f;c++)u.push(h[c].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,u=s.length;l<u;l++){let h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},w3=new je,Zf=new Im,oA=new ua,Vg=new L,jg=new L,Hg=new L,lA=new L,R1=new L,O1=new oe,k1=new oe,L1=new oe,uA=new L,z1=new L,ar=class extends qi{constructor(t=new St,i=new Wu){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=r.length;n<s;n++){let a=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(t,i){let r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);let o=this.morphTargetInfluences;if(s&&o){R1.set(0,0,0);for(let l=0,u=s.length;l<u;l++){let h=o[l],c=s[l];h!==0&&(lA.fromBufferAttribute(c,t),a?R1.addScaledVector(lA,h):R1.addScaledVector(lA.sub(i),h))}i.add(R1)}return this.isSkinnedMesh&&this.boneTransform(t,i),i}raycast(t,i){let r=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),oA.copy(r.boundingSphere),oA.applyMatrix4(s),t.ray.intersectsSphere(oA)===!1)||(w3.copy(s).invert(),Zf.copy(t.ray).applyMatrix4(w3),r.boundingBox!==null&&Zf.intersectsBox(r.boundingBox)===!1))return;let a,o=r.index,l=r.attributes.position,u=r.attributes.uv,h=r.attributes.uv2,c=r.groups,f=r.drawRange;if(o!==null)if(Array.isArray(n))for(let m=0,g=c.length;m<g;m++){let y=c[m],v=n[y.materialIndex],b=Math.max(y.start,f.start),S=Math.min(o.count,Math.min(y.start+y.count,f.start+f.count));for(let _=b,T=S;_<T;_+=3){let M=o.getX(_),C=o.getX(_+1),P=o.getX(_+2);a=N1(this,v,t,Zf,u,h,M,C,P),a&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=y.materialIndex,i.push(a))}}else{let m=Math.max(0,f.start),g=Math.min(o.count,f.start+f.count);for(let y=m,v=g;y<v;y+=3){let b=o.getX(y),S=o.getX(y+1),_=o.getX(y+2);a=N1(this,n,t,Zf,u,h,b,S,_),a&&(a.faceIndex=Math.floor(y/3),i.push(a))}}else if(l!==void 0)if(Array.isArray(n))for(let m=0,g=c.length;m<g;m++){let y=c[m],v=n[y.materialIndex],b=Math.max(y.start,f.start),S=Math.min(l.count,Math.min(y.start+y.count,f.start+f.count));for(let _=b,T=S;_<T;_+=3){let M=_,C=_+1,P=_+2;a=N1(this,v,t,Zf,u,h,M,C,P),a&&(a.faceIndex=Math.floor(_/3),a.face.materialIndex=y.materialIndex,i.push(a))}}else{let m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let y=m,v=g;y<v;y+=3){let b=y,S=y+1,_=y+2;a=N1(this,n,t,Zf,u,h,b,S,_),a&&(a.faceIndex=Math.floor(y/3),i.push(a))}}}};function G7(e,t,i,r,n,s,a,o){let l;if(t.side===zn?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Uo,o),l===null)return null;z1.copy(o),z1.applyMatrix4(e.matrixWorld);let u=i.ray.origin.distanceTo(z1);return u<i.near||u>i.far?null:{distance:u,point:z1.clone(),object:e}}function N1(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,Vg),e.getVertexPosition(o,jg),e.getVertexPosition(l,Hg);let u=G7(e,t,i,r,Vg,jg,Hg,uA);if(u){n&&(O1.fromBufferAttribute(n,a),k1.fromBufferAttribute(n,o),L1.fromBufferAttribute(n,l),u.uv=$n.getUV(uA,Vg,jg,Hg,O1,k1,L1,new oe)),s&&(O1.fromBufferAttribute(s,a),k1.fromBufferAttribute(s,o),L1.fromBufferAttribute(s,l),u.uv2=$n.getUV(uA,Vg,jg,Hg,O1,k1,L1,new oe));let h={a,b:o,c:l,normal:new L,materialIndex:0};$n.getNormal(Vg,jg,Hg,h.normal),u.face=h}return u}var jo=class extends St{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],u=[],h=[],c=0,f=0;m("z","y","x",-1,-1,i,t,e,s,n,0),m("z","y","x",1,-1,i,t,-e,s,n,1),m("x","z","y",1,1,e,i,t,r,s,2),m("x","z","y",1,-1,e,i,-t,r,s,3),m("x","y","z",1,-1,e,t,i,r,n,4),m("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new ot(l,3)),this.setAttribute("normal",new ot(u,3)),this.setAttribute("uv",new ot(h,2));function m(g,y,v,b,S,_,T,M,C,P,E){let D=_/C,I=T/P,O=_/2,N=T/2,k=M/2,U=C+1,Q=P+1,se=0,K=0,H=new L;for(let ie=0;ie<Q;ie++){let $=ie*I-N;for(let V=0;V<U;V++){let X=V*D-O;H[g]=X*b,H[y]=$*S,H[v]=k,l.push(H.x,H.y,H.z),H[g]=0,H[y]=0,H[v]=M>0?1:-1,u.push(H.x,H.y,H.z),h.push(V/C),h.push(1-ie/P),se+=1}}for(let ie=0;ie<P;ie++)for(let $=0;$<C;$++){let V=c+$+U*ie,X=c+$+U*(ie+1),ue=c+($+1)+U*(ie+1),ne=c+($+1)+U*ie;o.push(V,X,ne),o.push(X,ue,ne),K+=6}a.addGroup(f,K,E),f+=K,c+=se}}static fromJSON(e){return new jo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function lm(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Ls(e){let t={};for(let i=0;i<e.length;i++){let r=lm(e[i]);for(let n in r)t[n]=r[n]}return t}function W7(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function p5(e){return e.getRenderTarget()===null&&e.outputEncoding===ui?wl:Fb}var Rm={clone:lm,merge:Ls},q7=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,X7=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Mi=class extends Uy{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=q7,this.fragmentShader=X7,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=lm(e.uniforms),this.uniformsGroups=W7(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},kc=class extends qi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new je,this.projectionMatrix=new je,this.projectionMatrixInverse=new je}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},vs=class extends kc{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=iy*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(kv*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return iy*2*Math.atan(Math.tan(kv*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(kv*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Jf=-90,$f=1,Y7=class extends qi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new vs(Jf,$f,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new vs(Jf,$f,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new vs(Jf,$f,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new vs(Jf,$f,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new vs(Jf,$f,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new vs(Jf,$f,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,u=e.getRenderTarget(),h=e.toneMapping,c=e.xr.enabled;e.toneMapping=Ol,e.xr.enabled=!1;let f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=f,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=h,e.xr.enabled=c,i.texture.needsPMREMUpdate=!0}},HP=class extends Ar{constructor(e,t,i,r,n,s,a,o,l,u){e=e!==void 0?e:[],t=t!==void 0?t:Bd,super(e,t,i,r,n,s,a,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Q7=class extends Pi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new HP(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:fi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new jo(5,5,5),n=new Mi({name:"CubemapFromEquirect",uniforms:lm(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:zn,blending:$r});n.uniforms.tEquirect.value=t;let s=new ar(r,n),a=t.minFilter;return t.minFilter===om&&(t.minFilter=fi),new Y7(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},hA=new L,K7=new L,Z7=new Zr,ia=class{constructor(e=new L(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=hA.subVectors(i,t).cross(K7.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(hA),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Z7.getNormalMatrix(e),r=this.coplanarPoint(hA).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},ep=new ua,B1=new L,GP=class{constructor(e=new ia,t=new ia,i=new ia,r=new ia,n=new ia,s=new ia){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],u=i[6],h=i[7],c=i[8],f=i[9],m=i[10],g=i[11],y=i[12],v=i[13],b=i[14],S=i[15];return t[0].setComponents(a-r,h-o,g-c,S-y).normalize(),t[1].setComponents(a+r,h+o,g+c,S+y).normalize(),t[2].setComponents(a+n,h+l,g+f,S+v).normalize(),t[3].setComponents(a-n,h-l,g-f,S-v).normalize(),t[4].setComponents(a-s,h-u,g-m,S-b).normalize(),t[5].setComponents(a+s,h+u,g+m,S+b).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),ep.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ep)}intersectsSprite(e){return ep.center.set(0,0,0),ep.radius=.7071067811865476,ep.applyMatrix4(e.matrixWorld),this.intersectsSphere(ep)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(B1.x=r.normal.x>0?e.max.x:e.min.x,B1.y=r.normal.y>0?e.max.y:e.min.y,B1.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(B1)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function m5(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function J7(e,t){let i=t.isWebGL2,r=new WeakMap;function n(u,h){let c=u.array,f=u.usage,m=e.createBuffer();e.bindBuffer(h,m),e.bufferData(h,c,f),u.onUploadCallback();let g;if(c instanceof Float32Array)g=5126;else if(c instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(i)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(c instanceof Int16Array)g=5122;else if(c instanceof Uint32Array)g=5125;else if(c instanceof Int32Array)g=5124;else if(c instanceof Int8Array)g=5120;else if(c instanceof Uint8Array)g=5121;else if(c instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:m,type:g,bytesPerElement:c.BYTES_PER_ELEMENT,version:u.version}}function s(u,h,c){let f=h.array,m=h.updateRange;e.bindBuffer(c,u),m.count===-1?e.bufferSubData(c,0,f):(i?e.bufferSubData(c,m.offset*f.BYTES_PER_ELEMENT,f,m.offset,m.count):e.bufferSubData(c,m.offset*f.BYTES_PER_ELEMENT,f.subarray(m.offset,m.offset+m.count)),m.count=-1),h.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),r.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);let h=r.get(u);h&&(e.deleteBuffer(h.buffer),r.delete(u))}function l(u,h){if(u.isGLBufferAttribute){let f=r.get(u);(!f||f.version<u.version)&&r.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let c=r.get(u);c===void 0?r.set(u,n(u,h)):c.version<u.version&&(s(c.buffer,u,h),c.version=u.version)}return{get:a,remove:o,update:l}}var Vl=class extends St{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,u=o+1,h=e/a,c=t/o,f=[],m=[],g=[],y=[];for(let v=0;v<u;v++){let b=v*c-s;for(let S=0;S<l;S++){let _=S*h-n;m.push(_,-b,0),g.push(0,0,1),y.push(S/a),y.push(1-v/o)}}for(let v=0;v<o;v++)for(let b=0;b<a;b++){let S=b+l*v,_=b+l*(v+1),T=b+1+l*(v+1),M=b+1+l*v;f.push(S,_,M),f.push(_,T,M)}this.setIndex(f),this.setAttribute("position",new ot(m,3)),this.setAttribute("normal",new ot(g,3)),this.setAttribute("uv",new ot(y,2))}static fromJSON(e){return new Vl(e.width,e.height,e.widthSegments,e.heightSegments)}},$7=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,eq=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tq=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,iq=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,rq=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nq=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,sq="vec3 transformed = vec3( position );",aq=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,oq=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,lq=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,uq=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,hq=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,cq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fq=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pq=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,vq=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,yq=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,xq=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bq=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wq=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_q=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Sq=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Eq=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Aq="gl_FragColor = linearToOutputTexel( gl_FragColor );",Cq=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Tq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Pq=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Mq=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Dq=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Iq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Rq=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Oq=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,kq=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Lq=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,zq=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Nq=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Bq=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Fq=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Uq=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Vq=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,jq=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Hq=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Gq=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Wq=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qq=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Xq=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Yq=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Qq=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Kq=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Zq=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Jq=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$q=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,tX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,iX=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,rX=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,sX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aX=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oX=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lX=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,uX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,hX=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,cX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,dX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,fX=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,vX=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,yX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,xX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,bX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,wX=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_X=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,SX=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,EX=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,AX=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,CX=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,TX=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,PX=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,MX=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,DX=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,IX=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RX=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,OX=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,kX=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,LX=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,zX=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,NX=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,BX=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,FX=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,UX=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,VX=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,jX=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,HX=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,GX=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,WX=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,qX=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,XX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,YX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,QX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,KX=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,ZX=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,JX=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$X=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,eY=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,iY=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rY=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,nY=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,sY=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,aY=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,oY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,lY=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,uY=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,hY=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cY=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,dY=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fY=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pY=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mY=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,gY=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vY=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,yY=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,xY=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bY=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wY=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_Y=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SY=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EY=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AY=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,CY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TY=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PY=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,MY=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,DY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,di={alphamap_fragment:$7,alphamap_pars_fragment:eq,alphatest_fragment:tq,alphatest_pars_fragment:iq,aomap_fragment:rq,aomap_pars_fragment:nq,begin_vertex:sq,beginnormal_vertex:aq,bsdfs:oq,iridescence_fragment:lq,bumpmap_pars_fragment:uq,clipping_planes_fragment:hq,clipping_planes_pars_fragment:cq,clipping_planes_pars_vertex:dq,clipping_planes_vertex:fq,color_fragment:pq,color_pars_fragment:mq,color_pars_vertex:gq,color_vertex:vq,common:yq,cube_uv_reflection_fragment:xq,defaultnormal_vertex:bq,displacementmap_pars_vertex:wq,displacementmap_vertex:_q,emissivemap_fragment:Sq,emissivemap_pars_fragment:Eq,encodings_fragment:Aq,encodings_pars_fragment:Cq,envmap_fragment:Tq,envmap_common_pars_fragment:Pq,envmap_pars_fragment:Mq,envmap_pars_vertex:Dq,envmap_physical_pars_fragment:jq,envmap_vertex:Iq,fog_vertex:Rq,fog_pars_vertex:Oq,fog_fragment:kq,fog_pars_fragment:Lq,gradientmap_pars_fragment:zq,lightmap_fragment:Nq,lightmap_pars_fragment:Bq,lights_lambert_fragment:Fq,lights_lambert_pars_fragment:Uq,lights_pars_begin:Vq,lights_toon_fragment:Hq,lights_toon_pars_fragment:Gq,lights_phong_fragment:Wq,lights_phong_pars_fragment:qq,lights_physical_fragment:Xq,lights_physical_pars_fragment:Yq,lights_fragment_begin:Qq,lights_fragment_maps:Kq,lights_fragment_end:Zq,logdepthbuf_fragment:Jq,logdepthbuf_pars_fragment:$q,logdepthbuf_pars_vertex:eX,logdepthbuf_vertex:tX,map_fragment:iX,map_pars_fragment:rX,map_particle_fragment:nX,map_particle_pars_fragment:sX,metalnessmap_fragment:aX,metalnessmap_pars_fragment:oX,morphcolor_vertex:lX,morphnormal_vertex:uX,morphtarget_pars_vertex:hX,morphtarget_vertex:cX,normal_fragment_begin:dX,normal_fragment_maps:fX,normal_pars_fragment:pX,normal_pars_vertex:mX,normal_vertex:gX,normalmap_pars_fragment:vX,clearcoat_normal_fragment_begin:yX,clearcoat_normal_fragment_maps:xX,clearcoat_pars_fragment:bX,iridescence_pars_fragment:wX,output_fragment:_X,packing:SX,premultiplied_alpha_fragment:EX,project_vertex:AX,dithering_fragment:CX,dithering_pars_fragment:TX,roughnessmap_fragment:PX,roughnessmap_pars_fragment:MX,shadowmap_pars_fragment:DX,shadowmap_pars_vertex:IX,shadowmap_vertex:RX,shadowmask_pars_fragment:OX,skinbase_vertex:kX,skinning_pars_vertex:LX,skinning_vertex:zX,skinnormal_vertex:NX,specularmap_fragment:BX,specularmap_pars_fragment:FX,tonemapping_fragment:UX,tonemapping_pars_fragment:VX,transmission_fragment:jX,transmission_pars_fragment:HX,uv_pars_fragment:GX,uv_pars_vertex:WX,uv_vertex:qX,uv2_pars_fragment:XX,uv2_pars_vertex:YX,uv2_vertex:QX,worldpos_vertex:KX,background_vert:ZX,background_frag:JX,backgroundCube_vert:$X,backgroundCube_frag:eY,cube_vert:tY,cube_frag:iY,depth_vert:rY,depth_frag:nY,distanceRGBA_vert:sY,distanceRGBA_frag:aY,equirect_vert:oY,equirect_frag:lY,linedashed_vert:uY,linedashed_frag:hY,meshbasic_vert:cY,meshbasic_frag:dY,meshlambert_vert:fY,meshlambert_frag:pY,meshmatcap_vert:mY,meshmatcap_frag:gY,meshnormal_vert:vY,meshnormal_frag:yY,meshphong_vert:xY,meshphong_frag:bY,meshphysical_vert:wY,meshphysical_frag:_Y,meshtoon_vert:SY,meshtoon_frag:EY,points_vert:AY,points_frag:CY,shadow_vert:TY,shadow_frag:PY,sprite_vert:MY,sprite_frag:DY},tt={common:{diffuse:{value:new Nt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Zr},uv2Transform:{value:new Zr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Nt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Nt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zr}},sprite:{diffuse:{value:new Nt(16777215)},opacity:{value:1},center:{value:new oe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zr}}},El={basic:{uniforms:Ls([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.fog]),vertexShader:di.meshbasic_vert,fragmentShader:di.meshbasic_frag},lambert:{uniforms:Ls([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new Nt(0)}}]),vertexShader:di.meshlambert_vert,fragmentShader:di.meshlambert_frag},phong:{uniforms:Ls([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new Nt(0)},specular:{value:new Nt(1118481)},shininess:{value:30}}]),vertexShader:di.meshphong_vert,fragmentShader:di.meshphong_frag},standard:{uniforms:Ls([tt.common,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.roughnessmap,tt.metalnessmap,tt.fog,tt.lights,{emissive:{value:new Nt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag},toon:{uniforms:Ls([tt.common,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.gradientmap,tt.fog,tt.lights,{emissive:{value:new Nt(0)}}]),vertexShader:di.meshtoon_vert,fragmentShader:di.meshtoon_frag},matcap:{uniforms:Ls([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,{matcap:{value:null}}]),vertexShader:di.meshmatcap_vert,fragmentShader:di.meshmatcap_frag},points:{uniforms:Ls([tt.points,tt.fog]),vertexShader:di.points_vert,fragmentShader:di.points_frag},dashed:{uniforms:Ls([tt.common,tt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:di.linedashed_vert,fragmentShader:di.linedashed_frag},depth:{uniforms:Ls([tt.common,tt.displacementmap]),vertexShader:di.depth_vert,fragmentShader:di.depth_frag},normal:{uniforms:Ls([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,{opacity:{value:1}}]),vertexShader:di.meshnormal_vert,fragmentShader:di.meshnormal_frag},sprite:{uniforms:Ls([tt.sprite,tt.fog]),vertexShader:di.sprite_vert,fragmentShader:di.sprite_frag},background:{uniforms:{uvTransform:{value:new Zr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:di.background_vert,fragmentShader:di.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:di.backgroundCube_vert,fragmentShader:di.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:di.cube_vert,fragmentShader:di.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:di.equirect_vert,fragmentShader:di.equirect_frag},distanceRGBA:{uniforms:Ls([tt.common,tt.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:di.distanceRGBA_vert,fragmentShader:di.distanceRGBA_frag},shadow:{uniforms:Ls([tt.lights,tt.fog,{color:{value:new Nt(0)},opacity:{value:1}}]),vertexShader:di.shadow_vert,fragmentShader:di.shadow_frag}};El.physical={uniforms:Ls([El.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new oe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Nt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Nt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Nt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag};var F1={r:0,b:0,g:0};function IY(e,t,i,r,n,s,a){let o=new Nt(0),l=s===!0?0:1,u,h,c=null,f=0,m=null;function g(v,b){let S=!1,_=b.isScene===!0?b.background:null;_&&_.isTexture&&(_=(b.backgroundBlurriness>0?i:t).get(_));let T=e.xr,M=T.getSession&&T.getSession();M&&M.environmentBlendMode==="additive"&&(_=null),_===null?y(o,l):_&&_.isColor&&(y(_,1),S=!0),(e.autoClear||S)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===Fy)?(h===void 0&&(h=new ar(new jo(1,1,1),new Mi({name:"BackgroundCubeMaterial",uniforms:lm(El.backgroundCube.uniforms),vertexShader:El.backgroundCube.vertexShader,fragmentShader:El.backgroundCube.fragmentShader,side:zn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,P,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,h.material.toneMapped=_.encoding!==ui,(c!==_||f!==_.version||m!==e.toneMapping)&&(h.material.needsUpdate=!0,c=_,f=_.version,m=e.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(u===void 0&&(u=new ar(new Vl(2,2),new Mi({name:"BackgroundMaterial",uniforms:lm(El.background.uniforms),vertexShader:El.background.vertexShader,fragmentShader:El.background.fragmentShader,side:Uo,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(u)),u.material.uniforms.t2D.value=_,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=_.encoding!==ui,_.matrixAutoUpdate===!0&&_.updateMatrix(),u.material.uniforms.uvTransform.value.copy(_.matrix),(c!==_||f!==_.version||m!==e.toneMapping)&&(u.material.needsUpdate=!0,c=_,f=_.version,m=e.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null))}function y(v,b){v.getRGB(F1,p5(e)),r.buffers.color.setClear(F1.r,F1.g,F1.b,b,a)}return{getClearColor:function(){return o},setClearColor:function(v,b=1){o.set(v),l=b,y(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,y(o,l)},render:g}}function RY(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=v(null),u=l,h=!1;function c(U,Q,se,K,H){let ie=!1;if(a){let $=y(K,se,Q);u!==$&&(u=$,m(u.object)),ie=b(U,K,se,H),ie&&S(U,K,se,H)}else{let $=Q.wireframe===!0;(u.geometry!==K.id||u.program!==se.id||u.wireframe!==$)&&(u.geometry=K.id,u.program=se.id,u.wireframe=$,ie=!0)}H!==null&&i.update(H,34963),(ie||h)&&(h=!1,E(U,Q,se,K),H!==null&&e.bindBuffer(34963,i.get(H).buffer))}function f(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function m(U){return r.isWebGL2?e.bindVertexArray(U):s.bindVertexArrayOES(U)}function g(U){return r.isWebGL2?e.deleteVertexArray(U):s.deleteVertexArrayOES(U)}function y(U,Q,se){let K=se.wireframe===!0,H=o[U.id];H===void 0&&(H={},o[U.id]=H);let ie=H[Q.id];ie===void 0&&(ie={},H[Q.id]=ie);let $=ie[K];return $===void 0&&($=v(f()),ie[K]=$),$}function v(U){let Q=[],se=[],K=[];for(let H=0;H<n;H++)Q[H]=0,se[H]=0,K[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Q,enabledAttributes:se,attributeDivisors:K,object:U,attributes:{},index:null}}function b(U,Q,se,K){let H=u.attributes,ie=Q.attributes,$=0,V=se.getAttributes();for(let X in V)if(V[X].location>=0){let ue=H[X],ne=ie[X];if(ne===void 0&&(X==="instanceMatrix"&&U.instanceMatrix&&(ne=U.instanceMatrix),X==="instanceColor"&&U.instanceColor&&(ne=U.instanceColor)),ue===void 0||ue.attribute!==ne||ne&&ue.data!==ne.data)return!0;$++}return u.attributesNum!==$||u.index!==K}function S(U,Q,se,K){let H={},ie=Q.attributes,$=0,V=se.getAttributes();for(let X in V)if(V[X].location>=0){let ue=ie[X];ue===void 0&&(X==="instanceMatrix"&&U.instanceMatrix&&(ue=U.instanceMatrix),X==="instanceColor"&&U.instanceColor&&(ue=U.instanceColor));let ne={};ne.attribute=ue,ue&&ue.data&&(ne.data=ue.data),H[X]=ne,$++}u.attributes=H,u.attributesNum=$,u.index=K}function _(){let U=u.newAttributes;for(let Q=0,se=U.length;Q<se;Q++)U[Q]=0}function T(U){M(U,0)}function M(U,Q){let se=u.newAttributes,K=u.enabledAttributes,H=u.attributeDivisors;se[U]=1,K[U]===0&&(e.enableVertexAttribArray(U),K[U]=1),H[U]!==Q&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](U,Q),H[U]=Q)}function C(){let U=u.newAttributes,Q=u.enabledAttributes;for(let se=0,K=Q.length;se<K;se++)Q[se]!==U[se]&&(e.disableVertexAttribArray(se),Q[se]=0)}function P(U,Q,se,K,H,ie){r.isWebGL2===!0&&(se===5124||se===5125)?e.vertexAttribIPointer(U,Q,se,H,ie):e.vertexAttribPointer(U,Q,se,K,H,ie)}function E(U,Q,se,K){if(r.isWebGL2===!1&&(U.isInstancedMesh||K.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();let H=K.attributes,ie=se.getAttributes(),$=Q.defaultAttributeValues;for(let V in ie){let X=ie[V];if(X.location>=0){let ue=H[V];if(ue===void 0&&(V==="instanceMatrix"&&U.instanceMatrix&&(ue=U.instanceMatrix),V==="instanceColor"&&U.instanceColor&&(ue=U.instanceColor)),ue!==void 0){let ne=ue.normalized,he=ue.itemSize,te=i.get(ue);if(te===void 0)continue;let me=te.buffer,de=te.type,fe=te.bytesPerElement;if(ue.isInterleavedBufferAttribute){let ye=ue.data,Te=ye.stride,Ie=ue.offset;if(ye.isInstancedInterleavedBuffer){for(let Ne=0;Ne<X.locationSize;Ne++)M(X.location+Ne,ye.meshPerAttribute);U.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=ye.meshPerAttribute*ye.count)}else for(let Ne=0;Ne<X.locationSize;Ne++)T(X.location+Ne);e.bindBuffer(34962,me);for(let Ne=0;Ne<X.locationSize;Ne++)P(X.location+Ne,he/X.locationSize,de,ne,Te*fe,(Ie+he/X.locationSize*Ne)*fe)}else{if(ue.isInstancedBufferAttribute){for(let ye=0;ye<X.locationSize;ye++)M(X.location+ye,ue.meshPerAttribute);U.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=ue.meshPerAttribute*ue.count)}else for(let ye=0;ye<X.locationSize;ye++)T(X.location+ye);e.bindBuffer(34962,me);for(let ye=0;ye<X.locationSize;ye++)P(X.location+ye,he/X.locationSize,de,ne,he*fe,he/X.locationSize*ye*fe)}}else if($!==void 0){let ne=$[V];if(ne!==void 0)switch(ne.length){case 2:e.vertexAttrib2fv(X.location,ne);break;case 3:e.vertexAttrib3fv(X.location,ne);break;case 4:e.vertexAttrib4fv(X.location,ne);break;default:e.vertexAttrib1fv(X.location,ne)}}}}C()}function D(){N();for(let U in o){let Q=o[U];for(let se in Q){let K=Q[se];for(let H in K)g(K[H].object),delete K[H];delete Q[se]}delete o[U]}}function I(U){if(o[U.id]===void 0)return;let Q=o[U.id];for(let se in Q){let K=Q[se];for(let H in K)g(K[H].object),delete K[H];delete Q[se]}delete o[U.id]}function O(U){for(let Q in o){let se=o[Q];if(se[U.id]===void 0)continue;let K=se[U.id];for(let H in K)g(K[H].object),delete K[H];delete se[U.id]}}function N(){k(),h=!0,u!==l&&(u=l,m(u.object))}function k(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:c,reset:N,resetDefaultState:k,dispose:D,releaseStatesOfGeometry:I,releaseStatesOfProgram:O,initAttributes:_,enableAttribute:T,disableUnusedAttributes:C}}function OY(e,t,i,r){let n=r.isWebGL2,s;function a(u){s=u}function o(u,h){e.drawArrays(s,u,h),i.update(h,s,1)}function l(u,h,c){if(c===0)return;let f,m;if(n)f=e,m="drawArraysInstanced";else if(f=t.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[m](s,u,h,c),i.update(h,s,c)}this.setMode=a,this.render=o,this.renderInstances=l}function kY(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let P=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(P){if(P==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";P="mediump"}return P==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let u=a||t.has("WEBGL_draw_buffers"),h=i.logarithmicDepthBuffer===!0,c=e.getParameter(34930),f=e.getParameter(35660),m=e.getParameter(3379),g=e.getParameter(34076),y=e.getParameter(34921),v=e.getParameter(36347),b=e.getParameter(36348),S=e.getParameter(36349),_=f>0,T=a||t.has("OES_texture_float"),M=_&&T,C=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:f,maxTextureSize:m,maxCubemapSize:g,maxAttributes:y,maxVertexUniforms:v,maxVaryings:b,maxFragmentUniforms:S,vertexTextures:_,floatFragmentTextures:T,floatVertexTextures:M,maxSamples:C}}function LY(e){let t=this,i=null,r=0,n=!1,s=!1,a=new ia,o=new Zr,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,f){let m=c.length!==0||f||r!==0||n;return n=f,r=c.length,m},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(c,f){i=h(c,f,0)},this.setState=function(c,f,m){let g=c.clippingPlanes,y=c.clipIntersection,v=c.clipShadows,b=e.get(c);if(!n||g===null||g.length===0||s&&!v)s?h(null):u();else{let S=s?0:r,_=S*4,T=b.clippingState||null;l.value=T,T=h(g,f,_,m);for(let M=0;M!==_;++M)T[M]=i[M];b.clippingState=T,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=S}};function u(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function h(c,f,m,g){let y=c!==null?c.length:0,v=null;if(y!==0){if(v=l.value,g!==!0||v===null){let b=m+y*4,S=f.matrixWorldInverse;o.getNormalMatrix(S),(v===null||v.length<b)&&(v=new Float32Array(b));for(let _=0,T=m;_!==y;++_,T+=4)a.copy(c[_]).applyMatrix4(S,o),a.normal.toArray(v,T),v[T+3]=a.constant}l.value=v,l.needsUpdate=!0}return t.numPlanes=y,t.numIntersection=0,v}}function zY(e){let t=new WeakMap;function i(a,o){return o===aT?a.mapping=Bd:o===oT&&(a.mapping=Fd),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===aT||o===oT)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let u=new Q7(l.height/2);return u.fromEquirectangularTexture(e,a),t.set(a,u),a.addEventListener("dispose",n),i(u.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var p_=class extends kc{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=u*this.view.offsetY,o=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Np=4,_3=[.125,.215,.35,.446,.526,.582],md=20,cA=new p_,S3=new Nt,dA=null,hd=(1+Math.sqrt(5))/2,tp=1/hd,E3=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,hd,tp),new L(0,hd,-tp),new L(tp,0,hd),new L(-tp,0,hd),new L(hd,tp,0),new L(-hd,tp,0)],A3=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){dA=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=P3(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=T3(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(dA),e.scissorTest=!1,U1(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Bd||e.mapping===Fd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),dA=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:fi,minFilter:fi,generateMipmaps:!1,type:Gu,format:br,encoding:Vo,depthBuffer:!1},r=C3(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=C3(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=NY(n)),this._blurMaterial=BY(n,e,t)}return r}_compileMaterial(e){let t=new ar(this._lodPlanes[0],e);this._renderer.compile(t,cA)}_sceneToCubeUV(e,t,i,r){let n=new vs(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,u=o.toneMapping;o.getClearColor(S3),o.toneMapping=Ol,o.autoClear=!1;let h=new Wu({name:"PMREM.Background",side:zn,depthWrite:!1,depthTest:!1}),c=new ar(new jo,h),f=!1,m=e.background;m?m.isColor&&(h.color.copy(m),e.background=null,f=!0):(h.color.copy(S3),f=!0);for(let g=0;g<6;g++){let y=g%3;y===0?(n.up.set(0,s[g],0),n.lookAt(a[g],0,0)):y===1?(n.up.set(0,0,s[g]),n.lookAt(0,a[g],0)):(n.up.set(0,s[g],0),n.lookAt(0,0,a[g]));let v=this._cubeSize;U1(r,y*v,g>2?v:0,v,v),o.setRenderTarget(r),f&&o.render(c,n),o.render(e,n)}c.geometry.dispose(),c.material.dispose(),o.toneMapping=u,o.autoClear=l,e.background=m}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===Bd||e.mapping===Fd;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=P3()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=T3());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new ar(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;U1(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,cA)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=E3[(r-1)%E3.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,h=new ar(this._lodPlanes[r],l),c=l.uniforms,f=this._sizeLods[i]-1,m=isFinite(n)?Math.PI/(2*f):2*Math.PI/(2*md-1),g=n/m,y=isFinite(n)?1+Math.floor(u*g):md;y>md&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${md}`);let v=[],b=0;for(let C=0;C<md;++C){let P=C/g,E=Math.exp(-P*P/2);v.push(E),C===0?b+=E:C<y&&(b+=2*E)}for(let C=0;C<v.length;C++)v[C]=v[C]/b;c.envMap.value=e.texture,c.samples.value=y,c.weights.value=v,c.latitudinal.value=s==="latitudinal",a&&(c.poleAxis.value=a);let{_lodMax:S}=this;c.dTheta.value=m,c.mipInt.value=S-i;let _=this._sizeLods[r],T=3*_*(r>S-Np?r-S+Np:0),M=4*(this._cubeSize-_);U1(t,T,M,3*_,2*_),o.setRenderTarget(t),o.render(h,cA)}};function NY(e){let t=[],i=[],r=[],n=e,s=e-Np+1+_3.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-Np?l=_3[a-e+Np-1]:a===0&&(l=0),r.push(l);let u=1/(o-2),h=-u,c=1+u,f=[h,h,c,h,c,c,h,h,c,c,h,c],m=6,g=6,y=3,v=2,b=1,S=new Float32Array(y*g*m),_=new Float32Array(v*g*m),T=new Float32Array(b*g*m);for(let C=0;C<m;C++){let P=C%3*2/3-1,E=C>2?0:-1,D=[P,E,0,P+2/3,E,0,P+2/3,E+1,0,P,E,0,P+2/3,E+1,0,P,E+1,0];S.set(D,y*g*C),_.set(f,v*g*C);let I=[C,C,C,C,C,C];T.set(I,b*g*C)}let M=new St;M.setAttribute("position",new Bt(S,y)),M.setAttribute("uv",new Bt(_,v)),M.setAttribute("faceIndex",new Bt(T,b)),t.push(M),n>Np&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function C3(e,t,i){let r=new Pi(e,t,i);return r.texture.mapping=Fy,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function U1(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function BY(e,t,i){let r=new Float32Array(md),n=new L(0,1,0);return new Mi({name:"SphericalGaussianBlur",defines:{n:md,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:WP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:$r,depthTest:!1,depthWrite:!1})}function T3(){return new Mi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:WP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:$r,depthTest:!1,depthWrite:!1})}function P3(){return new Mi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:WP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:$r,depthTest:!1,depthWrite:!1})}function WP(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function FY(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,u=l===aT||l===oT,h=l===Bd||l===Fd;if(u||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let c=t.get(o);return i===null&&(i=new A3(e)),c=u?i.fromEquirectangular(o,c):i.fromCubemap(o,c),t.set(o,c),c.texture}else{if(t.has(o))return t.get(o).texture;{let c=o.image;if(u&&c&&c.height>0||h&&c&&n(c)){i===null&&(i=new A3(e));let f=u?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,f),o.addEventListener("dispose",s),f.texture}else return null}}}return o}function n(o){let l=0,u=6;for(let h=0;h<u;h++)o[h]!==void 0&&l++;return l===u}function s(o){let l=o.target;l.removeEventListener("dispose",s);let u=t.get(l);u!==void 0&&(t.delete(l),u.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function UY(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function VY(e,t,i,r){let n={},s=new WeakMap;function a(c){let f=c.target;f.index!==null&&t.remove(f.index);for(let g in f.attributes)t.remove(f.attributes[g]);f.removeEventListener("dispose",a),delete n[f.id];let m=s.get(f);m&&(t.remove(m),s.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,i.memory.geometries--}function o(c,f){return n[f.id]===!0||(f.addEventListener("dispose",a),n[f.id]=!0,i.memory.geometries++),f}function l(c){let f=c.attributes;for(let g in f)t.update(f[g],34962);let m=c.morphAttributes;for(let g in m){let y=m[g];for(let v=0,b=y.length;v<b;v++)t.update(y[v],34962)}}function u(c){let f=[],m=c.index,g=c.attributes.position,y=0;if(m!==null){let S=m.array;y=m.version;for(let _=0,T=S.length;_<T;_+=3){let M=S[_+0],C=S[_+1],P=S[_+2];f.push(M,C,C,P,P,M)}}else{let S=g.array;y=g.version;for(let _=0,T=S.length/3-1;_<T;_+=3){let M=_+0,C=_+1,P=_+2;f.push(M,C,C,P,P,M)}}let v=new(o5(f)?Hp:f5)(f,1);v.version=y;let b=s.get(c);b&&t.remove(b),s.set(c,v)}function h(c){let f=s.get(c);if(f){let m=c.index;m!==null&&f.version<m.version&&u(c)}else u(c);return s.get(c)}return{get:o,update:l,getWireframeAttribute:h}}function jY(e,t,i,r){let n=r.isWebGL2,s;function a(f){s=f}let o,l;function u(f){o=f.type,l=f.bytesPerElement}function h(f,m){e.drawElements(s,m,o,f*l),i.update(m,s,1)}function c(f,m,g){if(g===0)return;let y,v;if(n)y=e,v="drawElementsInstanced";else if(y=t.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[v](s,m,o,f*l,g),i.update(m,s,g)}this.setMode=a,this.setIndex=u,this.render=h,this.renderInstances=c}function HY(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function GY(e,t){return e[0]-t[0]}function WY(e,t){return Math.abs(t[1])-Math.abs(e[1])}function qY(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new Yt,o=[];for(let u=0;u<8;u++)o[u]=[u,0];function l(u,h,c,f){let m=u.morphTargetInfluences;if(t.isWebGL2===!0){let g=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,y=g!==void 0?g.length:0,v=s.get(h);if(v===void 0||v.count!==y){let _=function(){U.dispose(),s.delete(h),h.removeEventListener("dispose",_)};v!==void 0&&v.texture.dispose();let T=h.morphAttributes.position!==void 0,M=h.morphAttributes.normal!==void 0,C=h.morphAttributes.color!==void 0,P=h.morphAttributes.position||[],E=h.morphAttributes.normal||[],D=h.morphAttributes.color||[],I=0;T===!0&&(I=1),M===!0&&(I=2),C===!0&&(I=3);let O=h.attributes.position.count*I,N=1;O>t.maxTextureSize&&(N=Math.ceil(O/t.maxTextureSize),O=t.maxTextureSize);let k=new Float32Array(O*N*4*y),U=new c5(k,O,N,y);U.type=Ki,U.needsUpdate=!0;let Q=I*4;for(let se=0;se<y;se++){let K=P[se],H=E[se],ie=D[se],$=O*N*4*se;for(let V=0;V<K.count;V++){let X=V*Q;T===!0&&(a.fromBufferAttribute(K,V),k[$+X+0]=a.x,k[$+X+1]=a.y,k[$+X+2]=a.z,k[$+X+3]=0),M===!0&&(a.fromBufferAttribute(H,V),k[$+X+4]=a.x,k[$+X+5]=a.y,k[$+X+6]=a.z,k[$+X+7]=0),C===!0&&(a.fromBufferAttribute(ie,V),k[$+X+8]=a.x,k[$+X+9]=a.y,k[$+X+10]=a.z,k[$+X+11]=ie.itemSize===4?a.w:1)}}v={count:y,texture:U,size:new oe(O,N)},s.set(h,v),h.addEventListener("dispose",_)}let b=0;for(let _=0;_<m.length;_++)b+=m[_];let S=h.morphTargetsRelative?1:1-b;f.getUniforms().setValue(e,"morphTargetBaseInfluence",S),f.getUniforms().setValue(e,"morphTargetInfluences",m),f.getUniforms().setValue(e,"morphTargetsTexture",v.texture,i),f.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{let g=m===void 0?0:m.length,y=r[h.id];if(y===void 0||y.length!==g){y=[];for(let T=0;T<g;T++)y[T]=[T,0];r[h.id]=y}for(let T=0;T<g;T++){let M=y[T];M[0]=T,M[1]=m[T]}y.sort(WY);for(let T=0;T<8;T++)T<g&&y[T][1]?(o[T][0]=y[T][0],o[T][1]=y[T][1]):(o[T][0]=Number.MAX_SAFE_INTEGER,o[T][1]=0);o.sort(GY);let v=h.morphAttributes.position,b=h.morphAttributes.normal,S=0;for(let T=0;T<8;T++){let M=o[T],C=M[0],P=M[1];C!==Number.MAX_SAFE_INTEGER&&P?(v&&h.getAttribute("morphTarget"+T)!==v[C]&&h.setAttribute("morphTarget"+T,v[C]),b&&h.getAttribute("morphNormal"+T)!==b[C]&&h.setAttribute("morphNormal"+T,b[C]),n[T]=P,S+=P):(v&&h.hasAttribute("morphTarget"+T)===!0&&h.deleteAttribute("morphTarget"+T),b&&h.hasAttribute("morphNormal"+T)===!0&&h.deleteAttribute("morphNormal"+T),n[T]=0)}let _=h.morphTargetsRelative?1:1-S;f.getUniforms().setValue(e,"morphTargetBaseInfluence",_),f.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function XY(e,t,i,r){let n=new WeakMap;function s(l){let u=r.render.frame,h=l.geometry,c=t.get(l,h);return n.get(c)!==u&&(t.update(c),n.set(c,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),c}function a(){n=new WeakMap}function o(l){let u=l.target;u.removeEventListener("dispose",o),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:s,dispose:a}}var g5=new Ar,v5=new c5,y5=new k7,x5=new HP,M3=[],D3=[],I3=new Float32Array(16),R3=new Float32Array(9),O3=new Float32Array(4);function Om(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=M3[n];if(s===void 0&&(s=new Float32Array(n),M3[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function yn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function xn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function m_(e,t){let i=D3[t];i===void 0&&(i=new Int32Array(t),D3[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function YY(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function QY(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yn(i,t))return;e.uniform2fv(this.addr,t),xn(i,t)}}function KY(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(yn(i,t))return;e.uniform3fv(this.addr,t),xn(i,t)}}function ZY(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yn(i,t))return;e.uniform4fv(this.addr,t),xn(i,t)}}function JY(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(yn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),xn(i,t)}else{if(yn(i,r))return;O3.set(r),e.uniformMatrix2fv(this.addr,!1,O3),xn(i,r)}}function $Y(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(yn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),xn(i,t)}else{if(yn(i,r))return;R3.set(r),e.uniformMatrix3fv(this.addr,!1,R3),xn(i,r)}}function eQ(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(yn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),xn(i,t)}else{if(yn(i,r))return;I3.set(r),e.uniformMatrix4fv(this.addr,!1,I3),xn(i,r)}}function tQ(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function iQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yn(i,t))return;e.uniform2iv(this.addr,t),xn(i,t)}}function rQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(yn(i,t))return;e.uniform3iv(this.addr,t),xn(i,t)}}function nQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yn(i,t))return;e.uniform4iv(this.addr,t),xn(i,t)}}function sQ(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function aQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yn(i,t))return;e.uniform2uiv(this.addr,t),xn(i,t)}}function oQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(yn(i,t))return;e.uniform3uiv(this.addr,t),xn(i,t)}}function lQ(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yn(i,t))return;e.uniform4uiv(this.addr,t),xn(i,t)}}function uQ(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||g5,n)}function hQ(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||y5,n)}function cQ(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||x5,n)}function dQ(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||v5,n)}function fQ(e){switch(e){case 5126:return YY;case 35664:return QY;case 35665:return KY;case 35666:return ZY;case 35674:return JY;case 35675:return $Y;case 35676:return eQ;case 5124:case 35670:return tQ;case 35667:case 35671:return iQ;case 35668:case 35672:return rQ;case 35669:case 35673:return nQ;case 5125:return sQ;case 36294:return aQ;case 36295:return oQ;case 36296:return lQ;case 35678:case 36198:case 36298:case 36306:case 35682:return uQ;case 35679:case 36299:case 36307:return hQ;case 35680:case 36300:case 36308:case 36293:return cQ;case 36289:case 36303:case 36311:case 36292:return dQ}}function pQ(e,t){e.uniform1fv(this.addr,t)}function mQ(e,t){let i=Om(t,this.size,2);e.uniform2fv(this.addr,i)}function gQ(e,t){let i=Om(t,this.size,3);e.uniform3fv(this.addr,i)}function vQ(e,t){let i=Om(t,this.size,4);e.uniform4fv(this.addr,i)}function yQ(e,t){let i=Om(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function xQ(e,t){let i=Om(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function bQ(e,t){let i=Om(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function wQ(e,t){e.uniform1iv(this.addr,t)}function _Q(e,t){e.uniform2iv(this.addr,t)}function SQ(e,t){e.uniform3iv(this.addr,t)}function EQ(e,t){e.uniform4iv(this.addr,t)}function AQ(e,t){e.uniform1uiv(this.addr,t)}function CQ(e,t){e.uniform2uiv(this.addr,t)}function TQ(e,t){e.uniform3uiv(this.addr,t)}function PQ(e,t){e.uniform4uiv(this.addr,t)}function MQ(e,t,i){let r=this.cache,n=t.length,s=m_(i,n);yn(r,s)||(e.uniform1iv(this.addr,s),xn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||g5,s[a])}function DQ(e,t,i){let r=this.cache,n=t.length,s=m_(i,n);yn(r,s)||(e.uniform1iv(this.addr,s),xn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||y5,s[a])}function IQ(e,t,i){let r=this.cache,n=t.length,s=m_(i,n);yn(r,s)||(e.uniform1iv(this.addr,s),xn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||x5,s[a])}function RQ(e,t,i){let r=this.cache,n=t.length,s=m_(i,n);yn(r,s)||(e.uniform1iv(this.addr,s),xn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||v5,s[a])}function OQ(e){switch(e){case 5126:return pQ;case 35664:return mQ;case 35665:return gQ;case 35666:return vQ;case 35674:return yQ;case 35675:return xQ;case 35676:return bQ;case 5124:case 35670:return wQ;case 35667:case 35671:return _Q;case 35668:case 35672:return SQ;case 35669:case 35673:return EQ;case 5125:return AQ;case 36294:return CQ;case 36295:return TQ;case 36296:return PQ;case 35678:case 36198:case 36298:case 36306:case 35682:return MQ;case 35679:case 36299:case 36307:return DQ;case 35680:case 36300:case 36308:case 36293:return IQ;case 36289:case 36303:case 36311:case 36292:return RQ}}var kQ=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=fQ(t.type)}},LQ=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=OQ(t.type)}},zQ=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},fA=/(\w+)(\])?(\[|\.)?/g;function k3(e,t){e.seq.push(t),e.map[t.id]=t}function NQ(e,t,i){let r=e.name,n=r.length;for(fA.lastIndex=0;;){let s=fA.exec(r),a=fA.lastIndex,o=s[1],l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===n){k3(i,u===void 0?new kQ(o,e,t):new LQ(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new zQ(o),k3(i,h)),i=h}}}var lb=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);NQ(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function L3(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var BQ=0;function FQ(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function UQ(e){switch(e){case Vo:return["Linear","( value )"];case ui:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function z3(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+FQ(e.getShaderSource(t),a)}else return n}function VQ(e,t){let i=UQ(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function jQ(e,t){let i;switch(t){case Q8:i="Linear";break;case K8:i="Reinhard";break;case Z8:i="OptimizedCineon";break;case J8:i="ACESFilmic";break;case $8:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function HQ(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(xv).join(`
`)}function GQ(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function WQ(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function xv(e){return e!==""}function N3(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function B3(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var qQ=/^[ \t]*#include +<([\w\d./]+)>/gm;function fT(e){return e.replace(qQ,XQ)}function XQ(e,t){let i=di[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return fT(i)}var YQ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function F3(e){return e.replace(YQ,QQ)}function QQ(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function U3(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function KQ(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===BP?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===T8?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===yv&&(t="SHADOWMAP_TYPE_VSM"),t}function ZQ(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Bd:case Fd:t="ENVMAP_TYPE_CUBE";break;case Fy:t="ENVMAP_TYPE_CUBE_UV";break}return t}function JQ(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Fd:t="ENVMAP_MODE_REFRACTION";break}return t}function $Q(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case $F:t="ENVMAP_BLENDING_MULTIPLY";break;case X8:t="ENVMAP_BLENDING_MIX";break;case Y8:t="ENVMAP_BLENDING_ADD";break}return t}function eK(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function tK(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=KQ(i),u=ZQ(i),h=JQ(i),c=$Q(i),f=eK(i),m=i.isWebGL2?"":HQ(i),g=GQ(s),y=n.createProgram(),v,b,S=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=[g].filter(xv).join(`
`),v.length>0&&(v+=`
`),b=[m,g].filter(xv).join(`
`),b.length>0&&(b+=`
`)):(v=[U3(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(xv).join(`
`),b=[m,U3(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Ol?"#define TONE_MAPPING":"",i.toneMapping!==Ol?di.tonemapping_pars_fragment:"",i.toneMapping!==Ol?jQ("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",di.encodings_pars_fragment,VQ("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(xv).join(`
`)),a=fT(a),a=N3(a,i),a=B3(a,i),o=fT(o),o=N3(o,i),o=B3(o,i),a=F3(a),o=F3(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,b=["#define varying in",i.glslVersion===hT?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===hT?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);let _=S+v+a,T=S+b+o,M=L3(n,35633,_),C=L3(n,35632,T);if(n.attachShader(y,M),n.attachShader(y,C),i.index0AttributeName!==void 0?n.bindAttribLocation(y,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(y,0,"position"),n.linkProgram(y),e.debug.checkShaderErrors){let D=n.getProgramInfoLog(y).trim(),I=n.getShaderInfoLog(M).trim(),O=n.getShaderInfoLog(C).trim(),N=!0,k=!0;if(n.getProgramParameter(y,35714)===!1){N=!1;let U=z3(n,M,"vertex"),Q=z3(n,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(y,35715)+`

Program Info Log: `+D+`
`+U+`
`+Q)}else D!==""?console.warn("THREE.WebGLProgram: Program Info Log:",D):(I===""||O==="")&&(k=!1);k&&(this.diagnostics={runnable:N,programLog:D,vertexShader:{log:I,prefix:v},fragmentShader:{log:O,prefix:b}})}n.deleteShader(M),n.deleteShader(C);let P;this.getUniforms=function(){return P===void 0&&(P=new lb(n,y)),P};let E;return this.getAttributes=function(){return E===void 0&&(E=WQ(n,y)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=BQ++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=C,this}var iK=0,rK=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new nK(e),t.set(e,i)),i}},nK=class{constructor(e){this.id=iK++,this.code=e,this.usedTimes=0}};function sK(e,t,i,r,n,s,a){let o=new jP,l=new rK,u=[],h=n.isWebGL2,c=n.logarithmicDepthBuffer,f=n.vertexTextures,m=n.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(E,D,I,O,N){let k=O.fog,U=N.geometry,Q=E.isMeshStandardMaterial?O.environment:null,se=(E.isMeshStandardMaterial?i:t).get(E.envMap||Q),K=se&&se.mapping===Fy?se.image.height:null,H=g[E.type];E.precision!==null&&(m=n.getMaxPrecision(E.precision),m!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",m,"instead."));let ie=U.morphAttributes.position||U.morphAttributes.normal||U.morphAttributes.color,$=ie!==void 0?ie.length:0,V=0;U.morphAttributes.position!==void 0&&(V=1),U.morphAttributes.normal!==void 0&&(V=2),U.morphAttributes.color!==void 0&&(V=3);let X,ue,ne,he;if(H){let ye=El[H];X=ye.vertexShader,ue=ye.fragmentShader}else X=E.vertexShader,ue=E.fragmentShader,l.update(E),ne=l.getVertexShaderID(E),he=l.getFragmentShaderID(E);let te=e.getRenderTarget(),me=E.alphaTest>0,de=E.clearcoat>0,fe=E.iridescence>0;return{isWebGL2:h,shaderID:H,shaderName:E.type,vertexShader:X,fragmentShader:ue,defines:E.defines,customVertexShaderID:ne,customFragmentShaderID:he,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:m,instancing:N.isInstancedMesh===!0,instancingColor:N.isInstancedMesh===!0&&N.instanceColor!==null,supportsVertexTextures:f,outputEncoding:te===null?e.outputEncoding:te.isXRRenderTarget===!0?te.texture.encoding:Vo,map:!!E.map,matcap:!!E.matcap,envMap:!!se,envMapMode:se&&se.mapping,envMapCubeUVHeight:K,lightMap:!!E.lightMap,aoMap:!!E.aoMap,emissiveMap:!!E.emissiveMap,bumpMap:!!E.bumpMap,normalMap:!!E.normalMap,objectSpaceNormalMap:E.normalMapType===m7,tangentSpaceNormalMap:E.normalMapType===p7,decodeVideoTexture:!!E.map&&E.map.isVideoTexture===!0&&E.map.encoding===ui,clearcoat:de,clearcoatMap:de&&!!E.clearcoatMap,clearcoatRoughnessMap:de&&!!E.clearcoatRoughnessMap,clearcoatNormalMap:de&&!!E.clearcoatNormalMap,iridescence:fe,iridescenceMap:fe&&!!E.iridescenceMap,iridescenceThicknessMap:fe&&!!E.iridescenceThicknessMap,displacementMap:!!E.displacementMap,roughnessMap:!!E.roughnessMap,metalnessMap:!!E.metalnessMap,specularMap:!!E.specularMap,specularIntensityMap:!!E.specularIntensityMap,specularColorMap:!!E.specularColorMap,opaque:E.transparent===!1&&E.blending===Id,alphaMap:!!E.alphaMap,alphaTest:me,gradientMap:!!E.gradientMap,sheen:E.sheen>0,sheenColorMap:!!E.sheenColorMap,sheenRoughnessMap:!!E.sheenRoughnessMap,transmission:E.transmission>0,transmissionMap:!!E.transmissionMap,thicknessMap:!!E.thicknessMap,combine:E.combine,vertexTangents:!!E.normalMap&&!!U.attributes.tangent,vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!U.attributes.color&&U.attributes.color.itemSize===4,vertexUvs:!!E.map||!!E.bumpMap||!!E.normalMap||!!E.specularMap||!!E.alphaMap||!!E.emissiveMap||!!E.roughnessMap||!!E.metalnessMap||!!E.clearcoatMap||!!E.clearcoatRoughnessMap||!!E.clearcoatNormalMap||!!E.iridescenceMap||!!E.iridescenceThicknessMap||!!E.displacementMap||!!E.transmissionMap||!!E.thicknessMap||!!E.specularIntensityMap||!!E.specularColorMap||!!E.sheenColorMap||!!E.sheenRoughnessMap,uvsVertexOnly:!(E.map||E.bumpMap||E.normalMap||E.specularMap||E.alphaMap||E.emissiveMap||E.roughnessMap||E.metalnessMap||E.clearcoatNormalMap||E.iridescenceMap||E.iridescenceThicknessMap||E.transmission>0||E.transmissionMap||E.thicknessMap||E.specularIntensityMap||E.specularColorMap||E.sheen>0||E.sheenColorMap||E.sheenRoughnessMap)&&!!E.displacementMap,fog:!!k,useFog:E.fog===!0,fogExp2:k&&k.isFogExp2,flatShading:!!E.flatShading,sizeAttenuation:E.sizeAttenuation,logarithmicDepthBuffer:c,skinning:N.isSkinnedMesh===!0,morphTargets:U.morphAttributes.position!==void 0,morphNormals:U.morphAttributes.normal!==void 0,morphColors:U.morphAttributes.color!==void 0,morphTargetsCount:$,morphTextureStride:V,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:e.shadowMap.enabled&&I.length>0,shadowMapType:e.shadowMap.type,toneMapping:E.toneMapped?e.toneMapping:Ol,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===bs,flipSided:E.side===zn,useDepthPacking:!!E.depthPacking,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:E.extensions&&E.extensions.derivatives,extensionFragDepth:E.extensions&&E.extensions.fragDepth,extensionDrawBuffers:E.extensions&&E.extensions.drawBuffers,extensionShaderTextureLOD:E.extensions&&E.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function v(E){let D=[];if(E.shaderID?D.push(E.shaderID):(D.push(E.customVertexShaderID),D.push(E.customFragmentShaderID)),E.defines!==void 0)for(let I in E.defines)D.push(I),D.push(E.defines[I]);return E.isRawShaderMaterial===!1&&(b(D,E),S(D,E),D.push(e.outputEncoding)),D.push(E.customProgramCacheKey),D.join()}function b(E,D){E.push(D.precision),E.push(D.outputEncoding),E.push(D.envMapMode),E.push(D.envMapCubeUVHeight),E.push(D.combine),E.push(D.vertexUvs),E.push(D.fogExp2),E.push(D.sizeAttenuation),E.push(D.morphTargetsCount),E.push(D.morphAttributeCount),E.push(D.numDirLights),E.push(D.numPointLights),E.push(D.numSpotLights),E.push(D.numSpotLightMaps),E.push(D.numHemiLights),E.push(D.numRectAreaLights),E.push(D.numDirLightShadows),E.push(D.numPointLightShadows),E.push(D.numSpotLightShadows),E.push(D.numSpotLightShadowsWithMaps),E.push(D.shadowMapType),E.push(D.toneMapping),E.push(D.numClippingPlanes),E.push(D.numClipIntersection),E.push(D.depthPacking)}function S(E,D){o.disableAll(),D.isWebGL2&&o.enable(0),D.supportsVertexTextures&&o.enable(1),D.instancing&&o.enable(2),D.instancingColor&&o.enable(3),D.map&&o.enable(4),D.matcap&&o.enable(5),D.envMap&&o.enable(6),D.lightMap&&o.enable(7),D.aoMap&&o.enable(8),D.emissiveMap&&o.enable(9),D.bumpMap&&o.enable(10),D.normalMap&&o.enable(11),D.objectSpaceNormalMap&&o.enable(12),D.tangentSpaceNormalMap&&o.enable(13),D.clearcoat&&o.enable(14),D.clearcoatMap&&o.enable(15),D.clearcoatRoughnessMap&&o.enable(16),D.clearcoatNormalMap&&o.enable(17),D.iridescence&&o.enable(18),D.iridescenceMap&&o.enable(19),D.iridescenceThicknessMap&&o.enable(20),D.displacementMap&&o.enable(21),D.specularMap&&o.enable(22),D.roughnessMap&&o.enable(23),D.metalnessMap&&o.enable(24),D.gradientMap&&o.enable(25),D.alphaMap&&o.enable(26),D.alphaTest&&o.enable(27),D.vertexColors&&o.enable(28),D.vertexAlphas&&o.enable(29),D.vertexUvs&&o.enable(30),D.vertexTangents&&o.enable(31),D.uvsVertexOnly&&o.enable(32),E.push(o.mask),o.disableAll(),D.fog&&o.enable(0),D.useFog&&o.enable(1),D.flatShading&&o.enable(2),D.logarithmicDepthBuffer&&o.enable(3),D.skinning&&o.enable(4),D.morphTargets&&o.enable(5),D.morphNormals&&o.enable(6),D.morphColors&&o.enable(7),D.premultipliedAlpha&&o.enable(8),D.shadowMapEnabled&&o.enable(9),D.physicallyCorrectLights&&o.enable(10),D.doubleSided&&o.enable(11),D.flipSided&&o.enable(12),D.useDepthPacking&&o.enable(13),D.dithering&&o.enable(14),D.specularIntensityMap&&o.enable(15),D.specularColorMap&&o.enable(16),D.transmission&&o.enable(17),D.transmissionMap&&o.enable(18),D.thicknessMap&&o.enable(19),D.sheen&&o.enable(20),D.sheenColorMap&&o.enable(21),D.sheenRoughnessMap&&o.enable(22),D.decodeVideoTexture&&o.enable(23),D.opaque&&o.enable(24),E.push(o.mask)}function _(E){let D=g[E.type],I;if(D){let O=El[D];I=Rm.clone(O.uniforms)}else I=E.uniforms;return I}function T(E,D){let I;for(let O=0,N=u.length;O<N;O++){let k=u[O];if(k.cacheKey===D){I=k,++I.usedTimes;break}}return I===void 0&&(I=new tK(e,D,E,s),u.push(I)),I}function M(E){if(--E.usedTimes===0){let D=u.indexOf(E);u[D]=u[u.length-1],u.pop(),E.destroy()}}function C(E){l.remove(E)}function P(){l.dispose()}return{getParameters:y,getProgramCacheKey:v,getUniforms:_,acquireProgram:T,releaseProgram:M,releaseShaderCache:C,programs:u,dispose:P}}function aK(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function oK(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function V3(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function j3(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(c,f,m,g,y,v){let b=e[t];return b===void 0?(b={id:c.id,object:c,geometry:f,material:m,groupOrder:g,renderOrder:c.renderOrder,z:y,group:v},e[t]=b):(b.id=c.id,b.object=c,b.geometry=f,b.material=m,b.groupOrder=g,b.renderOrder=c.renderOrder,b.z=y,b.group=v),t++,b}function o(c,f,m,g,y,v){let b=a(c,f,m,g,y,v);m.transmission>0?r.push(b):m.transparent===!0?n.push(b):i.push(b)}function l(c,f,m,g,y,v){let b=a(c,f,m,g,y,v);m.transmission>0?r.unshift(b):m.transparent===!0?n.unshift(b):i.unshift(b)}function u(c,f){i.length>1&&i.sort(c||oK),r.length>1&&r.sort(f||V3),n.length>1&&n.sort(f||V3)}function h(){for(let c=t,f=e.length;c<f;c++){let m=e[c];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:h,sort:u}}function lK(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new j3,e.set(r,[a])):n>=s.length?(a=new j3,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function uK(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new L,color:new Nt};break;case"SpotLight":i={position:new L,direction:new L,color:new Nt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new L,color:new Nt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new L,skyColor:new Nt,groundColor:new Nt};break;case"RectAreaLight":i={color:new Nt,position:new L,halfWidth:new L,halfHeight:new L};break}return e[t.id]=i,i}}}function hK(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var cK=0;function dK(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function fK(e,t){let i=new uK,r=hK(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new L);let s=new L,a=new je,o=new je;function l(h,c){let f=0,m=0,g=0;for(let O=0;O<9;O++)n.probe[O].set(0,0,0);let y=0,v=0,b=0,S=0,_=0,T=0,M=0,C=0,P=0,E=0;h.sort(dK);let D=c!==!0?Math.PI:1;for(let O=0,N=h.length;O<N;O++){let k=h[O],U=k.color,Q=k.intensity,se=k.distance,K=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)f+=U.r*Q*D,m+=U.g*Q*D,g+=U.b*Q*D;else if(k.isLightProbe)for(let H=0;H<9;H++)n.probe[H].addScaledVector(k.sh.coefficients[H],Q);else if(k.isDirectionalLight){let H=i.get(k);if(H.color.copy(k.color).multiplyScalar(k.intensity*D),k.castShadow){let ie=k.shadow,$=r.get(k);$.shadowBias=ie.bias,$.shadowNormalBias=ie.normalBias,$.shadowRadius=ie.radius,$.shadowMapSize=ie.mapSize,n.directionalShadow[y]=$,n.directionalShadowMap[y]=K,n.directionalShadowMatrix[y]=k.shadow.matrix,T++}n.directional[y]=H,y++}else if(k.isSpotLight){let H=i.get(k);H.position.setFromMatrixPosition(k.matrixWorld),H.color.copy(U).multiplyScalar(Q*D),H.distance=se,H.coneCos=Math.cos(k.angle),H.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),H.decay=k.decay,n.spot[b]=H;let ie=k.shadow;if(k.map&&(n.spotLightMap[P]=k.map,P++,ie.updateMatrices(k),k.castShadow&&E++),n.spotLightMatrix[b]=ie.matrix,k.castShadow){let $=r.get(k);$.shadowBias=ie.bias,$.shadowNormalBias=ie.normalBias,$.shadowRadius=ie.radius,$.shadowMapSize=ie.mapSize,n.spotShadow[b]=$,n.spotShadowMap[b]=K,C++}b++}else if(k.isRectAreaLight){let H=i.get(k);H.color.copy(U).multiplyScalar(Q),H.halfWidth.set(k.width*.5,0,0),H.halfHeight.set(0,k.height*.5,0),n.rectArea[S]=H,S++}else if(k.isPointLight){let H=i.get(k);if(H.color.copy(k.color).multiplyScalar(k.intensity*D),H.distance=k.distance,H.decay=k.decay,k.castShadow){let ie=k.shadow,$=r.get(k);$.shadowBias=ie.bias,$.shadowNormalBias=ie.normalBias,$.shadowRadius=ie.radius,$.shadowMapSize=ie.mapSize,$.shadowCameraNear=ie.camera.near,$.shadowCameraFar=ie.camera.far,n.pointShadow[v]=$,n.pointShadowMap[v]=K,n.pointShadowMatrix[v]=k.shadow.matrix,M++}n.point[v]=H,v++}else if(k.isHemisphereLight){let H=i.get(k);H.skyColor.copy(k.color).multiplyScalar(Q*D),H.groundColor.copy(k.groundColor).multiplyScalar(Q*D),n.hemi[_]=H,_++}}S>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=tt.LTC_FLOAT_1,n.rectAreaLTC2=tt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=tt.LTC_HALF_1,n.rectAreaLTC2=tt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=f,n.ambient[1]=m,n.ambient[2]=g;let I=n.hash;(I.directionalLength!==y||I.pointLength!==v||I.spotLength!==b||I.rectAreaLength!==S||I.hemiLength!==_||I.numDirectionalShadows!==T||I.numPointShadows!==M||I.numSpotShadows!==C||I.numSpotMaps!==P)&&(n.directional.length=y,n.spot.length=b,n.rectArea.length=S,n.point.length=v,n.hemi.length=_,n.directionalShadow.length=T,n.directionalShadowMap.length=T,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=C,n.spotShadowMap.length=C,n.directionalShadowMatrix.length=T,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=C+P-E,n.spotLightMap.length=P,n.numSpotLightShadowsWithMaps=E,I.directionalLength=y,I.pointLength=v,I.spotLength=b,I.rectAreaLength=S,I.hemiLength=_,I.numDirectionalShadows=T,I.numPointShadows=M,I.numSpotShadows=C,I.numSpotMaps=P,n.version=cK++)}function u(h,c){let f=0,m=0,g=0,y=0,v=0,b=c.matrixWorldInverse;for(let S=0,_=h.length;S<_;S++){let T=h[S];if(T.isDirectionalLight){let M=n.directional[f];M.direction.setFromMatrixPosition(T.matrixWorld),s.setFromMatrixPosition(T.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(b),f++}else if(T.isSpotLight){let M=n.spot[g];M.position.setFromMatrixPosition(T.matrixWorld),M.position.applyMatrix4(b),M.direction.setFromMatrixPosition(T.matrixWorld),s.setFromMatrixPosition(T.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(b),g++}else if(T.isRectAreaLight){let M=n.rectArea[y];M.position.setFromMatrixPosition(T.matrixWorld),M.position.applyMatrix4(b),o.identity(),a.copy(T.matrixWorld),a.premultiply(b),o.extractRotation(a),M.halfWidth.set(T.width*.5,0,0),M.halfHeight.set(0,T.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),y++}else if(T.isPointLight){let M=n.point[m];M.position.setFromMatrixPosition(T.matrixWorld),M.position.applyMatrix4(b),m++}else if(T.isHemisphereLight){let M=n.hemi[v];M.direction.setFromMatrixPosition(T.matrixWorld),M.direction.transformDirection(b),v++}}}return{setup:l,setupView:u,state:n}}function H3(e,t){let i=new fK(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function u(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function pK(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new H3(e,t),i.set(s,[l])):a>=o.length?(l=new H3(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var b5=class extends Uy{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=eh,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},mK=class extends Uy{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new L,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},gK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,vK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function yK(e,t,i){let r=new GP,n=new oe,s=new oe,a=new Yt,o=new b5({depthPacking:s5}),l=new mK,u={},h=i.maxTextureSize,c={[Uo]:zn,[zn]:Uo,[bs]:bs},f=new Mi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new oe},radius:{value:4}},vertexShader:gK,fragmentShader:vK}),m=f.clone();m.defines.HORIZONTAL_PASS=1;let g=new St;g.setAttribute("position",new Bt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let y=new ar(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=BP,this.render=function(T,M,C){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||T.length===0)return;let P=e.getRenderTarget(),E=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),I=e.state;I.setBlending($r),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);for(let O=0,N=T.length;O<N;O++){let k=T[O],U=k.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;n.copy(U.mapSize);let Q=U.getFrameExtents();if(n.multiply(Q),s.copy(U.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/Q.x),n.x=s.x*Q.x,U.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/Q.y),n.y=s.y*Q.y,U.mapSize.y=s.y)),U.map===null){let K=this.type!==yv?{minFilter:vi,magFilter:vi}:{};U.map=new Pi(n.x,n.y,K),U.map.texture.name=k.name+".shadowMap",U.camera.updateProjectionMatrix()}e.setRenderTarget(U.map),e.clear();let se=U.getViewportCount();for(let K=0;K<se;K++){let H=U.getViewport(K);a.set(s.x*H.x,s.y*H.y,s.x*H.z,s.y*H.w),I.viewport(a),U.updateMatrices(k,K),r=U.getFrustum(),_(M,C,U.camera,k,this.type)}U.isPointLightShadow!==!0&&this.type===yv&&b(U,C),U.needsUpdate=!1}v.needsUpdate=!1,e.setRenderTarget(P,E,D)};function b(T,M){let C=t.update(y);f.defines.VSM_SAMPLES!==T.blurSamples&&(f.defines.VSM_SAMPLES=T.blurSamples,m.defines.VSM_SAMPLES=T.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new Pi(n.x,n.y)),f.uniforms.shadow_pass.value=T.map.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,e.setRenderTarget(T.mapPass),e.clear(),e.renderBufferDirect(M,null,C,f,y,null),m.uniforms.shadow_pass.value=T.mapPass.texture,m.uniforms.resolution.value=T.mapSize,m.uniforms.radius.value=T.radius,e.setRenderTarget(T.map),e.clear(),e.renderBufferDirect(M,null,C,m,y,null)}function S(T,M,C,P,E,D){let I=null,O=C.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(O!==void 0)I=O;else if(I=C.isPointLight===!0?l:o,e.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){let N=I.uuid,k=M.uuid,U=u[N];U===void 0&&(U={},u[N]=U);let Q=U[k];Q===void 0&&(Q=I.clone(),U[k]=Q),I=Q}return I.visible=M.visible,I.wireframe=M.wireframe,D===yv?I.side=M.shadowSide!==null?M.shadowSide:M.side:I.side=M.shadowSide!==null?M.shadowSide:c[M.side],I.alphaMap=M.alphaMap,I.alphaTest=M.alphaTest,I.map=M.map,I.clipShadows=M.clipShadows,I.clippingPlanes=M.clippingPlanes,I.clipIntersection=M.clipIntersection,I.displacementMap=M.displacementMap,I.displacementScale=M.displacementScale,I.displacementBias=M.displacementBias,I.wireframeLinewidth=M.wireframeLinewidth,I.linewidth=M.linewidth,C.isPointLight===!0&&I.isMeshDistanceMaterial===!0&&(I.referencePosition.setFromMatrixPosition(C.matrixWorld),I.nearDistance=P,I.farDistance=E),I}function _(T,M,C,P,E){if(T.visible===!1)return;if(T.layers.test(M.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&E===yv)&&(!T.frustumCulled||r.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,T.matrixWorld);let I=t.update(T),O=T.material;if(Array.isArray(O)){let N=I.groups;for(let k=0,U=N.length;k<U;k++){let Q=N[k],se=O[Q.materialIndex];if(se&&se.visible){let K=S(T,se,P,C.near,C.far,E);e.renderBufferDirect(C,null,I,K,T,Q)}}}else if(O.visible){let N=S(T,O,P,C.near,C.far,E);e.renderBufferDirect(C,null,I,N,T,null)}}let D=T.children;for(let I=0,O=D.length;I<O;I++)_(D[I],M,C,P,E)}}function xK(e,t,i){let r=i.isWebGL2;function n(){let pe=!1,Oe=new Yt,Be=null,et=new Yt(0,0,0,0);return{setMask:function(Ot){Be!==Ot&&!pe&&(e.colorMask(Ot,Ot,Ot,Ot),Be=Ot)},setLocked:function(Ot){pe=Ot},setClear:function(Ot,ti,rr,or,os){os===!0&&(Ot*=or,ti*=or,rr*=or),Oe.set(Ot,ti,rr,or),et.equals(Oe)===!1&&(e.clearColor(Ot,ti,rr,or),et.copy(Oe))},reset:function(){pe=!1,Be=null,et.set(-1,0,0,0)}}}function s(){let pe=!1,Oe=null,Be=null,et=null;return{setTest:function(Ot){Ot?me(2929):de(2929)},setMask:function(Ot){Oe!==Ot&&!pe&&(e.depthMask(Ot),Oe=Ot)},setFunc:function(Ot){if(Be!==Ot){switch(Ot){case U8:e.depthFunc(512);break;case V8:e.depthFunc(519);break;case j8:e.depthFunc(513);break;case sT:e.depthFunc(515);break;case H8:e.depthFunc(514);break;case G8:e.depthFunc(518);break;case W8:e.depthFunc(516);break;case q8:e.depthFunc(517);break;default:e.depthFunc(515)}Be=Ot}},setLocked:function(Ot){pe=Ot},setClear:function(Ot){et!==Ot&&(e.clearDepth(Ot),et=Ot)},reset:function(){pe=!1,Oe=null,Be=null,et=null}}}function a(){let pe=!1,Oe=null,Be=null,et=null,Ot=null,ti=null,rr=null,or=null,os=null;return{setTest:function(Ei){pe||(Ei?me(2960):de(2960))},setMask:function(Ei){Oe!==Ei&&!pe&&(e.stencilMask(Ei),Oe=Ei)},setFunc:function(Ei,Un,Ai){(Be!==Ei||et!==Un||Ot!==Ai)&&(e.stencilFunc(Ei,Un,Ai),Be=Ei,et=Un,Ot=Ai)},setOp:function(Ei,Un,Ai){(ti!==Ei||rr!==Un||or!==Ai)&&(e.stencilOp(Ei,Un,Ai),ti=Ei,rr=Un,or=Ai)},setLocked:function(Ei){pe=Ei},setClear:function(Ei){os!==Ei&&(e.clearStencil(Ei),os=Ei)},reset:function(){pe=!1,Oe=null,Be=null,et=null,Ot=null,ti=null,rr=null,or=null,os=null}}}let o=new n,l=new s,u=new a,h=new WeakMap,c=new WeakMap,f={},m={},g=new WeakMap,y=[],v=null,b=!1,S=null,_=null,T=null,M=null,C=null,P=null,E=null,D=!1,I=null,O=null,N=null,k=null,U=null,Q=e.getParameter(35661),se=!1,K=0,H=e.getParameter(7938);H.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(H)[1]),se=K>=1):H.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),se=K>=2);let ie=null,$={},V=e.getParameter(3088),X=e.getParameter(2978),ue=new Yt().fromArray(V),ne=new Yt().fromArray(X);function he(pe,Oe,Be){let et=new Uint8Array(4),Ot=e.createTexture();e.bindTexture(pe,Ot),e.texParameteri(pe,10241,9728),e.texParameteri(pe,10240,9728);for(let ti=0;ti<Be;ti++)e.texImage2D(Oe+ti,0,6408,1,1,0,6408,5121,et);return Ot}let te={};te[3553]=he(3553,3553,1),te[34067]=he(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),me(2929),l.setFunc(sT),ct(!1),ut(LO),me(2884),st($r);function me(pe){f[pe]!==!0&&(e.enable(pe),f[pe]=!0)}function de(pe){f[pe]!==!1&&(e.disable(pe),f[pe]=!1)}function fe(pe,Oe){return m[pe]!==Oe?(e.bindFramebuffer(pe,Oe),m[pe]=Oe,r&&(pe===36009&&(m[36160]=Oe),pe===36160&&(m[36009]=Oe)),!0):!1}function ye(pe,Oe){let Be=y,et=!1;if(pe)if(Be=g.get(Oe),Be===void 0&&(Be=[],g.set(Oe,Be)),pe.isWebGLMultipleRenderTargets){let Ot=pe.texture;if(Be.length!==Ot.length||Be[0]!==36064){for(let ti=0,rr=Ot.length;ti<rr;ti++)Be[ti]=36064+ti;Be.length=Ot.length,et=!0}}else Be[0]!==36064&&(Be[0]=36064,et=!0);else Be[0]!==1029&&(Be[0]=1029,et=!0);et&&(i.isWebGL2?e.drawBuffers(Be):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Be))}function Te(pe){return v!==pe?(e.useProgram(pe),v=pe,!0):!1}let Ie={[Ep]:32774,[M8]:32778,[D8]:32779};if(r)Ie[FO]=32775,Ie[UO]=32776;else{let pe=t.get("EXT_blend_minmax");pe!==null&&(Ie[FO]=pe.MIN_EXT,Ie[UO]=pe.MAX_EXT)}let Ne={[I8]:0,[R8]:1,[O8]:768,[ZF]:770,[F8]:776,[N8]:774,[L8]:772,[k8]:769,[JF]:771,[B8]:775,[z8]:773};function st(pe,Oe,Be,et,Ot,ti,rr,or){if(pe===$r){b===!0&&(de(3042),b=!1);return}if(b===!1&&(me(3042),b=!0),pe!==P8){if(pe!==S||or!==D){if((_!==Ep||C!==Ep)&&(e.blendEquation(32774),_=Ep,C=Ep),or)switch(pe){case Id:e.blendFuncSeparate(1,771,1,771);break;case zO:e.blendFunc(1,1);break;case NO:e.blendFuncSeparate(0,769,0,1);break;case BO:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe);break}else switch(pe){case Id:e.blendFuncSeparate(770,771,1,771);break;case zO:e.blendFunc(770,1);break;case NO:e.blendFuncSeparate(0,769,0,1);break;case BO:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe);break}T=null,M=null,P=null,E=null,S=pe,D=or}return}Ot=Ot||Oe,ti=ti||Be,rr=rr||et,(Oe!==_||Ot!==C)&&(e.blendEquationSeparate(Ie[Oe],Ie[Ot]),_=Oe,C=Ot),(Be!==T||et!==M||ti!==P||rr!==E)&&(e.blendFuncSeparate(Ne[Be],Ne[et],Ne[ti],Ne[rr]),T=Be,M=et,P=ti,E=rr),S=pe,D=!1}function We(pe,Oe){pe.side===bs?de(2884):me(2884);let Be=pe.side===zn;Oe&&(Be=!Be),ct(Be),pe.blending===Id&&pe.transparent===!1?st($r):st(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.premultipliedAlpha),l.setFunc(pe.depthFunc),l.setTest(pe.depthTest),l.setMask(pe.depthWrite),o.setMask(pe.colorWrite);let et=pe.stencilWrite;u.setTest(et),et&&(u.setMask(pe.stencilWriteMask),u.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),u.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),Ye(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),pe.alphaToCoverage===!0?me(32926):de(32926)}function ct(pe){I!==pe&&(pe?e.frontFace(2304):e.frontFace(2305),I=pe)}function ut(pe){pe!==A8?(me(2884),pe!==O&&(pe===LO?e.cullFace(1029):pe===C8?e.cullFace(1028):e.cullFace(1032))):de(2884),O=pe}function Ke(pe){pe!==N&&(se&&e.lineWidth(pe),N=pe)}function Ye(pe,Oe,Be){pe?(me(32823),(k!==Oe||U!==Be)&&(e.polygonOffset(Oe,Be),k=Oe,U=Be)):de(32823)}function yt(pe){pe?me(3089):de(3089)}function pt(pe){pe===void 0&&(pe=33984+Q-1),ie!==pe&&(e.activeTexture(pe),ie=pe)}function re(pe,Oe,Be){Be===void 0&&(ie===null?Be=33984+Q-1:Be=ie);let et=$[Be];et===void 0&&(et={type:void 0,texture:void 0},$[Be]=et),(et.type!==pe||et.texture!==Oe)&&(ie!==Be&&(e.activeTexture(Be),ie=Be),e.bindTexture(pe,Oe||te[pe]),et.type=pe,et.texture=Oe)}function Y(){let pe=$[ie];pe!==void 0&&pe.type!==void 0&&(e.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)}function Ee(){try{e.compressedTexImage2D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Ve(){try{e.compressedTexImage3D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function W(){try{e.texSubImage2D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Ge(){try{e.texSubImage3D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function lt(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function it(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function De(){try{e.texStorage2D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function dt(){try{e.texStorage3D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function at(){try{e.texImage2D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function bt(){try{e.texImage3D.apply(e,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Dt(pe){ue.equals(pe)===!1&&(e.scissor(pe.x,pe.y,pe.z,pe.w),ue.copy(pe))}function Ct(pe){ne.equals(pe)===!1&&(e.viewport(pe.x,pe.y,pe.z,pe.w),ne.copy(pe))}function Pt(pe,Oe){let Be=c.get(Oe);Be===void 0&&(Be=new WeakMap,c.set(Oe,Be));let et=Be.get(pe);et===void 0&&(et=e.getUniformBlockIndex(Oe,pe.name),Be.set(pe,et))}function Oi(pe,Oe){let Be=c.get(Oe).get(pe);h.get(Oe)!==Be&&(e.uniformBlockBinding(Oe,Be,pe.__bindingPointIndex),h.set(Oe,Be))}function ji(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),f={},ie=null,$={},m={},g=new WeakMap,y=[],v=null,b=!1,S=null,_=null,T=null,M=null,C=null,P=null,E=null,D=!1,I=null,O=null,N=null,k=null,U=null,ue.set(0,0,e.canvas.width,e.canvas.height),ne.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:me,disable:de,bindFramebuffer:fe,drawBuffers:ye,useProgram:Te,setBlending:st,setMaterial:We,setFlipSided:ct,setCullFace:ut,setLineWidth:Ke,setPolygonOffset:Ye,setScissorTest:yt,activeTexture:pt,bindTexture:re,unbindTexture:Y,compressedTexImage2D:Ee,compressedTexImage3D:Ve,texImage2D:at,texImage3D:bt,updateUBOMapping:Pt,uniformBlockBinding:Oi,texStorage2D:De,texStorage3D:dt,texSubImage2D:W,texSubImage3D:Ge,compressedTexSubImage2D:lt,compressedTexSubImage3D:it,scissor:Dt,viewport:Ct,reset:ji}}function bK(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,u=n.maxCubemapSize,h=n.maxTextureSize,c=n.maxSamples,f=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y,v=new WeakMap,b=!1;try{b=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(re,Y){return b?new OffscreenCanvas(re,Y):ry("canvas")}function _(re,Y,Ee,Ve){let W=1;if((re.width>Ve||re.height>Ve)&&(W=Ve/Math.max(re.width,re.height)),W<1||Y===!0)if(typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&re instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&re instanceof ImageBitmap){let Ge=Y?Ub:Math.floor,lt=Ge(W*re.width),it=Ge(W*re.height);y===void 0&&(y=S(lt,it));let De=Ee?S(lt,it):y;return De.width=lt,De.height=it,De.getContext("2d").drawImage(re,0,0,lt,it),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+re.width+"x"+re.height+") to ("+lt+"x"+it+")."),De}else return"data"in re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+re.width+"x"+re.height+")."),re;return re}function T(re){return dT(re.width)&&dT(re.height)}function M(re){return o?!1:re.wrapS!==gr||re.wrapT!==gr||re.minFilter!==vi&&re.minFilter!==fi}function C(re,Y){return re.generateMipmaps&&Y&&re.minFilter!==vi&&re.minFilter!==fi}function P(re){e.generateMipmap(re)}function E(re,Y,Ee,Ve,W=!1){if(o===!1)return Y;if(re!==null){if(e[re]!==void 0)return e[re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+re+"'")}let Ge=Y;return Y===6403&&(Ee===5126&&(Ge=33326),Ee===5131&&(Ge=33325),Ee===5121&&(Ge=33321)),Y===33319&&(Ee===5126&&(Ge=33328),Ee===5131&&(Ge=33327),Ee===5121&&(Ge=33323)),Y===6408&&(Ee===5126&&(Ge=34836),Ee===5131&&(Ge=34842),Ee===5121&&(Ge=Ve===ui&&W===!1?35907:32856),Ee===32819&&(Ge=32854),Ee===32820&&(Ge=32855)),(Ge===33325||Ge===33326||Ge===33327||Ge===33328||Ge===34842||Ge===34836)&&t.get("EXT_color_buffer_float"),Ge}function D(re,Y,Ee){return C(re,Ee)===!0||re.isFramebufferTexture&&re.minFilter!==vi&&re.minFilter!==fi?Math.log2(Math.max(Y.width,Y.height))+1:re.mipmaps!==void 0&&re.mipmaps.length>0?re.mipmaps.length:re.isCompressedTexture&&Array.isArray(re.image)?Y.mipmaps.length:1}function I(re){return re===vi||re===VO||re===NE?9728:9729}function O(re){let Y=re.target;Y.removeEventListener("dispose",O),k(Y),Y.isVideoTexture&&g.delete(Y)}function N(re){let Y=re.target;Y.removeEventListener("dispose",N),Q(Y)}function k(re){let Y=r.get(re);if(Y.__webglInit===void 0)return;let Ee=re.source,Ve=v.get(Ee);if(Ve){let W=Ve[Y.__cacheKey];W.usedTimes--,W.usedTimes===0&&U(re),Object.keys(Ve).length===0&&v.delete(Ee)}r.remove(re)}function U(re){let Y=r.get(re);e.deleteTexture(Y.__webglTexture);let Ee=re.source,Ve=v.get(Ee);delete Ve[Y.__cacheKey],a.memory.textures--}function Q(re){let Y=re.texture,Ee=r.get(re),Ve=r.get(Y);if(Ve.__webglTexture!==void 0&&(e.deleteTexture(Ve.__webglTexture),a.memory.textures--),re.depthTexture&&re.depthTexture.dispose(),re.isWebGLCubeRenderTarget)for(let W=0;W<6;W++)e.deleteFramebuffer(Ee.__webglFramebuffer[W]),Ee.__webglDepthbuffer&&e.deleteRenderbuffer(Ee.__webglDepthbuffer[W]);else{if(e.deleteFramebuffer(Ee.__webglFramebuffer),Ee.__webglDepthbuffer&&e.deleteRenderbuffer(Ee.__webglDepthbuffer),Ee.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Ee.__webglMultisampledFramebuffer),Ee.__webglColorRenderbuffer)for(let W=0;W<Ee.__webglColorRenderbuffer.length;W++)Ee.__webglColorRenderbuffer[W]&&e.deleteRenderbuffer(Ee.__webglColorRenderbuffer[W]);Ee.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Ee.__webglDepthRenderbuffer)}if(re.isWebGLMultipleRenderTargets)for(let W=0,Ge=Y.length;W<Ge;W++){let lt=r.get(Y[W]);lt.__webglTexture&&(e.deleteTexture(lt.__webglTexture),a.memory.textures--),r.remove(Y[W])}r.remove(Y),r.remove(re)}let se=0;function K(){se=0}function H(){let re=se;return re>=l&&console.warn("THREE.WebGLTextures: Trying to use "+re+" texture units while this GPU supports only "+l),se+=1,re}function ie(re){let Y=[];return Y.push(re.wrapS),Y.push(re.wrapT),Y.push(re.wrapR||0),Y.push(re.magFilter),Y.push(re.minFilter),Y.push(re.anisotropy),Y.push(re.internalFormat),Y.push(re.format),Y.push(re.type),Y.push(re.generateMipmaps),Y.push(re.premultiplyAlpha),Y.push(re.flipY),Y.push(re.unpackAlignment),Y.push(re.encoding),Y.join()}function $(re,Y){let Ee=r.get(re);if(re.isVideoTexture&&yt(re),re.isRenderTargetTexture===!1&&re.version>0&&Ee.__version!==re.version){let Ve=re.image;if(Ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{de(Ee,re,Y);return}}i.bindTexture(3553,Ee.__webglTexture,33984+Y)}function V(re,Y){let Ee=r.get(re);if(re.version>0&&Ee.__version!==re.version){de(Ee,re,Y);return}i.bindTexture(35866,Ee.__webglTexture,33984+Y)}function X(re,Y){let Ee=r.get(re);if(re.version>0&&Ee.__version!==re.version){de(Ee,re,Y);return}i.bindTexture(32879,Ee.__webglTexture,33984+Y)}function ue(re,Y){let Ee=r.get(re);if(re.version>0&&Ee.__version!==re.version){fe(Ee,re,Y);return}i.bindTexture(34067,Ee.__webglTexture,33984+Y)}let ne={[Iu]:10497,[gr]:33071,[lT]:33648},he={[vi]:9728,[VO]:9984,[NE]:9986,[fi]:9729,[e7]:9985,[om]:9987};function te(re,Y,Ee){if(Ee?(e.texParameteri(re,10242,ne[Y.wrapS]),e.texParameteri(re,10243,ne[Y.wrapT]),(re===32879||re===35866)&&e.texParameteri(re,32882,ne[Y.wrapR]),e.texParameteri(re,10240,he[Y.magFilter]),e.texParameteri(re,10241,he[Y.minFilter])):(e.texParameteri(re,10242,33071),e.texParameteri(re,10243,33071),(re===32879||re===35866)&&e.texParameteri(re,32882,33071),(Y.wrapS!==gr||Y.wrapT!==gr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(re,10240,I(Y.magFilter)),e.texParameteri(re,10241,I(Y.minFilter)),Y.minFilter!==vi&&Y.minFilter!==fi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let Ve=t.get("EXT_texture_filter_anisotropic");if(Y.magFilter===vi||Y.minFilter!==NE&&Y.minFilter!==om||Y.type===Ki&&t.has("OES_texture_float_linear")===!1||o===!1&&Y.type===Gu&&t.has("OES_texture_half_float_linear")===!1)return;(Y.anisotropy>1||r.get(Y).__currentAnisotropy)&&(e.texParameterf(re,Ve.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y.anisotropy,n.getMaxAnisotropy())),r.get(Y).__currentAnisotropy=Y.anisotropy)}}function me(re,Y){let Ee=!1;re.__webglInit===void 0&&(re.__webglInit=!0,Y.addEventListener("dispose",O));let Ve=Y.source,W=v.get(Ve);W===void 0&&(W={},v.set(Ve,W));let Ge=ie(Y);if(Ge!==re.__cacheKey){W[Ge]===void 0&&(W[Ge]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,Ee=!0),W[Ge].usedTimes++;let lt=W[re.__cacheKey];lt!==void 0&&(W[re.__cacheKey].usedTimes--,lt.usedTimes===0&&U(Y)),re.__cacheKey=Ge,re.__webglTexture=W[Ge].texture}return Ee}function de(re,Y,Ee){let Ve=3553;(Y.isDataArrayTexture||Y.isCompressedArrayTexture)&&(Ve=35866),Y.isData3DTexture&&(Ve=32879);let W=me(re,Y),Ge=Y.source;i.bindTexture(Ve,re.__webglTexture,33984+Ee);let lt=r.get(Ge);if(Ge.version!==lt.__version||W===!0){i.activeTexture(33984+Ee),e.pixelStorei(37440,Y.flipY),e.pixelStorei(37441,Y.premultiplyAlpha),e.pixelStorei(3317,Y.unpackAlignment),e.pixelStorei(37443,0);let it=M(Y)&&T(Y.image)===!1,De=_(Y.image,it,!1,h);De=pt(Y,De);let dt=T(De)||o,at=s.convert(Y.format,Y.encoding),bt=s.convert(Y.type),Dt=E(Y.internalFormat,at,bt,Y.encoding,Y.isVideoTexture);te(Ve,Y,dt);let Ct,Pt=Y.mipmaps,Oi=o&&Y.isVideoTexture!==!0,ji=lt.__version===void 0||W===!0,pe=D(Y,De,dt);if(Y.isDepthTexture)Dt=6402,o?Y.type===Ki?Dt=36012:Y.type===Ru?Dt=33190:Y.type===Rd?Dt=35056:Dt=33189:Y.type===Ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Y.format===Od&&Dt===6402&&Y.type!==t5&&Y.type!==Ru&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Y.type=Ru,bt=s.convert(Y.type)),Y.format===Ud&&Dt===6402&&(Dt=34041,Y.type!==Rd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Y.type=Rd,bt=s.convert(Y.type))),ji&&(Oi?i.texStorage2D(3553,1,Dt,De.width,De.height):i.texImage2D(3553,0,Dt,De.width,De.height,0,at,bt,null));else if(Y.isDataTexture)if(Pt.length>0&&dt){Oi&&ji&&i.texStorage2D(3553,pe,Dt,Pt[0].width,Pt[0].height);for(let Oe=0,Be=Pt.length;Oe<Be;Oe++)Ct=Pt[Oe],Oi?i.texSubImage2D(3553,Oe,0,0,Ct.width,Ct.height,at,bt,Ct.data):i.texImage2D(3553,Oe,Dt,Ct.width,Ct.height,0,at,bt,Ct.data);Y.generateMipmaps=!1}else Oi?(ji&&i.texStorage2D(3553,pe,Dt,De.width,De.height),i.texSubImage2D(3553,0,0,0,De.width,De.height,at,bt,De.data)):i.texImage2D(3553,0,Dt,De.width,De.height,0,at,bt,De.data);else if(Y.isCompressedTexture)if(Y.isCompressedArrayTexture){Oi&&ji&&i.texStorage3D(35866,pe,Dt,Pt[0].width,Pt[0].height,De.depth);for(let Oe=0,Be=Pt.length;Oe<Be;Oe++)Ct=Pt[Oe],Y.format!==br?at!==null?Oi?i.compressedTexSubImage3D(35866,Oe,0,0,0,Ct.width,Ct.height,De.depth,at,Ct.data,0,0):i.compressedTexImage3D(35866,Oe,Dt,Ct.width,Ct.height,De.depth,0,Ct.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Oi?i.texSubImage3D(35866,Oe,0,0,0,Ct.width,Ct.height,De.depth,at,bt,Ct.data):i.texImage3D(35866,Oe,Dt,Ct.width,Ct.height,De.depth,0,at,bt,Ct.data)}else{Oi&&ji&&i.texStorage2D(3553,pe,Dt,Pt[0].width,Pt[0].height);for(let Oe=0,Be=Pt.length;Oe<Be;Oe++)Ct=Pt[Oe],Y.format!==br?at!==null?Oi?i.compressedTexSubImage2D(3553,Oe,0,0,Ct.width,Ct.height,at,Ct.data):i.compressedTexImage2D(3553,Oe,Dt,Ct.width,Ct.height,0,Ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Oi?i.texSubImage2D(3553,Oe,0,0,Ct.width,Ct.height,at,bt,Ct.data):i.texImage2D(3553,Oe,Dt,Ct.width,Ct.height,0,at,bt,Ct.data)}else if(Y.isDataArrayTexture)Oi?(ji&&i.texStorage3D(35866,pe,Dt,De.width,De.height,De.depth),i.texSubImage3D(35866,0,0,0,0,De.width,De.height,De.depth,at,bt,De.data)):i.texImage3D(35866,0,Dt,De.width,De.height,De.depth,0,at,bt,De.data);else if(Y.isData3DTexture)Oi?(ji&&i.texStorage3D(32879,pe,Dt,De.width,De.height,De.depth),i.texSubImage3D(32879,0,0,0,0,De.width,De.height,De.depth,at,bt,De.data)):i.texImage3D(32879,0,Dt,De.width,De.height,De.depth,0,at,bt,De.data);else if(Y.isFramebufferTexture){if(ji)if(Oi)i.texStorage2D(3553,pe,Dt,De.width,De.height);else{let Oe=De.width,Be=De.height;for(let et=0;et<pe;et++)i.texImage2D(3553,et,Dt,Oe,Be,0,at,bt,null),Oe>>=1,Be>>=1}}else if(Pt.length>0&&dt){Oi&&ji&&i.texStorage2D(3553,pe,Dt,Pt[0].width,Pt[0].height);for(let Oe=0,Be=Pt.length;Oe<Be;Oe++)Ct=Pt[Oe],Oi?i.texSubImage2D(3553,Oe,0,0,at,bt,Ct):i.texImage2D(3553,Oe,Dt,at,bt,Ct);Y.generateMipmaps=!1}else Oi?(ji&&i.texStorage2D(3553,pe,Dt,De.width,De.height),i.texSubImage2D(3553,0,0,0,at,bt,De)):i.texImage2D(3553,0,Dt,at,bt,De);C(Y,dt)&&P(Ve),lt.__version=Ge.version,Y.onUpdate&&Y.onUpdate(Y)}re.__version=Y.version}function fe(re,Y,Ee){if(Y.image.length!==6)return;let Ve=me(re,Y),W=Y.source;i.bindTexture(34067,re.__webglTexture,33984+Ee);let Ge=r.get(W);if(W.version!==Ge.__version||Ve===!0){i.activeTexture(33984+Ee),e.pixelStorei(37440,Y.flipY),e.pixelStorei(37441,Y.premultiplyAlpha),e.pixelStorei(3317,Y.unpackAlignment),e.pixelStorei(37443,0);let lt=Y.isCompressedTexture||Y.image[0].isCompressedTexture,it=Y.image[0]&&Y.image[0].isDataTexture,De=[];for(let Oe=0;Oe<6;Oe++)!lt&&!it?De[Oe]=_(Y.image[Oe],!1,!0,u):De[Oe]=it?Y.image[Oe].image:Y.image[Oe],De[Oe]=pt(Y,De[Oe]);let dt=De[0],at=T(dt)||o,bt=s.convert(Y.format,Y.encoding),Dt=s.convert(Y.type),Ct=E(Y.internalFormat,bt,Dt,Y.encoding),Pt=o&&Y.isVideoTexture!==!0,Oi=Ge.__version===void 0||Ve===!0,ji=D(Y,dt,at);te(34067,Y,at);let pe;if(lt){Pt&&Oi&&i.texStorage2D(34067,ji,Ct,dt.width,dt.height);for(let Oe=0;Oe<6;Oe++){pe=De[Oe].mipmaps;for(let Be=0;Be<pe.length;Be++){let et=pe[Be];Y.format!==br?bt!==null?Pt?i.compressedTexSubImage2D(34069+Oe,Be,0,0,et.width,et.height,bt,et.data):i.compressedTexImage2D(34069+Oe,Be,Ct,et.width,et.height,0,et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pt?i.texSubImage2D(34069+Oe,Be,0,0,et.width,et.height,bt,Dt,et.data):i.texImage2D(34069+Oe,Be,Ct,et.width,et.height,0,bt,Dt,et.data)}}}else{pe=Y.mipmaps,Pt&&Oi&&(pe.length>0&&ji++,i.texStorage2D(34067,ji,Ct,De[0].width,De[0].height));for(let Oe=0;Oe<6;Oe++)if(it){Pt?i.texSubImage2D(34069+Oe,0,0,0,De[Oe].width,De[Oe].height,bt,Dt,De[Oe].data):i.texImage2D(34069+Oe,0,Ct,De[Oe].width,De[Oe].height,0,bt,Dt,De[Oe].data);for(let Be=0;Be<pe.length;Be++){let et=pe[Be].image[Oe].image;Pt?i.texSubImage2D(34069+Oe,Be+1,0,0,et.width,et.height,bt,Dt,et.data):i.texImage2D(34069+Oe,Be+1,Ct,et.width,et.height,0,bt,Dt,et.data)}}else{Pt?i.texSubImage2D(34069+Oe,0,0,0,bt,Dt,De[Oe]):i.texImage2D(34069+Oe,0,Ct,bt,Dt,De[Oe]);for(let Be=0;Be<pe.length;Be++){let et=pe[Be];Pt?i.texSubImage2D(34069+Oe,Be+1,0,0,bt,Dt,et.image[Oe]):i.texImage2D(34069+Oe,Be+1,Ct,bt,Dt,et.image[Oe])}}}C(Y,at)&&P(34067),Ge.__version=W.version,Y.onUpdate&&Y.onUpdate(Y)}re.__version=Y.version}function ye(re,Y,Ee,Ve,W){let Ge=s.convert(Ee.format,Ee.encoding),lt=s.convert(Ee.type),it=E(Ee.internalFormat,Ge,lt,Ee.encoding);r.get(Y).__hasExternalTextures||(W===32879||W===35866?i.texImage3D(W,0,it,Y.width,Y.height,Y.depth,0,Ge,lt,null):i.texImage2D(W,0,it,Y.width,Y.height,0,Ge,lt,null)),i.bindFramebuffer(36160,re),Ye(Y)?f.framebufferTexture2DMultisampleEXT(36160,Ve,W,r.get(Ee).__webglTexture,0,Ke(Y)):(W===3553||W>=34069&&W<=34074)&&e.framebufferTexture2D(36160,Ve,W,r.get(Ee).__webglTexture,0),i.bindFramebuffer(36160,null)}function Te(re,Y,Ee){if(e.bindRenderbuffer(36161,re),Y.depthBuffer&&!Y.stencilBuffer){let Ve=33189;if(Ee||Ye(Y)){let W=Y.depthTexture;W&&W.isDepthTexture&&(W.type===Ki?Ve=36012:W.type===Ru&&(Ve=33190));let Ge=Ke(Y);Ye(Y)?f.renderbufferStorageMultisampleEXT(36161,Ge,Ve,Y.width,Y.height):e.renderbufferStorageMultisample(36161,Ge,Ve,Y.width,Y.height)}else e.renderbufferStorage(36161,Ve,Y.width,Y.height);e.framebufferRenderbuffer(36160,36096,36161,re)}else if(Y.depthBuffer&&Y.stencilBuffer){let Ve=Ke(Y);Ee&&Ye(Y)===!1?e.renderbufferStorageMultisample(36161,Ve,35056,Y.width,Y.height):Ye(Y)?f.renderbufferStorageMultisampleEXT(36161,Ve,35056,Y.width,Y.height):e.renderbufferStorage(36161,34041,Y.width,Y.height),e.framebufferRenderbuffer(36160,33306,36161,re)}else{let Ve=Y.isWebGLMultipleRenderTargets===!0?Y.texture:[Y.texture];for(let W=0;W<Ve.length;W++){let Ge=Ve[W],lt=s.convert(Ge.format,Ge.encoding),it=s.convert(Ge.type),De=E(Ge.internalFormat,lt,it,Ge.encoding),dt=Ke(Y);Ee&&Ye(Y)===!1?e.renderbufferStorageMultisample(36161,dt,De,Y.width,Y.height):Ye(Y)?f.renderbufferStorageMultisampleEXT(36161,dt,De,Y.width,Y.height):e.renderbufferStorage(36161,De,Y.width,Y.height)}}e.bindRenderbuffer(36161,null)}function Ie(re,Y){if(Y&&Y.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,re),!(Y.depthTexture&&Y.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Y.depthTexture).__webglTexture||Y.depthTexture.image.width!==Y.width||Y.depthTexture.image.height!==Y.height)&&(Y.depthTexture.image.width=Y.width,Y.depthTexture.image.height=Y.height,Y.depthTexture.needsUpdate=!0),$(Y.depthTexture,0);let Ee=r.get(Y.depthTexture).__webglTexture,Ve=Ke(Y);if(Y.depthTexture.format===Od)Ye(Y)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,Ee,0,Ve):e.framebufferTexture2D(36160,36096,3553,Ee,0);else if(Y.depthTexture.format===Ud)Ye(Y)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,Ee,0,Ve):e.framebufferTexture2D(36160,33306,3553,Ee,0);else throw new Error("Unknown depthTexture format")}function Ne(re){let Y=r.get(re),Ee=re.isWebGLCubeRenderTarget===!0;if(re.depthTexture&&!Y.__autoAllocateDepthBuffer){if(Ee)throw new Error("target.depthTexture not supported in Cube render targets");Ie(Y.__webglFramebuffer,re)}else if(Ee){Y.__webglDepthbuffer=[];for(let Ve=0;Ve<6;Ve++)i.bindFramebuffer(36160,Y.__webglFramebuffer[Ve]),Y.__webglDepthbuffer[Ve]=e.createRenderbuffer(),Te(Y.__webglDepthbuffer[Ve],re,!1)}else i.bindFramebuffer(36160,Y.__webglFramebuffer),Y.__webglDepthbuffer=e.createRenderbuffer(),Te(Y.__webglDepthbuffer,re,!1);i.bindFramebuffer(36160,null)}function st(re,Y,Ee){let Ve=r.get(re);Y!==void 0&&ye(Ve.__webglFramebuffer,re,re.texture,36064,3553),Ee!==void 0&&Ne(re)}function We(re){let Y=re.texture,Ee=r.get(re),Ve=r.get(Y);re.addEventListener("dispose",N),re.isWebGLMultipleRenderTargets!==!0&&(Ve.__webglTexture===void 0&&(Ve.__webglTexture=e.createTexture()),Ve.__version=Y.version,a.memory.textures++);let W=re.isWebGLCubeRenderTarget===!0,Ge=re.isWebGLMultipleRenderTargets===!0,lt=T(re)||o;if(W){Ee.__webglFramebuffer=[];for(let it=0;it<6;it++)Ee.__webglFramebuffer[it]=e.createFramebuffer()}else{if(Ee.__webglFramebuffer=e.createFramebuffer(),Ge)if(n.drawBuffers){let it=re.texture;for(let De=0,dt=it.length;De<dt;De++){let at=r.get(it[De]);at.__webglTexture===void 0&&(at.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&re.samples>0&&Ye(re)===!1){let it=Ge?Y:[Y];Ee.__webglMultisampledFramebuffer=e.createFramebuffer(),Ee.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,Ee.__webglMultisampledFramebuffer);for(let De=0;De<it.length;De++){let dt=it[De];Ee.__webglColorRenderbuffer[De]=e.createRenderbuffer(),e.bindRenderbuffer(36161,Ee.__webglColorRenderbuffer[De]);let at=s.convert(dt.format,dt.encoding),bt=s.convert(dt.type),Dt=E(dt.internalFormat,at,bt,dt.encoding,re.isXRRenderTarget===!0),Ct=Ke(re);e.renderbufferStorageMultisample(36161,Ct,Dt,re.width,re.height),e.framebufferRenderbuffer(36160,36064+De,36161,Ee.__webglColorRenderbuffer[De])}e.bindRenderbuffer(36161,null),re.depthBuffer&&(Ee.__webglDepthRenderbuffer=e.createRenderbuffer(),Te(Ee.__webglDepthRenderbuffer,re,!0)),i.bindFramebuffer(36160,null)}}if(W){i.bindTexture(34067,Ve.__webglTexture),te(34067,Y,lt);for(let it=0;it<6;it++)ye(Ee.__webglFramebuffer[it],re,Y,36064,34069+it);C(Y,lt)&&P(34067),i.unbindTexture()}else if(Ge){let it=re.texture;for(let De=0,dt=it.length;De<dt;De++){let at=it[De],bt=r.get(at);i.bindTexture(3553,bt.__webglTexture),te(3553,at,lt),ye(Ee.__webglFramebuffer,re,at,36064+De,3553),C(at,lt)&&P(3553)}i.unbindTexture()}else{let it=3553;(re.isWebGL3DRenderTarget||re.isWebGLArrayRenderTarget)&&(o?it=re.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(it,Ve.__webglTexture),te(it,Y,lt),ye(Ee.__webglFramebuffer,re,Y,36064,it),C(Y,lt)&&P(it),i.unbindTexture()}re.depthBuffer&&Ne(re)}function ct(re){let Y=T(re)||o,Ee=re.isWebGLMultipleRenderTargets===!0?re.texture:[re.texture];for(let Ve=0,W=Ee.length;Ve<W;Ve++){let Ge=Ee[Ve];if(C(Ge,Y)){let lt=re.isWebGLCubeRenderTarget?34067:3553,it=r.get(Ge).__webglTexture;i.bindTexture(lt,it),P(lt),i.unbindTexture()}}}function ut(re){if(o&&re.samples>0&&Ye(re)===!1){let Y=re.isWebGLMultipleRenderTargets?re.texture:[re.texture],Ee=re.width,Ve=re.height,W=16384,Ge=[],lt=re.stencilBuffer?33306:36096,it=r.get(re),De=re.isWebGLMultipleRenderTargets===!0;if(De)for(let dt=0;dt<Y.length;dt++)i.bindFramebuffer(36160,it.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+dt,36161,null),i.bindFramebuffer(36160,it.__webglFramebuffer),e.framebufferTexture2D(36009,36064+dt,3553,null,0);i.bindFramebuffer(36008,it.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,it.__webglFramebuffer);for(let dt=0;dt<Y.length;dt++){Ge.push(36064+dt),re.depthBuffer&&Ge.push(lt);let at=it.__ignoreDepthValues!==void 0?it.__ignoreDepthValues:!1;if(at===!1&&(re.depthBuffer&&(W|=256),re.stencilBuffer&&(W|=1024)),De&&e.framebufferRenderbuffer(36008,36064,36161,it.__webglColorRenderbuffer[dt]),at===!0&&(e.invalidateFramebuffer(36008,[lt]),e.invalidateFramebuffer(36009,[lt])),De){let bt=r.get(Y[dt]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,bt,0)}e.blitFramebuffer(0,0,Ee,Ve,0,0,Ee,Ve,W,9728),m&&e.invalidateFramebuffer(36008,Ge)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),De)for(let dt=0;dt<Y.length;dt++){i.bindFramebuffer(36160,it.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+dt,36161,it.__webglColorRenderbuffer[dt]);let at=r.get(Y[dt]).__webglTexture;i.bindFramebuffer(36160,it.__webglFramebuffer),e.framebufferTexture2D(36009,36064+dt,3553,at,0)}i.bindFramebuffer(36009,it.__webglMultisampledFramebuffer)}}function Ke(re){return Math.min(c,re.samples)}function Ye(re){let Y=r.get(re);return o&&re.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&Y.__useRenderToTexture!==!1}function yt(re){let Y=a.render.frame;g.get(re)!==Y&&(g.set(re,Y),re.update())}function pt(re,Y){let Ee=re.encoding,Ve=re.format,W=re.type;return re.isCompressedTexture===!0||re.isVideoTexture===!0||re.format===cT||Ee!==Vo&&(Ee===ui?o===!1?t.has("EXT_sRGB")===!0&&Ve===br?(re.format=cT,re.minFilter=fi,re.generateMipmaps=!1):Y=u5.sRGBToLinear(Y):(Ve!==br||W!==_s)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Ee)),Y}this.allocateTextureUnit=H,this.resetTextureUnits=K,this.setTexture2D=$,this.setTexture2DArray=V,this.setTexture3D=X,this.setTextureCube=ue,this.rebindTextures=st,this.setupRenderTarget=We,this.updateRenderTargetMipmap=ct,this.updateMultisampleRenderTarget=ut,this.setupDepthRenderbuffer=Ne,this.setupFrameBufferTexture=ye,this.useMultisampledRTT=Ye}function wK(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===_s)return 5121;if(s===n7)return 32819;if(s===s7)return 32820;if(s===t7)return 5120;if(s===i7)return 5122;if(s===t5)return 5123;if(s===r7)return 5124;if(s===Ru)return 5125;if(s===Ki)return 5126;if(s===Gu)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===a7)return 6406;if(s===br)return 6408;if(s===o7)return 6409;if(s===l7)return 6410;if(s===Od)return 6402;if(s===Ud)return 34041;if(s===cT)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===ab)return 6403;if(s===u7)return 36244;if(s===Lb)return 33319;if(s===h7)return 33320;if(s===i5)return 36249;if(s===BE||s===FE||s===UE||s===VE)if(a===ui)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===BE)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===FE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===UE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===VE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===BE)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===FE)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===UE)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===VE)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===jO||s===HO||s===GO||s===WO)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===jO)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===HO)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===GO)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===WO)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===c7)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===qO||s===XO)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===qO)return a===ui?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===XO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===YO||s===QO||s===KO||s===ZO||s===JO||s===$O||s===e3||s===t3||s===i3||s===r3||s===n3||s===s3||s===a3||s===o3)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===YO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===QO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===KO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===ZO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===JO)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===$O)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===e3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===t3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===i3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===r3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===n3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===s3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===a3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===o3)return a===ui?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===jE)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===jE)return a===ui?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===d7||s===l3||s===u3||s===h3)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===jE)return o.COMPRESSED_RED_RGTC1_EXT;if(s===l3)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===u3)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===h3)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Rd?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var _K=class extends vs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},ku=class extends qi{constructor(){super(),this.isGroup=!0,this.type="Group"}},SK={type:"move"},pA=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ku,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ku,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ku,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let g of e.hand.values()){let y=t.getJointPose(g,i),v=this._getHandJoint(l,g);y!==null&&(v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=y.radius),v.visible=y!==null}let u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],c=u.position.distanceTo(h.position),f=.02,m=.005;l.inputState.pinching&&c>f+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&c<=f-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(SK)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new ku;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},um=class extends Ar{constructor(e,t,i,r,n,s,a,o,l,u){if(u=u!==void 0?u:Od,u!==Od&&u!==Ud)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Od&&(i=Ru),i===void 0&&u===Ud&&(i=Rd),super(null,r,n,s,a,o,u,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:vi,this.minFilter=o!==void 0?o:vi,this.flipY=!1,this.generateMipmaps=!1}},EK=class extends as{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,u=null,h=null,c=null,f=null,m=null,g=t.getContextAttributes(),y=null,v=null,b=[],S=[],_=new Set,T=new Map,M=new vs;M.layers.enable(1),M.viewport=new Yt;let C=new vs;C.layers.enable(2),C.viewport=new Yt;let P=[M,C],E=new _K;E.layers.enable(1),E.layers.enable(2);let D=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(V){let X=b[V];return X===void 0&&(X=new pA,b[V]=X),X.getTargetRaySpace()},this.getControllerGrip=function(V){let X=b[V];return X===void 0&&(X=new pA,b[V]=X),X.getGripSpace()},this.getHand=function(V){let X=b[V];return X===void 0&&(X=new pA,b[V]=X),X.getHandSpace()};function O(V){let X=S.indexOf(V.inputSource);if(X===-1)return;let ue=b[X];ue!==void 0&&ue.dispatchEvent({type:V.type,data:V.inputSource})}function N(){r.removeEventListener("select",O),r.removeEventListener("selectstart",O),r.removeEventListener("selectend",O),r.removeEventListener("squeeze",O),r.removeEventListener("squeezestart",O),r.removeEventListener("squeezeend",O),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",k);for(let V=0;V<b.length;V++){let X=S[V];X!==null&&(S[V]=null,b[V].disconnect(X))}D=null,I=null,e.setRenderTarget(y),f=null,c=null,h=null,r=null,v=null,$.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(V){n=V,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(V){a=V,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(V){l=V},this.getBaseLayer=function(){return c!==null?c:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(V){if(r=V,r!==null){if(y=e.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",N),r.addEventListener("inputsourceschange",k),g.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let X={antialias:r.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:n};f=new XRWebGLLayer(r,t,X),r.updateRenderState({baseLayer:f}),v=new Pi(f.framebufferWidth,f.framebufferHeight,{format:br,type:_s,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let X=null,ue=null,ne=null;g.depth&&(ne=g.stencil?35056:33190,X=g.stencil?Ud:Od,ue=g.stencil?Rd:Ru);let he={colorFormat:32856,depthFormat:ne,scaleFactor:n};h=new XRWebGLBinding(r,t),c=h.createProjectionLayer(he),r.updateRenderState({layers:[c]}),v=new Pi(c.textureWidth,c.textureHeight,{format:br,type:_s,depthTexture:new um(c.textureWidth,c.textureHeight,ue,void 0,void 0,void 0,void 0,void 0,void 0,X),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});let te=e.properties.get(v);te.__ignoreDepthValues=c.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),$.setContext(r),$.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function k(V){for(let X=0;X<V.removed.length;X++){let ue=V.removed[X],ne=S.indexOf(ue);ne>=0&&(S[ne]=null,b[ne].disconnect(ue))}for(let X=0;X<V.added.length;X++){let ue=V.added[X],ne=S.indexOf(ue);if(ne===-1){for(let te=0;te<b.length;te++)if(te>=S.length){S.push(ue),ne=te;break}else if(S[te]===null){S[te]=ue,ne=te;break}if(ne===-1)break}let he=b[ne];he&&he.connect(ue)}}let U=new L,Q=new L;function se(V,X,ue){U.setFromMatrixPosition(X.matrixWorld),Q.setFromMatrixPosition(ue.matrixWorld);let ne=U.distanceTo(Q),he=X.projectionMatrix.elements,te=ue.projectionMatrix.elements,me=he[14]/(he[10]-1),de=he[14]/(he[10]+1),fe=(he[9]+1)/he[5],ye=(he[9]-1)/he[5],Te=(he[8]-1)/he[0],Ie=(te[8]+1)/te[0],Ne=me*Te,st=me*Ie,We=ne/(-Te+Ie),ct=We*-Te;X.matrixWorld.decompose(V.position,V.quaternion,V.scale),V.translateX(ct),V.translateZ(We),V.matrixWorld.compose(V.position,V.quaternion,V.scale),V.matrixWorldInverse.copy(V.matrixWorld).invert();let ut=me+We,Ke=de+We,Ye=Ne-ct,yt=st+(ne-ct),pt=fe*de/Ke*ut,re=ye*de/Ke*ut;V.projectionMatrix.makePerspective(Ye,yt,pt,re,ut,Ke)}function K(V,X){X===null?V.matrixWorld.copy(V.matrix):V.matrixWorld.multiplyMatrices(X.matrixWorld,V.matrix),V.matrixWorldInverse.copy(V.matrixWorld).invert()}this.updateCamera=function(V){if(r===null)return;E.near=C.near=M.near=V.near,E.far=C.far=M.far=V.far,(D!==E.near||I!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),D=E.near,I=E.far);let X=V.parent,ue=E.cameras;K(E,X);for(let he=0;he<ue.length;he++)K(ue[he],X);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),V.matrix.copy(E.matrix),V.matrix.decompose(V.position,V.quaternion,V.scale);let ne=V.children;for(let he=0,te=ne.length;he<te;he++)ne[he].updateMatrixWorld(!0);ue.length===2?se(E,M,C):E.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(!(c===null&&f===null))return o},this.setFoveation=function(V){o=V,c!==null&&(c.fixedFoveation=V),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=V)},this.getPlanes=function(){return _};let H=null;function ie(V,X){if(u=X.getViewerPose(l||s),m=X,u!==null){let ue=u.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let ne=!1;ue.length!==E.cameras.length&&(E.cameras.length=0,ne=!0);for(let he=0;he<ue.length;he++){let te=ue[he],me=null;if(f!==null)me=f.getViewport(te);else{let fe=h.getViewSubImage(c,te);me=fe.viewport,he===0&&(e.setRenderTargetTextures(v,fe.colorTexture,c.ignoreDepthValues?void 0:fe.depthStencilTexture),e.setRenderTarget(v))}let de=P[he];de===void 0&&(de=new vs,de.layers.enable(he),de.viewport=new Yt,P[he]=de),de.matrix.fromArray(te.transform.matrix),de.projectionMatrix.fromArray(te.projectionMatrix),de.viewport.set(me.x,me.y,me.width,me.height),he===0&&E.matrix.copy(de.matrix),ne===!0&&E.cameras.push(de)}}for(let ue=0;ue<b.length;ue++){let ne=S[ue],he=b[ue];ne!==null&&he!==void 0&&he.update(ne,X,l||s)}if(H&&H(V,X),X.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:X.detectedPlanes});let ue=null;for(let ne of _)X.detectedPlanes.has(ne)||(ue===null&&(ue=[]),ue.push(ne));if(ue!==null)for(let ne of ue)_.delete(ne),T.delete(ne),i.dispatchEvent({type:"planeremoved",data:ne});for(let ne of X.detectedPlanes)if(!_.has(ne))_.add(ne),T.set(ne,X.lastChangedTime),i.dispatchEvent({type:"planeadded",data:ne});else{let he=T.get(ne);ne.lastChangedTime>he&&(T.set(ne,ne.lastChangedTime),i.dispatchEvent({type:"planechanged",data:ne}))}}m=null}let $=new m5;$.setAnimationLoop(ie),this.setAnimationLoop=function(V){H=V},this.dispose=function(){}}};function AK(e,t){function i(y,v){v.color.getRGB(y.fogColor.value,p5(e)),v.isFog?(y.fogNear.value=v.near,y.fogFar.value=v.far):v.isFogExp2&&(y.fogDensity.value=v.density)}function r(y,v,b,S,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?n(y,v):v.isMeshToonMaterial?(n(y,v),h(y,v)):v.isMeshPhongMaterial?(n(y,v),u(y,v)):v.isMeshStandardMaterial?(n(y,v),c(y,v),v.isMeshPhysicalMaterial&&f(y,v,_)):v.isMeshMatcapMaterial?(n(y,v),m(y,v)):v.isMeshDepthMaterial?n(y,v):v.isMeshDistanceMaterial?(n(y,v),g(y,v)):v.isMeshNormalMaterial?n(y,v):v.isLineBasicMaterial?(s(y,v),v.isLineDashedMaterial&&a(y,v)):v.isPointsMaterial?o(y,v,b,S):v.isSpriteMaterial?l(y,v):v.isShadowMaterial?(y.color.value.copy(v.color),y.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function n(y,v){y.opacity.value=v.opacity,v.color&&y.diffuse.value.copy(v.color),v.emissive&&y.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.bumpMap&&(y.bumpMap.value=v.bumpMap,y.bumpScale.value=v.bumpScale,v.side===zn&&(y.bumpScale.value*=-1)),v.displacementMap&&(y.displacementMap.value=v.displacementMap,y.displacementScale.value=v.displacementScale,y.displacementBias.value=v.displacementBias),v.emissiveMap&&(y.emissiveMap.value=v.emissiveMap),v.normalMap&&(y.normalMap.value=v.normalMap,y.normalScale.value.copy(v.normalScale),v.side===zn&&y.normalScale.value.negate()),v.specularMap&&(y.specularMap.value=v.specularMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);let b=t.get(v).envMap;if(b&&(y.envMap.value=b,y.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=v.reflectivity,y.ior.value=v.ior,y.refractionRatio.value=v.refractionRatio),v.lightMap){y.lightMap.value=v.lightMap;let T=e.physicallyCorrectLights!==!0?Math.PI:1;y.lightMapIntensity.value=v.lightMapIntensity*T}v.aoMap&&(y.aoMap.value=v.aoMap,y.aoMapIntensity.value=v.aoMapIntensity);let S;v.map?S=v.map:v.specularMap?S=v.specularMap:v.displacementMap?S=v.displacementMap:v.normalMap?S=v.normalMap:v.bumpMap?S=v.bumpMap:v.roughnessMap?S=v.roughnessMap:v.metalnessMap?S=v.metalnessMap:v.alphaMap?S=v.alphaMap:v.emissiveMap?S=v.emissiveMap:v.clearcoatMap?S=v.clearcoatMap:v.clearcoatNormalMap?S=v.clearcoatNormalMap:v.clearcoatRoughnessMap?S=v.clearcoatRoughnessMap:v.iridescenceMap?S=v.iridescenceMap:v.iridescenceThicknessMap?S=v.iridescenceThicknessMap:v.specularIntensityMap?S=v.specularIntensityMap:v.specularColorMap?S=v.specularColorMap:v.transmissionMap?S=v.transmissionMap:v.thicknessMap?S=v.thicknessMap:v.sheenColorMap?S=v.sheenColorMap:v.sheenRoughnessMap&&(S=v.sheenRoughnessMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),y.uvTransform.value.copy(S.matrix));let _;v.aoMap?_=v.aoMap:v.lightMap&&(_=v.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),y.uv2Transform.value.copy(_.matrix))}function s(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity}function a(y,v){y.dashSize.value=v.dashSize,y.totalSize.value=v.dashSize+v.gapSize,y.scale.value=v.scale}function o(y,v,b,S){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.size.value=v.size*b,y.scale.value=S*.5,v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);let _;v.map?_=v.map:v.alphaMap&&(_=v.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),y.uvTransform.value.copy(_.matrix))}function l(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.rotation.value=v.rotation,v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);let b;v.map?b=v.map:v.alphaMap&&(b=v.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),y.uvTransform.value.copy(b.matrix))}function u(y,v){y.specular.value.copy(v.specular),y.shininess.value=Math.max(v.shininess,1e-4)}function h(y,v){v.gradientMap&&(y.gradientMap.value=v.gradientMap)}function c(y,v){y.roughness.value=v.roughness,y.metalness.value=v.metalness,v.roughnessMap&&(y.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(y.metalnessMap.value=v.metalnessMap),t.get(v).envMap&&(y.envMapIntensity.value=v.envMapIntensity)}function f(y,v,b){y.ior.value=v.ior,v.sheen>0&&(y.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),y.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(y.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(y.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(y.clearcoat.value=v.clearcoat,y.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(y.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),y.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===zn&&y.clearcoatNormalScale.value.negate())),v.iridescence>0&&(y.iridescence.value=v.iridescence,y.iridescenceIOR.value=v.iridescenceIOR,y.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(y.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(y.transmission.value=v.transmission,y.transmissionSamplerMap.value=b.texture,y.transmissionSamplerSize.value.set(b.width,b.height),v.transmissionMap&&(y.transmissionMap.value=v.transmissionMap),y.thickness.value=v.thickness,v.thicknessMap&&(y.thicknessMap.value=v.thicknessMap),y.attenuationDistance.value=v.attenuationDistance,y.attenuationColor.value.copy(v.attenuationColor)),y.specularIntensity.value=v.specularIntensity,y.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(y.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(y.specularColorMap.value=v.specularColorMap)}function m(y,v){v.matcap&&(y.matcap.value=v.matcap)}function g(y,v){y.referencePosition.value.copy(v.referencePosition),y.nearDistance.value=v.nearDistance,y.farDistance.value=v.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function CK(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(S,_){let T=_.program;r.uniformBlockBinding(S,T)}function u(S,_){let T=n[S.id];T===void 0&&(g(S),T=h(S),n[S.id]=T,S.addEventListener("dispose",v));let M=_.program;r.updateUBOMapping(S,M);let C=t.render.frame;s[S.id]!==C&&(f(S),s[S.id]=C)}function h(S){let _=c();S.__bindingPointIndex=_;let T=e.createBuffer(),M=S.__size,C=S.usage;return e.bindBuffer(35345,T),e.bufferData(35345,M,C),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,T),T}function c(){for(let S=0;S<o;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(S){let _=n[S.id],T=S.uniforms,M=S.__cache;e.bindBuffer(35345,_);for(let C=0,P=T.length;C<P;C++){let E=T[C];if(m(E,C,M)===!0){let D=E.__offset,I=Array.isArray(E.value)?E.value:[E.value],O=0;for(let N=0;N<I.length;N++){let k=I[N],U=y(k);typeof k=="number"?(E.__data[0]=k,e.bufferSubData(35345,D+O,E.__data)):k.isMatrix3?(E.__data[0]=k.elements[0],E.__data[1]=k.elements[1],E.__data[2]=k.elements[2],E.__data[3]=k.elements[0],E.__data[4]=k.elements[3],E.__data[5]=k.elements[4],E.__data[6]=k.elements[5],E.__data[7]=k.elements[0],E.__data[8]=k.elements[6],E.__data[9]=k.elements[7],E.__data[10]=k.elements[8],E.__data[11]=k.elements[0]):(k.toArray(E.__data,O),O+=U.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,D,E.__data)}}e.bindBuffer(35345,null)}function m(S,_,T){let M=S.value;if(T[_]===void 0){if(typeof M=="number")T[_]=M;else{let C=Array.isArray(M)?M:[M],P=[];for(let E=0;E<C.length;E++)P.push(C[E].clone());T[_]=P}return!0}else if(typeof M=="number"){if(T[_]!==M)return T[_]=M,!0}else{let C=Array.isArray(T[_])?T[_]:[T[_]],P=Array.isArray(M)?M:[M];for(let E=0;E<C.length;E++){let D=C[E];if(D.equals(P[E])===!1)return D.copy(P[E]),!0}}return!1}function g(S){let _=S.uniforms,T=0,M=16,C=0;for(let P=0,E=_.length;P<E;P++){let D=_[P],I={boundary:0,storage:0},O=Array.isArray(D.value)?D.value:[D.value];for(let N=0,k=O.length;N<k;N++){let U=O[N],Q=y(U);I.boundary+=Q.boundary,I.storage+=Q.storage}if(D.__data=new Float32Array(I.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=T,P>0){C=T%M;let N=M-C;C!==0&&N-I.boundary<0&&(T+=M-C,D.__offset=T)}T+=I.storage}return C=T%M,C>0&&(T+=M-C),S.__size=T,S.__cache={},this}function y(S){let _={boundary:0,storage:0};return typeof S=="number"?(_.boundary=4,_.storage=4):S.isVector2?(_.boundary=8,_.storage=8):S.isVector3||S.isColor?(_.boundary=16,_.storage=12):S.isVector4?(_.boundary=16,_.storage=16):S.isMatrix3?(_.boundary=48,_.storage=48):S.isMatrix4?(_.boundary=64,_.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),_}function v(S){let _=S.target;_.removeEventListener("dispose",v);let T=a.indexOf(_.__bindingPointIndex);a.splice(T,1),e.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function b(){for(let S in n)e.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:u,dispose:b}}function TK(){let e=ry("canvas");return e.style.display="block",e}function w5(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:TK(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,h;i!==null?h=i.getContextAttributes().alpha:h=e.alpha!==void 0?e.alpha:!1;let c=null,f=null,m=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vo,this.physicallyCorrectLights=!1,this.toneMapping=Ol,this.toneMappingExposure=1;let y=this,v=!1,b=0,S=0,_=null,T=-1,M=null,C=new Yt,P=new Yt,E=null,D=t.width,I=t.height,O=1,N=null,k=null,U=new Yt(0,0,D,I),Q=new Yt(0,0,D,I),se=!1,K=new GP,H=!1,ie=!1,$=null,V=new je,X=new oe,ue=new L,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function he(){return _===null?O:1}let te=i;function me(ee,we){for(let ke=0;ke<ee.length;ke++){let xe=ee[ke],ze=t.getContext(xe,we);if(ze!==null)return ze}return null}try{let ee={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Dm}`),t.addEventListener("webglcontextlost",Dt,!1),t.addEventListener("webglcontextrestored",Ct,!1),t.addEventListener("webglcontextcreationerror",Pt,!1),te===null){let we=["webgl2","webgl","experimental-webgl"];if(y.isWebGL1Renderer===!0&&we.shift(),te=me(we,ee),te===null)throw me(we)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}let de,fe,ye,Te,Ie,Ne,st,We,ct,ut,Ke,Ye,yt,pt,re,Y,Ee,Ve,W,Ge,lt,it,De,dt;function at(){de=new UY(te),fe=new kY(te,de,e),de.init(fe),it=new wK(te,de,fe),ye=new xK(te,de,fe),Te=new HY,Ie=new aK,Ne=new bK(te,de,ye,Ie,fe,it,Te),st=new zY(y),We=new FY(y),ct=new J7(te,fe),De=new RY(te,de,ct,fe),ut=new VY(te,ct,Te,De),Ke=new XY(te,ut,ct,Te),W=new qY(te,fe,Ne),Y=new LY(Ie),Ye=new sK(y,st,We,de,fe,De,Y),yt=new AK(y,Ie),pt=new lK,re=new pK(de,fe),Ve=new IY(y,st,We,ye,Ke,h,a),Ee=new yK(y,Ke,fe),dt=new CK(te,Te,fe,ye),Ge=new OY(te,de,Te,fe),lt=new jY(te,de,Te,fe),Te.programs=Ye.programs,y.capabilities=fe,y.extensions=de,y.properties=Ie,y.renderLists=pt,y.shadowMap=Ee,y.state=ye,y.info=Te}at();let bt=new EK(y,te);this.xr=bt,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){let ee=de.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){let ee=de.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(ee){ee!==void 0&&(O=ee,this.setSize(D,I,!1))},this.getSize=function(ee){return ee.set(D,I)},this.setSize=function(ee,we,ke){if(bt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}D=ee,I=we,t.width=Math.floor(ee*O),t.height=Math.floor(we*O),ke!==!1&&(t.style.width=ee+"px",t.style.height=we+"px"),this.setViewport(0,0,ee,we)},this.getDrawingBufferSize=function(ee){return ee.set(D*O,I*O).floor()},this.setDrawingBufferSize=function(ee,we,ke){D=ee,I=we,O=ke,t.width=Math.floor(ee*ke),t.height=Math.floor(we*ke),this.setViewport(0,0,ee,we)},this.getCurrentViewport=function(ee){return ee.copy(C)},this.getViewport=function(ee){return ee.copy(U)},this.setViewport=function(ee,we,ke,xe){ee.isVector4?U.set(ee.x,ee.y,ee.z,ee.w):U.set(ee,we,ke,xe),ye.viewport(C.copy(U).multiplyScalar(O).floor())},this.getScissor=function(ee){return ee.copy(Q)},this.setScissor=function(ee,we,ke,xe){ee.isVector4?Q.set(ee.x,ee.y,ee.z,ee.w):Q.set(ee,we,ke,xe),ye.scissor(P.copy(Q).multiplyScalar(O).floor())},this.getScissorTest=function(){return se},this.setScissorTest=function(ee){ye.setScissorTest(se=ee)},this.setOpaqueSort=function(ee){N=ee},this.setTransparentSort=function(ee){k=ee},this.getClearColor=function(ee){return ee.copy(Ve.getClearColor())},this.setClearColor=function(){Ve.setClearColor.apply(Ve,arguments)},this.getClearAlpha=function(){return Ve.getClearAlpha()},this.setClearAlpha=function(){Ve.setClearAlpha.apply(Ve,arguments)},this.clear=function(ee=!0,we=!0,ke=!0){let xe=0;ee&&(xe|=16384),we&&(xe|=256),ke&&(xe|=1024),te.clear(xe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Dt,!1),t.removeEventListener("webglcontextrestored",Ct,!1),t.removeEventListener("webglcontextcreationerror",Pt,!1),pt.dispose(),re.dispose(),Ie.dispose(),st.dispose(),We.dispose(),Ke.dispose(),De.dispose(),dt.dispose(),Ye.dispose(),bt.dispose(),bt.removeEventListener("sessionstart",et),bt.removeEventListener("sessionend",Ot),$&&($.dispose(),$=null),ti.stop()};function Dt(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Ct(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let ee=Te.autoReset,we=Ee.enabled,ke=Ee.autoUpdate,xe=Ee.needsUpdate,ze=Ee.type;at(),Te.autoReset=ee,Ee.enabled=we,Ee.autoUpdate=ke,Ee.needsUpdate=xe,Ee.type=ze}function Pt(ee){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ee.statusMessage)}function Oi(ee){let we=ee.target;we.removeEventListener("dispose",Oi),ji(we)}function ji(ee){pe(ee),Ie.remove(ee)}function pe(ee){let we=Ie.get(ee).programs;we!==void 0&&(we.forEach(function(ke){Ye.releaseProgram(ke)}),ee.isShaderMaterial&&Ye.releaseShaderCache(ee))}this.renderBufferDirect=function(ee,we,ke,xe,ze,vt){we===null&&(we=ne);let It=ze.isMesh&&ze.matrixWorld.determinant()<0,Lt=Ts(ee,we,ke,xe,ze);ye.setMaterial(xe,It);let wt=ke.index,wi=1;xe.wireframe===!0&&(wt=ut.getWireframeAttribute(ke),wi=2);let ni=ke.drawRange,ii=ke.attributes.position,Xt=ni.start*wi,dr=(ni.start+ni.count)*wi;vt!==null&&(Xt=Math.max(Xt,vt.start*wi),dr=Math.min(dr,(vt.start+vt.count)*wi)),wt!==null?(Xt=Math.max(Xt,0),dr=Math.min(dr,wt.count)):ii!=null&&(Xt=Math.max(Xt,0),dr=Math.min(dr,ii.count));let Vn=dr-Xt;if(Vn<0||Vn===1/0)return;De.setup(ze,xe,Lt,ke,wt);let fa,Zt=Ge;if(wt!==null&&(fa=ct.get(wt),Zt=lt,Zt.setIndex(fa)),ze.isMesh)xe.wireframe===!0?(ye.setLineWidth(xe.wireframeLinewidth*he()),Zt.setMode(1)):Zt.setMode(4);else if(ze.isLine){let mi=xe.linewidth;mi===void 0&&(mi=1),ye.setLineWidth(mi*he()),ze.isLineSegments?Zt.setMode(1):ze.isLineLoop?Zt.setMode(2):Zt.setMode(3)}else ze.isPoints?Zt.setMode(0):ze.isSprite&&Zt.setMode(4);if(ze.isInstancedMesh)Zt.renderInstances(Xt,Vn,ze.count);else if(ke.isInstancedBufferGeometry){let mi=ke._maxInstanceCount!==void 0?ke._maxInstanceCount:1/0,rn=Math.min(ke.instanceCount,mi);Zt.renderInstances(Xt,Vn,rn)}else Zt.render(Xt,Vn)},this.compile=function(ee,we){function ke(xe,ze,vt){xe.transparent===!0&&xe.side===bs&&xe.forceSinglePass===!1?(xe.side=zn,xe.needsUpdate=!0,Ai(xe,ze,vt),xe.side=Uo,xe.needsUpdate=!0,Ai(xe,ze,vt),xe.side=bs):Ai(xe,ze,vt)}f=re.get(ee),f.init(),g.push(f),ee.traverseVisible(function(xe){xe.isLight&&xe.layers.test(we.layers)&&(f.pushLight(xe),xe.castShadow&&f.pushShadow(xe))}),f.setupLights(y.physicallyCorrectLights),ee.traverse(function(xe){let ze=xe.material;if(ze)if(Array.isArray(ze))for(let vt=0;vt<ze.length;vt++){let It=ze[vt];ke(It,ee,xe)}else ke(ze,ee,xe)}),g.pop(),f=null};let Oe=null;function Be(ee){Oe&&Oe(ee)}function et(){ti.stop()}function Ot(){ti.start()}let ti=new m5;ti.setAnimationLoop(Be),typeof self<"u"&&ti.setContext(self),this.setAnimationLoop=function(ee){Oe=ee,bt.setAnimationLoop(ee),ee===null?ti.stop():ti.start()},bt.addEventListener("sessionstart",et),bt.addEventListener("sessionend",Ot),this.render=function(ee,we){if(we!==void 0&&we.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),we.parent===null&&we.matrixWorldAutoUpdate===!0&&we.updateMatrixWorld(),bt.enabled===!0&&bt.isPresenting===!0&&(bt.cameraAutoUpdate===!0&&bt.updateCamera(we),we=bt.getCamera()),ee.isScene===!0&&ee.onBeforeRender(y,ee,we,_),f=re.get(ee,g.length),f.init(),g.push(f),V.multiplyMatrices(we.projectionMatrix,we.matrixWorldInverse),K.setFromProjectionMatrix(V),ie=this.localClippingEnabled,H=Y.init(this.clippingPlanes,ie),c=pt.get(ee,m.length),c.init(),m.push(c),rr(ee,we,0,y.sortObjects),c.finish(),y.sortObjects===!0&&c.sort(N,k),H===!0&&Y.beginShadows();let ke=f.state.shadowsArray;if(Ee.render(ke,ee,we),H===!0&&Y.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ve.render(c,ee),f.setupLights(y.physicallyCorrectLights),we.isArrayCamera){let xe=we.cameras;for(let ze=0,vt=xe.length;ze<vt;ze++){let It=xe[ze];or(c,ee,It,It.viewport)}}else or(c,ee,we);_!==null&&(Ne.updateMultisampleRenderTarget(_),Ne.updateRenderTargetMipmap(_)),ee.isScene===!0&&ee.onAfterRender(y,ee,we),De.resetDefaultState(),T=-1,M=null,g.pop(),g.length>0?f=g[g.length-1]:f=null,m.pop(),m.length>0?c=m[m.length-1]:c=null};function rr(ee,we,ke,xe){if(ee.visible===!1)return;if(ee.layers.test(we.layers)){if(ee.isGroup)ke=ee.renderOrder;else if(ee.isLOD)ee.autoUpdate===!0&&ee.update(we);else if(ee.isLight)f.pushLight(ee),ee.castShadow&&f.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||K.intersectsSprite(ee)){xe&&ue.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(V);let vt=Ke.update(ee),It=ee.material;It.visible&&c.push(ee,vt,It,ke,ue.z,null)}}else if((ee.isMesh||ee.isLine||ee.isPoints)&&(ee.isSkinnedMesh&&ee.skeleton.frame!==Te.render.frame&&(ee.skeleton.update(),ee.skeleton.frame=Te.render.frame),!ee.frustumCulled||K.intersectsObject(ee))){xe&&ue.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(V);let vt=Ke.update(ee),It=ee.material;if(Array.isArray(It)){let Lt=vt.groups;for(let wt=0,wi=Lt.length;wt<wi;wt++){let ni=Lt[wt],ii=It[ni.materialIndex];ii&&ii.visible&&c.push(ee,vt,ii,ke,ue.z,ni)}}else It.visible&&c.push(ee,vt,It,ke,ue.z,null)}}let ze=ee.children;for(let vt=0,It=ze.length;vt<It;vt++)rr(ze[vt],we,ke,xe)}function or(ee,we,ke,xe){let ze=ee.opaque,vt=ee.transmissive,It=ee.transparent;f.setupLightsView(ke),H===!0&&Y.setGlobalState(y.clippingPlanes,ke),vt.length>0&&os(ze,we,ke),xe&&ye.viewport(C.copy(xe)),ze.length>0&&Ei(ze,we,ke),vt.length>0&&Ei(vt,we,ke),It.length>0&&Ei(It,we,ke),ye.buffers.depth.setTest(!0),ye.buffers.depth.setMask(!0),ye.buffers.color.setMask(!0),ye.setPolygonOffset(!1)}function os(ee,we,ke){let xe=fe.isWebGL2;$===null&&($=new Pi(1,1,{generateMipmaps:!0,type:de.has("EXT_color_buffer_half_float")?Gu:_s,minFilter:om,samples:xe&&s===!0?4:0})),y.getDrawingBufferSize(X),xe?$.setSize(X.x,X.y):$.setSize(Ub(X.x),Ub(X.y));let ze=y.getRenderTarget();y.setRenderTarget($),y.clear();let vt=y.toneMapping;y.toneMapping=Ol,Ei(ee,we,ke),y.toneMapping=vt,Ne.updateMultisampleRenderTarget($),Ne.updateRenderTargetMipmap($),y.setRenderTarget(ze)}function Ei(ee,we,ke){let xe=we.isScene===!0?we.overrideMaterial:null;for(let ze=0,vt=ee.length;ze<vt;ze++){let It=ee[ze],Lt=It.object,wt=It.geometry,wi=xe===null?It.material:xe,ni=It.group;Lt.layers.test(ke.layers)&&Un(Lt,we,ke,wt,wi,ni)}}function Un(ee,we,ke,xe,ze,vt){ee.onBeforeRender(y,we,ke,xe,ze,vt),ee.modelViewMatrix.multiplyMatrices(ke.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),ze.onBeforeRender(y,we,ke,xe,ee,vt),ze.transparent===!0&&ze.side===bs&&ze.forceSinglePass===!1?(ze.side=zn,ze.needsUpdate=!0,y.renderBufferDirect(ke,we,xe,ze,ee,vt),ze.side=Uo,ze.needsUpdate=!0,y.renderBufferDirect(ke,we,xe,ze,ee,vt),ze.side=bs):y.renderBufferDirect(ke,we,xe,ze,ee,vt),ee.onAfterRender(y,we,ke,xe,ze,vt)}function Ai(ee,we,ke){we.isScene!==!0&&(we=ne);let xe=Ie.get(ee),ze=f.state.lights,vt=f.state.shadowsArray,It=ze.state.version,Lt=Ye.getParameters(ee,ze.state,vt,we,ke),wt=Ye.getProgramCacheKey(Lt),wi=xe.programs;xe.environment=ee.isMeshStandardMaterial?we.environment:null,xe.fog=we.fog,xe.envMap=(ee.isMeshStandardMaterial?We:st).get(ee.envMap||xe.environment),wi===void 0&&(ee.addEventListener("dispose",Oi),wi=new Map,xe.programs=wi);let ni=wi.get(wt);if(ni!==void 0){if(xe.currentProgram===ni&&xe.lightsStateVersion===It)return ca(ee,Lt),ni}else Lt.uniforms=Ye.getUniforms(ee),ee.onBuild(ke,Lt,y),ee.onBeforeCompile(Lt,y),ni=Ye.acquireProgram(Lt,wt),wi.set(wt,ni),xe.uniforms=Lt.uniforms;let ii=xe.uniforms;(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||ee.clipping===!0)&&(ii.clippingPlanes=Y.uniform),ca(ee,Lt),xe.needsLights=da(ee),xe.lightsStateVersion=It,xe.needsLights&&(ii.ambientLightColor.value=ze.state.ambient,ii.lightProbe.value=ze.state.probe,ii.directionalLights.value=ze.state.directional,ii.directionalLightShadows.value=ze.state.directionalShadow,ii.spotLights.value=ze.state.spot,ii.spotLightShadows.value=ze.state.spotShadow,ii.rectAreaLights.value=ze.state.rectArea,ii.ltc_1.value=ze.state.rectAreaLTC1,ii.ltc_2.value=ze.state.rectAreaLTC2,ii.pointLights.value=ze.state.point,ii.pointLightShadows.value=ze.state.pointShadow,ii.hemisphereLights.value=ze.state.hemi,ii.directionalShadowMap.value=ze.state.directionalShadowMap,ii.directionalShadowMatrix.value=ze.state.directionalShadowMatrix,ii.spotShadowMap.value=ze.state.spotShadowMap,ii.spotLightMatrix.value=ze.state.spotLightMatrix,ii.spotLightMap.value=ze.state.spotLightMap,ii.pointShadowMap.value=ze.state.pointShadowMap,ii.pointShadowMatrix.value=ze.state.pointShadowMatrix);let Xt=ni.getUniforms(),dr=lb.seqWithValue(Xt.seq,ii);return xe.currentProgram=ni,xe.uniformsList=dr,ni}function ca(ee,we){let ke=Ie.get(ee);ke.outputEncoding=we.outputEncoding,ke.instancing=we.instancing,ke.skinning=we.skinning,ke.morphTargets=we.morphTargets,ke.morphNormals=we.morphNormals,ke.morphColors=we.morphColors,ke.morphTargetsCount=we.morphTargetsCount,ke.numClippingPlanes=we.numClippingPlanes,ke.numIntersection=we.numClipIntersection,ke.vertexAlphas=we.vertexAlphas,ke.vertexTangents=we.vertexTangents,ke.toneMapping=we.toneMapping}function Ts(ee,we,ke,xe,ze){we.isScene!==!0&&(we=ne),Ne.resetTextureUnits();let vt=we.fog,It=xe.isMeshStandardMaterial?we.environment:null,Lt=_===null?y.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Vo,wt=(xe.isMeshStandardMaterial?We:st).get(xe.envMap||It),wi=xe.vertexColors===!0&&!!ke.attributes.color&&ke.attributes.color.itemSize===4,ni=!!xe.normalMap&&!!ke.attributes.tangent,ii=!!ke.morphAttributes.position,Xt=!!ke.morphAttributes.normal,dr=!!ke.morphAttributes.color,Vn=xe.toneMapped?y.toneMapping:Ol,fa=ke.morphAttributes.position||ke.morphAttributes.normal||ke.morphAttributes.color,Zt=fa!==void 0?fa.length:0,mi=Ie.get(xe),rn=f.state.lights;if(H===!0&&(ie===!0||ee!==M)){let J=ee===M&&xe.id===T;Y.setState(xe,ee,J)}let $t=!1;xe.version===mi.__version?(mi.needsLights&&mi.lightsStateVersion!==rn.state.version||mi.outputEncoding!==Lt||ze.isInstancedMesh&&mi.instancing===!1||!ze.isInstancedMesh&&mi.instancing===!0||ze.isSkinnedMesh&&mi.skinning===!1||!ze.isSkinnedMesh&&mi.skinning===!0||mi.envMap!==wt||xe.fog===!0&&mi.fog!==vt||mi.numClippingPlanes!==void 0&&(mi.numClippingPlanes!==Y.numPlanes||mi.numIntersection!==Y.numIntersection)||mi.vertexAlphas!==wi||mi.vertexTangents!==ni||mi.morphTargets!==ii||mi.morphNormals!==Xt||mi.morphColors!==dr||mi.toneMapping!==Vn||fe.isWebGL2===!0&&mi.morphTargetsCount!==Zt)&&($t=!0):($t=!0,mi.__version=xe.version);let Tr=mi.currentProgram;$t===!0&&(Tr=Ai(xe,we,ze));let pa=!1,ma=!1,_n=!1,j=Tr.getUniforms(),q=mi.uniforms;if(ye.useProgram(Tr.program)&&(pa=!0,ma=!0,_n=!0),xe.id!==T&&(T=xe.id,ma=!0),pa||M!==ee){if(j.setValue(te,"projectionMatrix",ee.projectionMatrix),fe.logarithmicDepthBuffer&&j.setValue(te,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),M!==ee&&(M=ee,ma=!0,_n=!0),xe.isShaderMaterial||xe.isMeshPhongMaterial||xe.isMeshToonMaterial||xe.isMeshStandardMaterial||xe.envMap){let J=j.map.cameraPosition;J!==void 0&&J.setValue(te,ue.setFromMatrixPosition(ee.matrixWorld))}(xe.isMeshPhongMaterial||xe.isMeshToonMaterial||xe.isMeshLambertMaterial||xe.isMeshBasicMaterial||xe.isMeshStandardMaterial||xe.isShaderMaterial)&&j.setValue(te,"isOrthographic",ee.isOrthographicCamera===!0),(xe.isMeshPhongMaterial||xe.isMeshToonMaterial||xe.isMeshLambertMaterial||xe.isMeshBasicMaterial||xe.isMeshStandardMaterial||xe.isShaderMaterial||xe.isShadowMaterial||ze.isSkinnedMesh)&&j.setValue(te,"viewMatrix",ee.matrixWorldInverse)}if(ze.isSkinnedMesh){j.setOptional(te,ze,"bindMatrix"),j.setOptional(te,ze,"bindMatrixInverse");let J=ze.skeleton;J&&(fe.floatVertexTextures?(J.boneTexture===null&&J.computeBoneTexture(),j.setValue(te,"boneTexture",J.boneTexture,Ne),j.setValue(te,"boneTextureSize",J.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let le=ke.morphAttributes;if((le.position!==void 0||le.normal!==void 0||le.color!==void 0&&fe.isWebGL2===!0)&&W.update(ze,ke,xe,Tr),(ma||mi.receiveShadow!==ze.receiveShadow)&&(mi.receiveShadow=ze.receiveShadow,j.setValue(te,"receiveShadow",ze.receiveShadow)),xe.isMeshGouraudMaterial&&xe.envMap!==null&&(q.envMap.value=wt,q.flipEnvMap.value=wt.isCubeTexture&&wt.isRenderTargetTexture===!1?-1:1),ma&&(j.setValue(te,"toneMappingExposure",y.toneMappingExposure),mi.needsLights&&so(q,_n),vt&&xe.fog===!0&&yt.refreshFogUniforms(q,vt),yt.refreshMaterialUniforms(q,xe,O,I,$),lb.upload(te,mi.uniformsList,q,Ne)),xe.isShaderMaterial&&xe.uniformsNeedUpdate===!0&&(lb.upload(te,mi.uniformsList,q,Ne),xe.uniformsNeedUpdate=!1),xe.isSpriteMaterial&&j.setValue(te,"center",ze.center),j.setValue(te,"modelViewMatrix",ze.modelViewMatrix),j.setValue(te,"normalMatrix",ze.normalMatrix),j.setValue(te,"modelMatrix",ze.matrixWorld),ze.previousModelViewMatrix&&j.setValue(te,"previousModelViewMatrix",ze.previousModelViewMatrix),ee.previousProjectionMatrix&&j.setValue(te,"previousProjectionMatrix",ee.previousProjectionMatrix),xe.isShaderMaterial||xe.isRawShaderMaterial){let J=xe.uniformsGroups;for(let ve=0,qe=J.length;ve<qe;ve++)if(fe.isWebGL2){let ls=J[ve];dt.update(ls,Tr),dt.bind(ls,Tr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Tr}function so(ee,we){ee.ambientLightColor.needsUpdate=we,ee.lightProbe.needsUpdate=we,ee.directionalLights.needsUpdate=we,ee.directionalLightShadows.needsUpdate=we,ee.pointLights.needsUpdate=we,ee.pointLightShadows.needsUpdate=we,ee.spotLights.needsUpdate=we,ee.spotLightShadows.needsUpdate=we,ee.rectAreaLights.needsUpdate=we,ee.hemisphereLights.needsUpdate=we}function da(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&ee.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(ee,we,ke){Ie.get(ee.texture).__webglTexture=we,Ie.get(ee.depthTexture).__webglTexture=ke;let xe=Ie.get(ee);xe.__hasExternalTextures=!0,xe.__hasExternalTextures&&(xe.__autoAllocateDepthBuffer=ke===void 0,xe.__autoAllocateDepthBuffer||de.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),xe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ee,we){let ke=Ie.get(ee);ke.__webglFramebuffer=we,ke.__useDefaultFramebuffer=we===void 0},this.setRenderTarget=function(ee,we=0,ke=0){_=ee,b=we,S=ke;let xe=!0,ze=null,vt=!1,It=!1;if(ee){let Lt=Ie.get(ee);Lt.__useDefaultFramebuffer!==void 0?(ye.bindFramebuffer(36160,null),xe=!1):Lt.__webglFramebuffer===void 0?Ne.setupRenderTarget(ee):Lt.__hasExternalTextures&&Ne.rebindTextures(ee,Ie.get(ee.texture).__webglTexture,Ie.get(ee.depthTexture).__webglTexture);let wt=ee.texture;(wt.isData3DTexture||wt.isDataArrayTexture||wt.isCompressedArrayTexture)&&(It=!0);let wi=Ie.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(ze=wi[we],vt=!0):fe.isWebGL2&&ee.samples>0&&Ne.useMultisampledRTT(ee)===!1?ze=Ie.get(ee).__webglMultisampledFramebuffer:ze=wi,C.copy(ee.viewport),P.copy(ee.scissor),E=ee.scissorTest}else C.copy(U).multiplyScalar(O).floor(),P.copy(Q).multiplyScalar(O).floor(),E=se;if(ye.bindFramebuffer(36160,ze)&&fe.drawBuffers&&xe&&ye.drawBuffers(ee,ze),ye.viewport(C),ye.scissor(P),ye.setScissorTest(E),vt){let Lt=Ie.get(ee.texture);te.framebufferTexture2D(36160,36064,34069+we,Lt.__webglTexture,ke)}else if(It){let Lt=Ie.get(ee.texture),wt=we||0;te.framebufferTextureLayer(36160,36064,Lt.__webglTexture,ke||0,wt)}T=-1},this.readRenderTargetPixels=function(ee,we,ke,xe,ze,vt,It){if(!(ee&&ee.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Lt=Ie.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&It!==void 0&&(Lt=Lt[It]),Lt){ye.bindFramebuffer(36160,Lt);try{let wt=ee.texture,wi=wt.format,ni=wt.type;if(wi!==br&&it.convert(wi)!==te.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let ii=ni===Gu&&(de.has("EXT_color_buffer_half_float")||fe.isWebGL2&&de.has("EXT_color_buffer_float"));if(ni!==_s&&it.convert(ni)!==te.getParameter(35738)&&!(ni===Ki&&(fe.isWebGL2||de.has("OES_texture_float")||de.has("WEBGL_color_buffer_float")))&&!ii){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}we>=0&&we<=ee.width-xe&&ke>=0&&ke<=ee.height-ze&&te.readPixels(we,ke,xe,ze,it.convert(wi),it.convert(ni),vt)}finally{let wt=_!==null?Ie.get(_).__webglFramebuffer:null;ye.bindFramebuffer(36160,wt)}}},this.readRenderTargetPixelsAsync=async function(ee,we,ke,xe,ze,vt,It){if(!(ee&&ee.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Lt=Ie.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&It!==void 0&&(Lt=Lt[It]),Lt){let wt=ee.texture,wi=wt.format,ni=wt.type;if(we>=0&&we<=ee.width-xe&&ke>=0&&ke<=ee.height-ze){ye.bindFramebuffer(te.FRAMEBUFFER,Lt);let ii=te.createBuffer();te.bindBuffer(te.PIXEL_PACK_BUFFER,ii),te.bufferData(te.PIXEL_PACK_BUFFER,vt.byteLength,te.STREAM_READ),te.readPixels(we,ke,xe,ze,it.convert(wi),it.convert(ni),0);let Xt=_!==null?Ie.get(_).__webglFramebuffer:null;ye.bindFramebuffer(te.FRAMEBUFFER,Xt);let dr=te.fenceSync(te.SYNC_GPU_COMMANDS_COMPLETE,0);return te.flush(),await R7(te,dr,4),te.bindBuffer(te.PIXEL_PACK_BUFFER,ii),te.getBufferSubData(te.PIXEL_PACK_BUFFER,0,vt),te.deleteBuffer(ii),te.deleteSync(dr),vt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ee,we,ke=0){let xe=Math.pow(2,-ke),ze=Math.floor(we.image.width*xe),vt=Math.floor(we.image.height*xe);Ne.setTexture2D(we,0),te.copyTexSubImage2D(3553,ke,0,0,ee.x,ee.y,ze,vt),ye.unbindTexture()},this.copyTextureToTexture=function(ee,we,ke,xe=0){let ze=we.image.width,vt=we.image.height,It=it.convert(ke.format),Lt=it.convert(ke.type);Ne.setTexture2D(ke,0),te.pixelStorei(37440,ke.flipY),te.pixelStorei(37441,ke.premultiplyAlpha),te.pixelStorei(3317,ke.unpackAlignment),we.isDataTexture?te.texSubImage2D(3553,xe,ee.x,ee.y,ze,vt,It,Lt,we.image.data):we.isCompressedTexture?te.compressedTexSubImage2D(3553,xe,ee.x,ee.y,we.mipmaps[0].width,we.mipmaps[0].height,It,we.mipmaps[0].data):te.texSubImage2D(3553,xe,ee.x,ee.y,It,Lt,we.image),xe===0&&ke.generateMipmaps&&te.generateMipmap(3553),ye.unbindTexture()},this.copyTextureToTexture3D=function(ee,we,ke,xe,ze=0){if(y.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let vt=ee.max.x-ee.min.x+1,It=ee.max.y-ee.min.y+1,Lt=ee.max.z-ee.min.z+1,wt=it.convert(xe.format),wi=it.convert(xe.type),ni;if(xe.isData3DTexture)Ne.setTexture3D(xe,0),ni=32879;else if(xe.isDataArrayTexture)Ne.setTexture2DArray(xe,0),ni=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(37440,xe.flipY),te.pixelStorei(37441,xe.premultiplyAlpha),te.pixelStorei(3317,xe.unpackAlignment);let ii=te.getParameter(3314),Xt=te.getParameter(32878),dr=te.getParameter(3316),Vn=te.getParameter(3315),fa=te.getParameter(32877),Zt=ke.isCompressedTexture?ke.mipmaps[0]:ke.image;te.pixelStorei(3314,Zt.width),te.pixelStorei(32878,Zt.height),te.pixelStorei(3316,ee.min.x),te.pixelStorei(3315,ee.min.y),te.pixelStorei(32877,ee.min.z),ke.isDataTexture||ke.isData3DTexture?te.texSubImage3D(ni,ze,we.x,we.y,we.z,vt,It,Lt,wt,wi,Zt.data):ke.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(ni,ze,we.x,we.y,we.z,vt,It,Lt,wt,Zt.data)):te.texSubImage3D(ni,ze,we.x,we.y,we.z,vt,It,Lt,wt,wi,Zt),te.pixelStorei(3314,ii),te.pixelStorei(32878,Xt),te.pixelStorei(3316,dr),te.pixelStorei(3315,Vn),te.pixelStorei(32877,fa),ze===0&&xe.generateMipmaps&&te.generateMipmap(ni),ye.unbindTexture()},this.initRenderTarget=function(ee){Ie.get(ee).__webglFramebuffer===void 0&&Ne.setupRenderTarget(ee)},this.initTexture=function(ee){ee.isCubeTexture?Ne.setTextureCube(ee,0):ee.isData3DTexture?Ne.setTexture3D(ee,0):ee.isDataArrayTexture||ee.isCompressedArrayTexture?Ne.setTexture2DArray(ee,0):Ne.setTexture2D(ee,0),ye.unbindTexture()},this.resetState=function(){b=0,S=0,_=null,ye.reset(),De.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var PK=class extends w5{};PK.prototype.isWebGL1Renderer=!0;var _5=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Nt(e),this.near=t,this.far=i}clone(){return new _5(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},la=class extends qi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},MK=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=uT,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$a()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$a()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$a()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Rs=new L,pT=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.applyMatrix4(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.applyNormalMatrix(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Rs.fromBufferAttribute(this,t),Rs.transformDirection(e),this.setXYZ(t,Rs.x,Rs.y,Rs.z);return this}setX(e,t){return this.normalized&&(t=sr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=sr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=sr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=sr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ou(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ou(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ou(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ou(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array),r=sr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=sr(t,this.array),i=sr(i,this.array),r=sr(r,this.array),n=sr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new Bt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pT(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},S5=class extends qi{constructor(){super(),this.isBone=!0,this.type="Bone"}},Fs=class extends Ar{constructor(e=null,t=1,i=1,r,n,s,a,o,l=vi,u=vi,h,c){super(null,s,a,o,l,u,r,n,h,c),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},G3=new je,DK=new je,qP=class{constructor(e=[],t=[]){this.uuid=$a(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new je)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new je;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:DK;G3.multiplyMatrices(a,t[n]),G3.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new qP(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=a5(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new Fs(t,e,e,br,Ki);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new S5),this.bones.push(s),this.boneInverses.push(new je().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},ny=class extends Bt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},W3=new je,q3=new je,V1=[],IK=new je,Gg=new ar,RK=class extends ar{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ny(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,IK)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(Gg.geometry=this.geometry,Gg.material=this.material,Gg.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,W3),q3.multiplyMatrices(i,W3),Gg.matrixWorld=q3,Gg.raycast(e,V1);for(let s=0,a=V1.length;s<a;s++){let o=V1[s];o.instanceId=n,o.object=this,t.push(o)}V1.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ny(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Lc=class extends Uy{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Nt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},X3=new L,Y3=new L,Q3=new je,mA=new Im,j1=new ua,Vb=class extends qi{constructor(e=new St,t=new Lc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)X3.fromBufferAttribute(t,r-1),Y3.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=X3.distanceTo(Y3);e.setAttribute("lineDistance",new ot(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),j1.copy(i.boundingSphere),j1.applyMatrix4(r),j1.radius+=n,e.ray.intersectsSphere(j1)===!1)return;Q3.copy(r).invert(),mA.copy(e.ray).applyMatrix4(Q3);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new L,u=new L,h=new L,c=new L,f=this.isLineSegments?2:1,m=i.index,g=i.attributes.position;if(m!==null){let y=Math.max(0,s.start),v=Math.min(m.count,s.start+s.count);for(let b=y,S=v-1;b<S;b+=f){let _=m.getX(b),T=m.getX(b+1);if(l.fromBufferAttribute(g,_),u.fromBufferAttribute(g,T),mA.distanceSqToSegment(l,u,c,h)>o)continue;c.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(c);M<e.near||M>e.far||t.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let y=Math.max(0,s.start),v=Math.min(g.count,s.start+s.count);for(let b=y,S=v-1;b<S;b+=f){if(l.fromBufferAttribute(g,b),u.fromBufferAttribute(g,b+1),mA.distanceSqToSegment(l,u,c,h)>o)continue;c.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(c);_<e.near||_>e.far||t.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},K3=new L,Z3=new L,Vy=class extends Vb{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)K3.fromBufferAttribute(t,r),Z3.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+K3.distanceTo(Z3);e.setAttribute("lineDistance",new ot(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},OK=class extends Ar{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:fi,this.magFilter=n!==void 0?n:fi,this.generateMipmaps=!1;let u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},kK=class extends Ar{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Xl=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let u=i[r],h=i[r+1]-u,c=(s-u)/h;return(r+c)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new oe:new L);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new L,r=[],n=[],s=[],a=new L,o=new je;for(let f=0;f<=e;f++){let m=f/e;r[f]=this.getTangentAt(m,new L)}n[0]=new L,s[0]=new L;let l=Number.MAX_VALUE,u=Math.abs(r[0].x),h=Math.abs(r[0].y),c=Math.abs(r[0].z);u<=l&&(l=u,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),c<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let f=1;f<=e;f++){if(n[f]=n[f-1].clone(),s[f]=s[f-1].clone(),a.crossVectors(r[f-1],r[f]),a.length()>Number.EPSILON){a.normalize();let m=Math.acos(Qr(r[f-1].dot(r[f]),-1,1));n[f].applyMatrix4(o.makeRotationAxis(a,m))}s[f].crossVectors(r[f],n[f])}if(t===!0){let f=Math.acos(Qr(n[0].dot(n[e]),-1,1));f/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(f=-f);for(let m=1;m<=e;m++)n[m].applyMatrix4(o.makeRotationAxis(r[m],f*m)),s[m].crossVectors(r[m],n[m])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},g_=class extends Xl{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new oe,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),c=o-this.aX,f=l-this.aY;o=c*u-f*h+this.aX,l=c*h+f*u+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},LK=class extends g_{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function XP(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){n(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,h,c){let f=(a-s)/u-(o-s)/(u+h)+(o-a)/h,m=(o-a)/h-(l-a)/(h+c)+(l-o)/c;f*=h,m*=h,n(a,o,f,m)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var H1=new L,gA=new XP,vA=new XP,yA=new XP,zK=class extends Xl{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new L){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,u;this.closed||a>0?l=r[(a-1)%n]:(H1.subVectors(r[0],r[1]).add(r[0]),l=H1);let h=r[a%n],c=r[(a+1)%n];if(this.closed||a+2<n?u=r[(a+2)%n]:(H1.subVectors(r[n-1],r[n-2]).add(r[n-1]),u=H1),this.curveType==="centripetal"||this.curveType==="chordal"){let f=this.curveType==="chordal"?.5:.25,m=Math.pow(l.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(c),f),y=Math.pow(c.distanceToSquared(u),f);g<1e-4&&(g=1),m<1e-4&&(m=g),y<1e-4&&(y=g),gA.initNonuniformCatmullRom(l.x,h.x,c.x,u.x,m,g,y),vA.initNonuniformCatmullRom(l.y,h.y,c.y,u.y,m,g,y),yA.initNonuniformCatmullRom(l.z,h.z,c.z,u.z,m,g,y)}else this.curveType==="catmullrom"&&(gA.initCatmullRom(l.x,h.x,c.x,u.x,this.tension),vA.initCatmullRom(l.y,h.y,c.y,u.y,this.tension),yA.initCatmullRom(l.z,h.z,c.z,u.z,this.tension));return i.set(gA.calc(o),vA.calc(o),yA.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new L().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function J3(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function NK(e,t){let i=1-e;return i*i*t}function BK(e,t){return 2*(1-e)*e*t}function FK(e,t){return e*e*t}function zv(e,t,i,r){return NK(e,t)+BK(e,i)+FK(e,r)}function UK(e,t){let i=1-e;return i*i*i*t}function VK(e,t){let i=1-e;return 3*i*i*e*t}function jK(e,t){return 3*(1-e)*e*e*t}function HK(e,t){return e*e*e*t}function Nv(e,t,i,r,n){return UK(e,t)+VK(e,i)+jK(e,r)+HK(e,n)}var Oo=class extends Xl{constructor(t=new oe,i=new oe,r=new oe,n=new oe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new oe){let r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Nv(t,n.x,s.x,a.x,o.x),Nv(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},ub=class extends Xl{constructor(e=new L,t=new L,i=new L,r=new L){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new L){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Nv(e,r.x,n.x,s.x,a.x),Nv(e,r.y,n.y,s.y,a.y),Nv(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Fo=class extends Xl{constructor(t=new oe,i=new oe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new oe){let r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i){let r=i||new oe;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},E5=class extends Xl{constructor(e=new L,t=new L){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new L){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},_c=class extends Xl{constructor(e=new oe,t=new oe,i=new oe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new oe){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(zv(e,r.x,n.x,s.x),zv(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},GK=class extends Xl{constructor(e=new L,t=new L,i=new L){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new L){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(zv(e,r.x,n.x,s.x),zv(e,r.y,n.y,s.y),zv(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},YP=class extends Xl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new oe){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return i.set(J3(a,o.x,l.x,u.x,h.x),J3(a,o.y,l.y,u.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new oe().fromArray(r))}return this}},WK=Object.freeze({__proto__:null,ArcCurve:LK,CatmullRomCurve3:zK,CubicBezierCurve:Oo,CubicBezierCurve3:ub,EllipseCurve:g_,LineCurve:Fo,LineCurve3:E5,QuadraticBezierCurve:_c,QuadraticBezierCurve3:GK,SplineCurve:YP}),A5=class extends Xl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Fo(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let u=o[l];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new WK[r.type]().fromJSON(r))}return this}},jb=class extends A5{constructor(e){super(),this.type="Path",this.currentPoint=new oe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Fo(this.currentPoint.clone(),new oe(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new _c(this.currentPoint.clone(),new oe(e,t),new oe(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Oo(this.currentPoint.clone(),new oe(e,t),new oe(i,r),new oe(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new YP(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new g_(e,t,i,r,n,s,a,o);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},C5=class extends St{constructor(e=[new oe(0,-.5),new oe(.5,0),new oe(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Qr(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],u=1/t,h=new L,c=new oe,f=new L,m=new L,g=new L,y=0,v=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:y=e[b+1].x-e[b].x,v=e[b+1].y-e[b].y,f.x=v*1,f.y=-y,f.z=v*0,g.copy(f),f.normalize(),o.push(f.x,f.y,f.z);break;case e.length-1:o.push(g.x,g.y,g.z);break;default:y=e[b+1].x-e[b].x,v=e[b+1].y-e[b].y,f.x=v*1,f.y=-y,f.z=v*0,m.copy(f),f.x+=g.x,f.y+=g.y,f.z+=g.z,f.normalize(),o.push(f.x,f.y,f.z),g.copy(m)}for(let b=0;b<=t;b++){let S=i+b*u*r,_=Math.sin(S),T=Math.cos(S);for(let M=0;M<=e.length-1;M++){h.x=e[M].x*_,h.y=e[M].y,h.z=e[M].x*T,s.push(h.x,h.y,h.z),c.x=b/t,c.y=M/(e.length-1),a.push(c.x,c.y);let C=o[3*M+0]*_,P=o[3*M+1],E=o[3*M+0]*T;l.push(C,P,E)}}for(let b=0;b<t;b++)for(let S=0;S<e.length-1;S++){let _=S+b*e.length,T=_,M=_+e.length,C=_+e.length+1,P=_+1;n.push(T,M,P),n.push(C,P,M)}this.setIndex(n),this.setAttribute("position",new ot(s,3)),this.setAttribute("uv",new ot(a,2)),this.setAttribute("normal",new ot(l,3))}static fromJSON(e){return new C5(e.points,e.segments,e.phiStart,e.phiLength)}},QP=class extends St{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let u=[],h=[],c=[],f=[],m=0,g=[],y=i/2,v=0;b(),s===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(u),this.setAttribute("position",new ot(h,3)),this.setAttribute("normal",new ot(c,3)),this.setAttribute("uv",new ot(f,2));function b(){let _=new L,T=new L,M=0,C=(t-e)/i;for(let P=0;P<=n;P++){let E=[],D=P/n,I=D*(t-e)+e;for(let O=0;O<=r;O++){let N=O/r,k=N*o+a,U=Math.sin(k),Q=Math.cos(k);T.x=I*U,T.y=-D*i+y,T.z=I*Q,h.push(T.x,T.y,T.z),_.set(U,C,Q).normalize(),c.push(_.x,_.y,_.z),f.push(N,1-D),E.push(m++)}g.push(E)}for(let P=0;P<r;P++)for(let E=0;E<n;E++){let D=g[E][P],I=g[E+1][P],O=g[E+1][P+1],N=g[E][P+1];u.push(D,I,N),u.push(I,O,N),M+=6}l.addGroup(v,M,0),v+=M}function S(_){let T=m,M=new oe,C=new L,P=0,E=_===!0?e:t,D=_===!0?1:-1;for(let O=1;O<=r;O++)h.push(0,y*D,0),c.push(0,D,0),f.push(.5,.5),m++;let I=m;for(let O=0;O<=r;O++){let N=O/r*o+a,k=Math.cos(N),U=Math.sin(N);C.x=E*U,C.y=y*D,C.z=E*k,h.push(C.x,C.y,C.z),c.push(0,D,0),M.x=k*.5+.5,M.y=U*.5*D+.5,f.push(M.x,M.y),m++}for(let O=0;O<r;O++){let N=T+O,k=I+O;_===!0?u.push(k,k+1,N):u.push(k+1,k,N),P+=3}l.addGroup(v,P,_===!0?1:2),v+=P}}static fromJSON(e){return new QP(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},KP=class extends QP{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new KP(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ZP=class extends St{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),u(),this.setAttribute("position",new ot(n,3)),this.setAttribute("normal",new ot(n.slice(),3)),this.setAttribute("uv",new ot(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){let S=new L,_=new L,T=new L;for(let M=0;M<t.length;M+=3)f(t[M+0],S),f(t[M+1],_),f(t[M+2],T),o(S,_,T,b)}function o(b,S,_,T){let M=T+1,C=[];for(let P=0;P<=M;P++){C[P]=[];let E=b.clone().lerp(_,P/M),D=S.clone().lerp(_,P/M),I=M-P;for(let O=0;O<=I;O++)O===0&&P===M?C[P][O]=E:C[P][O]=E.clone().lerp(D,O/I)}for(let P=0;P<M;P++)for(let E=0;E<2*(M-P)-1;E++){let D=Math.floor(E/2);E%2===0?(c(C[P][D+1]),c(C[P+1][D]),c(C[P][D])):(c(C[P][D+1]),c(C[P+1][D+1]),c(C[P+1][D]))}}function l(b){let S=new L;for(let _=0;_<n.length;_+=3)S.x=n[_+0],S.y=n[_+1],S.z=n[_+2],S.normalize().multiplyScalar(b),n[_+0]=S.x,n[_+1]=S.y,n[_+2]=S.z}function u(){let b=new L;for(let S=0;S<n.length;S+=3){b.x=n[S+0],b.y=n[S+1],b.z=n[S+2];let _=y(b)/2/Math.PI+.5,T=v(b)/Math.PI+.5;s.push(_,1-T)}m(),h()}function h(){for(let b=0;b<s.length;b+=6){let S=s[b+0],_=s[b+2],T=s[b+4],M=Math.max(S,_,T),C=Math.min(S,_,T);M>.9&&C<.1&&(S<.2&&(s[b+0]+=1),_<.2&&(s[b+2]+=1),T<.2&&(s[b+4]+=1))}}function c(b){n.push(b.x,b.y,b.z)}function f(b,S){let _=b*3;S.x=e[_+0],S.y=e[_+1],S.z=e[_+2]}function m(){let b=new L,S=new L,_=new L,T=new L,M=new oe,C=new oe,P=new oe;for(let E=0,D=0;E<n.length;E+=9,D+=6){b.set(n[E+0],n[E+1],n[E+2]),S.set(n[E+3],n[E+4],n[E+5]),_.set(n[E+6],n[E+7],n[E+8]),M.set(s[D+0],s[D+1]),C.set(s[D+2],s[D+3]),P.set(s[D+4],s[D+5]),T.copy(b).add(S).add(_).divideScalar(3);let I=y(T);g(M,D+0,b,I),g(C,D+2,S,I),g(P,D+4,_,I)}}function g(b,S,_,T){T<0&&b.x===1&&(s[S]=b.x-1),_.x===0&&_.z===0&&(s[S]=T/2/Math.PI+.5)}function y(b){return Math.atan2(b.z,-b.x)}function v(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}static fromJSON(e){return new ZP(e.vertices,e.indices,e.radius,e.details)}},T5=class extends ZP{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new T5(e.radius,e.detail)}},Hb=class extends jb{constructor(e){super(e),this.uuid=$a(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new jb().fromJSON(r))}return this}},qK={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=P5(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,u,h,c,f,m;if(r&&(s=ZK(e,t,s,i)),e.length>80*i){o=u=e[0],l=h=e[1];for(let g=i;g<n;g+=i)c=e[g],f=e[g+1],c<o&&(o=c),f<l&&(l=f),c>u&&(u=c),f>h&&(h=f);m=Math.max(u-o,h-l),m=m!==0?32767/m:0}return sy(s,a,i,o,l,m,0),a}};function P5(e,t,i,r,n){let s,a;if(n===lZ(e,t,i,r)>0)for(s=t;s<i;s+=r)a=$3(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=$3(s,e[s],e[s+1],a);return a&&v_(a,a.next)&&(oy(a),a=a.next),a}function Vd(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(v_(i,i.next)||Er(i.prev,i,i.next)===0)){if(oy(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function sy(e,t,i,r,n,s,a){if(!e)return;!a&&s&&iZ(e,r,n,s);let o=e,l,u;for(;e.prev!==e.next;){if(l=e.prev,u=e.next,s?YK(e,r,n,s):XK(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(u.i/i|0),oy(e),e=u.next,o=u.next;continue}if(e=u,e===o){a?a===1?(e=QK(Vd(e),t,i),sy(e,t,i,r,n,s,2)):a===2&&KK(e,t,i,r,n,s):sy(Vd(e),t,i,r,n,s,1);break}}}function XK(e){let t=e.prev,i=e,r=e.next;if(Er(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,u=r.y,h=n<s?n<a?n:a:s<a?s:a,c=o<l?o<u?o:u:l<u?l:u,f=n>s?n>a?n:a:s>a?s:a,m=o>l?o>u?o:u:l>u?l:u,g=r.next;for(;g!==t;){if(g.x>=h&&g.x<=f&&g.y>=c&&g.y<=m&&Bp(n,o,s,l,a,u,g.x,g.y)&&Er(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function YK(e,t,i,r){let n=e.prev,s=e,a=e.next;if(Er(n,s,a)>=0)return!1;let o=n.x,l=s.x,u=a.x,h=n.y,c=s.y,f=a.y,m=o<l?o<u?o:u:l<u?l:u,g=h<c?h<f?h:f:c<f?c:f,y=o>l?o>u?o:u:l>u?l:u,v=h>c?h>f?h:f:c>f?c:f,b=mT(m,g,t,i,r),S=mT(y,v,t,i,r),_=e.prevZ,T=e.nextZ;for(;_&&_.z>=b&&T&&T.z<=S;){if(_.x>=m&&_.x<=y&&_.y>=g&&_.y<=v&&_!==n&&_!==a&&Bp(o,h,l,c,u,f,_.x,_.y)&&Er(_.prev,_,_.next)>=0||(_=_.prevZ,T.x>=m&&T.x<=y&&T.y>=g&&T.y<=v&&T!==n&&T!==a&&Bp(o,h,l,c,u,f,T.x,T.y)&&Er(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;_&&_.z>=b;){if(_.x>=m&&_.x<=y&&_.y>=g&&_.y<=v&&_!==n&&_!==a&&Bp(o,h,l,c,u,f,_.x,_.y)&&Er(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;T&&T.z<=S;){if(T.x>=m&&T.x<=y&&T.y>=g&&T.y<=v&&T!==n&&T!==a&&Bp(o,h,l,c,u,f,T.x,T.y)&&Er(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function QK(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!v_(n,s)&&M5(n,r,r.next,s)&&ay(n,s)&&ay(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),oy(r),oy(r.next),r=e=s),r=r.next}while(r!==e);return Vd(r)}function KK(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&sZ(a,o)){let l=D5(a,o);a=Vd(a,a.next),l=Vd(l,l.next),sy(a,t,i,r,n,s,0),sy(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function ZK(e,t,i,r){let n=[],s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,u=P5(e,o,l,r,!1),u===u.next&&(u.steiner=!0),n.push(nZ(u));for(n.sort(JK),s=0;s<n.length;s++)i=$K(n[s],i);return i}function JK(e,t){return e.x-t.x}function $K(e,t){let i=eZ(e,t);if(!i)return t;let r=D5(i,e);return Vd(r,r.next),Vd(i,i.next)}function eZ(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let f=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(f<=s&&f>r&&(r=f,n=i.x<i.next.x?i:i.next,f===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,u=n.y,h=1/0,c;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Bp(a<u?s:r,a,l,u,a<u?r:s,a,i.x,i.y)&&(c=Math.abs(a-i.y)/(s-i.x),ay(i,e)&&(c<h||c===h&&(i.x>n.x||i.x===n.x&&tZ(n,i)))&&(n=i,h=c)),i=i.next;while(i!==o);return n}function tZ(e,t){return Er(e.prev,e,t.prev)<0&&Er(t.next,e,e.next)<0}function iZ(e,t,i,r){let n=e;do n.z===0&&(n.z=mT(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,rZ(n)}function rZ(e){let t,i,r,n,s,a,o,l,u=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<u&&(o++,r=r.nextZ,!!r);t++);for(l=u;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,u*=2}while(a>1);return e}function mT(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function nZ(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Bp(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function sZ(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!aZ(e,t)&&(ay(e,t)&&ay(t,e)&&oZ(e,t)&&(Er(e.prev,e,t.prev)||Er(e,t.prev,t))||v_(e,t)&&Er(e.prev,e,e.next)>0&&Er(t.prev,t,t.next)>0)}function Er(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v_(e,t){return e.x===t.x&&e.y===t.y}function M5(e,t,i,r){let n=W1(Er(e,t,i)),s=W1(Er(e,t,r)),a=W1(Er(i,r,e)),o=W1(Er(i,r,t));return!!(n!==s&&a!==o||n===0&&G1(e,i,t)||s===0&&G1(e,r,t)||a===0&&G1(i,e,r)||o===0&&G1(i,t,r))}function G1(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function W1(e){return e>0?1:e<0?-1:0}function aZ(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&M5(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function ay(e,t){return Er(e.prev,e,e.next)<0?Er(e,t,e.next)>=0&&Er(e,e.prev,t)>=0:Er(e,t,e.prev)<0||Er(e,e.next,t)<0}function oZ(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function D5(e,t){let i=new gT(e.i,e.x,e.y),r=new gT(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function $3(e,t,i,r){let n=new gT(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function oy(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function gT(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lZ(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var I5=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return I5.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];ek(e),tk(i,e);let s=e.length;t.forEach(ek);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,tk(i,t[o]);let a=qK.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function ek(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function tk(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var R5=class extends ZP{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new R5(e.radius,e.detail)}},Gp=class extends St{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,u=[],h=new L,c=new L,f=[],m=[],g=[],y=[];for(let v=0;v<=i;v++){let b=[],S=v/i,_=0;v==0&&s==0?_=.5/t:v==i&&o==Math.PI&&(_=-.5/t);for(let T=0;T<=t;T++){let M=T/t;h.x=-e*Math.cos(r+M*n)*Math.sin(s+S*a),h.y=e*Math.cos(s+S*a),h.z=e*Math.sin(r+M*n)*Math.sin(s+S*a),m.push(h.x,h.y,h.z),c.copy(h).normalize(),g.push(c.x,c.y,c.z),y.push(M+_,1-S),b.push(l++)}u.push(b)}for(let v=0;v<i;v++)for(let b=0;b<t;b++){let S=u[v][b+1],_=u[v][b],T=u[v+1][b],M=u[v+1][b+1];(v!==0||s>0)&&f.push(S,_,M),(v!==i-1||o<Math.PI)&&f.push(_,T,M)}this.setIndex(f),this.setAttribute("position",new ot(m,3)),this.setAttribute("normal",new ot(g,3)),this.setAttribute("uv",new ot(y,2))}static fromJSON(e){return new Gp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},O5=class extends St{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],u=new L,h=new L,c=new L;for(let f=0;f<=i;f++)for(let m=0;m<=r;m++){let g=m/r*n,y=f/i*Math.PI*2;h.x=(e+t*Math.cos(y))*Math.cos(g),h.y=(e+t*Math.cos(y))*Math.sin(g),h.z=t*Math.sin(y),a.push(h.x,h.y,h.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),c.subVectors(h,u).normalize(),o.push(c.x,c.y,c.z),l.push(m/r),l.push(f/i)}for(let f=1;f<=i;f++)for(let m=1;m<=r;m++){let g=(r+1)*f+m-1,y=(r+1)*(f-1)+m-1,v=(r+1)*(f-1)+m,b=(r+1)*f+m;s.push(g,y,b),s.push(y,v,b)}this.setIndex(s),this.setAttribute("position",new ot(a,3)),this.setAttribute("normal",new ot(o,3)),this.setAttribute("uv",new ot(l,2))}static fromJSON(e){return new O5(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},k5=class extends St{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],u=[],h=new L,c=new L,f=new L,m=new L,g=new L,y=new L,v=new L;for(let S=0;S<=i;++S){let _=S/i*n*Math.PI*2;b(_,n,s,e,f),b(_+.01,n,s,e,m),y.subVectors(m,f),v.addVectors(m,f),g.crossVectors(y,v),v.crossVectors(g,y),g.normalize(),v.normalize();for(let T=0;T<=r;++T){let M=T/r*Math.PI*2,C=-t*Math.cos(M),P=t*Math.sin(M);h.x=f.x+(C*v.x+P*g.x),h.y=f.y+(C*v.y+P*g.y),h.z=f.z+(C*v.z+P*g.z),o.push(h.x,h.y,h.z),c.subVectors(h,f).normalize(),l.push(c.x,c.y,c.z),u.push(S/i),u.push(T/r)}}for(let S=1;S<=i;S++)for(let _=1;_<=r;_++){let T=(r+1)*(S-1)+(_-1),M=(r+1)*S+(_-1),C=(r+1)*S+_,P=(r+1)*(S-1)+_;a.push(T,M,P),a.push(M,C,P)}this.setIndex(a),this.setAttribute("position",new ot(o,3)),this.setAttribute("normal",new ot(l,3)),this.setAttribute("uv",new ot(u,2));function b(S,_,T,M,C){let P=Math.cos(S),E=Math.sin(S),D=T/_*S,I=Math.cos(D);C.x=M*(2+I)*.5*P,C.y=M*(2+I)*E*.5,C.z=M*Math.sin(D)*.5}}static fromJSON(e){return new k5(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},uZ=class extends Mi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Ih(e,t,i){return L5(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function q1(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function L5(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function hZ(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function ik(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function z5(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var y_=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},cZ=class extends y_{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Lp,endingEnd:Lp}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case zp:n=e,a=2*t-i;break;case Bb:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case zp:s=e,o=2*i-t;break;case Bb:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*u,this._offsetNext=s*u}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=this._offsetPrev,h=this._offsetNext,c=this._weightPrev,f=this._weightNext,m=(i-t)/(r-t),g=m*m,y=g*m,v=-c*y+2*c*g-c*m,b=(1+c)*y+(-1.5-2*c)*g+(-.5+c)*m+1,S=(-1-f)*y+(1.5+f)*g+.5*m,_=f*y-f*g;for(let T=0;T!==a;++T)n[T]=v*s[u+T]+b*s[l+T]+S*s[o+T]+_*s[h+T];return n}},N5=class extends y_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=(i-t)/(r-t),h=1-u;for(let c=0;c!==a;++c)n[c]=s[l+c]*h+s[o+c]*u;return n}},dZ=class extends y_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Yl=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=q1(t,this.TimeBufferType),this.values=q1(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:q1(e.times,Array),values:q1(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new dZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new N5(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new cZ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case zb:t=this.InterpolantFactoryMethodDiscrete;break;case Nb:t=this.InterpolantFactoryMethodLinear;break;case HE:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zb;case this.InterpolantFactoryMethodLinear:return Nb;case this.InterpolantFactoryMethodSmooth:return HE}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Ih(i,n,s),this.values=Ih(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&L5(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Ih(this.times),t=Ih(this.values),i=this.getValueSize(),r=this.getInterpolation()===HE,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],u=e[a+1];if(l!==u&&(a!==1||l!==e[0]))if(r)o=!0;else{let h=a*i,c=h-i,f=h+i;for(let m=0;m!==i;++m){let g=t[h+m];if(g!==t[c+m]||g!==t[f+m]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let h=a*i,c=s*i;for(let f=0;f!==i;++f)t[c+f]=t[h+f]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Ih(e,0,s),this.values=Ih(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Ih(this.times,0),t=Ih(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Yl.prototype.TimeBufferType=Float32Array;Yl.prototype.ValueBufferType=Float32Array;Yl.prototype.DefaultInterpolation=Nb;var km=class extends Yl{};km.prototype.ValueTypeName="bool";km.prototype.ValueBufferType=Array;km.prototype.DefaultInterpolation=zb;km.prototype.InterpolantFactoryMethodLinear=void 0;km.prototype.InterpolantFactoryMethodSmooth=void 0;var B5=class extends Yl{};B5.prototype.ValueTypeName="color";var Gb=class extends Yl{};Gb.prototype.ValueTypeName="number";var fZ=class extends y_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let u=l+a;l!==u;l+=4)Wt.slerpFlat(n,0,s,l-a,s,l,o);return n}},jy=class extends Yl{InterpolantFactoryMethodLinear(e){return new fZ(this.times,this.values,this.getValueSize(),e)}};jy.prototype.ValueTypeName="quaternion";jy.prototype.DefaultInterpolation=Nb;jy.prototype.InterpolantFactoryMethodSmooth=void 0;var Lm=class extends Yl{};Lm.prototype.ValueTypeName="string";Lm.prototype.ValueBufferType=Array;Lm.prototype.DefaultInterpolation=zb;Lm.prototype.InterpolantFactoryMethodLinear=void 0;Lm.prototype.InterpolantFactoryMethodSmooth=void 0;var Wb=class extends Yl{};Wb.prototype.ValueTypeName="vector";var vT=class{constructor(e,t=-1,i,r=UP){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=$a(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(mZ(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(Yl.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let u=hZ(o);o=ik(o,1,u),l=ik(l,1,u),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new Gb(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],u=l.name.match(n);if(u&&u.length>1){let h=u[1],c=r[h];c||(r[h]=c=[]),c.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(u,h,c,f,m){if(c.length!==0){let g=[],y=[];z5(c,g,y,f),g.length!==0&&m.push(new u(h,g,y))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let u=0;u<l.length;u++){let h=l[u].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let c={},f;for(f=0;f<h.length;f++)if(h[f].morphTargets)for(let m=0;m<h[f].morphTargets.length;m++)c[h[f].morphTargets[m]]=-1;for(let m in c){let g=[],y=[];for(let v=0;v!==h[f].morphTargets.length;++v){let b=h[f];g.push(b.time),y.push(b.morphTarget===m?1:0)}r.push(new Gb(".morphTargetInfluence["+m+"]",g,y))}o=c.length*s}else{let c=".bones["+t[u].name+"]";i(Wb,c+".position",h,"pos",r),i(jy,c+".quaternion",h,"rot",r),i(Wb,c+".scale",h,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function pZ(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gb;case"vector":case"vector2":case"vector3":case"vector4":return Wb;case"color":return B5;case"quaternion":return jy;case"bool":case"boolean":return km;case"string":return Lm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function mZ(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=pZ(e.type);if(e.times===void 0){let i=[],r=[];z5(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var qb={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},F5=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,n===!1&&r.onStart!==void 0&&r.onStart(u,s,a),n=!0},this.itemEnd=function(u){s++,r.onProgress!==void 0&&r.onProgress(u,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return o?o(u):u},this.setURLModifier=function(u){return o=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){let h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,c=l.length;h<c;h+=2){let f=l[h],m=l[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return m}return null}}},gZ=new F5,Hy=class{constructor(e){this.manager=e!==void 0?e:gZ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},fu={},vZ=class extends Error{constructor(e,t){super(e),this.response=t}},yT=class extends Hy{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=qb.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(fu[e]!==void 0){fu[e].push({onLoad:t,onProgress:i,onError:r});return}fu[e]=[],fu[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let u=fu[e],h=l.body.getReader(),c=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),f=c?parseInt(c):0,m=f!==0,g=0,y=new ReadableStream({start(v){b();function b(){h.read().then(({done:S,value:_})=>{if(S)v.close();else{g+=_.byteLength;let T=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:f});for(let M=0,C=u.length;M<C;M++){let P=u[M];P.onProgress&&P.onProgress(T)}v.enqueue(_),b()}})}}});return new Response(y)}else throw new vZ(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return l.json();default:if(a===void 0)return l.text();{let u=/charset="?([^;"\s]*)"?/i.exec(a),h=u&&u[1]?u[1].toLowerCase():void 0,c=new TextDecoder(h);return l.arrayBuffer().then(f=>c.decode(f))}}}).then(l=>{qb.add(e,l);let u=fu[e];delete fu[e];for(let h=0,c=u.length;h<c;h++){let f=u[h];f.onLoad&&f.onLoad(l)}}).catch(l=>{let u=fu[e];if(u===void 0)throw this.manager.itemError(e),l;delete fu[e];for(let h=0,c=u.length;h<c;h++){let f=u[h];f.onError&&f.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},yZ=class extends Hy{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=qb.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=ry("img");function o(){u(),qb.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(h){u(),r&&r(h),n.manager.itemError(e),n.manager.itemEnd(e)}function u(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},xZ=class extends Hy{constructor(e){super(e)}load(e,t,i,r){let n=new Ar,s=new yZ(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},Gy=class extends qi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Nt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},bZ=class extends Gy{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(qi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Nt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},xA=new je,rk=new L,nk=new L,JP=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new oe(512,512),this.map=null,this.mapPass=null,this.matrix=new je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new GP,this._frameExtents=new oe(1,1),this._viewportCount=1,this._viewports=[new Yt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;rk.setFromMatrixPosition(e.matrixWorld),t.position.copy(rk),nk.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(nk),t.updateMatrixWorld(),xA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xA),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(xA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},wZ=class extends JP{constructor(){super(new vs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=iy*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},_Z=class extends Gy{constructor(e,t,i=0,r=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(qi.DEFAULT_UP),this.updateMatrix(),this.target=new qi,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new wZ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},sk=new je,Wg=new L,bA=new L,SZ=class extends JP{constructor(){super(new vs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new oe(4,2),this._viewportCount=6,this._viewports=[new Yt(2,1,1,1),new Yt(0,1,1,1),new Yt(3,1,1,1),new Yt(1,1,1,1),new Yt(3,0,1,1),new Yt(1,0,1,1)],this._cubeDirections=[new L(1,0,0),new L(-1,0,0),new L(0,0,1),new L(0,0,-1),new L(0,1,0),new L(0,-1,0)],this._cubeUps=[new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,0,1),new L(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Wg.setFromMatrixPosition(e.matrixWorld),i.position.copy(Wg),bA.copy(i.position),bA.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(bA),i.updateMatrixWorld(),r.makeTranslation(-Wg.x,-Wg.y,-Wg.z),sk.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sk)}},EZ=class extends Gy{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new SZ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},AZ=class extends JP{constructor(){super(new p_(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},CZ=class extends Gy{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(qi.DEFAULT_UP),this.updateMatrix(),this.target=new qi,this.shadow=new AZ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},U5=class extends St{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},V5=class extends Hy{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new yT(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(c,f){if(t[f]!==void 0)return t[f];let m=c.interleavedBuffers[f],g=n(c,m.buffer),y=_1(m.type,g),v=new MK(y,m.stride);return v.uuid=m.uuid,t[f]=v,v}function n(c,f){if(i[f]!==void 0)return i[f];let m=c.arrayBuffers[f],g=new Uint32Array(m).buffer;return i[f]=g,g}let s=e.isInstancedBufferGeometry?new U5:new St,a=e.data.index;if(a!==void 0){let c=_1(a.type,a.array);s.setIndex(new Bt(c,1))}let o=e.data.attributes;for(let c in o){let f=o[c],m;if(f.isInterleavedBufferAttribute){let g=r(e.data,f.data);m=new pT(g,f.itemSize,f.offset,f.normalized)}else{let g=_1(f.type,f.array),y=f.isInstancedBufferAttribute?ny:Bt;m=new y(g,f.itemSize,f.normalized)}f.name!==void 0&&(m.name=f.name),f.usage!==void 0&&m.setUsage(f.usage),f.updateRange!==void 0&&(m.updateRange.offset=f.updateRange.offset,m.updateRange.count=f.updateRange.count),s.setAttribute(c,m)}let l=e.data.morphAttributes;if(l)for(let c in l){let f=l[c],m=[];for(let g=0,y=f.length;g<y;g++){let v=f[g],b;if(v.isInterleavedBufferAttribute){let S=r(e.data,v.data);b=new pT(S,v.itemSize,v.offset,v.normalized)}else{let S=_1(v.type,v.array);b=new Bt(S,v.itemSize,v.normalized)}v.name!==void 0&&(b.name=v.name),m.push(b)}s.morphAttributes[c]=m}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let c=0,f=u.length;c!==f;++c){let m=u[c];s.addGroup(m.start,m.count,m.materialIndex)}let h=e.data.boundingSphere;if(h!==void 0){let c=new L;h.center!==void 0&&c.fromArray(h.center),s.boundingSphere=new ua(c,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},TZ=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ak(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=ak();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function ak(){return(typeof performance>"u"?Date:performance).now()}var PZ=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){Wt.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;Wt.multiplyQuaternionsFlat(e,s,e,t,e,i),Wt.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},$P="\\[\\]\\.:\\/",MZ=new RegExp("["+$P+"]","g"),eM="[^"+$P+"]",DZ="[^"+$P.replace("\\.","")+"]",IZ=/((?:WC+[\/:])*)/.source.replace("WC",eM),RZ=/(WCOD+)?/.source.replace("WCOD",DZ),OZ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",eM),kZ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",eM),LZ=new RegExp("^"+IZ+RZ+OZ+kZ+"$"),zZ=["material","materials","bones","map"],NZ=class{constructor(e,t,i){let r=i||er.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},er=class{constructor(e,t,i){this.path=t,this.parsedPath=i||er.parseTrackName(t),this.node=er.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new er.Composite(e,t,i):new er(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(MZ,"")}static parseTrackName(e){let t=LZ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);zZ.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=er.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};er.Composite=NZ;er.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};er.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};er.prototype.GetterByBindingType=[er.prototype._getValue_direct,er.prototype._getValue_array,er.prototype._getValue_arrayElement,er.prototype._getValue_toArray];er.prototype.SetterByBindingTypeAndVersioning=[[er.prototype._setValue_direct,er.prototype._setValue_direct_setNeedsUpdate,er.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[er.prototype._setValue_array,er.prototype._setValue_array_setNeedsUpdate,er.prototype._setValue_array_setMatrixWorldNeedsUpdate],[er.prototype._setValue_arrayElement,er.prototype._setValue_arrayElement_setNeedsUpdate,er.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[er.prototype._setValue_fromArray,er.prototype._setValue_fromArray_setNeedsUpdate,er.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var BZ=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:Lp,endingEnd:Lp};for(let l=0;l!==s;++l){let u=n[l].createInterpolant(null);a[l]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n5,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case f7:for(let u=0,h=o.length;u!==h;++u)o[u].evaluate(s),l[u].accumulateAdditive(a);break;case UP:default:for(let u=0,h=o.length;u!==h;++u)o[u].evaluate(s),l[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===FP;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===r5){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=zp,r.endingEnd=zp):(e?r.endingStart=this.zeroSlopeAtStart?zp:Lp:r.endingStart=Bb,t?r.endingEnd=this.zeroSlopeAtEnd?zp:Lp:r.endingEnd=Bb)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},FZ=new Float32Array(1),UZ=class extends as{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,u=l[o];u===void 0&&(u={},l[o]=u);for(let h=0;h!==n;++h){let c=r[h],f=c.name,m=u[f];if(m!==void 0)++m.referenceCount,s[h]=m;else{if(m=s[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,o,f));continue}let g=t&&t._propertyBindings[h].binding.parsedPath;m=new PZ(er.create(i,f,g),c.ValueTypeName,c.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,o,f),s[h]=m}a[h].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null;let h=a.actionByRoot,c=(e._localRoot||this._root).uuid;delete h[c],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new N5(new Float32Array(2),new Float32Array(2),1,FZ),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?vT.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=UP),o!==void 0){let h=o.actionByRoot[n];if(h!==void 0&&h.blendMode===i)return h;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let u=new BZ(this,s,t,i);return this._bindAction(u,l),this._addInactiveAction(u,a,n),u}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?vT.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let u=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Fe=class{constructor(e){this.value=e}clone(){return new Fe(this.value.clone===void 0?this.value:this.value.clone())}},j5=class{constructor(e,t,i=0,r=1/0){this.ray=new Im(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new jP,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return xT(e,this,i,t),i.sort(ok),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)xT(e[r],this,i,t);return i.sort(ok),i}};function ok(e,t){return e.distance-t.distance}function xT(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)xT(n[s],t,i,!0)}}var lk=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Qr(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},uk=new oe,tM=class{constructor(e=new oe(1/0,1/0),t=new oe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=uk.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return uk.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},hk=new L,X1=new L,eo=class{constructor(e=new L,t=new L){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){hk.subVectors(e,this.start),X1.subVectors(this.end,this.start);let i=X1.dot(X1),r=X1.dot(hk)/i;return t&&(r=Qr(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},ck=new L,VZ=class extends qi{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new St,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,u=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new ot(r,3));let n=new Lc({fog:!1,toneMapped:!1});this.cone=new Vy(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ck.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ck),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},jZ=class extends ar{constructor(e,t,i){let r=new Gp(t,4,2),n=new Wu({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},dk=new L,Y1=new L,fk=new L,HZ=class extends qi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new St;r.setAttribute("position",new ot([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new Lc({fog:!1,toneMapped:!1});this.lightPlane=new Vb(r,n),this.add(this.lightPlane),r=new St,r.setAttribute("position",new ot([0,0,0,0,0,1],3)),this.targetLine=new Vb(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),dk.setFromMatrixPosition(this.light.matrixWorld),Y1.setFromMatrixPosition(this.light.target.matrixWorld),fk.subVectors(Y1,dk),this.lightPlane.lookAt(Y1),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Y1),this.targetLine.scale.z=fk.length()}},Q1=new L,Mr=new kc,Xb=class extends Vy{constructor(e){let t=new St,i=new Lc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,g){o(m),o(g)}function o(m){r.push(0,0,0),n.push(0,0,0),s[m]===void 0&&(s[m]=[]),s[m].push(r.length/3-1)}t.setAttribute("position",new ot(r,3)),t.setAttribute("color",new ot(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Nt(16755200),u=new Nt(16711680),h=new Nt(43775),c=new Nt(16777215),f=new Nt(3355443);this.setColors(l,u,h,c,f)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Mr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),zr("c",t,e,Mr,0,0,-1),zr("t",t,e,Mr,0,0,1),zr("n1",t,e,Mr,-1,-1,-1),zr("n2",t,e,Mr,i,-1,-1),zr("n3",t,e,Mr,-1,r,-1),zr("n4",t,e,Mr,i,r,-1),zr("f1",t,e,Mr,-1,-1,1),zr("f2",t,e,Mr,i,-1,1),zr("f3",t,e,Mr,-1,r,1),zr("f4",t,e,Mr,i,r,1),zr("u1",t,e,Mr,i*.7,r*1.1,-1),zr("u2",t,e,Mr,-1*.7,r*1.1,-1),zr("u3",t,e,Mr,0,r*2,-1),zr("cf1",t,e,Mr,-1,0,1),zr("cf2",t,e,Mr,i,0,1),zr("cf3",t,e,Mr,0,-1,1),zr("cf4",t,e,Mr,0,r,1),zr("cn1",t,e,Mr,-1,0,-1),zr("cn2",t,e,Mr,i,0,-1),zr("cn3",t,e,Mr,0,-1,-1),zr("cn4",t,e,Mr,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function zr(e,t,i,r,n,s,a){Q1.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let u=0,h=o.length;u<h;u++)l.setXYZ(o[u],Q1.x,Q1.y,Q1.z)}}var Yb=class extends Vy{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new St;n.setIndex(new Bt(i,1)),n.setAttribute("position",new ot(r,3)),super(n,new Lc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},GZ=class extends Vy{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new St;r.setAttribute("position",new ot(t,3)),r.setAttribute("color",new ot(i,3));let n=new Lc({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new Nt,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Mu=WZ();function WZ(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let u=l-127;u<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):u<-14?(r[l]=1024>>-u-14,r[l|256]=1024>>-u-14|32768,n[l]=-u-1,n[l|256]=-u-1):u<=15?(r[l]=u+15<<10,r[l|256]=u+15<<10|32768,n[l]=13,n[l|256]=13):u<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,h=0;for(;(u&8388608)===0;)u<<=1,h-=8388608;u&=-8388609,h+=947912704,s[l]=u|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function qZ(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Qr(e,-65504,65504),Mu.floatView[0]=e;let t=Mu.uint32View[0],i=t>>23&511;return Mu.baseTable[i]+((t&8388607)>>Mu.shiftTable[i])}function XZ(e){let t=e>>10;return Mu.uint32View[0]=Mu.mantissaTable[Mu.offsetTable[t]+(e&1023)]+Mu.exponentTable[t],Mu.floatView[0]}var YZ=Object.freeze({__proto__:null,fromHalfFloat:XZ,toHalfFloat:qZ});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Dm}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Dm);var qg=".",iM=Symbol("target"),H5=Symbol("unsubscribe");function bT(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function QZ(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Cl=Array.isArray;function rM(e){return typeof e=="symbol"}var KZ={after:(e,t)=>Cl(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Cl(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=qg),rM(t)?e+t.toString():e+t):e,initial:e=>{if(Cl(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(qg);return t===-1?"":e.slice(0,t)},last:e=>{if(Cl(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(qg);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Cl(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(qg);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(qg,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Wa=KZ;function ZZ(e){return typeof e=="object"&&typeof e.next=="function"}function JZ(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[iM].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function pk(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&rM(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var $Z=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Wa.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function wT(e){return toString.call(e)==="[object Object]"}function K1(){return!0}function ip(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var G5=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),eJ=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),W5={push:K1,pop:K1,shift:K1,unshift:K1,copyWithin:ip,reverse:ip,sort:ip,splice:ip,flat:ip,fill:ip},tJ=new Set([...G5,...eJ,...Object.keys(W5)]);function Z1(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var q5=["keys","values","entries"],X5=new Set(["has","toString"]),Y5={add:Z1,clear:Z1,delete:Z1,forEach:Z1},iJ=new Set([...X5,...Object.keys(Y5),...q5]);function J1(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var rJ=new Set([...X5,"get"]),Q5={set:J1,clear:J1,delete:J1,forEach:J1},nJ=new Set([...rJ,...Object.keys(Q5),...q5]),Sc=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return G5.has(e)}_shallowClone(e){let t=e;if(wT(e))t={...e};else if(Cl(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Cl(r)?this._onIsChanged=W5[t]:r instanceof Set?this._onIsChanged=Y5[t]:r instanceof Map&&(this._onIsChanged=Q5[t]),r):i}update(e,t,i){let r=Wa.after(e,this._path);if(t!=="length"){let n=this.clone;Wa.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Wa.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},mk=class extends Sc{static isHandledMethod(e){return tJ.has(e)}},sJ=class extends Sc{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},gk=class extends Sc{static isHandledMethod(e){return iJ.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},vk=class extends Sc{static isHandledMethod(e){return nJ.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},aJ=class extends Sc{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},oJ=class extends Sc{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Ap=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return wT(e)||Cl(e)||bT(e)}static isHandledMethod(e,t){return wT(e)?Sc.isHandledMethod(t):Cl(e)?mk.isHandledMethod(t):e instanceof Set?gk.isHandledMethod(t):e instanceof Map?vk.isHandledMethod(t):bT(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=Sc;Cl(e)?r=mk:e instanceof Date?r=sJ:e instanceof Set?r=gk:e instanceof Map?r=vk:e instanceof WeakSet?r=aJ:e instanceof WeakMap&&(r=oJ),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=Ap.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},lJ={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},nM=(e,t,i={})=>{i={...lJ,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new $Z(n),u=typeof i.onValidate=="function",h=new Ap(u),c=(S,_,T,M,C)=>!u||h.isCloning||i.onValidate(Wa.concat(l.getPath(S),_),T,M,C)===!0,f=(S,_,T,M)=>{!pk(l,i,_)&&!(a&&l.isDetached(S,e))&&m(l.getPath(S),_,T,M)},m=(S,_,T,M,C)=>{h.isCloning?h.update(S,_,M):t(Wa.concat(S,_),T,M,C)},g=S=>S&&(S[r]||S),y=(S,_,T,M)=>QZ(S)||T==="constructor"||s&&!Ap.isHandledMethod(_,T)||pk(l,i,T)||l.isGetInvariant(_,T)||a&&l.isDetached(_,e)?S:(M===void 0&&(M=l.getPath(_)),l.getProxy(S,Wa.concat(M,T),v,r)),v={get(S,_,T){if(rM(_)){if(_===r||_===iM)return S;if(_===H5&&!l.isUnsubscribed&&l.getPath(S).length===0)return l.unsubscribe(),S}let M=bT(S)?Reflect.get(S,_):Reflect.get(S,_,T);return y(M,S,_)},set(S,_,T,M){T=g(T);let C=S[r]||S,P=C[_];if(n(P,T)&&_ in S)return!0;let E=c(S,_,T,P);return E&&l.setProperty(C,_,T,M,P)?(f(S,_,S[_],P),!0):!E},defineProperty(S,_,T){if(!l.isSameDescriptor(T,S,_)){let M=S[_];c(S,_,T.value,M)&&l.defineProperty(S,_,T,M)&&f(S,_,T.value,M)}return!0},deleteProperty(S,_){if(!Reflect.has(S,_))return!0;let T=Reflect.get(S,_),M=c(S,_,void 0,T);return M&&l.deleteProperty(S,_,T)?(f(S,_,void 0,T),!0):!M},apply(S,_,T){let M=_[r]||_;if(l.isUnsubscribed)return Reflect.apply(S,M,T);if((o===!1||o!==!0&&!o.includes(S.name))&&Ap.isHandledType(M)){let C=Wa.initial(l.getPath(S)),P=Ap.isHandledMethod(M,S.name);h.start(M,C,T);let E=Reflect.apply(S,h.preferredThisArg(S,_,M),P?T.map(O=>g(O)):T),D=h.isChanged(M,n),I=h.stop();if(Ap.isHandledType(E)&&P&&(_ instanceof Map&&S.name==="get"&&(C=Wa.concat(C,T[0])),E=l.getProxy(E,C,v)),D){let O={name:S.name,args:T,result:E},N=h.isCloning?Wa.initial(C):C,k=h.isCloning?Wa.last(C):"";c(Wa.get(e,N),k,M,I,O)?m(N,k,M,I,O):h.undo(M)}return(_ instanceof Map||_ instanceof Set)&&ZZ(E)?JZ(E,S,_,C,y):E}return Reflect.apply(S,_,T)}},b=l.getProxy(e,i.pathAsArray?[]:"",v);return t=t.bind(b),u&&(i.onValidate=i.onValidate.bind(b)),b};nM.target=e=>e&&e[iM]||e;nM.unsubscribe=e=>e[H5]||e;var yk=nM,uJ=typeof global=="object"&&global&&global.Object===Object&&global,K5=uJ,hJ=typeof self=="object"&&self&&self.Object===Object&&self,cJ=K5||hJ||Function("return this")(),qo=cJ,dJ=qo.Symbol,ro=dJ,Z5=Object.prototype,fJ=Z5.hasOwnProperty,pJ=Z5.toString,Xg=ro?ro.toStringTag:void 0;function mJ(e){var t=fJ.call(e,Xg),i=e[Xg];try{e[Xg]=void 0;var r=!0}catch{}var n=pJ.call(e);return r&&(t?e[Xg]=i:delete e[Xg]),n}var gJ=mJ,vJ=Object.prototype,yJ=vJ.toString;function xJ(e){return yJ.call(e)}var bJ=xJ,wJ="[object Null]",_J="[object Undefined]",xk=ro?ro.toStringTag:void 0;function SJ(e){return e==null?e===void 0?_J:wJ:xk&&xk in Object(e)?gJ(e):bJ(e)}var tf=SJ;function EJ(e){return e!=null&&typeof e=="object"}var qu=EJ,AJ="[object Symbol]";function CJ(e){return typeof e=="symbol"||qu(e)&&tf(e)==AJ}var Wy=CJ;function TJ(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var J5=TJ,PJ=Array.isArray,jl=PJ,bk=ro?ro.prototype:void 0,wk=bk?bk.toString:void 0;function $5(e){if(typeof e=="string")return e;if(jl(e))return J5(e,$5)+"";if(Wy(e))return wk?wk.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var MJ=$5,DJ=/\s/;function IJ(e){for(var t=e.length;t--&&DJ.test(e.charAt(t)););return t}var RJ=IJ,OJ=/^\s+/;function kJ(e){return e&&e.slice(0,RJ(e)+1).replace(OJ,"")}var LJ=kJ;function zJ(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ho=zJ,_k=NaN,NJ=/^[-+]0x[0-9a-f]+$/i,BJ=/^0b[01]+$/i,FJ=/^0o[0-7]+$/i,UJ=parseInt;function VJ(e){if(typeof e=="number")return e;if(Wy(e))return _k;if(Ho(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ho(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=LJ(e);var i=BJ.test(e);return i||FJ.test(e)?UJ(e.slice(2),i?2:8):NJ.test(e)?_k:+e}var Sk=VJ;function jJ(e){return e}var eU=jJ,HJ="[object AsyncFunction]",GJ="[object Function]",WJ="[object GeneratorFunction]",qJ="[object Proxy]";function XJ(e){if(!Ho(e))return!1;var t=tf(e);return t==GJ||t==WJ||t==HJ||t==qJ}var tU=XJ,YJ=qo["__core-js_shared__"],wA=YJ,Ek=function(){var e=/[^.]+$/.exec(wA&&wA.keys&&wA.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function QJ(e){return!!Ek&&Ek in e}var KJ=QJ,ZJ=Function.prototype,JJ=ZJ.toString;function $J(e){if(e!=null){try{return JJ.call(e)}catch{}try{return e+""}catch{}}return""}var rf=$J,e$=/[\\^$.*+?()[\]{}|]/g,t$=/^\[object .+?Constructor\]$/,i$=Function.prototype,r$=Object.prototype,n$=i$.toString,s$=r$.hasOwnProperty,a$=RegExp("^"+n$.call(s$).replace(e$,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function o$(e){if(!Ho(e)||KJ(e))return!1;var t=tU(e)?a$:t$;return t.test(rf(e))}var l$=o$;function u$(e,t){return e==null?void 0:e[t]}var h$=u$;function c$(e,t){var i=h$(e,t);return l$(i)?i:void 0}var nf=c$,d$=nf(qo,"WeakMap"),_T=d$,Ak=Object.create,f$=function(){function e(){}return function(t){if(!Ho(t))return{};if(Ak)return Ak(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),p$=f$;function m$(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var g$=m$;function v$(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var y$=v$,x$=800,b$=16,w$=Date.now;function _$(e){var t=0,i=0;return function(){var r=w$(),n=b$-(r-i);if(i=r,n>0){if(++t>=x$)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var S$=_$;function E$(e){return function(){return e}}var A$=E$,C$=function(){try{var e=nf(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Qb=C$,T$=Qb?function(e,t){return Qb(e,"toString",{configurable:!0,enumerable:!1,value:A$(t),writable:!0})}:eU,P$=T$,M$=S$(P$),D$=M$;function I$(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var R$=I$,O$=9007199254740991,k$=/^(?:0|[1-9]\d*)$/;function L$(e,t){var i=typeof e;return t=t??O$,!!t&&(i=="number"||i!="symbol"&&k$.test(e))&&e>-1&&e%1==0&&e<t}var sM=L$;function z$(e,t,i){t=="__proto__"&&Qb?Qb(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var iU=z$;function N$(e,t){return e===t||e!==e&&t!==t}var aM=N$,B$=Object.prototype,F$=B$.hasOwnProperty;function U$(e,t,i){var r=e[t];(!(F$.call(e,t)&&aM(r,i))||i===void 0&&!(t in e))&&iU(e,t,i)}var oM=U$;function V$(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?iU(i,o,l):oM(i,o,l)}return i}var qy=V$,Ck=Math.max;function j$(e,t,i){return t=Ck(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=Ck(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),g$(e,this,o)}}var H$=j$,G$=9007199254740991;function W$(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G$}var lM=W$;function q$(e){return e!=null&&lM(e.length)&&!tU(e)}var rU=q$,X$=Object.prototype;function Y$(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||X$;return e===i}var uM=Y$;function Q$(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var K$=Q$,Z$="[object Arguments]";function J$(e){return qu(e)&&tf(e)==Z$}var Tk=J$,nU=Object.prototype,$$=nU.hasOwnProperty,eee=nU.propertyIsEnumerable,tee=Tk(function(){return arguments}())?Tk:function(e){return qu(e)&&$$.call(e,"callee")&&!eee.call(e,"callee")},hM=tee;function iee(){return!1}var ree=iee,sU=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Pk=sU&&typeof module=="object"&&module&&!module.nodeType&&module,nee=Pk&&Pk.exports===sU,Mk=nee?qo.Buffer:void 0,see=Mk?Mk.isBuffer:void 0,aee=see||ree,Kb=aee,oee="[object Arguments]",lee="[object Array]",uee="[object Boolean]",hee="[object Date]",cee="[object Error]",dee="[object Function]",fee="[object Map]",pee="[object Number]",mee="[object Object]",gee="[object RegExp]",vee="[object Set]",yee="[object String]",xee="[object WeakMap]",bee="[object ArrayBuffer]",wee="[object DataView]",_ee="[object Float32Array]",See="[object Float64Array]",Eee="[object Int8Array]",Aee="[object Int16Array]",Cee="[object Int32Array]",Tee="[object Uint8Array]",Pee="[object Uint8ClampedArray]",Mee="[object Uint16Array]",Dee="[object Uint32Array]",mr={};mr[_ee]=mr[See]=mr[Eee]=mr[Aee]=mr[Cee]=mr[Tee]=mr[Pee]=mr[Mee]=mr[Dee]=!0;mr[oee]=mr[lee]=mr[bee]=mr[uee]=mr[wee]=mr[hee]=mr[cee]=mr[dee]=mr[fee]=mr[pee]=mr[mee]=mr[gee]=mr[vee]=mr[yee]=mr[xee]=!1;function Iee(e){return qu(e)&&lM(e.length)&&!!mr[tf(e)]}var Ree=Iee;function Oee(e){return function(t){return e(t)}}var cM=Oee,aU=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Bv=aU&&typeof module=="object"&&module&&!module.nodeType&&module,kee=Bv&&Bv.exports===aU,_A=kee&&K5.process,Lee=function(){try{var e=Bv&&Bv.require&&Bv.require("util").types;return e||_A&&_A.binding&&_A.binding("util")}catch{}}(),hm=Lee,Dk=hm&&hm.isTypedArray,zee=Dk?cM(Dk):Ree,oU=zee,Nee=Object.prototype,Bee=Nee.hasOwnProperty;function Fee(e,t){var i=jl(e),r=!i&&hM(e),n=!i&&!r&&Kb(e),s=!i&&!r&&!n&&oU(e),a=i||r||n||s,o=a?K$(e.length,String):[],l=o.length;for(var u in e)(t||Bee.call(e,u))&&!(a&&(u=="length"||n&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||sM(u,l)))&&o.push(u);return o}var lU=Fee;function Uee(e,t){return function(i){return e(t(i))}}var uU=Uee,Vee=uU(Object.keys,Object),jee=Vee,Hee=Object.prototype,Gee=Hee.hasOwnProperty;function Wee(e){if(!uM(e))return jee(e);var t=[];for(var i in Object(e))Gee.call(e,i)&&i!="constructor"&&t.push(i);return t}var qee=Wee;function Xee(e){return rU(e)?lU(e):qee(e)}var dM=Xee;function Yee(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var Qee=Yee,Kee=Object.prototype,Zee=Kee.hasOwnProperty;function Jee(e){if(!Ho(e))return Qee(e);var t=uM(e),i=[];for(var r in e)r=="constructor"&&(t||!Zee.call(e,r))||i.push(r);return i}var $ee=Jee;function ete(e){return rU(e)?lU(e,!0):$ee(e)}var _d=ete,tte=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ite=/^\w*$/;function rte(e,t){if(jl(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||Wy(e)?!0:ite.test(e)||!tte.test(e)||t!=null&&e in Object(t)}var nte=rte,ste=nf(Object,"create"),ly=ste;function ate(){this.__data__=ly?ly(null):{},this.size=0}var ote=ate;function lte(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var ute=lte,hte="__lodash_hash_undefined__",cte=Object.prototype,dte=cte.hasOwnProperty;function fte(e){var t=this.__data__;if(ly){var i=t[e];return i===hte?void 0:i}return dte.call(t,e)?t[e]:void 0}var pte=fte,mte=Object.prototype,gte=mte.hasOwnProperty;function vte(e){var t=this.__data__;return ly?t[e]!==void 0:gte.call(t,e)}var yte=vte,xte="__lodash_hash_undefined__";function bte(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=ly&&t===void 0?xte:t,this}var wte=bte;function zm(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}zm.prototype.clear=ote;zm.prototype.delete=ute;zm.prototype.get=pte;zm.prototype.has=yte;zm.prototype.set=wte;var Ik=zm;function _te(){this.__data__=[],this.size=0}var Ste=_te;function Ete(e,t){for(var i=e.length;i--;)if(aM(e[i][0],t))return i;return-1}var x_=Ete,Ate=Array.prototype,Cte=Ate.splice;function Tte(e){var t=this.__data__,i=x_(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():Cte.call(t,i,1),--this.size,!0}var Pte=Tte;function Mte(e){var t=this.__data__,i=x_(t,e);return i<0?void 0:t[i][1]}var Dte=Mte;function Ite(e){return x_(this.__data__,e)>-1}var Rte=Ite;function Ote(e,t){var i=this.__data__,r=x_(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var kte=Ote;function Nm(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Nm.prototype.clear=Ste;Nm.prototype.delete=Pte;Nm.prototype.get=Dte;Nm.prototype.has=Rte;Nm.prototype.set=kte;var b_=Nm,Lte=nf(qo,"Map"),uy=Lte;function zte(){this.size=0,this.__data__={hash:new Ik,map:new(uy||b_),string:new Ik}}var Nte=zte;function Bte(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Fte=Bte;function Ute(e,t){var i=e.__data__;return Fte(t)?i[typeof t=="string"?"string":"hash"]:i.map}var w_=Ute;function Vte(e){var t=w_(this,e).delete(e);return this.size-=t?1:0,t}var jte=Vte;function Hte(e){return w_(this,e).get(e)}var Gte=Hte;function Wte(e){return w_(this,e).has(e)}var qte=Wte;function Xte(e,t){var i=w_(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var Yte=Xte;function Bm(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Bm.prototype.clear=Nte;Bm.prototype.delete=jte;Bm.prototype.get=Gte;Bm.prototype.has=qte;Bm.prototype.set=Yte;var __=Bm,Qte="Expected a function";function fM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Qte);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(fM.Cache||__),i}fM.Cache=__;var Kte=fM,Zte=500;function Jte(e){var t=Kte(e,function(r){return i.size===Zte&&i.clear(),r}),i=t.cache;return t}var $te=Jte,eie=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tie=/\\(\\)?/g,iie=$te(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(eie,function(i,r,n,s){t.push(n?s.replace(tie,"$1"):r||i)}),t}),rie=iie;function nie(e){return e==null?"":MJ(e)}var sie=nie;function aie(e,t){return jl(e)?e:nte(e,t)?[e]:rie(sie(e))}var Fm=aie;function oie(e){if(typeof e=="string"||Wy(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var S_=oie;function lie(e,t){t=Fm(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[S_(t[i++])];return i&&i==r?e:void 0}var hU=lie;function uie(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var pM=uie,Rk=ro?ro.isConcatSpreadable:void 0;function hie(e){return jl(e)||hM(e)||!!(Rk&&e&&e[Rk])}var cie=hie;function cU(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=cie),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?cU(o,t-1,i,r,n):pM(n,o):r||(n[n.length]=o)}return n}var die=cU;function fie(e){var t=e==null?0:e.length;return t?die(e,1):[]}var pie=fie;function mie(e){return D$(H$(e,void 0,pie),e+"")}var dU=mie,gie=uU(Object.getPrototypeOf,Object),mM=gie,vie="[object Object]",yie=Function.prototype,xie=Object.prototype,fU=yie.toString,bie=xie.hasOwnProperty,wie=fU.call(Object);function _ie(e){if(!qu(e)||tf(e)!=vie)return!1;var t=mM(e);if(t===null)return!0;var i=bie.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&fU.call(i)==wie}var Sie=_ie;function Eie(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var Aie=Eie;function Cie(){this.__data__=new b_,this.size=0}var Tie=Cie;function Pie(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var Mie=Pie;function Die(e){return this.__data__.get(e)}var Iie=Die;function Rie(e){return this.__data__.has(e)}var Oie=Rie,kie=200;function Lie(e,t){var i=this.__data__;if(i instanceof b_){var r=i.__data__;if(!uy||r.length<kie-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new __(r)}return i.set(e,t),this.size=i.size,this}var zie=Lie;function Um(e){var t=this.__data__=new b_(e);this.size=t.size}Um.prototype.clear=Tie;Um.prototype.delete=Mie;Um.prototype.get=Iie;Um.prototype.has=Oie;Um.prototype.set=zie;var hb=Um;function Nie(e,t){return e&&qy(t,dM(t),e)}var Bie=Nie;function Fie(e,t){return e&&qy(t,_d(t),e)}var Uie=Fie,pU=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ok=pU&&typeof module=="object"&&module&&!module.nodeType&&module,Vie=Ok&&Ok.exports===pU,kk=Vie?qo.Buffer:void 0,Lk=kk?kk.allocUnsafe:void 0;function jie(e,t){if(t)return e.slice();var i=e.length,r=Lk?Lk(i):new e.constructor(i);return e.copy(r),r}var Hie=jie;function Gie(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var Wie=Gie;function qie(){return[]}var mU=qie,Xie=Object.prototype,Yie=Xie.propertyIsEnumerable,zk=Object.getOwnPropertySymbols,Qie=zk?function(e){return e==null?[]:(e=Object(e),Wie(zk(e),function(t){return Yie.call(e,t)}))}:mU,gM=Qie;function Kie(e,t){return qy(e,gM(e),t)}var Zie=Kie,Jie=Object.getOwnPropertySymbols,$ie=Jie?function(e){for(var t=[];e;)pM(t,gM(e)),e=mM(e);return t}:mU,gU=$ie;function ere(e,t){return qy(e,gU(e),t)}var tre=ere;function ire(e,t,i){var r=t(e);return jl(e)?r:pM(r,i(e))}var vU=ire;function rre(e){return vU(e,dM,gM)}var ST=rre;function nre(e){return vU(e,_d,gU)}var yU=nre,sre=nf(qo,"DataView"),ET=sre,are=nf(qo,"Promise"),AT=are,ore=nf(qo,"Set"),CT=ore,Nk="[object Map]",lre="[object Object]",Bk="[object Promise]",Fk="[object Set]",Uk="[object WeakMap]",Vk="[object DataView]",ure=rf(ET),hre=rf(uy),cre=rf(AT),dre=rf(CT),fre=rf(_T),cd=tf;(ET&&cd(new ET(new ArrayBuffer(1)))!=Vk||uy&&cd(new uy)!=Nk||AT&&cd(AT.resolve())!=Bk||CT&&cd(new CT)!=Fk||_T&&cd(new _T)!=Uk)&&(cd=function(e){var t=tf(e),i=t==lre?e.constructor:void 0,r=i?rf(i):"";if(r)switch(r){case ure:return Vk;case hre:return Nk;case cre:return Bk;case dre:return Fk;case fre:return Uk}return t});var hy=cd,pre=Object.prototype,mre=pre.hasOwnProperty;function gre(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&mre.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var vre=gre,yre=qo.Uint8Array,Zb=yre;function xre(e){var t=new e.constructor(e.byteLength);return new Zb(t).set(new Zb(e)),t}var vM=xre;function bre(e,t){var i=t?vM(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var wre=bre,_re=/\w*$/;function Sre(e){var t=new e.constructor(e.source,_re.exec(e));return t.lastIndex=e.lastIndex,t}var Ere=Sre,jk=ro?ro.prototype:void 0,Hk=jk?jk.valueOf:void 0;function Are(e){return Hk?Object(Hk.call(e)):{}}var Cre=Are;function Tre(e,t){var i=t?vM(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var Pre=Tre,Mre="[object Boolean]",Dre="[object Date]",Ire="[object Map]",Rre="[object Number]",Ore="[object RegExp]",kre="[object Set]",Lre="[object String]",zre="[object Symbol]",Nre="[object ArrayBuffer]",Bre="[object DataView]",Fre="[object Float32Array]",Ure="[object Float64Array]",Vre="[object Int8Array]",jre="[object Int16Array]",Hre="[object Int32Array]",Gre="[object Uint8Array]",Wre="[object Uint8ClampedArray]",qre="[object Uint16Array]",Xre="[object Uint32Array]";function Yre(e,t,i){var r=e.constructor;switch(t){case Nre:return vM(e);case Mre:case Dre:return new r(+e);case Bre:return wre(e,i);case Fre:case Ure:case Vre:case jre:case Hre:case Gre:case Wre:case qre:case Xre:return Pre(e,i);case Ire:return new r;case Rre:case Lre:return new r(e);case Ore:return Ere(e);case kre:return new r;case zre:return Cre(e)}}var Qre=Yre;function Kre(e){return typeof e.constructor=="function"&&!uM(e)?p$(mM(e)):{}}var Zre=Kre,Jre="[object Map]";function $re(e){return qu(e)&&hy(e)==Jre}var ene=$re,Gk=hm&&hm.isMap,tne=Gk?cM(Gk):ene,ine=tne,rne="[object Set]";function nne(e){return qu(e)&&hy(e)==rne}var sne=nne,Wk=hm&&hm.isSet,ane=Wk?cM(Wk):sne,one=ane,lne=1,une=2,hne=4,xU="[object Arguments]",cne="[object Array]",dne="[object Boolean]",fne="[object Date]",pne="[object Error]",bU="[object Function]",mne="[object GeneratorFunction]",gne="[object Map]",vne="[object Number]",wU="[object Object]",yne="[object RegExp]",xne="[object Set]",bne="[object String]",wne="[object Symbol]",_ne="[object WeakMap]",Sne="[object ArrayBuffer]",Ene="[object DataView]",Ane="[object Float32Array]",Cne="[object Float64Array]",Tne="[object Int8Array]",Pne="[object Int16Array]",Mne="[object Int32Array]",Dne="[object Uint8Array]",Ine="[object Uint8ClampedArray]",Rne="[object Uint16Array]",One="[object Uint32Array]",ur={};ur[xU]=ur[cne]=ur[Sne]=ur[Ene]=ur[dne]=ur[fne]=ur[Ane]=ur[Cne]=ur[Tne]=ur[Pne]=ur[Mne]=ur[gne]=ur[vne]=ur[wU]=ur[yne]=ur[xne]=ur[bne]=ur[wne]=ur[Dne]=ur[Ine]=ur[Rne]=ur[One]=!0;ur[pne]=ur[bU]=ur[_ne]=!1;function cb(e,t,i,r,n,s){var a,o=t&lne,l=t&une,u=t&hne;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!Ho(e))return e;var h=jl(e);if(h){if(a=vre(e),!o)return y$(e,a)}else{var c=hy(e),f=c==bU||c==mne;if(Kb(e))return Hie(e,o);if(c==wU||c==xU||f&&!n){if(a=l||f?{}:Zre(e),!o)return l?tre(e,Uie(a,e)):Zie(e,Bie(a,e))}else{if(!ur[c])return n?e:{};a=Qre(e,c,o)}}s||(s=new hb);var m=s.get(e);if(m)return m;s.set(e,a),one(e)?e.forEach(function(v){a.add(cb(v,t,i,v,e,s))}):ine(e)&&e.forEach(function(v,b){a.set(b,cb(v,t,i,b,e,s))});var g=u?l?yU:ST:l?_d:dM,y=h?void 0:g(e);return R$(y||e,function(v,b){y&&(b=v,v=e[b]),oM(a,b,cb(v,t,i,b,e,s))}),a}var _U=cb,kne=1,Lne=4;function zne(e){return _U(e,kne|Lne)}var E_=zne,Nne="__lodash_hash_undefined__";function Bne(e){return this.__data__.set(e,Nne),this}var Fne=Bne;function Une(e){return this.__data__.has(e)}var Vne=Une;function Jb(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new __;++t<i;)this.add(e[t])}Jb.prototype.add=Jb.prototype.push=Fne;Jb.prototype.has=Vne;var jne=Jb;function Hne(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var Gne=Hne;function Wne(e,t){return e.has(t)}var qne=Wne,Xne=1,Yne=2;function Qne(e,t,i,r,n,s){var a=i&Xne,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var c=-1,f=!0,m=i&Yne?new jne:void 0;for(s.set(e,t),s.set(t,e);++c<o;){var g=e[c],y=t[c];if(r)var v=a?r(y,g,c,t,e,s):r(g,y,c,e,t,s);if(v!==void 0){if(v)continue;f=!1;break}if(m){if(!Gne(t,function(b,S){if(!qne(m,S)&&(g===b||n(g,b,i,r,s)))return m.push(S)})){f=!1;break}}else if(!(g===y||n(g,y,i,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}var SU=Qne;function Kne(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var Zne=Kne;function Jne(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var $ne=Jne,ese=1,tse=2,ise="[object Boolean]",rse="[object Date]",nse="[object Error]",sse="[object Map]",ase="[object Number]",ose="[object RegExp]",lse="[object Set]",use="[object String]",hse="[object Symbol]",cse="[object ArrayBuffer]",dse="[object DataView]",qk=ro?ro.prototype:void 0,SA=qk?qk.valueOf:void 0;function fse(e,t,i,r,n,s,a){switch(i){case dse:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case cse:return!(e.byteLength!=t.byteLength||!s(new Zb(e),new Zb(t)));case ise:case rse:case ase:return aM(+e,+t);case nse:return e.name==t.name&&e.message==t.message;case ose:case use:return e==t+"";case sse:var o=Zne;case lse:var l=r&ese;if(o||(o=$ne),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;r|=tse,a.set(e,t);var h=SU(o(e),o(t),r,n,s,a);return a.delete(e),h;case hse:if(SA)return SA.call(e)==SA.call(t)}return!1}var pse=fse,mse=1,gse=Object.prototype,vse=gse.hasOwnProperty;function yse(e,t,i,r,n,s){var a=i&mse,o=ST(e),l=o.length,u=ST(t),h=u.length;if(l!=h&&!a)return!1;for(var c=l;c--;){var f=o[c];if(!(a?f in t:vse.call(t,f)))return!1}var m=s.get(e),g=s.get(t);if(m&&g)return m==t&&g==e;var y=!0;s.set(e,t),s.set(t,e);for(var v=a;++c<l;){f=o[c];var b=e[f],S=t[f];if(r)var _=a?r(S,b,f,t,e,s):r(b,S,f,e,t,s);if(!(_===void 0?b===S||n(b,S,i,r,s):_)){y=!1;break}v||(v=f=="constructor")}if(y&&!v){var T=e.constructor,M=t.constructor;T!=M&&"constructor"in e&&"constructor"in t&&!(typeof T=="function"&&T instanceof T&&typeof M=="function"&&M instanceof M)&&(y=!1)}return s.delete(e),s.delete(t),y}var xse=yse,bse=1,Xk="[object Arguments]",Yk="[object Array]",$1="[object Object]",wse=Object.prototype,Qk=wse.hasOwnProperty;function _se(e,t,i,r,n,s){var a=jl(e),o=jl(t),l=a?Yk:hy(e),u=o?Yk:hy(t);l=l==Xk?$1:l,u=u==Xk?$1:u;var h=l==$1,c=u==$1,f=l==u;if(f&&Kb(e)){if(!Kb(t))return!1;a=!0,h=!1}if(f&&!h)return s||(s=new hb),a||oU(e)?SU(e,t,i,r,n,s):pse(e,t,l,i,r,n,s);if(!(i&bse)){var m=h&&Qk.call(e,"__wrapped__"),g=c&&Qk.call(t,"__wrapped__");if(m||g){var y=m?e.value():e,v=g?t.value():t;return s||(s=new hb),n(y,v,i,r,s)}}return f?(s||(s=new hb),xse(e,t,i,r,n,s)):!1}var Sse=_se;function EU(e,t,i,r,n){return e===t?!0:e==null||t==null||!qu(e)&&!qu(t)?e!==e&&t!==t:Sse(e,t,i,r,EU,n)}var Ese=EU;function Ase(e,t){return e!=null&&t in Object(e)}var Cse=Ase;function Tse(e,t,i){t=Fm(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=S_(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&lM(n)&&sM(a,n)&&(jl(e)||hM(e)))}var Pse=Tse;function Mse(e,t){return e!=null&&Pse(e,t,Cse)}var Dse=Mse,Ise=function(){return qo.Date.now()},EA=Ise,Rse="Expected a function",Ose=Math.max,kse=Math.min;function Lse(e,t,i){var r,n,s,a,o,l,u=0,h=!1,c=!1,f=!0;if(typeof e!="function")throw new TypeError(Rse);t=Sk(t)||0,Ho(i)&&(h=!!i.leading,c="maxWait"in i,s=c?Ose(Sk(i.maxWait)||0,t):s,f="trailing"in i?!!i.trailing:f);function m(C){var P=r,E=n;return r=n=void 0,u=C,a=e.apply(E,P),a}function g(C){return u=C,o=setTimeout(b,t),h?m(C):a}function y(C){var P=C-l,E=C-u,D=t-P;return c?kse(D,s-E):D}function v(C){var P=C-l,E=C-u;return l===void 0||P>=t||P<0||c&&E>=s}function b(){var C=EA();if(v(C))return S(C);o=setTimeout(b,y(C))}function S(C){return o=void 0,f&&r?m(C):(r=n=void 0,a)}function _(){o!==void 0&&clearTimeout(o),u=0,r=l=n=o=void 0}function T(){return o===void 0?a:S(EA())}function M(){var C=EA(),P=v(C);if(r=arguments,n=this,l=C,P){if(o===void 0)return g(l);if(c)return clearTimeout(o),o=setTimeout(b,t),m(l)}return o===void 0&&(o=setTimeout(b,t)),a}return M.cancel=_,M.flush=T,M}var cy=Lse;function zse(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Nse=zse;function Bse(e,t){return e>t}var Fse=Bse;function Use(e,t){return t.length<2?e:hU(e,Aie(t,0,-1))}var Vse=Use;function jse(e,t){return Ese(e,t)}var yM=jse;function Hse(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!Wy(a):i(a,o)))var o=a,l=s}return l}var Gse=Hse;function Wse(e){return e&&e.length?Gse(e,eU,Fse):void 0}var qse=Wse;function Xse(e,t){return t=Fm(t,e),e=Vse(e,t),e==null||delete e[S_(Nse(t))]}var Yse=Xse;function Qse(e){return Sie(e)?void 0:e}var Kse=Qse,Zse=1,Jse=2,$se=4,eae=dU(function(e,t){var i={};if(e==null)return i;var r=!1;t=J5(t,function(s){return s=Fm(s,e),r||(r=s.length>1),s}),qy(e,yU(e),i),r&&(i=_U(i,Zse|Jse|$se,Kse));for(var n=t.length;n--;)Yse(i,t[n]);return i}),TT=eae;function tae(e,t,i,r){if(!Ho(e))return e;t=Fm(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=S_(t[n]),u=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var h=o[l];u=r?r(h,l,o):void 0,u===void 0&&(u=Ho(h)?h:sM(t[n+1])?[]:{})}oM(o,l,u),o=o[l]}return e}var iae=tae;function rae(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=hU(e,a);i(o,a)&&iae(s,Fm(a,e),o)}return s}var nae=rae;function sae(e,t){return nae(e,t,function(i,r){return Dse(e,r)})}var aae=sae,oae=dU(function(e,t){return e==null?{}:aae(e,t)}),kl=oae,lae="Expected a function";function uae(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(lae);return Ho(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),cy(e,t,{leading:r,maxWait:t,trailing:n})}var hae=uae;function AU(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function no(e,t){return Object.setPrototypeOf(e,t),e}var cae=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),dae=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),fae=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||A_&&"ontouchend"in document,pae=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,mae=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,gae=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},vae=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},yae=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},CU=cae();CU&&yae();var A_=dae(),Xy=fae(),xae=pae(),Pa=mae(),Kk=gae(),bae=Number(vae());function TU(e){return Array.isArray(e)?e:[e]}function PU(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function ex(e){return A_?e.metaKey:e.ctrlKey}function wae(e){return e.wheelDeltaY===0||e.deltaY===0?A_&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var Vt=[],$b={},bv={},db={};function MU(e){Vt.includes(e)||Vt.push(e)}function Wp(e){delete $b[e.pointerId];for(let t=0;t<Vt.length;t++)if(Vt[t].pointerId===e.pointerId){Vt.splice(t,1);break}}function _ae(){Vt.splice(0,Vt.length)}function ew(e){if(e.pointerType!=="touch")return;let t=$b[e.pointerId];t===void 0&&(t={x:0,y:0},$b[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function AA(e){let t=e.pointerId===Vt[0].pointerId?Vt[1]:Vt[0];return $b[t.pointerId]}function DU(e){bv[e.key]=!0,db[e.key]=db[e.key]===void 0?1:db[e.key]+1}function IU(e){if(A_&&bv.Meta)for(let t in bv)bv[t]=!1;else bv[e.key]=!1;db={}}function Sae(e){e.addEventListener("pointerdown",MU,!0),e.addEventListener("pointerdown",ew,!0),e.addEventListener("pointermove",ew,!0),e.addEventListener("pointerup",Wp,!0),e.addEventListener("pointercancel",Wp,!0),e.addEventListener("pointerleave",Wp,!0),window.addEventListener("keydown",DU,!0),window.addEventListener("keyup",IU,!0)}function Eae(e){e.removeEventListener("pointerdown",MU,!0),e.removeEventListener("pointerdown",ew,!0),e.removeEventListener("pointermove",ew,!0),e.removeEventListener("pointerup",Wp,!0),e.removeEventListener("pointercancel",Wp,!0),e.removeEventListener("pointerleave",Wp,!0),window.removeEventListener("keydown",DU,!0),window.removeEventListener("keyup",IU,!0)}var RU,Aae=new Promise(e=>{RU=e}),tx;function Cae(){if(tx)return tx;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.59/build",i=Es(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});RU(a)}return tx=e(),tx}var OU,Tae=new Promise(e=>{OU=e}),ix;function Pae(){if(ix)return ix;async function e(){let t=await Es(()=>import("./physics-fi288bvL.js"),[]);await t.init(),OU(t)}return ix=e(),ix}var zt=class{modifyById(t,i){let r=this;if(r[t]===void 0)throw new Error("not expected");{let n={...r,[t]:i};return Object.setPrototypeOf(n,zt.prototype),n}}add(t,i){var r;return((r=this.runOp({type:1,id:t,data:i}))==null?void 0:r.data)??this}runOp(t){let i=this;if(t.type===1){let r=i[t.id],n;r===void 0?n={type:2,id:t.id}:n={type:1,id:t.id,data:r};let{id:s,data:a}=t,o={...i,[s]:a};return Object.setPrototypeOf(o,zt.prototype),{data:o,actual:t,reverse:n}}else if(t.type===2){let{id:r}=t,n=i[r];if(n===void 0)return null;{let s={...i};return Object.setPrototypeOf(s,zt.prototype),delete s[r],{data:s,actual:t,reverse:{type:1,id:r,data:n}}}}return null}};function xM(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&xM(r)}return Object.freeze(e)}function Mae(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var kU=class extends Error{};function CA(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function ic(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function bM(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Dae(){return typeof process<"u"}function LU(e,t){for(let i of e)t(i.id,i.data)!==!0&&LU(i.children,t)}function zU(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)zU(i,t)}var ts=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ts.prototype)}deepFreeze(){let e=0;for(;e<this.length;)xM(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&zU(i,t)}}traverse(e){LU(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,ts.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((u,h)=>u.fi-h.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let c=t;for(;c!==null;){if(c===void 0)throw new Error;if(c===r)throw new kU("cyclic tree");c=this.parent(c)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(c=>c.id===r);a=[...a];let l=a.splice(o,1)[0],u=this.modifyArrayBy(n,a);n=t,a=u.childrenArray(n);let h=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((c,f)=>c.fi-f.fi),e.localIndex=a.indexOf(l),u=u.modifyArrayBy(n,a),{data:u,actual:e,reverse:{type:9,parent:s,fi:h,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>Mae(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return ic(0,i,i);{let n=r[0].fi;return ic(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return ic(a,a+i,i)}else return ic(n.fi,s.fi,i)}}},tw;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let u=parseInt(l);if(isNaN(u))throw new Error("wrong index");s[l]=a[u],a[u]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let u=n[l];u===void 0?delete a[l]:a[l]=u,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(tw||(tw={}));var At=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,At.prototype)}deepFreeze(){let e=0;for(;e<this.length;)xM(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,At.prototype);let t=e;return Dae()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return ic(0,t,t);{let r=i[0].fi;return ic(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return ic(s,s+t,t)}else return ic(r.fi,n.fi,t)}}};function cm(e){return e&&typeof e=="object"&&e instanceof en}var en=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!cm(i))return null;r+=1}i=i?CA(i):new en;for(let[o,l]of Object.entries(e.props)){let u=i[o];n[o]=u,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=CA(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=CA(o);l[e.path[r-1]]=i,i=l}else{let l=new en;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,en.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},dc;(e=>{function t(n,s){return dy(n,s)??n}e.apply=t;function i(n,s){return _M(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=fn.zoomOnce(l,o[a]),l===void 0)return s;if(!cm(l))return;a+=1}if(l===void 0)return s;if(cm(l))if(s.type===0){let u={...s.props};for(let h of Object.keys(l))delete u[h];return{...s,props:u}}else if(s.type===1||s.type===4||s.type===7){let u=wM([s],l);return u?(console.log(u),u):s}else return s}e.filterOp=r})(dc||(dc={}));function wM(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=dy(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=wM(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function Iae(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=dy(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function dy(e,t){if(!cm(t))return t;if(e instanceof ts){let i=wM(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof At)return Iae(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=dy(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof en)return _M(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=dy(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function _M(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!cm(t))return t;if(!cm(e))return dc.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new en;for(let n of i){let s=_M(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function Rae(e,t){let i={cur:[],result:[],len:0};return e=fy(e,t,i)??e,[e,i.result]}function iw(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function rw(e){e&&(e.len-=1)}function Oae(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function NU(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=fy(s.data,t,iw(i,a));rw(i),r=r||l!==void 0,l===void 0&&(l=s.data);let u=NU(s.children,t,i);return u!==void 0?r=!0:u=s.children,{...s,id:a,data:l,children:u}});if(r)return n}function kae(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=fy(s.data,t,iw(i,a));return rw(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function fy(e,t,i){if(e instanceof ts){let r=NU(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof At)return kae(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=fy(s,t,iw(i,a));return rw(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!bM(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=fy(a,t,iw(i,s));rw(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&Oae(i),r}else return}}var nw;(e=>{function t(i,r){let n=fn.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(nw||(nw={}));var kn;(e=>{function t(l,u){return{...l,path:l.path.slice(u)}}e.drop=t;function i(l,u){var h;return((h=r(l,u))==null?void 0:h.data)??l}e.applySimple=i;function r(l,u){var f,m;let h=u.path;for(var c=[];;){let g;if(l instanceof en&&u.type===0&&(g=l.runOp({...u,path:h.slice(c.length)}),g===null&&(g=void 0)),g===void 0&&c.length===h.length&&(l instanceof ts||l instanceof At||l instanceof zt?g=l.runOp(u):g=tw.runOp(l,u)),g!==void 0)if(g!==null){let b=g.data;for(let S=c.length-1;S>=0;S--){let _=h[S],T=c[S];if(T instanceof ts){if(typeof _=="number")throw new Error("illegal arg");b=T.modifyById(_,b)}else if(T instanceof At){if(typeof _=="number")throw new Error("illegal arg");b=T.modifyById(_,b)}else if(T instanceof zt){if(typeof _=="number")throw new Error("illegal arg");b=T.modifyById(_,b)}else if(T instanceof en){let M={...T,[_]:b};b=Object.setPrototypeOf(M,en.prototype)}else if(typeof T=="object")if(Array.isArray(T)){if(typeof _=="string"&&(_=parseInt(_),isNaN(_)))throw new Error("Invalid path");let M=b;b=[...T],b[_]=M}else b={...T,[_]:b};else return null}return{data:b,actual:{...g.actual,path:h},reverse:{...g.reverse,path:h}}}else return null;let y=h[c.length],v;if(l instanceof ts){if(typeof y=="number")throw new Error("");v=(f=l.get(y))==null?void 0:f.data}else if(l instanceof At){if(typeof y=="number")throw new Error("");v=(m=l.get(y))==null?void 0:m.data}else l!==null&&(v=l[y]);if(v!==void 0)c.push(l),l=v;else return null}}e.apply=r;function n(l,u){for(let h=0;h<l.length&&h<u.length;h++)if(l[h]!==u[h])return!0;return!1}e.pathDisjoint=n;function s(l,u){if(l.length!==u.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==u[h])return!1;return!0}e.pathEq=s;function a(l,u){return n(l.path,u.path)}e.commutative=a;function o(l,u){return l.type===0&&u.type===0&&s(l.path,u.path)?Object.keys(l.props).every(h=>u.props[h]!==void 0):!1}e.subsumed=o})(kn||(kn={}));var PT;(e=>{function t(){return[]}e.empty=t;function i(u,h){let c=[];for(let f of u){let[m,...g]=f.path;m===h&&c.push({...f,path:g})}return c}e.removePrefix=i;function r(u,h){return u.map(c=>({...c,path:[h,...c.path]}))}e.addPrefix=r;function n(u,h){return[...u,...h]}e.concat=n;function s(u,h){return[...u.filter(c=>!h.some(f=>kn.subsumed(c,f))),...h]}e.compress=s;function a(u,h){return u.every(c=>h.every(f=>kn.commutative(c,f)))}e.commutative=a;function o(u,h){for(let c of h){let f=l(u,c);f!==null&&(u=f.data)}return u}e.applyAll=o;function l(u,h){var c=u;let f=[],m=[];for(let g of h)try{if(g.type===3||g.type===5&&g.path[g.path.length-1]==="variables"){let y,v,b;if(g.type===3?(y=fn.zoom(c,[...g.path,g.id]),b=kn.apply(c,{...g,type:2})):(y=fn.zoom(c,[...g.path,g.id,"value"]),b=kn.apply(c,g)),b!==null){c=b.data;let[S,_]=Rae(c,{[g.id]:y});c=S;for(let T=0;T<_.length;T++){let M=_[T],C=M.pop();if(typeof C=="number"){let P=[C];for(let D=T+1;D<_.length;D++){let I=_[D],O=I[I.length-1];if(typeof O=="number"&&fn.equal(M,I.slice(0,I.length-1)))P.push(O),_.splice(D,1);else break}let E=fn.zoom(c,M);v=E.map((D,I)=>P.includes(I)?g.id:D),y=E,C=M.pop()}else{if(C==="alphaOverride"||C==="alpha"){y/=100;let P=y,E=fn.zoom(c,M.slice(0,M.length-2)),D=E.layers.map(I=>I.id===M[M.length-1]?{...I,data:{...I.data,[C]:P}}:I);Object.setPrototypeOf(D,Object.getPrototypeOf(E.layers)),E.layers=D}v=g.id}f.push({type:0,path:M,props:{[C]:y}}),m.push({type:0,path:M,props:{[C]:v}})}m.push(b.reverse),f.push(b.actual)}}else{let y=kn.apply(c,g);y!==null&&(f.push(y.actual),c=y.data,m.push(y.reverse))}}catch(y){if(y instanceof kU)return null;throw y}return{data:c,actual:f,reverse:m.reverse()}}e.apply=l})(PT||(PT={}));var BU=Symbol(),Lae=Symbol(),C_=Symbol(),Yy=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof UU);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[C_];i&&i(),delete this._children[e]}}}},zae=class extends Yy{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,tw.runOp(this._current,e),e.path)}},Nae=class extends Yy{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,zt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},FU={get(e,t){if(t===C_)return()=>{e._parent=null};if(t===BU)return e._current;if(t===Lae)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=T_(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},Bae={...FU,set(e,t,i){let r={type:0,props:{[t]:Ur(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},Fae={...FU,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},SM=class extends Yy{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[C_]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=T_(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},EM=class extends Yy{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[C_]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=T_(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function TA(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&fn.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var UU=class extends Yy{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){TA(this.ts,t,e),TA(this.actual,i,e),TA(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function T_(e,t,i){return i instanceof ts?new SM(e,t,i):i instanceof At?new EM(e,t,i):i instanceof zt?new Proxy(new Nae(e,t,i),Fae):i!==null&&typeof i=="object"?bM(i)?i:new Proxy(new zae(e,t,i),Bae):i}function VU(e){let t=new UU(e);return[T_(t,"",e),t]}function py(e,t){let[i,r]=VU(e);return t(i),r.result()}function Ur(e){return e instanceof SM||e instanceof EM?e._current:e!==null&&typeof e=="object"?e[BU]:e}var fn;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let u={...a};return Object.keys(l).forEach(h=>{delete u[h]}),u}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof ts||s instanceof SM)&&typeof a=="string"||(s instanceof At||s instanceof EM)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(fn||(fn={}));function Uae(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function ir(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var jU=class{},Zk=class extends jU{constructor(e){super(),this.id=e}},Jk=class extends jU{constructor(e){super(),this.data=e}},MT;try{MT=new TextDecoder}catch{}var mt,fc,Se=0,na={},Vi,rc,qa=0,Tl=0,Ta,Fu,Vs=[],Wi,$k={useRecords:!1,mapsAsObjects:!0},HU=class{},GU=new HU;GU.name="MessagePack 0xC1";var dm=!1,sw=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(mt)return KU(()=>(IT(),this?this.unpack(e,t):sw.prototype.unpack.call($k,e,t)));fc=t>-1?t:e.length,Se=0,Tl=0,rc=null,Ta=null,mt=e;try{Wi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw mt=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof sw){if(na=this,this.structures)return Vi=this.structures,rx();(!Vi||Vi.length>0)&&(Vi=[])}else na=$k,(!Vi||Vi.length>0)&&(Vi=[]);return rx()}unpackMultiple(e,t){let i,r=0;try{dm=!0;let n=e.length,s=this?this.unpack(e,n):M_.unpack(e,n);if(t){for(t(s);Se<n;)if(r=Se,t(rx())===!1)return}else{for(i=[s];Se<n;)r=Se,i.push(rx());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{dm=!1,IT()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function rx(){try{if(!na.trusted&&!dm){let t=Vi.sharedLength||0;t<Vi.length&&(Vi.length=t)}let e=Ir();if(Se==fc)Vi.restoreStructures&&eL(),Vi=null,mt=null,Fu&&(Fu=null);else if(Se>fc){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!dm)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw Vi.restoreStructures&&eL(),IT(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function eL(){for(let e in Vi.restoreStructures)Vi[e]=Vi.restoreStructures[e];Vi.restoreStructures=null}function Ir(){let e=mt[Se++];if(e<160)if(e<128){if(e<64)return e;{let t=Vi[e&63]||na.getStructures&&WU()[e&63];return t?(t.read||(t.read=AM(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,na.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[XU()]=Ir();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ir(),Ir());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ir();return t}else if(e<192){let t=e-160;if(Tl>=Se)return rc.slice(Se-qa,(Se+=t)-qa);if(Tl==0&&fc<140){let i=t<16?CM(t):qU(t);if(i!=null)return i}return DT(t)}else{let t;switch(e){case 192:return null;case 193:return Ta?(t=Ir(),t>0?Ta[1].slice(Ta.position1,Ta.position1+=t):Ta[0].slice(Ta.position0,Ta.position0-=t)):GU;case 194:return!1;case 195:return!0;case 196:return PA(mt[Se++]);case 197:return t=Wi.getUint16(Se),Se+=2,PA(t);case 198:return t=Wi.getUint32(Se),Se+=4,PA(t);case 199:return nd(mt[Se++]);case 200:return t=Wi.getUint16(Se),Se+=2,nd(t);case 201:return t=Wi.getUint32(Se),Se+=4,nd(t);case 202:if(t=Wi.getFloat32(Se),na.useFloat32>2){let i=TM[(mt[Se]&127)<<1|mt[Se+1]>>7];return Se+=4,(i*t+(t>0?.5:-.5)>>0)/i}return Se+=4,t;case 203:return t=Wi.getFloat64(Se),Se+=8,t;case 204:return mt[Se++];case 205:return t=Wi.getUint16(Se),Se+=2,t;case 206:return t=Wi.getUint32(Se),Se+=4,t;case 207:return na.int64AsNumber?(t=Wi.getUint32(Se)*4294967296,t+=Wi.getUint32(Se+4)):t=Wi.getBigUint64(Se),Se+=8,t;case 208:return Wi.getInt8(Se++);case 209:return t=Wi.getInt16(Se),Se+=2,t;case 210:return t=Wi.getInt32(Se),Se+=4,t;case 211:return na.int64AsNumber?(t=Wi.getInt32(Se)*4294967296,t+=Wi.getUint32(Se+4)):t=Wi.getBigInt64(Se),Se+=8,t;case 212:if(t=mt[Se++],t==114)return sL(mt[Se++]&63);{let i=Vs[t];if(i)return i.read?(Se++,i.read(Ir())):i.noBuffer?(Se++,i()):i(mt.subarray(Se,++Se));throw new Error("Unknown extension "+t)}case 213:return t=mt[Se],t==114?(Se++,sL(mt[Se++]&63,mt[Se++])):nd(2);case 214:return nd(4);case 215:return nd(8);case 216:return nd(16);case 217:return t=mt[Se++],Tl>=Se?rc.slice(Se-qa,(Se+=t)-qa):jae(t);case 218:return t=Wi.getUint16(Se),Se+=2,Tl>=Se?rc.slice(Se-qa,(Se+=t)-qa):Hae(t);case 219:return t=Wi.getUint32(Se),Se+=4,Tl>=Se?rc.slice(Se-qa,(Se+=t)-qa):Gae(t);case 220:return t=Wi.getUint16(Se),Se+=2,iL(t);case 221:return t=Wi.getUint32(Se),Se+=4,iL(t);case 222:return t=Wi.getUint16(Se),Se+=2,rL(t);case 223:return t=Wi.getUint32(Se),Se+=4,rL(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var Vae=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function AM(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>Vae.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Ir);return e.highByte===0&&(e.read=tL(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=Ir()}return r}return i.count=0,e.highByte===0?tL(t,i):i}var tL=(e,t)=>function(){let i=mt[Se++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=Vi[r]||WU()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=AM(n,e)),n.read()};function WU(){let e=KU(()=>(mt=null,na.getStructures()));return Vi=na._mergeStructures(e,Vi)}var DT=P_,jae=P_,Hae=P_,Gae=P_;function P_(e){let t;if(e<16&&(t=CM(e)))return t;if(e>64&&MT)return MT.decode(mt.subarray(Se,Se+=e));let i=Se+e,r=[];for(t="";Se<i;){let n=mt[Se++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=mt[Se++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=mt[Se++]&63,a=mt[Se++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=mt[Se++]&63,a=mt[Se++]&63,o=mt[Se++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Mn.apply(String,r),r.length=0)}return r.length>0&&(t+=Mn.apply(String,r)),t}function iL(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ir();return t}function rL(e){if(na.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[XU()]=Ir();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ir(),Ir());return t}}var Mn=String.fromCharCode;function qU(e){let t=Se,i=new Array(e);for(let r=0;r<e;r++){let n=mt[Se++];if((n&128)>0){Se=t;return}i[r]=n}return Mn.apply(String,i)}function CM(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[Se++];if((t&128)>1){Se-=1;return}return Mn(t)}}else{let t=mt[Se++],i=mt[Se++];if((t&128)>0||(i&128)>0){Se-=2;return}if(e<3)return Mn(t,i);let r=mt[Se++];if((r&128)>0){Se-=3;return}return Mn(t,i,r)}else{let t=mt[Se++],i=mt[Se++],r=mt[Se++],n=mt[Se++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Se-=4;return}if(e<6){if(e===4)return Mn(t,i,r,n);{let s=mt[Se++];if((s&128)>0){Se-=5;return}return Mn(t,i,r,n,s)}}else if(e<8){let s=mt[Se++],a=mt[Se++];if((s&128)>0||(a&128)>0){Se-=6;return}if(e<7)return Mn(t,i,r,n,s,a);let o=mt[Se++];if((o&128)>0){Se-=7;return}return Mn(t,i,r,n,s,a,o)}else{let s=mt[Se++],a=mt[Se++],o=mt[Se++],l=mt[Se++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){Se-=8;return}if(e<10){if(e===8)return Mn(t,i,r,n,s,a,o,l);{let u=mt[Se++];if((u&128)>0){Se-=9;return}return Mn(t,i,r,n,s,a,o,l,u)}}else if(e<12){let u=mt[Se++],h=mt[Se++];if((u&128)>0||(h&128)>0){Se-=10;return}if(e<11)return Mn(t,i,r,n,s,a,o,l,u,h);let c=mt[Se++];if((c&128)>0){Se-=11;return}return Mn(t,i,r,n,s,a,o,l,u,h,c)}else{let u=mt[Se++],h=mt[Se++],c=mt[Se++],f=mt[Se++];if((u&128)>0||(h&128)>0||(c&128)>0||(f&128)>0){Se-=12;return}if(e<14){if(e===12)return Mn(t,i,r,n,s,a,o,l,u,h,c,f);{let m=mt[Se++];if((m&128)>0){Se-=13;return}return Mn(t,i,r,n,s,a,o,l,u,h,c,f,m)}}else{let m=mt[Se++],g=mt[Se++];if((m&128)>0||(g&128)>0){Se-=14;return}if(e<15)return Mn(t,i,r,n,s,a,o,l,u,h,c,f,m,g);let y=mt[Se++];if((y&128)>0){Se-=15;return}return Mn(t,i,r,n,s,a,o,l,u,h,c,f,m,g,y)}}}}}function PA(e){return na.copyBuffers?Uint8Array.prototype.slice.call(mt,Se,Se+=e):mt.subarray(Se,Se+=e)}function nd(e){let t=mt[Se++];if(Vs[t])return Vs[t](mt.subarray(Se,Se+=e));throw new Error("Unknown extension type "+t)}var nL=new Array(4096);function XU(){let e=mt[Se++];if(e>=160&&e<192){if(e=e-160,Tl>=Se)return rc.slice(Se-qa,(Se+=e)-qa);if(!(Tl==0&&fc<180))return DT(e)}else return Se--,Ir();let t=(e<<5^(e>1?Wi.getUint16(Se):e>0?mt[Se]:0))&4095,i=nL[t],r=Se,n=Se+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=Wi.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=mt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return Se=r,i.string;n-=3,r=Se}for(i=[],nL[t]=i,i.bytes=e;r<n;)s=Wi.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=mt[r++],i.push(s);let o=e<16?CM(e):qU(e);return o!=null?i.string=o:i.string=DT(e)}var sL=(e,t)=>{var i=Ir();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=Vi[e];return n&&n.isShared&&((Vi.restoreStructures||(Vi.restoreStructures=[]))[e]=n),Vi[e]=i,i.read=AM(i,r),i.read()},YU=typeof self=="object"?self:global;Vs[0]=()=>{};Vs[0].noBuffer=!0;Vs[101]=()=>{let e=Ir();return(YU[e[0]]||Error)(e[1])};Vs[105]=e=>{let t=Wi.getUint32(Se-4);Fu||(Fu=new Map);let i=mt[Se],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Fu.set(t,n);let s=Ir();return n.used?Object.assign(r,s):(n.target=s,s)};Vs[112]=e=>{let t=Wi.getUint32(Se-4),i=Fu.get(t);return i.used=!0,i.target};Vs[115]=()=>new Set(Ir());var QU=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Vs[116]=e=>{let t=e[0],i=QU[t];if(!i)throw new Error("Could not find typed array for code "+t);return new YU[i](Uint8Array.prototype.slice.call(e,1).buffer)};Vs[120]=()=>{let e=Ir();return new RegExp(e[0],e[1])};Vs[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=Se;Se+=t-4,Ta=[Ir(),Ir()],Ta.position0=0,Ta.position1=0;let r=Se;Se=i;try{return Ir()}finally{Se=r}};Vs[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function KU(e){let t=fc,i=Se,r=qa,n=Tl,s=rc,a=Fu,o=Ta,l=new Uint8Array(mt.slice(0,fc)),u=Vi,h=Vi.slice(0,Vi.length),c=na,f=dm,m=e();return fc=t,Se=i,qa=r,Tl=n,rc=s,Fu=a,Ta=o,mt=l,dm=f,Vi=u,Vi.splice(0,Vi.length,...h),na=c,Wi=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),m}function IT(){mt=null,Fu=null,Vi=null}function Wae(e){e.unpack?Vs[e.type]=e.unpack:Vs[e.type]=e}var TM=new Array(147);for(let e=0;e<256;e++)TM[e]=+("1e"+Math.floor(45.15-e*.30103));var M_=new sw({useRecords:!1});M_.unpack;M_.unpackMultiple;M_.unpack;var qae=new Float32Array(1);new Uint8Array(qae.buffer,0,4);var fb;try{fb=new TextEncoder}catch{}var aw,PM,D_=typeof Buffer<"u",MA=D_?Buffer.allocUnsafeSlow:Uint8Array,ZU=D_?Buffer:Uint8Array,aL=D_?4294967296:2144337920,Ue,Nr,Me=0,ol,ll=null,Xae=/[\u0080-\uFFFF]/,Yg=Symbol("record-id"),JU=class extends sw{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=ZU.prototype.utf8Write?function(C,P,E){return Ue.utf8Write(C,P,E)}:fb&&fb.encodeInto?function(C,P){return fb.encodeInto(C,Ue.subarray(P)).written}:!1,l=this;e||(e={});let u=e&&e.sequential,h=e.structures||e.saveStructures,c=e.maxSharedStructures;if(c==null&&(c=h?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");let f=e.maxOwnStructures;f==null&&(f=h?32:64),u&&!e.saveStructures&&(this.structures=[]);let m=c>32||f+c>64,g=c+64,y=c+f+64;if(y>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],b=0,S=0;this.pack=this.encode=function(C,P){if(Ue||(Ue=new MA(8192),Nr=new DataView(Ue.buffer,0,8192),Me=0),ol=Ue.length-10,ol-Me<2048?(Ue=new MA(Ue.length),Nr=new DataView(Ue.buffer,0,Ue.length),ol=Ue.length-10,Me=0):Me=Me+7&2147483640,t=Me,s=l.structuredClone?new Map:null,l.bundleStrings?(ll=["",""],Ue[Me++]=214,Ue[Me++]=98,ll.position=Me-t,Me+=4):ll=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let E=i.sharedLength||0;if(E>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<E;D++){let I=i[D];if(!I)continue;let O,N=i.transitions;for(let k=0,U=I.length;k<U;k++){let Q=I[k];O=N[Q],O||(O=N[Q]=Object.create(null)),N=O}N[Yg]=D+64}a=E}u||(i.nextId=E+64)}r&&(r=!1),n=i||[];try{if(_(C),ll){Nr.setUint32(ll.position+t,Me-ll.position-t);let E=ll;ll=null,_(E[0]),_(E[1])}if(l.offset=Me,s&&s.idsToInsert){Me+=s.idsToInsert.length*6,Me>ol&&M(Me),l.offset=Me;let E=Qae(Ue.subarray(t,Me),s.idsToInsert);return s=null,E}return P&Kae?(Ue.start=t,Ue.end=Me,Ue):Ue.subarray(t,Me)}finally{if(i){if(S<10&&S++,b>1e4)i.transitions=null,S=0,b=0,v.length>0&&(v=[]);else if(v.length>0&&!u){for(let E=0,D=v.length;E<D;E++)v[E][Yg]=0;v=[]}if(r&&l.saveStructures){let E=i.sharedLength||c;i.length>E&&(i=i.slice(0,E));let D=Ue.subarray(t,Me);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(C)):(a=E,D)}}P&Zae&&(Me=t)}};let _=C=>{Me>ol&&(Ue=M(Me));var P=typeof C,E;if(P==="string"){let D=C.length;if(ll&&D>=8&&D<4096){let N=Xae.test(C);ll[N?0:1]+=C,Ue[Me++]=193,_(N?-D:D);return}let I;D<32?I=1:D<256?I=2:D<65536?I=3:I=5;let O=D*3;if(Me+O>ol&&(Ue=M(Me+O)),D<64||!o){let N,k,U,Q=Me+I;for(N=0;N<D;N++)k=C.charCodeAt(N),k<128?Ue[Q++]=k:k<2048?(Ue[Q++]=k>>6|192,Ue[Q++]=k&63|128):(k&64512)===55296&&((U=C.charCodeAt(N+1))&64512)===56320?(k=65536+((k&1023)<<10)+(U&1023),N++,Ue[Q++]=k>>18|240,Ue[Q++]=k>>12&63|128,Ue[Q++]=k>>6&63|128,Ue[Q++]=k&63|128):(Ue[Q++]=k>>12|224,Ue[Q++]=k>>6&63|128,Ue[Q++]=k&63|128);E=Q-Me-I}else E=o(C,Me+I,O);E<32?Ue[Me++]=160|E:E<256?(I<2&&Ue.copyWithin(Me+2,Me+1,Me+1+E),Ue[Me++]=217,Ue[Me++]=E):E<65536?(I<3&&Ue.copyWithin(Me+3,Me+2,Me+2+E),Ue[Me++]=218,Ue[Me++]=E>>8,Ue[Me++]=E&255):(I<5&&Ue.copyWithin(Me+5,Me+3,Me+3+E),Ue[Me++]=219,Nr.setUint32(Me,E),Me+=4),Me+=E}else if(P==="number")if(C>>>0===C)C<64?Ue[Me++]=C:C<256?(Ue[Me++]=204,Ue[Me++]=C):C<65536?(Ue[Me++]=205,Ue[Me++]=C>>8,Ue[Me++]=C&255):(Ue[Me++]=206,Nr.setUint32(Me,C),Me+=4);else if(C>>0===C)C>=-32?Ue[Me++]=256+C:C>=-128?(Ue[Me++]=208,Ue[Me++]=C+256):C>=-32768?(Ue[Me++]=209,Nr.setInt16(Me,C),Me+=2):(Ue[Me++]=210,Nr.setInt32(Me,C),Me+=4);else{let D;if((D=this.useFloat32)>0&&C<4294967296&&C>=-2147483648){Ue[Me++]=202,Nr.setFloat32(Me,C);let I;if(D<4||(I=C*TM[(Ue[Me]&127)<<1|Ue[Me+1]>>7])>>0===I){Me+=4;return}else Me--}Ue[Me++]=203,Nr.setFloat64(Me,C),Me+=8}else if(P==="object")if(!C)Ue[Me++]=192;else{if(s){let I=s.get(C);if(I){if(!I.id){let O=s.idsToInsert||(s.idsToInsert=[]);I.id=O.push(I)}Ue[Me++]=214,Ue[Me++]=112,Nr.setUint32(Me,I.id),Me+=4;return}else s.set(C,{offset:Me-t})}let D=C.constructor;if(D===Object)T(C,!0);else if(D===Array){E=C.length,E<16?Ue[Me++]=144|E:E<65536?(Ue[Me++]=220,Ue[Me++]=E>>8,Ue[Me++]=E&255):(Ue[Me++]=221,Nr.setUint32(Me,E),Me+=4);for(let I=0;I<E;I++)_(C[I])}else if(D===Map){E=C.size,E<16?Ue[Me++]=128|E:E<65536?(Ue[Me++]=222,Ue[Me++]=E>>8,Ue[Me++]=E&255):(Ue[Me++]=223,Nr.setUint32(Me,E),Me+=4);for(let[I,O]of C)_(I),_(O)}else{for(let I=0,O=aw.length;I<O;I++){let N=PM[I];if(C instanceof N){let k=aw[I];if(k.write){k.type&&(Ue[Me++]=212,Ue[Me++]=k.type,Ue[Me++]=0),_(k.write.call(this,C));return}let U=Ue,Q=Nr,se=Me;Ue=null;let K;try{K=k.pack.call(this,C,H=>(Ue=U,U=null,Me+=H,Me>ol&&M(Me),{target:Ue,targetView:Nr,position:Me-H}),_)}finally{U&&(Ue=U,Nr=Q,Me=se,ol=Ue.length-10)}K&&(K.length+Me>ol&&M(K.length+Me),Me=Yae(K,Ue,Me,k.type));return}}T(C,!C.hasOwnProperty)}}else if(P==="boolean")Ue[Me++]=C?195:194;else if(P==="bigint"){if(C<BigInt(1)<<BigInt(63)&&C>=-(BigInt(1)<<BigInt(63)))Ue[Me++]=211,Nr.setBigInt64(Me,C);else if(C<BigInt(1)<<BigInt(64)&&C>0)Ue[Me++]=207,Nr.setBigUint64(Me,C);else if(this.largeBigIntToFloat)Ue[Me++]=203,Nr.setFloat64(Me,Number(C));else throw new RangeError(C+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Me+=8}else if(P==="undefined")this.encodeUndefinedAsNil?Ue[Me++]=192:(Ue[Me++]=212,Ue[Me++]=0,Ue[Me++]=0);else if(P==="function")_(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+P)},T=this.useRecords===!1?this.variableMapSize?C=>{let P=Object.keys(C),E=P.length;E<16?Ue[Me++]=128|E:E<65536?(Ue[Me++]=222,Ue[Me++]=E>>8,Ue[Me++]=E&255):(Ue[Me++]=223,Nr.setUint32(Me,E),Me+=4);let D;for(let I=0;I<E;I++)_(D=P[I]),_(C[D])}:(C,P)=>{Ue[Me++]=222;let E=Me-t;Me+=2;let D=0;for(let I in C)(P||C.hasOwnProperty(I))&&(_(I),_(C[I]),D++);Ue[E+++t]=D>>8,Ue[E+t]=D&255}:C=>{let P=Object.keys(C),E,D=n.transitions||(n.transitions=Object.create(null)),I=0;for(let N=0,k=P.length;N<k;N++){let U=P[N];E=D[U],E||(E=D[U]=Object.create(null),I++),D=E}let O=D[Yg];if(O)O>=96&&m?(Ue[Me++]=((O-=96)&31)+96,Ue[Me++]=O>>5):Ue[Me++]=O;else{O=n.nextId,O||(O=64),O<g&&this.shouldShareStructure&&!this.shouldShareStructure(P)?(O=n.nextOwnId,O<y||(O=g),n.nextOwnId=O+1):(O>=y&&(O=g),n.nextId=O+1);let N=P.highByte=O>=96&&m?O-96>>5:-1;D[Yg]=O,n[O-64]=P,O<g?(P.isShared=!0,n.sharedLength=O-63,r=!0,N>=0?(Ue[Me++]=(O&31)+96,Ue[Me++]=N):Ue[Me++]=O):(N>=0?(Ue[Me++]=213,Ue[Me++]=114,Ue[Me++]=(O&31)+96,Ue[Me++]=N):(Ue[Me++]=212,Ue[Me++]=114,Ue[Me++]=O),I&&(b+=S*I),v.length>=f&&(v.shift()[Yg]=0),v.push(D),_(P))}for(let N=0,k=P.length;N<k;N++)_(C[P[N]])},M=C=>{let P;if(C>16777216){if(C-t>aL)throw new Error("Packed buffer would be larger than maximum buffer size");P=Math.min(aL,Math.round(Math.max((C-t)*(C>67108864?1.25:2),4194304)/4096)*4096)}else P=(Math.max(C-t<<2,Ue.length-1)>>12)+1<<12;let E=new MA(P);return Nr=new DataView(E.buffer,0,P),Ue.copy?Ue.copy(E,0,t,C):E.set(Ue.slice(t,C)),Me-=t,t=0,ol=E.length-10,Ue=E}}useBuffer(e){Ue=e,Nr=new DataView(Ue.buffer,Ue.byteOffset,Ue.byteLength),Me=0}};PM=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,HU];aw=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?oL(e,16,t):lL(D_?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==ZU&&this.structuredClone?oL(e,QU.indexOf(i.name),t):lL(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function oL(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function lL(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function Yae(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function Qae(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function Vm(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");PM.unshift(e.Class),aw.unshift(e)}Wae(e)}var $U=new JU({useRecords:!1});$U.pack;$U.pack;var Kae=512,Zae=1024,uL=new JU({structuredClone:!0});Vm({Class:zt.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,zt.prototype),e}});Vm({Class:At.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,At.prototype),e}});Vm({Class:ts.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,ts.prototype),e}});Vm({Class:Zk.prototype.constructor,type:4,write(e){return e.id},read(e){return new Zk(e)}});Vm({Class:Jk.prototype.constructor,type:5,write(e){return e.data},read(e){return new Jk(e)}});Vm({Class:en.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,en.prototype),e}});function Jae(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function RT(e){if(bM(e))return e;if(Array.isArray(e))return e.map(RT);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=RT(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var OT;(e=>{function t(n){return uL.pack(n)}e.serialize=t;function i(n){return uL.unpack(n)}e.deserialize=i;function r(n){return Jae(t(RT(n))).toString()}e.checksum=r})(OT||(OT={}));var hL;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(hL||(hL={}));function cL(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var ps={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},dL;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new At}:{type:r,disabled:!1,key:void 0,actions:new At}}e.defaultData=i})(dL||(dL={}));var ow;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(ow||(ow={}));var kT;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:ow.propertyDefaultData(n),rOperand:{...ow.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(kT||(kT={}));var fL;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(fL||(fL={}));var pL;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new At,outActions:new At,condition:kT.distanceDefaultData(r)}}e.defaultData=i})(pL||(pL={}));var mL;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new At,drop:new At}})(mL||(mL={}));var LT;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new At})(LT||(LT={}));var zT;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(zT||(zT={}));var gL;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new At}}e.defaultData=i})(gL||(gL={}));var vL;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new At}}e.defaultData=i})(vL||(vL={}));var yL;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new At}}e.defaultData=i})(yL||(yL={}));var xL;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new At}}e.defaultData=i})(xL||(xL={}));var bL;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new At,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(bL||(bL={}));var NT;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new At},o={size:"tablet",operator:"<",actions:new At},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new At},u=new At;return u.push({id:ht.generateUUID(),fi:0,data:a},{id:ht.generateUUID(),fi:1,data:o},{id:ht.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:u}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new At}}e.defaultBreakpointData=s})(NT||(NT={}));var BT;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new At,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(BT||(BT={}));var wL;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new At,errorActions:new At,userAPIId:""}}e.defaultData=i})(wL||(wL={}));var _L;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new At,userWebhookId:""}}e.defaultData=i})(_L||(_L={}));var SL;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new At,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(SL||(SL={}));var EL;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new At}}e.defaultData=i})(EL||(EL={}));var jm="personal camera",Fv="a218fcc3-276b-49b9-b485-49037fd14f5f",$ae=2960946,Ma=5526619,Lu;(e=>{function t(g,y){return g[0]===y[0]&&g[1]===y[1]}e.isEqual=t;function i(g,y,v){return[g[0]+(y[0]-g[0])*v,g[1]+(y[1]-g[1])*v]}e.lerp=i;function r(g,y){return[g[0]+y[0],g[1]+y[1]]}e.add=r;function n(g,y){return[g[0]-y[0],g[1]-y[1]]}e.sub=n;function s(g,y){return[g[0]*y[0],g[1]*y[1]]}e.multiply=s;function a(g,y){return[g[0]/y[0],g[1]/y[1]]}e.divide=a;function o(g,y){return Math.pow(y[0]-g[0],2)+Math.pow(y[1]-g[1],2)}e.distanceSquared=o;function l(g,y){return Math.sqrt(o(g,y))}e.distance=l;function u(g,y){return g[0]*y[0]+g[1]*y[1]}e.dot=u;function h(g,y){return[g[0]*y,g[1]*y]}e.scalarMultiply=h;function c(g,y,v){let b=e.sub(y,g),S=e.sub(v,g),_=e.dot(b,S)/e.dot(b,b),T=e.scalarMultiply(b,_);return e.add(g,T)}e.projectionOnto=c;function f(g,y,v){return l(g,c(g,y,v))}e.projectionOntoDistance=f;function m(g,y){return[(g[0]+y[0])*.5,(g[1]+y[1])*.5]}e.center=m})(Lu||(Lu={}));var Ld;(e=>{function t(l,u){return l[0]===u[0]&&l[1]===u[1]&&l[2]===u[2]}e.isEqual=t;function i(l,u){return[l[0]+u[0],l[1]+u[1],l[2]+u[2]]}e.add=i;function r(l,u){return[l[0]-u[0],l[1]-u[1],l[2]-u[2]]}e.sub=r;function n(l,u){return[l[0]/u[0],l[1]/u[1],l[2]/u[2]]}e.div=n;function s(l,u){return[l[0]*u[0],l[1]*u[1],l[2]*u[2]]}e.mul=s;function a(l,u){return Math.hypot(l[0]-u[0],l[1]-u[1],l[2]-u[2])}e.dist=a;function o(l,u,h){return[l[0]+(u[0]-l[0])*h,l[1]+(u[1]-l[1])*h,l[2]+(u[2]-l[2])*h]}e.lerp=o})(Ld||(Ld={}));var lw;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(lw||(lw={}));var AL;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(AL||(AL={}));var fm;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let u=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/u,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/u,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/u}return a}e.applyMatrix4=r})(fm||(fm={}));var Jn;(e=>{function t(u){return typeof u=="object"&&typeof u.r=="number"&&typeof u.g=="number"&&typeof u.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(u){return{r:Math.round(u.r*255),g:Math.round(u.g*255),b:Math.round(u.b*255),a:1}}e.toRgb255a1=i;function r(u){return{r:u.r,g:u.g,b:u.b}}e.clone=r;function n(u){return u=Math.floor(u),{r:(u>>16&255)/255,g:(u>>8&255)/255,b:(u&255)/255}}e.fromHex=n;function s(u){return Math.round(u.r*255)*65536+Math.round(u.g*255)*256+Math.round(u.b*255)}e.toHex=s;function a(u,h){return u.r===h.r&&u.g===h.g&&u.b===h.b}e.equals=a;function o(u,h){return u.r.toFixed(2)===h.r.toFixed(2)&&u.g.toFixed(2)===h.g.toFixed(2)&&u.b.toFixed(2)===h.b.toFixed(2)}e.equalsFixed=o;function l(u,h,c){return{r:u.r+(h.r-u.r)*c,g:u.g+(h.g-u.g)*c,b:u.b+(h.b-u.b)*c}}e.lerp=l})(Jn||(Jn={}));var Ji;(e=>{e.white={...Jn.white,a:1},e.transparent={...Jn.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,u){return{...Jn.fromHex(l),a:u}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,u){return Jn.equals(l,u)&&l.a===u.a}e.equals=n;function s(l,u){return Jn.equalsFixed(l,u)&&l.a.toFixed(2)===u.a.toFixed(2)}e.equalsFixed=s;function a(l,u,h){return{r:l.r+(u.r-l.r)*h,g:l.g+(u.g-l.g)*h,b:l.b+(u.b-l.b)*h,a:l.a+(u.a-l.a)*h}}e.lerp=a;function o({r:l,g:u,b:h,a:c}=e.white){return`rgba(${l*255}, ${u*255}, ${h*255}, ${c})`}e.toStyle=o})(Ji||(Ji={}));var FT;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(FT||(FT={}));var CL;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(CL||(CL={}));var TL;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(TL||(TL={}));var Gh;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Gh||(Gh={}));function PL(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var jd;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(jd||(jd={}));var pm;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})(pm||(pm={}));var nc;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(eV.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;tV.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;iV.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;rV.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;nV.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;sV.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(nc||(nc={}));var UT;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(UT||(UT={}));var eV=["count"],tV=["radius","start","end","position","scale","rotation"],iV=["position","scale","rotation"],rV=["count","size"],nV=["count","position","scale","rotation"],sV=["strength","scale","rotation","position","movement","seed","freqScale"],VT;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(VT||(VT={}));var jT;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Ji.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Ji.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Ji.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(jT||(jT={}));var uw;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(uw||(uw={}));var mm;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(mm||(mm={}));var HT;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(HT||(HT={}));var GT;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(GT||(GT={}));var WT;(e=>e.defaultData={...GT.defaultData,...HT.defaultData})(WT||(WT={}));var ML;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(ML||(ML={}));var hw;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(hw||(hw={}));var DL;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(DL||(DL={}));function eoe(e){return e.type!=="displace"}var IL;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(IL||(IL={}));var aV=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],toe=["wrapping","image","video","name","minFilter","magFilter"],Dn;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let u=s.texture;u&&Object.assign(u,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:hw.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:Jn.fromHex(Ma)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Jn.fromHex(6710886),a:1},colorB:{...Jn.fromHex(6710886),a:1},colorC:{...Jn.fromHex(16777215),a:1},colorD:{...Jn.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:Ji.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Ji.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:Ji.fromHexAndA(0,1),contourColor:Ji.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Jn.fromHex(0),a:1},colorB:{...Jn.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Dn||(Dn={}));var Ln;(e=>{function t(h){return!h.layers.some(c=>c.data.type==="texture"&&c.data.projection!==0||c.data.type==="depth"&&!c.data.isWorldSpace||c.data.type==="noise"||c.data.type==="displace")}e.isMergable=t;function i(h){let c="";return h.layers.forEach(f=>{Object.entries(f.data).forEach(([m,g])=>{c+=`${m}${g}`,Array.isArray(g)?g.forEach(y=>c+=`${y}`):typeof g=="object"?Object.values(g).forEach(y=>{typeof y=="number"?c+=`${y.toFixed(4)}`:c+=`${y}`}):c+=`${g}`})}),c}e.getHash=i;function r(){return{layers:new At}}e.defaultEmptyData=r;function n(h="layer1",c="layer2"){return a("phong",h,c)}e.defaultData=n;function s(h,c){return{...h,name:c}}e.withName=s;function a(h,c="layer1",f="layer2"){let m=new At;return m.push({fi:0,data:Dn.defaultData("light",h),id:c}),m.push({fi:1,data:Dn.defaultData("color"),id:f}),{layers:m}}e.defaultTwoLayerData=a;function o(h){let c=Dn.defaultData("texture");h&&Object.assign(c.texture,{image:h});let f=new At;return f.push({fi:0,data:c,id:"layer1"}),f.push({fi:1,data:{...Dn.defaultData("transmission"),alpha:1},id:"layer2"}),f.push({fi:2,data:{...Dn.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:f}}e.defaultUIObjectMaterial=o;function l(h,c="phong",f="layer1",m="layer2"){let g=Dn.defaultData("texture");Object.assign(g.texture,{image:h});let y=new At;return y.push({fi:0,data:g,id:f}),y.push({fi:1,data:Dn.defaultData("light",c),id:m}),{layers:y}}e.defaultTwoLayerTextureData=l;function u(h,c="phong",f="layer1",m="layer2"){let g=Dn.defaultData("video");Object.assign(g.texture,{video:h});let y=new At;return y.push({fi:0,data:g,id:f}),y.push({fi:1,data:Dn.defaultData("light",c),id:m}),{layers:y}}e.defaultTwoLayerVideoTextureData=u})(Ln||(Ln={}));var cw;(e=>{function t(){return{points:new At,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(cw||(cw={}));var dw;(e=>{function t(){return{points:new At,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(dw||(dw={}));var oV={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},qT;(e=>{function t(i,r){let n={...i};return uV.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(qT||(qT={}));var lV={shape:oV,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},uV=["depth","offset","angle","twist","startScale","endScale"],fw;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(fw||(fw={}));var XT;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,qT.merge(n.extrusion,r.extrusion))),n}e.merge=t})(XT||(XT={}));var qh;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:dw.defaultData(),extrusion:lV};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:cw.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(qh||(qh={}));var DA=["width","height","depth"],YT;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:Jn.white,near:.1,far:2e3})(YT||(YT={}));var pw;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(pw||(pw={}));var QT;(e=>e.defaultData={softShadowQuality:"low"})(QT||(QT={}));var KT;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(KT||(KT={}));var ZT;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(ZT||(ZT={}));var gm;(e=>e.defaultData={usePhysics:!1,gravity:-10})(gm||(gm={}));var JT;(e=>e.defaultData={playCamera:jm,gameControlObject:null})(JT||(JT={}));var $T;(e=>e.defaultData={backgroundColor:Ji.fromHexAndA($ae,1),postprocessing:pw.defaultData,fog:YT.defaultData,globalPhysics:gm.defaultData,ambient:KT.defaultData,ao:ZT.defaultData,shadow:QT.defaultData,publish:JT.defaultData})($T||($T={}));var e2;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(e2||(e2={}));var RL;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(RL||(RL={}));var vm;(e=>{e.identity={...FT.identity,hiddenMatrix:fm.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return AU({position:Ld.isEqual(n.position,s.position)?void 0:s.position,rotation:Ld.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Ld.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:fm.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(vm||(vm={}));var pn;(e=>e.defaultData={states:new At,events:new At,visible:!0,raycastLock:!1,physics:mm.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...vm.identity,cloner:null})(pn||(pn={}));var t2;(e=>e.defaultData={type:"Empty",...pn.defaultData})(t2||(t2={}));var OL;(e=>e.defaultData={type:"ParticleCollider",...e2.defaultData,...pn.defaultData})(OL||(OL={}));var kL;(e=>e.defaultData={type:"Component",...pn.defaultData})(kL||(kL={}));var LL;(e=>e.defaultData={type:"Particle",...pn.defaultData,...uw.defaultData})(LL||(LL={}));var Xh;(e=>e.defaultData={type:"Mesh",...pn.defaultData,...WT.defaultData})(Xh||(Xh={}));var my;(e=>e.defaultData={...pn.defaultData,...vm.identity,position:[0,0,pm.DefaultTargetOffset],...pm.defaultData})(my||(my={}));var i2;(e=>{function t(i){return{...pn.defaultData,...jT.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(i2||(i2={}));var mw;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(mw||(mw={}));var sc;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...pn.defaultData,...n,component:r,overrides:new en,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=vm.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(sc||(sc={}));var ym;(e=>{e.defaultData={type:"Page",...pn.defaultData,physics:{...mm.defaultData,fusedBody:!1},...$T.defaultData,camera:my.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(ym||(ym={}));var r2;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:fm.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:mm.defaultData,states:new At,events:new At,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...pm.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...pn.defaultData,...Xh.defaultData,geometry:qh.defaultData("RectangleGeometry"),material:Ln.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...pn.defaultData,...Xh.defaultData,geometry:qh.defaultData("BooleanGeometry"),material:Ln.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...pn.defaultData,...Xh.defaultData,geometry:qh.defaultData("ShapeBlendGeometry"),material:Ln.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...pn.defaultData,...Xh.defaultData,geometry:qh.defaultData("TextGeometry"),material:Ln.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...pn.defaultData,...Xh.defaultData,geometry:qh.defaultData("InputGeometry"),material:Ln.defaultTwoLayerData("phong","layer1","layer2")}))(r2||(r2={}));var Sd;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new en}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new en})))):jd.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=py(o.material,l=>{if(typeof l!="string")for(let[u,h]of Object.entries(a.material.layers)){let c=l.layers.data(u);c&&Dn.patch(c,h)}}).data),o.materials&&a.materials&&(o.materials=py(o.materials,l=>{var u,h;for(let c=0;c<o.materials.length;c++){let f=a.materials[c];if(typeof f!="string")for(let[m,g]of Object.entries(f.layers)){let y=(h=(u=l[c])==null?void 0:u.layers)==null?void 0:h.data(m);y&&Dn.patch(y,g)}}}).data),o}function r(s,a){let o,l=[],u={orthographic:0,perspective:0,geometry:0};function h(c,f){for(let[m,g]of Object.entries(f.layers)){let{texture:y,...v}=g;if(y!==void 0&&Object.keys(y).length>0){let b={path:[...c,"layers",m,"texture"],props:y,type:0};l.push(b)}if(Object.keys(v).length>0){let b={path:[...c,"layers",m],props:v,type:0};l.push(b)}}}for(let[c,f]of Object.entries(a))if(c!=="name")if(c==="cloner")l.push(...UT.toOps(f,["cloner"]));else if(c==="pathSnapping")l.push({path:[c],props:{slide:f.slide,offset:f.offset},type:0});else if(c==="material")h(["material"],f);else if(c==="materials")for(let[m,g]of Object.entries(f))h(["materials",m],g);else if(u[c]===0){if(c==="geometry"&&f.extrusion!==void 0){let m={path:[c,"extrusion"],props:f.extrusion,type:0};l.push(m),f={...f},delete f.extrusion}if(Object.keys(f).length>0){let m={path:[c],props:f,type:0};l.push(m)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[c]=f;return l}e.toOps=r;function n(s,a){var l,u,h,c,f,m;if(a===void 0)return s;let o={...s};if(Object.assign(o,vm.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((u=o.pathSnapping)==null?void 0:u.slide)??0,offset:((h=a.pathSnapping)==null?void 0:h.offset)??((c=o.pathSnapping)==null?void 0:c.offset)??0})}),jd.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let g=a;((f=g.orthographic)==null?void 0:f.zoom)!==void 0&&(o.orthographic.zoom=g.orthographic.zoom),((m=g.perspective)==null?void 0:m.zoom)!==void 0&&(o.perspective.zoom=g.perspective.zoom),g.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=g.isUpVectorFlipped),g.targetOffset!==void 0&&(o.targetOffset=g.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:XT.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:nc.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:nc.merge(o.cloner,a.cloner)});else if(VT.is(s.type)){let g=a;g.intensity!==void 0&&(o.intensity=g.intensity),g.color!==void 0&&(typeof g.color=="string"?o.color=g.color:o.color=Jn.clone(g.color))}return o}e.patch=n})(Sd||(Sd={}));var gw;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(gw||(gw={}));var ac;(e=>e.defaultData={orbitControls:gw.defaultData,playPage:Fv,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(ac||(ac={}));var n2;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(n2||(n2={}));var s2;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(s2||(s2={}));var Ed;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...n2.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:s2.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(Ed||(Ed={}));var gy;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let u=(l=xw.getComponentData(r,o.component))==null?void 0:l.data;u&&s(a,o,u.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(gy||(gy={}));var Ad;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:i2.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=r2.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new ts;return l.push({fi:1,id:Fv,data:{...ym.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:ac.defaultData,styles:Ed.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new ts,publish:ac.defaultData,styles:Ed.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:ac.defaultData,styles:Ed.defaultData()}},e.emptyData=function(){return{objects:new ts,publish:{...ac.defaultData},styles:Ed.defaultData()}};function i(n){return{...e.defaultData,objects:no(n,ts.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(Ad||(Ad={}));var Uv;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(Uv||(Uv={}));var a2;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new At}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(a2||(a2={}));var zL;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new At,queries:new At,autoStart:!0}))(zL||(zL={}));var is;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(is||(is={}));var o2;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(o2||(o2={}));var NL;(e=>e.all=[...o2.all,"components"])(NL||(NL={}));var BL;(e=>{function t(){return{images:new zt,videos:new zt,colors:new zt,audios:new zt,particles:new zt,fonts:new zt,materials:new zt,components:new zt,variables:new zt,userAPIs:new zt,userWebhooks:new zt}}e.defaultData=t})(BL||(BL={}));var Xu;(e=>{function t(){return{images:new zt,videos:new zt,colors:new zt,audios:new zt,particles:new zt,fonts:new zt,materials:new zt,components:new zt,variables:new zt,userAPIs:new zt,userWebhooks:new zt}}e.defaultData=t})(Xu||(Xu={}));var Xa;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},no(a,zt.prototype)}e.defaultColors=t;function i(){return no({},zt.prototype)}e.defaultImages=i;function r(){return{catelogs:new zt,materials:new zt,images:new zt,videos:new zt,colors:new zt,audios:new zt,particles:new zt,fonts:new zt,variables:new At,userAPIs:new zt,userWebhooks:new zt,lib:Xu.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),u=Math.floor((a-l*3600)/60),h=Math.round(a-l*3600-u*60);return{textValue:[l,u,h]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),u=Math.round(a-l*60);return{textValue:[l,u]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(Xa||(Xa={}));var vw;(e=>e.list=["idle","move","jump","run"])(vw||(vw={}));var yw;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new At,move:new At,jump:new At,run:new At},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Ji.fromHexAndA(3728051,1)}}))(yw||(yw={}));function FL(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...kl(Ur(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...Ur(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Yh(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Qh(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Ln.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Ln.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Ln.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==en.prototype&&t(n.material)})})}function ioe(e){Object.assign(e.scene.publish,{orbitControls:{...gw.defaultData,...Ur(e.scene.publish.orbitControls)}})}function roe(e){Object.assign(e.scene.publish.settings,{video:{...ac.defaultData.settings.video,...Ur(e.scene.publish.settings.video)}})}function noe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((aV.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(toe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function soe(e){e.scene.publish.withBackground=!0}function aoe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function ooe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function loe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function uoe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=Ur(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Ur(i).booleanExclude!==!0)}})}function hoe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function coe(e){function t(r){Object.setPrototypeOf(r,en.prototype),r.texture&&Object.setPrototypeOf(r.texture,en.prototype)}function i(r){Object.setPrototypeOf(r,en.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=Ur(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],u=Ur(l).layers;i(u),l.layers=u}})})}function UL(e){e.layers===void 0&&Object.assign(e,Ln.defaultTwoLayerData("lambert"))}function IA(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...Ur(t),colors:i,steps:r};Object.assign(t,n)}})}function doe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function VL(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&IA(r)}):"material"in i&&typeof i.material!="string"&&IA(i.material)}),Object.values(e.shared.materials).forEach(t=>IA(t))}function foe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function poe(e){e.shared.audios=no({},zt.prototype)}function moe(e){e.shared.videos=no({},zt.prototype)}function goe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function voe(e){Object.entries(Ur(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Ur(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function yoe(e){e.scene.publish.settings.web.preload=!1}function jL(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function HL(e){e.layers&&e.layers.forEach(t=>{eoe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function xoe(e){e.shared.fonts=no({},zt.prototype)}function boe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function woe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Ln.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=boe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...pn.defaultData,...Xh.defaultData,flatShading:!1,wireframe:!1,geometry:{...qh.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Ur(n.states),events:Ur(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},u=Ur(e.scene.objects).parent(i);e.scene.objects.insertAfter(u??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function _oe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new At,move:new At,jump:new At}});else{let s=new At;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:ht.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let u={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},h={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(h,kl(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(h,{control1:{...a.control1},control2:{...a.control2}});let c={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},f={state:a.state,...c,...h},m={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new At({fi:0,id:ht.generateUUID(),data:u},{fi:1,id:ht.generateUUID(),data:f})};s.push({fi:l,id:o,data:m})}),delete n.targets)}})})}function Soe(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new At,o=[];if(i.events.forEach((u,h,c)=>{if(u.type==="Audio"&&u.trigger===s){let f;o.push(h),u.interaction==="play"?f={...kl(u,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in u?u.after:void 0,toggle:"after"in u?u.toggle:void 0,type:"Audio"}:(u.interaction==="pause"||u.interaction==="stop")&&(f={...kl(u,"interaction","delay","object","playAudio"),type:"Audio"}),f&&a.push({fi:c,id:h,data:f})}}),o.forEach(u=>i.events.delete(u)),a.length){let u=(l=i.events.find(h=>h.type===n))==null?void 0:l.data;u?"actions"in u&&u.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:ht.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function GL(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=Dn.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function WL(e){Yh(e,GL),Qh(e,GL)}function Eoe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function Aoe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function Coe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Ln.defaultTwoLayerData("phong"))})}function Toe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function Poe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function Moe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function Doe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function Ioe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function Roe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function Ooe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=yw.defaultDataThirdPerson.navmesh)})})}function koe(e){e.scene.styles||(e.scene.styles=Ed.defaultData())}function qL(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function Loe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Qh(e,qL),Yh(e,qL)}function zoe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new At})})})}function Noe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function XL(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function Boe(e,t){if(t<1&&(Qh(e,FL),Yh(e,FL),e.schema=1),t<2&&(ioe(e),e.schema=2),t<3&&(noe(e),e.schema=3),t<4&&(soe(e),e.schema=4),t<5&&(aoe(e),e.schema=5),t<6&&(ooe(e),e.schema=6),t<7&&(loe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(VL(e),e.schema=9),t<10&&(doe(e),e.schema=10),t<11&&(foe(e),e.schema=11),t<12&&(VL(e),e.schema=12),t<13&&(poe(e),e.schema=13),t<14&&(goe(e),e.schema=14),t<15&&(voe(e),e.schema=15),t<16&&(yoe(e),e.schema=16),t<17&&(Qh(e,jL),Yh(e,jL),e.schema=17),t<18&&(Qh(e,UL),Yh(e,UL),e.schema=18),t<19&&(roe(e),e.schema=19),t<20&&(xoe(e),woe(e),e.schema=20),t<21&&(_oe(e),Soe(e),e.schema=21),t<22&&(WL(e),e.schema=22),t<23&&(Eoe(e),e.schema=23),t<24&&(Aoe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(moe(e),t<25&&(e.schema=25)),t<26&&(uoe(e),e.schema=26),t<27&&(hoe(e),e.schema=27),t<28&&(WL(e),e.schema=28),t<29&&(coe(e),e.schema=29),t<30&&(Coe(e),e.schema=30),t<31&&(Toe(e),e.schema=31),t<33&&(Poe(e),e.schema=33),t<34&&(Moe(e),e.schema=34),t<35&&(Doe(e),e.schema=35),t<36&&(Ioe(e),e.schema=36),t<37&&(Roe(e),e.schema=37),t<38&&(Qh(e,HL),Yh(e,HL),e.schema=38),t<39&&(Ooe(e),e.schema=39),t<40&&(koe(e),e.schema=40),t<41&&(Loe(e),e.schema=41),t<42&&(zoe(e),e.schema=42),t<43&&(Noe(e),e.schema=43),t<99){Qh(e,XL),Yh(e,XL),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=jm);let i=Ur(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=Fv,r.insertBefore(null,null,[{id:Fv,data:{...ym.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:kl(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:kl(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...gm.defaultData,...kl(e.scene.environment,"usePhysics","gravity")},camera:Ur(e.scene.ownerCamera)??ym.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==Ad.TRASH_CAN_ID&&r.move(Fv,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,mm.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function YL(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function Foe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function Uoe(e){var t;Array.isArray(Ur(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var Cp=180/Math.PI;function QL(e){e.rotation=e.rotation.slice(0,3).map(t=>t*Cp)}function hV(e){var i,r;QL(e),e.type==="Page"&&QL(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*Cp))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*Cp),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*Cp),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=Cp,t.extrusion.twist*=Cp),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Ur(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function Voe(e){e.shared.variables=no({},zt.prototype)}function joe(e){let t=Ur(e.shared.variables);e.shared.variables=no(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),At.prototype)}var Au=115;function cV(e,t){t(e.data);for(let i of e.children)cV(i,t)}function Hoe(e){let t=e.schema??104;t!==Au&&t<105&&(cV(e.asset,hV),e.schema=105)}function Goe(e){e.shared.particles=no({},zt.prototype),e.shared.lib&&(e.shared.lib.particles=Xu.defaultData().particles)}function Woe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function qoe(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function Xoe(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(Ur(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,u,h,c,f,m,g,y,v;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(b=>{b.type==="Transition"&&(b.runMode=s??"Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(b=>{var S;(S=n.gameActions[b])==null||S.forEach(_=>{_.type==="Transition"&&(_.runMode="Repeat"),_.type==="Animation"&&(_.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(u=(l=n.dragDropActions)==null?void 0:l.drag)==null||u.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}),(c=(h=n.dragDropActions)==null?void 0:h.drop)==null||c.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(f=n.breakpoints)==null||f.forEach(b=>{var S;(S=b.actions)==null||S.forEach(_=>{(_.type==="Transition"||_.type==="Animation"||_.type==="SwitchCamera")&&(_.runMode="Toggle")})})):n.type==="Start"?(m=n.actions)==null||m.forEach(b=>{b.type==="Transition"&&(b.runMode="Once"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(g=n.actions)==null||g.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(y=n.inActions)==null||y.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}),(v=n.outActions)==null||v.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}))}))})}function Yoe(e){e.shared.userAPIs=no({},zt.prototype),e.shared.userWebhooks=no({},zt.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Xu.defaultData().userAPIs,e.shared.lib.userWebhooks=Xu.defaultData().userWebhooks)}function dV(e){let t=e.schema??0;if(t!==Au){console.warn("updating from ",t,"to ",Au),Boe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=ac.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Qh(e,YL),Yh(e,YL),e.schema=101),t<102&&(Foe(e),e.schema=102),t<104&&(e.shared.catelogs=new zt,e.shared.lib=Xu.defaultData(),e.schema=104),t<105&&(Voe(e),e.scene.objects.traverse((i,r)=>{hV(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))Hoe(i);t<106&&(joe(e),e.schema=106),t<107&&(e.shared.lib.variables=Xu.defaultData().variables,e.schema=107),t<109&&(Goe(e),e.schema=109),t<110&&(Woe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{Uoe(r)}),e.schema=111),t<112&&(qoe(e),e.schema=112),t<113&&(Xoe(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(Yoe(e),e.schema=115)}}var xw;(e=>{e.defaultData={schema:Au,scene:Ad.defaultData,frames:new zt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Uv.defaultData),shared:{...Xa.emptyData(),colors:Xa.defaultColors()}},e.emptyDataForImports=function(){let s=Ad.emptyDataWithPage();return{schema:Au,scene:s,frames:new zt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Uv.defaultData),shared:{...Xa.emptyData(),colors:Xa.defaultColors(),images:Xa.defaultImages()}}},e.emptyData=function(){return{schema:Au,scene:Ad.emptyDataWithPage(),frames:new zt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Uv.defaultData),shared:Xa.emptyData()}},e.clipboard2dData=function(){return{schema:Au,scene:Ad.emptyData(),frames:new zt,shared:Xa.emptyData()}},e.collabHelper={...PT,updateSchema(s){return(s.schema??0)<Au?py(s,dV):(s.schema??0)-Au}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:Xu.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let u of l)if(u.data.key.toLowerCase()==="authorization"&&u.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(xw||(xw={}));var l2;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(l2||(l2={}));var KL;(e=>{function t(i){return!0}e.is=t})(KL||(KL={}));var bw;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return AU({position:Lu.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Lu.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Lu.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(bw||(bw={}));var u2;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(u2||(u2={}));var ZL;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(ZL||(ZL={}));var ww;(e=>e.defaultData={opacity:1,fill:{color:Ji.fromHexAndA(Ma,1),enabled:!0},stroke:{color:Ji.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:Ji.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:Ji.from0to1([0,0,0,1]),enabled:!1,spread:0}})(ww||(ww={}));var Cd;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},u=["width","height","cornerRadius"];for(let h of u)h in l&&h in o&&o[h]!==void 0&&Object.assign(l,{[h]:o[h]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,bw.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,u=[];for(let[h,c]of Object.entries(o))h!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},u.push(l)),l.props[h]=c);return u}e.toOps=s})(Cd||(Cd={}));var vy;(e=>e.defaultData={...bw.defaultData,...u2.defaultData,states:new At,events:new At,visible:!0,raycastLock:!1})(vy||(vy={}));var xm;(e=>e.defaultData={...vy.defaultData,...ww.defaultData})(xm||(xm={}));var _w;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(_w||(_w={}));var h2;(e=>e.defaultData={...xm.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(h2||(h2={}));var yy;(e=>e.defaultData={...xm.defaultData,..._w.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(yy||(yy={}));var c2;(e=>e.defaultData={...xm.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(c2||(c2={}));var d2;(e=>e.defaultData={...xm.defaultData,type:"path2d",path:"",name:"Path"})(d2||(d2={}));var JL;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(JL||(JL={}));var Sw;(e=>e.defaultData={...vy.defaultData,name:"Group",type:"group2d"})(Sw||(Sw={}));var f2;(e=>e.defaultData=()=>({...vy.defaultData,..._w.defaultData,...ww.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:Ji.fromHexAndA(4737101,1),enabled:!0},stroke:{color:Ji.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(f2||(f2={}));var zd;(e=>{function t(a){switch(a){case"rectangle2d":return{...yy.defaultData};case"ellipse2d":return{...h2.defaultData};case"text2d":return{...c2.defaultData};case"vector2d":return{...yy.defaultData};case"path2d":return{...d2.defaultData};case"frame2d":return{...f2.defaultData()};case"group2d":return{...Sw.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(zd||(zd={}));var p2;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new ts},e.emptyData=function(){return{type:"scene2d",objects:new ts}}))(p2||(p2={}));function Td(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new St,u=0;for(let h=0;h<e.length;++h){let c=e[h],f=0;if(i!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let m in c.attributes){if(!r.has(m))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.'),null;s[m]===void 0&&(s[m]=[]),s[m].push(c.attributes[m]),f++}if(f!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let m in c.morphAttributes){if(!n.has(m))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;a[m]===void 0&&(a[m]=[]),a[m].push(c.morphAttributes[m])}if(t){let m;if(i)m=c.index.count;else if(c.attributes.position!==void 0)m=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(u,m,h),u+=m}}if(i){let h=0,c=[];for(let f=0;f<e.length;++f){let m=e[f].index;for(let g=0;g<m.count;++g)c.push(m.getX(g)+h);h+=e[f].attributes.position.count}l.setIndex(c)}for(let h in s){let c=$L(s[h]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,c)}for(let h in a){let c=a[h][0].length;if(c===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let f=0;f<c;++f){let m=[];for(let y=0;y<a[h].length;++y)m.push(a[h][y][f]);let g=$L(m);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(g)}}return l}function $L(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new Bt(s,i,r)}var Qoe=Math.pow(2,-24),nx=class{constructor(){}};function Pl(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function ez(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function tz(e,t){t.set(e)}function iz(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function sx(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function Qg(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function Koe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new Bt(n,1));for(let s=0;s<i;s++)n[s]=s}}function Zoe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function RA(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,h=-1/0,c=1/0,f=1/0,m=1/0,g=-1/0,y=-1/0,v=-1/0,b=n!==null;for(let S=t*6,_=(t+i)*6;S<_;S+=6){let T=e[S+0],M=e[S+1],C=T-M,P=T+M;C<s&&(s=C),P>l&&(l=P),b&&T<c&&(c=T),b&&T>g&&(g=T);let E=e[S+2],D=e[S+3],I=E-D,O=E+D;I<a&&(a=I),O>u&&(u=O),b&&E<f&&(f=E),b&&E>y&&(y=E);let N=e[S+4],k=e[S+5],U=N-k,Q=N+k;U<o&&(o=U),Q>h&&(h=Q),b&&N<m&&(m=N),b&&N>v&&(v=N)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=u,r[5]=h,b&&(n[0]=c,n[1]=f,n[2]=m,n[3]=g,n[4]=y,n[5]=v)}function Joe(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,u=-1/0;for(let h=t*6,c=(t+i)*6;h<c;h+=6){let f=e[h+0];f<n&&(n=f),f>o&&(o=f);let m=e[h+2];m<s&&(s=m),m>l&&(l=m);let g=e[h+4];g<a&&(a=g),g>u&&(u=g)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=u}function $oe(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let u=0;u<3;u++){let h=e[s*3+u];e[s*3+u]=e[a*3+u],e[a*3+u]=h;let c=t[s*6+u*2+0];t[s*6+u*2+0]=t[a*6+u*2+0],t[a*6+u*2+0]=c;let f=t[s*6+u*2+1];t[s*6+u*2+1]=t[a*6+u*2+1],t[a*6+u*2+1]=f}s++,a--}else return s}}var bu=32,ele=(e,t)=>e.candidate-t.candidate,Rh=new Array(bu).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),ax=new Float32Array(6);function tle(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=ez(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=ez(e),a!==-1&&(o=ile(i,r,n,a));else if(s===2){let l=Qg(e),u=1.25*n,h=r*6,c=(r+n)*6;for(let f=0;f<3;f++){let m=t[f],g=(t[f+3]-m)/bu;if(n<bu/4){let y=[...Rh];y.length=n;let v=0;for(let S=h;S<c;S+=6,v++){let _=y[v];_.candidate=i[S+2*f],_.count=0;let{bounds:T,leftCacheBounds:M,rightCacheBounds:C}=_;for(let P=0;P<3;P++)C[P]=1/0,C[P+3]=-1/0,M[P]=1/0,M[P+3]=-1/0,T[P]=1/0,T[P+3]=-1/0;sx(S,i,T)}y.sort(ele);let b=n;for(let S=0;S<b;S++){let _=y[S];for(;S+1<b&&y[S+1].candidate===_.candidate;)y.splice(S+1,1),b--}for(let S=h;S<c;S+=6){let _=i[S+2*f];for(let T=0;T<b;T++){let M=y[T];_>=M.candidate?sx(S,i,M.rightCacheBounds):(sx(S,i,M.leftCacheBounds),M.count++)}}for(let S=0;S<b;S++){let _=y[S],T=_.count,M=n-_.count,C=_.leftCacheBounds,P=_.rightCacheBounds,E=0;T!==0&&(E=Qg(C)/l);let D=0;M!==0&&(D=Qg(P)/l);let I=1+1.25*(E*T+D*M);I<u&&(a=f,u=I,o=_.candidate)}}else{for(let b=0;b<bu;b++){let S=Rh[b];S.count=0,S.candidate=m+g+b*g;let _=S.bounds;for(let T=0;T<3;T++)_[T]=1/0,_[T+3]=-1/0}for(let b=h;b<c;b+=6){let S=~~((i[b+2*f]-m)/g);S>=bu&&(S=bu-1);let _=Rh[S];_.count++,sx(b,i,_.bounds)}let y=Rh[bu-1];tz(y.bounds,y.rightCacheBounds);for(let b=bu-2;b>=0;b--){let S=Rh[b],_=Rh[b+1];iz(S.bounds,_.rightCacheBounds,S.rightCacheBounds)}let v=0;for(let b=0;b<bu-1;b++){let S=Rh[b],_=S.count,T=S.bounds,M=Rh[b+1].rightCacheBounds;_!==0&&(v===0?tz(T,ax):iz(T,ax,ax)),v+=_;let C=0,P=0;v!==0&&(C=Qg(ax)/l);let E=n-v;E!==0&&(P=Qg(M)/l);let D=1+1.25*(C*v+P*E);D<u&&(a=f,u=D,o=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function ile(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function rle(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);let h=["getX","getY","getZ"];for(let c=0;c<n;c++){let f=c*3,m=c*6,g,y,v;a?(g=r[f+0],y=r[f+1],v=r[f+2]):(g=r[f+0]*u+l,y=r[f+1]*u+l,v=r[f+2]*u+l);for(let b=0;b<3;b++){let S,_,T;a?(S=i[h[b]](g),_=i[h[b]](y),T=i[h[b]](v)):(S=o[g+b],_=o[y+b],T=o[v+b]);let M=S;_<M&&(M=_),T<M&&(M=T);let C=S;_>C&&(C=_),T>C&&(C=T);let P=(C-M)/2,E=b*2;s[m+E+0]=M+P,s[m+E+1]=P+(Math.abs(M)+P)*Qoe,M<t[b]&&(t[b]=M),C>t[b+3]&&(t[b+3]=C)}}return s}function nle(e,t){function i(b){f&&f(b/m)}function r(b,S,_,T=null,M=0){if(!g&&M>=l&&(g=!0,u&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),_<=h||M>=l)return i(S+_),b.offset=S,b.count=_,b;let C=tle(b.boundingData,T,a,S,_,c);if(C.axis===-1)return i(S+_),b.offset=S,b.count=_,b;let P=$oe(o,a,S,_,C);if(P===S||P===S+_)i(S+_),b.offset=S,b.count=_;else{b.splitAxis=C.axis;let E=new nx,D=S,I=P-S;b.left=E,E.boundingData=new Float32Array(6),RA(a,D,I,E.boundingData,s),r(E,D,I,s,M+1);let O=new nx,N=P,k=_-I;b.right=O,O.boundingData=new Float32Array(6),RA(a,N,k,O.boundingData,s),r(O,N,k,s,M+1)}return b}Koe(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=rle(e,n),o=e.index.array,l=t.maxDepth,u=t.verbose,h=t.maxLeafTris,c=t.strategy,f=t.onProgress,m=e.index.count/3,g=!1,y=[],v=Zoe(e);if(v.length===1){let b=v[0],S=new nx;S.boundingData=n,Joe(a,b.offset,b.count,s),r(S,b.offset,b.count,s),y.push(S)}else for(let b of v){let S=new nx;S.boundingData=new Float32Array(6),RA(a,b.offset,b.count,S.boundingData,s),r(S,b.offset,b.count,s),y.push(S)}return y}function sle(e,t){let i=nle(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let c=i[h],f=l(c),m=new o(32*f);r=new Float32Array(m),n=new Uint32Array(m),s=new Uint16Array(m),u(0,c),a.push(m)}return a;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function u(h,c){let f=h/4,m=h/2,g=!!c.count,y=c.boundingData;for(let v=0;v<6;v++)r[f+v]=y[v];if(g){let v=c.offset,b=c.count;return n[f+6]=v,s[m+14]=b,s[m+15]=65535,h+32}else{let v=c.left,b=c.right,S=c.splitAxis,_;if(_=u(h+32,v),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[f+6]=_/4,_=u(_,b),n[f+7]=S,_}}}var Yu=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Yu.prototype.setFromBox=function(){let e=new L;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*u+n.z*(1-u);let h=t.dot(e);s=Math.min(h,s),a=Math.max(h,a)}this.min=s,this.max=a}}();var ale=function(){let e=new L,t=new L,i=new L;return function(r,n,s){let a=r.start,o=e,l=n.start,u=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let h=i.dot(u),c=u.dot(o),f=u.dot(u),m=i.dot(o),g=o.dot(o)*f-c*c,y,v;g!==0?y=(h*c-m*f)/g:y=0,v=(h+y*c)/f,s.x=y,s.y=v}}(),MM=function(){let e=new oe,t=new L,i=new L;return function(r,n,s,a){ale(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let u;o<0?u=r.start:u=r.end;let h;l<0?h=n.start:h=n.end;let c=t,f=i;if(r.closestPointToPoint(h,!0,t),n.closestPointToPoint(u,!0,i),c.distanceToSquared(h)<=f.distanceToSquared(u)){s.copy(c),a.copy(h);return}else{s.copy(u),a.copy(f);return}}}}(),ole=function(){let e=new L,t=new L,i=new ia,r=new eo;return function(n,s){let{radius:a,center:o}=n,{a:l,b:u,c:h}=s;if(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=h,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=u,r.end=h,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let c=s.getPlane(i);if(Math.abs(c.distanceToPoint(o))<=a){let f=c.projectPoint(o,t);if(s.containsPoint(f))return!0}return!1}}(),lle=1e-15;function rp(e){return Math.abs(e)<lle}var Qu=class extends $n{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new L),this.satBounds=new Array(4).fill().map(()=>new Yu),this.points=[this.a,this.b,this.c],this.sphere=new ua,this.plane=new ia,this.needsUpdate=!0}intersectsSphere(e){return ole(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],u=s[1];l.subVectors(e,t),u.setFromPoints(l,r);let h=n[2],c=s[2];h.subVectors(t,i),c.setFromPoints(h,r);let f=n[3],m=s[3];f.subVectors(i,e),m.setFromPoints(f,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Qu.prototype.closestPointToSegment=function(){let e=new L,t=new L,i=new eo;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,u,h=1/0;for(let c=0;c<3;c++){let f=(c+1)%3;i.start.copy(l[c]),i.end.copy(l[f]),MM(i,r,e,t),u=e.distanceToSquared(t),u<h&&(h=u,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),u=a.distanceToSquared(e),u<h&&(h=u,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),u=o.distanceToSquared(e),u<h&&(h=u,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(h)}}();Qu.prototype.intersectsTriangle=function(){let e=new Qu,t=new Array(3),i=new Array(3),r=new Yu,n=new Yu,s=new L,a=new L,o=new L,l=new L,u=new eo,h=new eo,c=new eo;return function(f,m=null,g=!1){this.needsUpdate&&this.update(),f.isExtendedTriangle?f.needsUpdate&&f.update():(e.copy(f),e.update(),f=e);let y=this.plane,v=f.plane;if(Math.abs(y.normal.dot(v.normal))>1-1e-10){let b=this.satBounds,S=this.satAxes;i[0]=f.a,i[1]=f.b,i[2]=f.c;for(let M=0;M<4;M++){let C=b[M],P=S[M];if(r.setFromPoints(P,i),C.isSeparated(r))return!1}let _=f.satBounds,T=f.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let M=0;M<4;M++){let C=_[M],P=T[M];if(r.setFromPoints(P,t),C.isSeparated(r))return!1}for(let M=0;M<4;M++){let C=S[M];for(let P=0;P<4;P++){let E=T[P];if(s.crossVectors(C,E),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return m&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),m.start.set(0,0,0),m.end.set(0,0,0)),!0}else{let b=this.points,S=!1,_=0;for(let k=0;k<3;k++){let U=b[k],Q=b[(k+1)%3];u.start.copy(U),u.end.copy(Q),u.delta(a);let se=S?h.start:h.end,K=rp(v.distanceToPoint(U));if(rp(v.normal.dot(a))&&K){h.copy(u),_=2;break}if((v.intersectLine(u,se)||K)&&!rp(se.distanceTo(Q))){if(_++,S)break;S=!0}}if(_===1&&f.containsPoint(h.end))return m&&(m.start.copy(h.end),m.end.copy(h.end)),!0;if(_!==2)return!1;let T=f.points,M=!1,C=0;for(let k=0;k<3;k++){let U=T[k],Q=T[(k+1)%3];u.start.copy(U),u.end.copy(Q),u.delta(o);let se=M?c.start:c.end,K=rp(y.distanceToPoint(U));if(rp(y.normal.dot(o))&&K){c.copy(u),C=2;break}if((y.intersectLine(u,se)||K)&&!rp(se.distanceTo(Q))){if(C++,M)break;M=!0}}if(C===1&&this.containsPoint(c.end))return m&&(m.start.copy(c.end),m.end.copy(c.end)),!0;if(C!==2)return!1;if(h.delta(a),c.delta(o),a.dot(o)<0){let k=c.start;c.start=c.end,c.end=k}let P=h.start.dot(a),E=h.end.dot(a),D=c.start.dot(a),I=c.end.dot(a),O=E<D,N=P<I;return P!==I&&D!==E&&O===N?!1:(m&&(l.subVectors(h.start,c.start),l.dot(a)>0?m.start.copy(h.start):m.start.copy(c.start),l.subVectors(h.end,c.end),l.dot(a)<0?m.end.copy(h.end):m.end.copy(c.end)),!0)}}}();Qu.prototype.distanceToPoint=function(){let e=new L;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Qu.prototype.distanceToTriangle=function(){let e=new L,t=new L,i=["a","b","c"],r=new eo,n=new eo;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let u=1/0;for(let h=0;h<3;h++){let c,f=i[h],m=s[f];this.closestPointToPoint(m,e),c=m.distanceToSquared(e),c<u&&(u=c,a&&a.copy(e),o&&o.copy(m));let g=this[f];s.closestPointToPoint(g,e),c=g.distanceToSquared(e),c<u&&(u=c,a&&a.copy(g),o&&o.copy(e))}for(let h=0;h<3;h++){let c=i[h],f=i[(h+1)%3];r.set(this[c],this[f]);for(let m=0;m<3;m++){let g=i[m],y=i[(m+1)%3];n.set(s[g],s[y]),MM(r,n,e,t);let v=e.distanceToSquared(t);v<u&&(u=v,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(u)}}();var Hl=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new L,this.max=new L,this.matrix=new je,this.invMatrix=new je,this.points=new Array(8).fill().map(()=>new L),this.satAxes=new Array(3).fill().map(()=>new L),this.satBounds=new Array(3).fill().map(()=>new Yu),this.alignedSatBounds=new Array(3).fill().map(()=>new Yu),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Hl.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){let c=1*l|2*u|4*h,f=r[c];f.x=l?i.x:t.x,f.y=u?i.y:t.y,f.z=h?i.z:t.z,f.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let u=s[l],h=n[l],c=1<<l,f=r[c];u.subVectors(a,f),h.setFromPoints(u,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Hl.prototype.intersectsBox=function(){let e=new Yu;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],u=n[o];if(e.setFromBox(l,t),u.isSeparated(e))return!1}return!0}}();Hl.prototype.intersectsTriangle=function(){let e=new Qu,t=new Array(3),i=new Yu,r=new Yu,n=new L;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let c=0;c<3;c++){let f=a[c],m=o[c];if(i.setFromPoints(m,t),f.isSeparated(i))return!1}let l=s.satBounds,u=s.satAxes,h=this.points;for(let c=0;c<3;c++){let f=l[c],m=u[c];if(i.setFromPoints(m,h),f.isSeparated(i))return!1}for(let c=0;c<3;c++){let f=o[c];for(let m=0;m<4;m++){let g=u[m];if(n.crossVectors(f,g),i.setFromPoints(n,t),r.setFromPoints(n,h),i.isSeparated(r))return!1}}return!0}}();Hl.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Hl.prototype.distanceToPoint=function(){let e=new L;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Hl.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new eo),i=new Array(12).fill().map(()=>new eo),r=new L,n=new L;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let u=a*a,h=s.min,c=s.max,f=this.points,m=1/0;for(let y=0;y<8;y++){let v=f[y];n.copy(v).clamp(h,c);let b=v.distanceToSquared(n);if(b<m&&(m=b,o&&o.copy(v),l&&l.copy(n),b<u))return Math.sqrt(b)}let g=0;for(let y=0;y<3;y++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){let S=(y+1)%3,_=(y+2)%3,T=v<<S|b<<_,M=1<<y|v<<S|b<<_,C=f[T],P=f[M];t[g].set(C,P);let E=e[y],D=e[S],I=e[_],O=i[g],N=O.start,k=O.end;N[E]=h[E],N[D]=v?h[D]:c[D],N[I]=b?h[I]:c[D],k[E]=c[E],k[D]=v?h[D]:c[D],k[I]=b?h[I]:c[D],g++}for(let y=0;y<=1;y++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){n.x=y?c.x:h.x,n.y=v?c.y:h.y,n.z=b?c.z:h.z,this.closestPointToPoint(n,r);let S=n.distanceToSquared(r);if(S<m&&(m=S,o&&o.copy(r),l&&l.copy(n),S<u))return Math.sqrt(S)}for(let y=0;y<12;y++){let v=t[y];for(let b=0;b<12;b++){let S=i[b];MM(v,S,r,n);let _=r.distanceToSquared(n);if(_<m&&(m=_,o&&o.copy(r),l&&l.copy(n),_<u))return Math.sqrt(_)}}return Math.sqrt(m)}}();var np=new L,sp=new L,ap=new L,ox=new oe,lx=new oe,ux=new oe,rz=new L,nz=new L,sz=new L,hx=new L;function ule(e,t,i,r,n,s){let a;return s===zn?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==bs,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function hle(e,t,i,r,n,s,a,o,l){np.fromBufferAttribute(t,s),sp.fromBufferAttribute(t,a),ap.fromBufferAttribute(t,o);let u=ule(e,np,sp,ap,hx,l);if(u){r&&(ox.fromBufferAttribute(r,s),lx.fromBufferAttribute(r,a),ux.fromBufferAttribute(r,o),u.uv=$n.getInterpolation(hx,np,sp,ap,ox,lx,ux,new oe)),n&&(ox.fromBufferAttribute(n,s),lx.fromBufferAttribute(n,a),ux.fromBufferAttribute(n,o),u.uv1=$n.getInterpolation(hx,np,sp,ap,ox,lx,ux,new oe)),i&&(rz.fromBufferAttribute(i,s),nz.fromBufferAttribute(i,a),sz.fromBufferAttribute(i,o),u.normal=$n.getInterpolation(hx,np,sp,ap,rz,nz,sz,new L),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));let h={a:s,b:a,c:o,normal:new L,materialIndex:0};$n.getNormal(np,sp,ap,h.normal),u.face=h,u.faceIndex=s}return u}function fV(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:u,normal:h,uv:c,uv1:f}=e.attributes,m=hle(i,u,h,c,f,a,o,l,t);return m?(m.faceIndex=r,n&&n.push(m),m):null}function cle(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)fV(e,t,i,a,s)}function dle(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let u=fV(e,t,i,o);u&&u.distance<s&&(a=u,s=u.distance)}return a}function Al(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,u=t+2;i&&(o=i.getX(t),l=i.getX(t+1),u=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(u),a.y=r.getY(u),a.z=r.getZ(u)}function az(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let u=e,h=t+e;u<h;u++)if(Al(a,u*3,o,l),a.needsUpdate=!0,r(a,u,n,s))return!0;return!1}var pV=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Kh(e,t){return t[e+15]===65535}function qp(e,t){return t[e+6]}function xy(e,t){return t[e+14]}function by(e){return e+8}function wy(e,t){return t[e+6]}function fle(e,t){return t[e+7]}var Fp=new jr,Ew=new L,ple=["x","y","z"];function m2(e,t,i,r,n){let s=e*2,a=Hm,o=pc,l=mc;if(Kh(s,o)){let u=qp(e,l),h=xy(s,o);cle(t,i,r,u,h,n)}else{let u=by(e);Aw(u,a,r,Ew)&&m2(u,t,i,r,n);let h=wy(e,l);Aw(h,a,r,Ew)&&m2(h,t,i,r,n)}}function g2(e,t,i,r){let n=e*2,s=Hm,a=pc,o=mc;if(Kh(n,a)){let l=qp(e,o),u=xy(n,a);return dle(t,i,r,l,u)}else{let l=fle(e,o),u=ple[l],h=r.direction[u]>=0,c,f;h?(c=by(e),f=wy(e,o)):(c=wy(e,o),f=by(e));let m=Aw(c,s,r,Ew)?g2(c,t,i,r):null;if(m){let y=m.point[u];if(h?y<=s[f+l]:y>=s[f+l+3])return m}let g=Aw(f,s,r,Ew)?g2(f,t,i,r):null;return m&&g?m.distance<=g.distance?m:g:m||g||null}}var mle=function(){let e,t,i=[],r=new pV(()=>new jr);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,u=null,h=0,c=0){function f(S){let _=S*2,T=pc,M=mc;for(;!Kh(_,T);)S=by(S),_=S*2;return qp(S,M)}function m(S){let _=S*2,T=pc,M=mc;for(;!Kh(_,T);)S=wy(S,M),_=S*2;return qp(S,M)+xy(_,T)}let g=s*2,y=Hm,v=pc,b=mc;if(Kh(g,v)){let S=qp(s,b),_=xy(g,v);return Pl(s,y,e),l(S,_,!1,c,h+s,e)}else{let S=by(s),_=wy(s,b),T=S,M=_,C,P,E,D;if(u&&(E=e,D=t,Pl(T,y,E),Pl(M,y,D),C=u(E),P=u(D),P<C)){T=_,M=S;let se=C;C=P,P=se,E=D}E||(E=e,Pl(T,y,E));let I=Kh(T*2,v),O=o(E,I,C,c+1,h+T),N;if(O===2){let se=f(T),K=m(T)-se;N=l(se,K,!0,c+1,h+T,E)}else N=O&&n(T,a,o,l,u,h,c+1);if(N)return!0;D=t,Pl(M,y,D);let k=Kh(M*2,v),U=o(D,k,P,c+1,h+M),Q;if(U===2){let se=f(M),K=m(M)-se;Q=l(se,K,!0,c+1,h+M,D)}else Q=U&&n(M,a,o,l,u,h,c+1);return!!Q}}}(),gle=function(){let e=new Qu,t=new Qu,i=new je,r=new Hl,n=new Hl;return function s(a,o,l,u,h=null){let c=a*2,f=Hm,m=pc,g=mc;if(h===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,u),h=r),Kh(c,m)){let y=o,v=y.index,b=y.attributes.position,S=l.index,_=l.attributes.position,T=qp(a,g),M=xy(c,m);if(i.copy(u).invert(),l.boundsTree)return Pl(a,f,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:C=>n.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(u),C.b.applyMatrix4(u),C.c.applyMatrix4(u),C.needsUpdate=!0;for(let P=T*3,E=(M+T)*3;P<E;P+=3)if(Al(t,P,v,b),t.needsUpdate=!0,C.intersectsTriangle(t))return!0;return!1}});for(let C=T*3,P=M+T*3;C<P;C+=3){Al(e,C,v,b),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let E=0,D=S.count;E<D;E+=3)if(Al(t,E,S,_),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let y=a+8,v=g[a+6];return Pl(y,f,Fp),!!(h.intersectsBox(Fp)&&s(y,o,l,u,h)||(Pl(v,f,Fp),h.intersectsBox(Fp)&&s(v,o,l,u,h)))}}}();function Aw(e,t,i,r){return Pl(e,t,Fp),i.intersectBox(Fp,r)}var v2=[],pb,Hm,pc,mc;function wv(e){pb&&v2.push(pb),pb=e,Hm=new Float32Array(e),pc=new Uint16Array(e),mc=new Uint32Array(e)}function cx(){pb=null,Hm=null,pc=null,mc=null,v2.length&&wv(v2.pop())}var OA=Symbol("skip tree generation"),kA=new jr,LA=new jr,op=new je,sd=new Hl,Kg=new Hl,Zg=new L,dx=new L,vle=new L,yle=new L,xle=new L,oz=new jr,ul=new pV(()=>new Qu),Vv=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Vv.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Vv.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new Vv(t,{...i,[OA]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new Bt(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[OA]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[OA]||(this._roots=sle(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new jr))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,u=this._roots;for(let c=0,f=u.length;c<f;c++)n=u[c],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),h(0,l),l+=n.byteLength;function h(c,f,m=!1){let g=c*2;if(a[g+15]===65535){let y=s[c+6],v=a[g+14],b=1/0,S=1/0,_=1/0,T=-1/0,M=-1/0,C=-1/0;for(let P=3*y,E=3*(y+v);P<E;P++){let D=i[P],I=r.getX(D),O=r.getY(D),N=r.getZ(D);I<b&&(b=I),I>T&&(T=I),O<S&&(S=O),O>M&&(M=O),N<_&&(_=N),N>C&&(C=N)}return o[c+0]!==b||o[c+1]!==S||o[c+2]!==_||o[c+3]!==T||o[c+4]!==M||o[c+5]!==C?(o[c+0]=b,o[c+1]=S,o[c+2]=_,o[c+3]=T,o[c+4]=M,o[c+5]=C,!0):!1}else{let y=c+8,v=s[c+6],b=y+f,S=v+f,_=m,T=!1,M=!1;e?_||(T=e.has(b),M=e.has(S),_=!T&&!M):(T=!0,M=!0);let C=_||T,P=_||M,E=!1;C&&(E=h(y,f,_));let D=!1;P&&(D=h(v,f,_));let I=E||D;if(I)for(let O=0;O<3;O++){let N=y+O,k=v+O,U=o[N],Q=o[N+3],se=o[k],K=o[k+3];o[c+O]=U<se?U:se,o[c+O+3]=Q>K?Q:K}return I}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,u=n[l+15]===65535;if(u){let h=r[a+6],c=n[l+14];e(o,u,new Float32Array(i,a*4,6),h,c)}else{let h=a+8,c=r[a+6],f=r[a+7];e(o,u,new Float32Array(i,a*4,6),f)||(s(h,o+1),s(c,o+1))}}}raycast(e,t=Uo){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let u=0,h=i.length;u<h;u++){let c=a?t[o[u].materialIndex].side:l,f=n.length;if(wv(i[u]),m2(0,r,c,e,n),cx(),a){let m=o[u].materialIndex;for(let g=f,y=n.length;g<y;g++)n[g].face.materialIndex=m}}return n}raycastFirst(e,t=Uo){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let u=0,h=i.length;u<h;u++){let c=s?t[o[u].materialIndex].side:l;wv(i[u]);let f=g2(0,r,c,e);cx(),f!=null&&(a==null||f.distance<a.distance)&&(a=f,s&&(f.face.materialIndex=o[u].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(wv(n),r=gle(0,i,e,t),cx(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let c=t;t=(f,m,g,y)=>{let v=m*3;return c(f,v,v+1,v+2,g,y)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=ul.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let c=o;o=(f,m,g,y,v)=>c(f,m,g,y,v)?!0:az(f,m,r,l,g,y,n)}else o||(l?o=(c,f,m,g)=>az(c,f,r,l,m,g,n):o=(c,f,m)=>m);let u=!1,h=0;for(let c of this._roots){if(wv(c),u=mle(0,r,a,o,s,h),cx(),u)break;h+=c.byteLength}return ul.releasePrimitive(n),u}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;op.copy(t).invert();let u=ul.getPrimitive(),h=ul.getPrimitive();if(n){let f=function(m,g,y,v,b,S,_,T){for(let M=y,C=y+v;M<C;M++){Al(h,M*3,o,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let P=m,E=m+g;P<E;P++)if(Al(u,P*3,s,a),u.needsUpdate=!0,n(u,h,P,M,b,S,_,T))return!0}return!1};if(r){let m=r;r=function(g,y,v,b,S,_,T,M){return m(g,y,v,b,S,_,T,M)?!0:f(g,y,v,b,S,_,T,M)}}else r=f}e.getBoundingBox(LA),LA.applyMatrix4(t);let c=this.shapecast({intersectsBounds:f=>LA.intersectsBox(f),intersectsRange:(f,m,g,y,v,b)=>(kA.copy(b),kA.applyMatrix4(op),e.shapecast({intersectsBounds:S=>kA.intersectsBox(S),intersectsRange:(S,_,T,M,C)=>r(f,m,S,_,y,v,M,C)}))});return ul.releasePrimitive(u),ul.releasePrimitive(h),c}intersectsBox(e,t){return sd.set(e.min,e.max,t),sd.needsUpdate=!0,this.shapecast({intersectsBounds:i=>sd.intersectsBox(i),intersectsTriangle:i=>sd.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),sd.set(e.boundingBox.min,e.boundingBox.max,t),sd.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,u=e.attributes.position,h=e.index,c=ul.getPrimitive(),f=ul.getPrimitive(),m=dx,g=vle,y=null,v=null;r&&(y=yle,v=xle);let b=1/0,S=null,_=null;return op.copy(t).invert(),Kg.matrix.copy(op),this.shapecast({boundsTraverseOrder:T=>sd.distanceToBox(T),intersectsBounds:(T,M,C)=>C<b&&C<s?(M&&(Kg.min.copy(T.min),Kg.max.copy(T.max),Kg.needsUpdate=!0),!0):!1,intersectsRange:(T,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:C=>Kg.distanceToBox(C),intersectsBounds:(C,P,E)=>E<b&&E<s,intersectsRange:(C,P)=>{for(let E=C*3,D=(C+P)*3;E<D;E+=3){Al(f,E,h,u),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let I=T*3,O=(T+M)*3;I<O;I+=3){Al(c,I,l,o),c.needsUpdate=!0;let N=c.distanceToTriangle(f,m,y);if(N<b&&(g.copy(m),v&&v.copy(y),b=N,S=I/3,_=E/3),N<n)return!0}}}});{let C=h?h.count:u.count;for(let P=0,E=C;P<E;P+=3){Al(f,P,h,u),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let D=T*3,I=(T+M)*3;D<I;D+=3){Al(c,D,l,o),c.needsUpdate=!0;let O=c.distanceToTriangle(f,m,y);if(O<b&&(g.copy(m),v&&v.copy(y),b=O,S=D/3,_=P/3),O<n)return!0}}}}}),ul.releasePrimitive(c),ul.releasePrimitive(f),b===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=b,i.faceIndex=S,r&&(r.point?r.point.copy(v):r.point=v.clone(),r.point.applyMatrix4(op),g.applyMatrix4(op),r.distance=g.sub(r.point).length(),r.faceIndex=_),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:u=>(Zg.copy(e).clamp(u.min,u.max),Zg.distanceToSquared(e)),intersectsBounds:(u,h,c)=>c<a&&c<s,intersectsTriangle:(u,h)=>{u.closestPointToPoint(e,Zg);let c=e.distanceToSquared(Zg);return c<a&&(dx.copy(Zg),a=c,o=h),c<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(dx):t.point=dx.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Pl(0,new Float32Array(t),oz),e.union(oz)}),e}},y2=Oc(b8()),ble=.5*(Math.sqrt(3)-1),Jg=(3-Math.sqrt(3))/6,wle=1/3,hl=1/6,jv=e=>Math.floor(e)|0,lz=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),zA=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function _le(e=Math.random){let t=mV(e),i=new Float64Array(t).map(n=>lz[n%12*2]),r=new Float64Array(t).map(n=>lz[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,u=(n+s)*ble,h=jv(n+u),c=jv(s+u),f=(h+c)*Jg,m=h-f,g=c-f,y=n-m,v=s-g,b,S;y>v?(b=1,S=0):(b=0,S=1);let _=y-b+Jg,T=v-S+Jg,M=y-1+2*Jg,C=v-1+2*Jg,P=h&255,E=c&255,D=.5-y*y-v*v;if(D>=0){let N=P+t[E],k=i[N],U=r[N];D*=D,a=D*D*(k*y+U*v)}let I=.5-_*_-T*T;if(I>=0){let N=P+b+t[E+S],k=i[N],U=r[N];I*=I,o=I*I*(k*_+U*T)}let O=.5-M*M-C*C;if(O>=0){let N=P+1+t[E+1],k=i[N],U=r[N];O*=O,l=O*O*(k*M+U*C)}return 70*(a+o+l)}}function Sle(e=Math.random){let t=mV(e),i=new Float64Array(t).map(s=>zA[s%12*3]),r=new Float64Array(t).map(s=>zA[s%12*3+1]),n=new Float64Array(t).map(s=>zA[s%12*3+2]);return function(s,a,o){let l,u,h,c,f=(s+a+o)*wle,m=jv(s+f),g=jv(a+f),y=jv(o+f),v=(m+g+y)*hl,b=m-v,S=g-v,_=y-v,T=s-b,M=a-S,C=o-_,P,E,D,I,O,N;T>=M?M>=C?(P=1,E=0,D=0,I=1,O=1,N=0):T>=C?(P=1,E=0,D=0,I=1,O=0,N=1):(P=0,E=0,D=1,I=1,O=0,N=1):M<C?(P=0,E=0,D=1,I=0,O=1,N=1):T<C?(P=0,E=1,D=0,I=0,O=1,N=1):(P=0,E=1,D=0,I=1,O=1,N=0);let k=T-P+hl,U=M-E+hl,Q=C-D+hl,se=T-I+2*hl,K=M-O+2*hl,H=C-N+2*hl,ie=T-1+3*hl,$=M-1+3*hl,V=C-1+3*hl,X=m&255,ue=g&255,ne=y&255,he=.6-T*T-M*M-C*C;if(he<0)l=0;else{let fe=X+t[ue+t[ne]];he*=he,l=he*he*(i[fe]*T+r[fe]*M+n[fe]*C)}let te=.6-k*k-U*U-Q*Q;if(te<0)u=0;else{let fe=X+P+t[ue+E+t[ne+D]];te*=te,u=te*te*(i[fe]*k+r[fe]*U+n[fe]*Q)}let me=.6-se*se-K*K-H*H;if(me<0)h=0;else{let fe=X+I+t[ue+O+t[ne+N]];me*=me,h=me*me*(i[fe]*se+r[fe]*K+n[fe]*H)}let de=.6-ie*ie-$*$-V*V;if(de<0)c=0;else{let fe=X+1+t[ue+1+t[ne+1]];de*=de,c=de*de*(i[fe]*ie+r[fe]*$+n[fe]*V)}return 32*(l+u+h+c)}}function mV(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var _o=new $n,Ele=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;_o.a.fromBufferAttribute(e,r),_o.b.fromBufferAttribute(e,r+1),_o.c.fromBufferAttribute(e,r+2),n*=_o.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),_o.a.fromBufferAttribute(this.positionAttribute,e*3),_o.b.fromBufferAttribute(this.positionAttribute,e*3+1),_o.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(_o.a,r).addScaledVector(_o.b,n).addScaledVector(_o.c,1-(r+n)),_o.getNormal(i),this}},Ale=Oc(QF()),Cle=new je,Tle=new je,Ple=new je,Hd;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(Hd||(Hd={}));var DM=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new je,this.copyPreviousMatrix=!0,this.hiddenMatrix=new je,this.matrixWorldRigid=new je,this.shearScale=new je,this.shearScaleInv=new je}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof qi&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)Hd.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Hd.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,Ale.SVD)(i),a=Cle.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=Tle.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=Ple.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(u=>Math.abs(s[0]-u)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new je().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof je?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},Mle=class extends DM(qi){},Dle=e=>e.type==="Mesh",rs=class extends Mle{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new rs(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return Dle(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},gd=new L,vd=new L,Xp=new je,gV=[new L(-1,1,1),new L(-1,-1,1),new L(1,-1,1),new L(1,1,1),new L(-1,1,-1),new L(-1,-1,-1),new L(1,-1,-1),new L(1,1,-1)],Ile=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Rle=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],uz=(e,t,i)=>{e.updateEntityBoxSize(gd,vd),Xp.copy(t).multiply(e.matrixWorld),vd.x===0&&vd.y===0&&vd.z===0?i.push(new L(gd.x,gd.y,gd.z).applyMatrix4(Xp)):gV.forEach(r=>{i.push(r.clone().multiply(vd).add(gd).applyMatrix4(Xp))})},hz=class extends jr{constructor(){super(...arguments),this.matrix=new je,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new je().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new L);return}uz(n,t,r)}}):uz(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Xp.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(vd).multiplyScalar(.5),this.getCenter(gd),Xp.copy(this.matrix).setPosition(gd),this.vertices=gV.map(e=>e.clone().multiply(vd).applyMatrix4(Xp))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=Ile.map(([e,t])=>new eo(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new L))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=Rle.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},oc={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},Ole=class extends A5{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],u=Math.ceil(e*l/n),h=o.getPoints(u);for(let c=0;c<h.length;c++){let f=h[c];i&&i.equals(f)||(t.push(f),i=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},x2=.001;function b2(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=x2}function NA(e,t){let i=new L(...e.position),r=new L(...e.controlNext.position),n=new L(...t.controlPrevious.position),s=new L(...t.position);return b2(i,r,s)&&b2(i,n,s)}function vV(e){let t=e.points.map(h=>new L(...h.data.position)),i=[e.points[0]],r=new L(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)b2(r,t[h],t[h+1])||(i.push(e.points[h]),r=t[h]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let h=0;h<a;h++){let c=i[h].data,f=new L(...c.position),m=new L(...c.controlPrevious.position),g=new L(...c.controlNext.position),y={position:f,baseRoundness:c.roundness,controlPrevious:m,controlNext:g};if(c.roundness===0||!e.isClosed&&(h===0||h===a-1)){o[h]={...y,removedLength:0};continue}let v=n&&h==0?a-1:h-1,b=n&&h==a-1?0:h+1,S=i[v].data,_=i[b].data,T=new L(...S.position),M=new L(..._.position),C=T.clone().sub(f).normalize(),P=M.clone().sub(f).normalize();Object.assign(y,{prevDir:C,nextDir:P});let E=NA(S,c),D=NA(c,_);if(!E||!D)o[h]={...y,removedLength:0};else{let I=C.clone().add(P).normalize(),O=I.clone().cross(C).length()/C.dot(I);o[h]={...y,tan:O,removedLength:c.roundness/O}}}for(let h=0;h<s;h++){let c=h,f=n&&h===a-1?0:h+1,m=o[c],g=o[f];if(m.removedLength!==0||g.removedLength!==0){let y=m.position.distanceTo(g.position);m.removedLength=Math.min(m.removedLength,y/2),g.removedLength=Math.min(g.removedLength,y/2)}}let l=[];for(let h=0;h<s;h++){let c=h,f=n&&h===a-1?0:h+1,m=o[c],g=o[f],y=null;if(!NA(i[c].data,i[f].data))m.position.distanceTo(g.position)>x2&&(y=new ub(m.position,m.controlNext,g.controlPrevious,g.position));else{let v=m.position.clone(),b=g.position.clone();(m.removedLength!==0||g.removedLength!==0)&&(m.nextDir&&v.add(m.nextDir.clone().setLength(m.removedLength)),g.prevDir&&b.add(g.prevDir.clone().setLength(g.removedLength))),v.distanceTo(b)>x2&&(y=new ub(v,v.clone().lerp(b,.3),b.clone().lerp(v,.3),b))}l[2*h+1]=y}for(let h=0;h<a;h++){let c=o[h];if(c.removedLength===0){l[2*h]=null;continue}let f=c.position,m=c.prevDir.clone().multiplyScalar(c.removedLength).add(f),g=c.nextDir.clone().multiplyScalar(c.removedLength).add(f),y=c.tan*c.removedLength,v=c.prevDir.clone().add(c.nextDir).normalize(),b=m.clone().lerp(g,.5),S=m.distanceTo(g)/2,_=v.clone().multiplyScalar(Math.sqrt(Math.pow(y,2)-Math.pow(S,2))).add(b),T=v.clone().multiplyScalar(-y).add(_),M=f.distanceTo(T)/f.distanceTo(b),C=c.prevDir.clone().multiplyScalar(M*f.distanceTo(m)).add(f),P=C.clone().lerp(T,2),E=m.clone().lerp(C,4/3),D=g.clone().lerp(P,4/3);l[2*h]=new ub(m,E,D,g)}let u=new Ole;return l.forEach(h=>{h&&u.add(h)}),u}var Si;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Si||(Si={}));var Cu=e=>Si.is(e),kle={type:"completeState",isfromEntity:!0},Lle=["x","y","z"],BA=new L,zle=new L().set(0,1,0),IM=e=>class extends DM(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new hz,this._recursiveBBox=new hz,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Si.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Si.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Si.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)Sd.toOps(this.data,n.data).forEach(s=>{let a=nw.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=Sd.patch(this.data,n),Sd.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Cu(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Si.is(i[r]))return i[r];if(Si.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Si.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Cu(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Si.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Cu(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Cu(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Cu(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Cu(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*ht.RAD2DEG,this.rotation.y*ht.RAD2DEG,this.rotation.z*ht.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return TT(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,Lle[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(BA.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(ht.DEG2RAD),this.rotation.setFromVector3(BA),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??fm.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Si.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Si.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return TT(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=ir(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let u={...t.props};if(delete u.name,Object.values(t.props).some(h=>h===void 0)){let h=this.data;if(h!==void 0){let c=fn.zoom(h,t.path.slice(2));if(c)for(let f in t.props)t.props[f]===void 0&&f in c&&(u[f]=c[f])}}a={...t,props:u,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:h,...c}=l;l=c}if(t.props.material!==void 0&&"material"in l){let{material:h,...c}=l;l=c}let u=fn.removeOverridden(t.path,t.props,l);a={...t,props:u}}}if(this.updateByPatchedOpBase(a,Sd.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),ir(t.path,["overrides"])){let l=[],u=[...t.path];for(l.push(u[1]),u.splice(0,2);u.length>0&&u[0]==="descendants";)l.push(u[1]),u.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let h of Object.keys(t.props)){l[l.length-1]=h;let c=r.scene.findInstance([this.uuid,...l]);c&&(c.overrideData=t.props[h],c.updateState(dc.apply(c.component.data,c.overrideData),r))}}else{let h=r.scene.findInstance([this.uuid,...l]);if(h){let c=fn.zoom(h.component.data,u);if(t={...t,path:u},t.type===0){let f=t.props;if(c)for(let[m,g]of Object.entries(t.props))g===void 0&&(f===t.props&&(f={...t.props}),f[m]=c[m]);t={...t,props:f}}h.overrideData=mw.resolve(i.overrides,l),h.updateByOp(t,kn.applySimple(h.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let u;for(let h of sc.rootOverrideProps)h in t.props&&(u===void 0&&(u={}),u[h]=t.props[h]);u&&(l={...t,props:u})}else for(let u of sc.rootOverrideProps)if(ir(t.path,[u])){l=t;break}l!==void 0&&this.instances.forEach(u=>{if(u.isInstanceRoot){let h=dc.filterOp(u.overrideData,l);h&&u.updateByOp(h,kn.applySimple(u.data,h),r,!0)}}),this.instances.forEach(u=>{if(!u.isInstanceRoot){let h=dc.filterOp(u.overrideData,t);if(h){let c;s===u.data&&t===h?c=i:c=kn.applySimple(u.data,h),u.updateByOp(h,c,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!jd.is(t.props.type)&&oc.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){oc.changeEntityProptotype(this,i,r);for(let n of this.children)Si.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){var n;if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(n=i.morphTargetInfluences.get(t.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(ir(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),ir(t.path,["cloner"])!==null){let s=kn.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var g,y,v,b,S;let i=((g=this._updatedPathSnapping)==null?void 0:g.pathId)??this.dataPatched.pathSnapping.pathId,r=((y=this._updatedPathSnapping)==null?void 0:y.slide)??this.dataPatched.pathSnapping.slide??0,n=((v=this._updatedPathSnapping)==null?void 0:v.offset)??this.dataPatched.pathSnapping.offset??0,s=((b=this._updatedPathSnapping)==null?void 0:b.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=vV(o.geometry.path),u=(r+n)%1;r+n===1&&u===0&&(u=1);let h=null;try{h=l.curves.length?l.getPointAt(u):null}catch{}if(h===null)return;let c=this.parent?(S=this.parent)==null?void 0:S.matrixWorld:new je;a.updateMatrixWorld();let f=new je().multiplyMatrices(c.clone().invert(),a.matrixWorld);h.applyMatrix4(f);let m={position:h.toArray(),rotation:o.rotation};if(s==="tangential"){let _=new je().extractRotation(a.matrixWorld),T=l.getTangentAt(u).applyMatrix4(_).add(h),M=new je().lookAt(h,T,zle),C=BA.setFromEuler(new dn().setFromRotationMatrix(M)).multiplyScalar(ht.RAD2DEG);m={...m,rotation:C.toArray()}}this.updateTransformState(m),this.traverseEntity(_=>{_._cameraType&&_.dispatchEvent(kle)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof oc.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new oc.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},yV=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,u;let i=(l=e.parameters)==null?void 0:l.radiusTop,r=(u=e.parameters)==null?void 0:u.radiusBottom,n=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=ht.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let h=Math.max(a,o)*2;n.width=h,n.depth=h}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:u,radiusBottom:h,cornerRadius:c,cornerSegments:f,hollow:m}=e.parameters,g;return l===0?(g=new St,g.setAttribute("position",new ot([],3))):c||m?g=new xV(u,h,r,n,s,a,o,l*Math.PI/180,c,c,f,m):g=new QP(u,h,r,n,s,a,o,l*Math.PI/180),g.scale(1,1,i/t),Object.assign(g,{userData:{...e,type:"CylinderGeometry"}})}};function Oh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function cz(e){return new oe(e.y,-e.x)}var xV=class extends St{constructor(e,t,i,r,n,s,a,o,l,u,h,c,f=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,u=0);let m=[],g=[],y=[],v=[],b=0,S=i/2,_=new L,T=new L;f&&e==0&&(e=l),f&&t==0&&(t=u);let M=new oe(e,S),C=new oe(t,-S),P=null,E=null,D=null,I=null,O=M.clone().sub(C),N=0,k=0,U=0;c>0&&(N=Math.min(e,t)*(1-c),k=e-N,U=t-N);let Q=M.clone();Q.x-=N;let se=Math.PI-O.angle(),K=O.angle(),H=Math.tan(K/2),ie=Math.tan(se/2),$=H+ie,V=c?$:ie,X=c?$:H;if(l=Math.min(l,(e-k)/V,O.length()/$),u=Math.min(u,(t-U)/X,O.length()/$),l>0){let de=l/H;P=M.clone().sub(new oe(de,l)),c&&(D=P.clone(),D.x-=N-$*l),M.sub(O.clone().setLength(de))}if(u>0){let de=u/ie;E=C.clone().sub(new oe(de,-u)),C.add(O.clone().setLength(de)),c&&(I=E.clone(),I.x-=N-$*u,Q.sub(O.clone().setLength(de)))}O=M.clone().sub(C);let ue=O.length()<.5,ne=[];for(let de=0;de<=r;de++){let fe=[],ye=de/r,Te=ye*o+a,Ie=new oe(Math.sin(Te),Math.cos(Te));I&&E?(he(fe,ye,Ie,se,u,I,-1,!0),he(fe,ye,Ie,K,u,E,-1,!1)):E?(te(fe,Ie,E.x,0,-1),he(fe,ye,Ie,K,u,E,-1,!1)):s||te(fe,Ie,t,U,-1);let Ne=cz(O).normalize();if(Oh(Ne,Ie,_),!ue)for(let st=0;st<=n;st++){let We=st/n,ct=O.clone().multiplyScalar(We).add(C);Oh(ct,Ie,T),g.push(T.x,T.y,T.z),y.push(_.x,_.y,_.z),v.push(ye,.5+T.y/i),fe.push(b++)}if(D&&P?(he(fe,ye,Ie,se,l,P,1,!1),he(fe,ye,Ie,K,l,D,1,!0)):P?(he(fe,ye,Ie,se,l,P,1,!1),te(fe,Ie,P.x,0,1)):s||te(fe,Ie,e,k,1),c&&!ue){let st=cz(O).multiplyScalar(-1).normalize();Oh(st,Ie,_);for(let We=0;We<=n;We++){let ct=We/n,ut=O.clone().multiplyScalar(-ct).add(Q);Oh(ut,Ie,T),g.push(T.x,T.y,T.z),y.push(_.x,_.y,_.z),v.push(ye,.5+T.y/i),fe.push(b++)}}c&&!s&&fe.push(fe[0]),ne.push(fe)}for(let de=0;de<ne.length-1;de++)for(let fe=0;fe<ne[0].length-1;fe++){if(s&&c&&fe==n)continue;let ye=ne[de][fe],Te=ne[de+1][fe],Ie=ne[de+1][fe+1],Ne=ne[de][fe+1],st=g[Ie*3+0],We=g[Ie*3+2];m.push(ye,Te,Ne),(st!=0||We!=0)&&m.push(Te,Ie,Ne)}o<Math.PI*2&&(me(-1,ne[0],a),me(1,ne[ne.length-1],a+o)),this.setIndex(m),this.setAttribute("position",new ot(g,3)),this.setAttribute("normal",new ot(y,3)),this.setAttribute("uv",new ot(v,2));function he(de,fe,ye,Te,Ie,Ne,st,We){for(let ct=0;ct<h+1;ct++){let ut=ct/h,Ke=st<0?ut:1-ut;We&&(Ke-=1),Ke*=Te;let Ye=new oe(Math.sin(Ke),Math.cos(Ke)*st),yt=Ye.clone().multiplyScalar(Ie).add(Ne);Oh(yt,ye,T),g.push(T.x,T.y,T.z),Oh(Ye,ye,_),y.push(_.x,_.y,_.z),v.push(fe,.5+T.y/i),de.push(b++)}}function te(de,fe,ye,Te,Ie){let Ne=new L,st=new oe,We=[ye,Te];Ie<0&&We.reverse();for(let ct of We)st.set(ct,S*Ie),Oh(st,fe,Ne),g.push(Ne.x,Ne.y,Ne.z),y.push(0,Ie,0),v.push(.5,.5),de.push(b++)}function me(de,fe,ye){let Te=new oe(Math.sin(ye),Math.cos(ye)),Ie=new oe(-Math.cos(ye),Math.sin(ye)),Ne=new L,st=de<0?(ut,Ke,Ye)=>m.push(ut,Ke,Ye):(ut,Ke,Ye)=>m.push(ut,Ye,Ke),We=new oe((e+t+k+U)/4,0);Oh(We,Te,Ne),g.push(Ne.x,Ne.y,Ne.z),y.push(Ie.x,0,Ie.y),v.push(.5,.5);let ct=b++;for(let ut of fe){let Ke=g.slice(ut*3,ut*3+3);g.push(...Ke),y.push(Ie.x,0,Ie.y);let Ye=v.slice(ut*2,ut*2+2);v.push(...Ye),b++}for(let ut=ct+1;ut<b-1;ut++)st(ct,ut,ut+1);st(ct,b-1,ct+1)}}},Nle=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=ht.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:u,cornerRadiusBottom:h,cornerSegments:c}=e.parameters,f;return l===0?(f=new St,f.setAttribute("position",new ot([],3))):u>0||h>0||l<360?f=new xV(0,t/2,r,n,s,a,o,l*Math.PI/180,u,h,c,0,!0):f=new KP(t/2,r,n,s,a),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"ConeGeometry"}})}},Ble=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,u;return o===0?u=new jo(t,i,r,n,s,a):u=new Fle(t,i,r,n,s,a,o,l),Object.assign(u,{userData:{...e,type:"CubeGeometry"}})}},FA=Math.PI/2,Fle=class extends St{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],u=[],h=[],c=[],f=0;m("z","y","x",-1,-1,i,t,e,s,n),m("z","y","x",1,-1,i,t,-e,s,n),m("x","z","y",1,1,e,i,t,r,s),m("x","z","y",1,-1,e,i,-t,r,s),m("x","y","z",1,-1,e,t,i,r,n),m("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(g("z","y","x",-1,-1,1,i,t,e,s),g("z","y","x",1,-1,-1,i,t,e,s),g("z","y","x",-1,1,-1,i,t,e,s),g("z","y","x",1,1,1,i,t,e,s),g("x","y","z",-1,-1,-1,e,t,i,r),g("x","y","z",1,-1,1,e,t,i,r),g("x","y","z",-1,1,1,e,t,i,r),g("x","y","z",1,1,-1,e,t,i,r),g("y","x","z",-1,-1,1,t,e,i,n),g("y","x","z",1,-1,-1,t,e,i,n),g("y","x","z",1,1,1,t,e,i,n),g("y","x","z",-1,1,-1,t,e,i,n),y(1,1,1),y(-1,1,1),y(1,-1,1),y(-1,-1,1),y(1,1,-1),y(-1,1,-1),y(1,-1,-1),y(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new ot(u,3)),this.setAttribute("normal",new ot(h,3)),this.setAttribute("uv",new ot(c,2));function m(v,b,S,_,T,M,C,P,E,D){let I=(M-2*a)/E,O=(C-2*a)/D,N=M/2-a,k=C/2-a,U=P/2,Q=E+1,se=D+1,K=0,H=new L;for(let ie=0;ie<se;ie++){let $=ie*O-k;for(let V=0;V<Q;V++){let X=V*I-N;H[v]=X*_,H[b]=$*T,H[S]=U,u.push(H.x,H.y,H.z),H[v]=0,H[b]=0,H[S]=P>0?1:-1,h.push(H.x,H.y,H.z),c.push(V/E),c.push(1-ie/D),K+=1}}for(let ie=0;ie<D;ie++)for(let $=0;$<E;$++){let V=f+$+Q*ie,X=f+$+Q*(ie+1),ue=f+($+1)+Q*(ie+1),ne=f+($+1)+Q*ie;l.push(V,X,ne),l.push(X,ue,ne)}f+=K}function g(v,b,S,_,T,M,C,P,E,D){let I=(C-2*a)/D,O=C/2-a,N=P/2-a,k=E/2,U=D+1,Q=0,se=new L,K=new L;for(let H=0;H<o+1;H++){let ie=H/o*FA,$=Math.sin(ie)*a,V=(1-Math.cos(ie))*a,X=Math.sin(ie),ue=Math.cos(ie);se[b]=(N+$)*T,se[S]=(k-V)*M,K[v]=0,K[b]=X*Math.sign(se[b]),K[S]=ue*Math.sign(se[S]);for(let ne=0;ne<U;ne++){let he=ne*I-O;se[v]=he*_,u.push(se.x,se.y,se.z),h.push(K.x,K.y,K.z),c.push(ne/D),c.push(0),Q+=1}}for(let H=0;H<o;H++)for(let ie=0;ie<D;ie++){let $=f+ie+U*H,V=f+ie+U*(H+1),X=f+(ie+1)+U*(H+1),ue=f+(ie+1)+U*H;l.push($,V,ue),l.push(V,X,ue)}f+=Q}function y(v,b,S){let _=new L,T=new L(e/2,t/2,i/2);T.subScalar(a);let M=[],C=v*b*S>0?(E,D,I)=>l.push(E,D,I):(E,D,I)=>l.push(E,I,D);for(let E=0;E<=o;E++){let D=[],I=FA*(1-E/o),O=Math.cos(I),N=Math.sin(I),k=0;for(let U=0;U<=E;U++){let Q=Math.cos(k),se=Math.sin(k);_.x=O*Q,_.y=N,_.z=O*se;let K=T.clone().addScaledVector(_,a);u.push(v*K.x,b*K.y,S*K.z),h.push(v*_.x,b*_.y,S*_.z),c.push(0,0),D.push(f++),k+=FA/E}M.push(D)}let P=M.length-1;for(let E=0;E<P;E++){let D=M[E],I=M[E+1],O=D.length-1;C(D[0],I[1],I[0]);for(let N=1;N<=O;N++)C(D[N-1],D[N],I[N]),C(D[N],I[N+1],I[N])}}}},RM=class extends St{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];u(),h(),this.setAttribute("position",new ot(a,3)),this.setAttribute("normal",new ot(l,3)),this.setAttribute("uv",new ot(o,2));return;function u(){var K;n=Math.min(1-1e-5,n),n==0&&(s=0);let c={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],f=new L,m=f.clone(),g=new $n,y=n*r,v=r-y,b=s+1,S=new L,_=(H,ie)=>S.subVectors(H,ie).normalize(),T=(H,ie)=>Array(H).fill(void 0).map(ie),M=T(e.length/3,(H,ie)=>new L().fromArray(e,ie*3).setLength(r)),C=[],P=1e6;for(let H=0;H<M.length;H++){let ie=M[H],$=[],V,X,ue,ne=1e10,he=-1;for(;(he=t.indexOf(H,he+1))!=-1;){let fe=he-he%3;V=t[fe+(he+1)%3],X=t[fe+(he+2)%3],ue=ie.distanceToSquared(M[V]),ne=Math.min(ne,ue),$.push([V,X,ue])}ne+=1e-6;let te=[],me=0,de=$.length;for(let fe=0;fe<de;fe++){[V,X,ue]=$[me];let ye=((K=C[V])==null?void 0:K.includes(H))==!0;ue<=ne&&te.push(V+ +ye*P),me=$.findIndex(Te=>Te[0]==X)}C.push(te)}let E=[];{let H=0,ie=0,$,V,X=c==3;for(let ue=0;ue<=s;ue++){$=ue*(ue+1)/2,V=(ue+1)*(ue+2)/2;for(let ne=0;ne<s-ue;ne++)[H,ie]=[$+ne+ue+2,V+ne+ue+3],E.push($,V,...X?[ie,$]:[H,V],ie,H),[$,V]=[H,ie];E.push($,V,$+s+2)}}let D=f.clone(),I=f.clone(),O=f.clone(),N=f.clone(),k=f.clone(),U=[],Q=T(M.length,()=>T(c,()=>f.clone()));for(let H=0;H<M.length;H++){f.copy(M[H]).normalize(),D.copy(f).multiplyScalar(v);let ie=C[H];for(let te=0;te<ie.length;te++){let me=ie[te],de=ie[(te+1)%c];g.setFromPointsAndIndices(M,H,me%P,de%P),g.b.sub(g.a).setLength(1e10).add(g.a),g.c.sub(g.a).setLength(1e10).add(g.a),g.closestPointToPoint(D,Q[H][te])}let $=[],V=[],X=[],ue=new L;s==0&&[...Q[H]].reduce((te,me)=>te.add(me),ue).multiplyScalar(1/c);for(let te=0;te<c;te++){let me=[],de=(te-1+c)%c,fe=Q[H][de],ye=Q[H][te];f.copy(fe).sub(D),m.copy(ye).sub(D);let Te=D.angleTo(f),Ie=f.angleTo(m),Ne=Math.cos(Te)*y;s==0?I.copy(ue):I.copy(D).setLength(v+Ne),V.push(Ne);let st=[I,fe,ye];for(let We=0;We<2;We++){let ct=st[We],ut=st[We+1];N.subVectors(ct,D),k.subVectors(ut,D),O.crossVectors(N,k).normalize();for(let Ke=0;Ke<b;Ke++){let Ye=[Te,Ie][We]*Ke/b;f.copy(N).applyAxisAngle(O,Ye).add(D),$.push(f.clone()),We&&(_(f,D),me.push([Ke==0?ct:f.clone(),S.clone()]))}We&&(_(ut,D),me.push([ut,S.clone()]))}X.push(me)}U.push(X);let ne=2*b,he=2;for(let te=0;te<c;te++){let me=ne*te,de=ne*((te+1)%c),fe=[$[me]];for(let Te=1;Te<b;Te++){N=$[me+Te],k=$[de+Te],fe.push(N);for(let Ie=1,Ne=Te-he+1;Ie<=Ne;Ie++)f.lerpVectors(N,k,Ie/(Ne+1)),f.sub(D).setLength(V[te]).add(D),fe.push(f.clone());fe.push(k)}for(let Te=0;Te<b;Te++)fe.push($[Te+b+me]);fe.push($[de+b]);let ye=E.map(Te=>fe[Te]);a.push(...ye.map(Te=>[Te.x,Te.y,Te.z]).flat()),l.push(...ye.map(Te=>(_(Te,D),[S.x,S.y,S.z])).flat())}}let se=[];for(let H=0;H<C.length;H++)for(let ie=0;ie<c;ie++){let $=C[H][ie];if($<P){let V=C[$].findIndex(ne=>ne%P==H),X=U[H][ie],ue=U[$][V];for(let ne=0;ne<b;ne++){let he=X[ne],te=ue[b-ne],me=X[ne+1],de=ue[b-(ne+1)];[he,te,me,me,te,de].forEach(fe=>{a.push(fe[0].x,fe[0].y,fe[0].z),l.push(fe[1].x,fe[1].y,fe[1].z)})}se.push(X[0][0],ue[b][0],X[b][0],ue[0][0])}}for(;se.length;){let H,ie,$,V;[H,ie]=se.splice(0,2);let X=[H];for(;H!=ie;)X.push(ie),$=se.indexOf(ie),V=$%2,ie=se.splice($-V,2)[1-V];S.subVectors(X[0],X[1]).cross(f.subVectors(X[0],X[2])).normalize();let ue=S.dot(X[0])<0;ue&&S.negate();for(let ne=1;ne<=X.length-2;ne++)[X[ne+ +ue],X[ne+1-+ue],X[0]].forEach(he=>{a.push(he.x,he.y,he.z),l.push(S.x,S.y,S.z)})}}function h(){let c=new L;for(let C=0;C<a.length;C+=3){c.x=a[C+0],c.y=a[C+1],c.z=a[C+2];let P=T(c)/2/Math.PI+.5,E=M(c)/Math.PI+.5;o.push(P,1-E)}let f=new L,m=new L,g=new L,y=new L,v=new oe,b=new oe,S=new oe,_=(C,P,E,D)=>{D<0&&C.x===1&&(o[P]=C.x-1),E.x===0&&E.z===0&&(o[P]=D/2/Math.PI+.5)};for(let C=0,P=0;C<a.length;C+=9,P+=6){f.set(a[C+0],a[C+1],a[C+2]),m.set(a[C+3],a[C+4],a[C+5]),g.set(a[C+6],a[C+7],a[C+8]),v.set(o[P+0],o[P+1]),b.set(o[P+2],o[P+3]),S.set(o[P+4],o[P+5]),y.copy(f).add(m).add(g).divideScalar(3);let E=T(y);_(v,P+0,f,E),_(b,P+2,m,E),_(S,P+4,g,E)}for(let C=0;C<o.length;C+=6){let P=o[C+0],E=o[C+2],D=o[C+4],I=Math.max(P,E,D),O=Math.min(P,E,D);I>.9&&O<.1&&(P<.2&&(o[C+0]+=1),E<.2&&(o[C+2]+=1),D<.2&&(o[C+4]+=1))}function T(C){return Math.atan2(C.z,-C.x)}function M(C){return Math.atan2(-C.y,Math.sqrt(C.x*C.x+C.z*C.z))}}}static fromJSON(e){return new RM(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},Ule=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new bV(t*.5,s,a):new T5(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},bV=class extends RM{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new bV(e.radius,e.corner,e.cornerSides)}},$g=1e-12,OM=class{constructor(e){this.position=new oe,this.startPosition=new oe,this.uuid=ht.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new OM(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},w2=class extends OM{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new w2(this.parent).copy(this)}},Yp=class extends OM{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new w2(this),new w2(this))}static create(e,t){let i=new Yp(e,new oe(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Yp(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new oe,t=new oe){let[i,r]=this.computeTangents();return i&&r&&(dz(i,e),dz(r,t)),[e,t]}computeTangent(e=new oe){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new oe){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function dz(e,t=new oe){let i=e.length();return t.set(-e.y/i,e.x/i)}var kM=e=>e,Gm=new oe,I_=new oe,Vle=new oe,jle=new oe,Hle=new oe,Gle=new oe,wV=new L,_V=new L;function Wle(e){let t=new oe;t.addVectors(e.v0,Gm.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new oe;return i.addVectors(e.v2,I_.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Oo(e.v0,t,i,e.v2)}function _v(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function qle(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Xle(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function SV(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function Yle(e,t,i){return pz(e,t)&&pz(t,i)&&_2(e.position,t.position,i.position)}function _2(e,t,i){return Gm.copy(t).sub(e).cross(I_.copy(i).sub(e))===0}function Qle(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,u=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+u),n.set(o-l,a-u),[r,n]}function Kle(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function Zle(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,u=i.y-e.y,h=Math.sqrt((a+l)*(a+l)+(o+u)*(o+u)),c;return SV(t,e,i)>Math.PI&&(h*=-1),_v(u,o)?c=(o+u)*(r/h-.5)*8/3/(a-l):c=(a+l)*(r/h-.5)*8/3/(u-o),n.set(t.x-c*o,t.y+c*a),s.set(i.x+c*u,i.y-c*l),[n,s]}function fz(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function pz(e,t){return _2(e.position,e.controls[1].position,t.position)&&_2(e.position,t.controls[0].position,t.position)}function Jle(e,t,i,r,n=.5){let s=Gm.subVectors(t,e).multiplyScalar(n).add(e),a=I_.subVectors(i,t).multiplyScalar(n).add(t),o=Vle.subVectors(r,i).multiplyScalar(n).add(i),l=s,u=jle.subVectors(a,s).multiplyScalar(n).add(s),h=Hle.subVectors(o,a).multiplyScalar(n).add(a),c=o,f=Gle.subVectors(h,u).multiplyScalar(n).add(u);return[e.x,e.y,l.x,l.y,u.x,u.y,f.x,f.y,h.x,h.y,c.x,c.y,r.x,r.y]}function $le(e,t,i=12,r=!0){let n=_V.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=kM(t[o]),u=Gm,h=Nd(l,i);for(let c=0;c<=h;c++)if(l instanceof Oo||l instanceof _c||l instanceof Fo){if(l.getPoint(c/h,u),n.set(u.x,u.y,0),s!==void 0&&Xle(s,n))continue;s===void 0&&(s=wV),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function eue(e,t,i,r=12,n=!0){let s=_V.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let u,h=kM(t[l]),c=Gm,f=Nd(h,r);o.push(f);for(let m=0;m<=f;m++)if(h instanceof Oo||h instanceof _c||h instanceof Fo){if(h.getPoint(m/f,c),s.set(c.x,c.y,0),u==null?void 0:u.equals(s))continue;u===void 0?u=wV:(e.setXYZ(a,u.x,u.y,u.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),u.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function mz(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Nd(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Nd(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Nd(e[0].roundedCurveCorner,t)*.5),r}function Nd(e,t=12){return e&&e instanceof g_?t*2:e&&(e instanceof Fo||e instanceof E5)?1:e&&e instanceof YP?t*e.points.length:t}function tue(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=kM(t[a]),l=Nd(o,i),u=Gm;for(let h=0;h<=l;h++)if(o instanceof Oo||o instanceof _c||o instanceof Fo){if(o.getPoint(h/l,u),n!==void 0&&qle(n,u,$g))continue;n===void 0&&(n=I_),n.copy(u),e.push(u.x,u.y),s++}}return _v(e[0],e[e.length-2],$g)&&_v(e[1],e[e.length-1],$g)&&(e.pop(),e.pop()),r&&s>1&&!(_v(e[s-1],e[1],$g)&&_v(e[s-2],e[0],$g))&&(e.push(e[0],e[1]),s++),e}var UA=new oe,iue=new oe,rue=new oe,nue=new oe,sue=new oe,aue=new oe,Or=class extends Hb{constructor(t=100,i=100){super(),this.points=[],this.shapeHoles=[],this.plane=new ia(new L(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=ht.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=i}static createFromState(t,i,r){let n=new Or;return n.isClosed=t.isClosed,n.points=t.points.map(s=>Yp.create(s.id,s.data)),typeof t.roundness=="number"&&(n.roundness=t.roundness),n.shapeHoles=t.shapeHoles.map(s=>Or.createFromState(s)),i!==void 0&&r!==void 0&&n.applySize(i,r),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let i=0,r=this.points.length;i<r;i++)this.points[i].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map(i=>this.getPointIndexById(i)).filter(i=>i>=0)}getPointIndexById(t){let i=this.points.length,r=this.points.findIndex(n=>n.uuid===t);if(r<0){let n=i;for(let s=0,a=this.shapeHoles.length;s<a;s++){let o=this.shapeHoles[s],l=o.points.length,u=o.getPointIndexById(t);if(u<0)n+=l;else return u+n}}return r}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let i=this.points.length;for(let r=0,n=this.shapeHoles.length;r<n;r++){let s=this.shapeHoles[r],a=t-i;if(a<=s.points.length-1)return s.points[a];i+=s.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let i=this.points.indexOf(t);if(i>=0)return i;if(i=this.points.length,this.shapeHoles.length>0)for(let r=0,n=this.shapeHoles.length;r<n;r++){let s=this.shapeHoles[r],a=s.points.indexOf(t);if(a>=0)return i+a;i+=s.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map(i=>i.points));return[...this.points,...t]}applySize(t,i){t===0&&(t=.001),i===0&&(i=.001),this._width=t,this._height=i}applyScale(t,i){let r=UA.set(t,i);for(let n=0,s=this.points.length;n<s;n++){let a=this.points[n];a.position.multiply(r),a.controls[0].position.multiply(r),a.controls[1].position.multiply(r)}for(let n=0,s=this.shapeHoles.length;n<s;n++)this.shapeHoles[n].applyScale(t,i);this._update()}createPoint(t,i=0,r=ht.generateUUID()){let n;t instanceof oe?n=t:n=new oe(t,i);let s=new Yp(r,n);return s.roundness=this.roundness,s}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,i){this.points.splice(i,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i];if(n.uuid===t)return n}for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i].getPointByUuid(t);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let i=this.points.indexOf(t);i>=0&&this.points.splice(i,1),this.needsUpdate=!0}removePointById(t){let i=this.points.find(r=>r.uuid===t);i&&this.removePoint(i)}update(){for(let t=0,i=this.shapeHoles.length;t<i;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,i=12,r=!1){this.subdivision=i,this.curveDivisions===void 0&&this.computeCurveDivisions(i);let n=r?this.roundedCurveDivisions:this.curveDivisions;return $le(t,r?this.roundedCurves:this.curves,i,this.autoClose),n.reduce((s,a)=>s+a,0)+1}computeCurveDivisions(t=12){return this.curveDivisions=mz(this.points,t,!1),this.roundedCurveDivisions=mz(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,i,r=12){return eue(t,this.curves,i,r,this.autoClose).reduce((n,s)=>n+s,0)*2}extractShapePointsToFlatArray(t,i=12){return this.subdivision=i,this.curveDivisions===void 0&&this.computeCurveDivisions(i),tue(t,this.roundedCurves,i,this.autoClose)}getCurveIndexFromVertexId(t,i=!1){let r=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let n=i?this.roundedCurveDivisions:this.curveDivisions,s=0;i&&this.points[0].roundedCurveCorner!==void 0&&(s=Nd(this.points[0].roundedCurveCorner,this.subdivision)*.5);let a=t-s;a<0&&(a+=n.reduce((o,l)=>o+l,0));for(let o=0,l=n.length;o<l;o++){let u=n[o];if(a<r+u)return[o,(a-r+1)/u];r+=u}return[0,1]}getCurveT(t,i,r){let n=this.points[t],s=this.points[t>=this.points.length-1?0:t+1],a=this.curveDivisions,o=a[t];if(fz(n,s)){let u=n.position.distanceTo(s.position);return n.position.distanceTo(UA.set(r.x,r.y))/u}let l=0;for(let u=0;u<t;u++)l+=a[u];return(i-l)/o}dispose(){}_applyCurveForPoint(t,i){fz(i,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(i.controls[1].position.x,i.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let r=this.curves[this.curves.length-1];t.curveBefore=r,i.curveAfter=r;let n=r.clone();t.roundedCurveBefore=n,i.roundedCurveAfter=n,t.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i];if(i===0)this.moveTo(n.position.x,n.position.y);else{let s=this.points[i-1];this._applyCurveForPoint(n,s)}}let t=this.getLastPoint();if(t!=null&&t.curveAfter&&(t.curveAfter=void 0),this.isClosed){let i=this.points[0],r=this.points[this.points.length-1];this._applyCurveForPoint(i,r)}if(this.points.length>2){let i=0;for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r],a=this.points[r-1]??this.points[this.points.length-1],o=this.points[r+1]??this.points[0],l=s.roundness,u=a&&o&&Yle(a,s,o);if(!s.controlsMoved()&&l>0&&!u){let h=s.curveBefore,c=s.curveAfter;if(h===void 0||c===void 0)continue;let f=s.roundedCurveBefore,m=s.roundedCurveAfter,g=h.getLength(),y=c.getLength(),v=Math.min(l,g*.499),b=Math.min(l,y*.499),S=Math.min(v,b),_=1-S/g,T=S/y,M=h.getPointAt(_,UA),C=c.getPointAt(T,iue);this._subSplitCurve(h,f,_,M,void 0),this._subSplitCurve(c,m,T,void 0,C);let P;if(this.useCubicForRoundedCorners){let E=SV(M,s.position,C)/2,D=Math.tan(E)*M.distanceTo(s.position),[I,O]=Qle(M,C,D,rue,nue),N=Kle(I,O,s.position),[k,U]=Zle(N,M,C,D,sue,aue);P=new Oo(M.clone(),k.clone(),U.clone(),C.clone())}else P=new _c(M.clone(),s.position.clone(),C.clone());s.roundedCurveCorner=P,this.roundedCurves.splice(r+i,0,P),i++}}}}_subSplitCurve(t,i,r,n,s){if(t instanceof Fo)n!==void 0&&i.v2.copy(n),s!==void 0&&i.v1.copy(s);else{let a=t,o=i,l=a.getUtoTmapping(r,0),u=Jle(a.v0,a.v1,a.v2,a.v3,l);return n!==void 0&&(o.v0.set(u[0],u[1]),o.v1.set(u[2],u[3]),o.v2.set(u[4],u[5]),o.v3.set(u[6],u[7])),s!==void 0&&(o.v0.set(u[6],u[7]),o.v1.set(u[8],u[9]),o.v2.set(u[10],u[11]),o.v3.set(u[12],u[13])),o}return i}clone(){let t=new Or(this._width,this._height);return t.points=this.points.map(i=>i.clone()),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map(i=>i.clone()),t}toJSON(){return{points:this.points.reduce((t,i)=>t.concat(i.toJSON()),[]),shapeHoles:this.shapeHoles.map(t=>t.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){var r;this.points=[],this.pointIDs=0;let i=t.points.length/7;for(let n=0;n<i;n++){let s=n*7,a=t.points[s+0],o=t.points[s+1],l=t.points[s+2],u=t.points[s+3],h=t.points[s+4],c=t.points[s+5],f=t.points[s+6],m=new Yp(ht.generateUUID(),new oe(a,o));m.controls[0].position.set(l,u),m.controls[1].position.set(h,c),m.roundness=f,this.points.push(m)}return this.shapeHoles=(r=t.shapeHoles)!=null&&r.length?t.shapeHoles.map(n=>{let s=new Or;return s.fromJSON(n),s}):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,i=!1){this.isText=i;let r=(s,a)=>{a instanceof Oo&&a.v3.equals(s.position)&&s.controls[0].position.copy(a.v2)},n=s=>{let a=[],o,l;for(o=0,l=s.length;o<l;o++)s[o]instanceof _c&&(s[o]=Wle(s[o]));for(o=0,l=s.length;o<l;o++){let c=s[o],f=o>0?s[o-1]:null,m;c instanceof Oo?(m=this.createPoint(c.v0),m.controls[1].position.copy(c.v1)):c instanceof Fo&&(m=this.createPoint(c.v1)),m!==void 0&&(f!==null&&r(m,f),a.push(m))}let u=s[s.length-1],h=!1;return u instanceof Oo?u.v3.equals(a[0].position)&&(a[0].controls[0].position.copy(u.v2),h=!0):u instanceof Fo&&u.v2.equals(a[0].position)&&(h=!0),this.isClosed=h,a};return this.points=n(t.curves),t instanceof Hb&&(this.shapeHoles=t.holes.map(s=>{let a=new Or;return a.fromShape(s),a})),this.update(),this}updatePoint(t,i){let r=this.getPointByUuid(t);r&&(i.position!==void 0&&r.position.fromArray(i.position),i.roundness!==void 0&&(r.roundness=i.roundness),i.areControlsDirectionsMirrored!==void 0&&(r.areControlsDirectionsMirrored=i.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,i){var n;let r=(n=this.getPointByUuid(t))==null?void 0:n.controls[0];r&&(i.position&&r.position.fromArray(i.position),this.needsUpdate=!0)}updateNextControl(t,i){var n;let r=(n=this.getPointByUuid(t))==null?void 0:n.controls[1];r&&(i.position&&r.position.fromArray(i.position),this.needsUpdate=!0)}},S2=Math.PI*2;function VA({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function oue(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function gz(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function lue(e,t,i,r,n,s,a,o,l,u){let h=Math.pow(n,2),c=Math.pow(s,2),f=Math.pow(a,2),m=Math.pow(o,2),g=h*c-h*m-c*f;g<0&&(g=0),g/=h*m+c*f,g=Math.sqrt(g)*(l===u?-1:1);let y=g*n/s*o,v=g*-s/n*a,b=y+(e+i)/2,S=v+(t+r)/2,_=(a-y)/n,T=(o-v)/s,M=(-a-y)/n,C=(-o-v)/s,P=gz(1,0,_,T),E=gz(_,T,M,C);return!u&&E>0&&(E-=S2),u&&E<0&&(E+=S2),{centerx:b,centery:S,ang1:P,ang2:E}}function uue({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let u=(e-i)/2,h=(t-r)/2;if(u===0&&h===0)return[];n=Math.abs(n),s=Math.abs(s);let c=Math.pow(u,2)/Math.pow(n,2)+Math.pow(h,2)/Math.pow(s,2);c>1&&(n*=Math.sqrt(c),s*=Math.sqrt(c));let f=lue(e,t,i,r,n,s,u,h,a,o),{ang1:m,ang2:g}=f,{centerx:y,centery:v}=f,b=Math.abs(g)/(S2/4);Math.abs(1-b)<1e-7&&(b=1);let S=Math.max(Math.ceil(b),1);g/=S;for(let _=0;_<S;_++)l.push(oue(m,g)),m+=g;return l.map(_=>{let{x:T,y:M}=VA(_[0],n,s,y,v),{x:C,y:P}=VA(_[1],n,s,y,v),{x:E,y:D}=VA(_[2],n,s,y,v);return{x1:T,y1:M,x2:C,y2:P,x:E,y:D}})}var Zi;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Zi||(Zi={}));var Kr;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Kr||(Kr={}));function Gt(e,t){if(!e)throw t||"Assertion Failed!"}var kt=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Gt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){Gt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){Gt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){Gt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),ev=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),fx=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Tp=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),vz=function(){function e(){var t=new Tp,i=new ev,r=new fx(0),n=new fx(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new fx(0),r=new fx(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;Gt(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;Gt(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new Tp,i=new Tp,r=new ev,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new Tp;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new ev;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new ev;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new Tp;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new ev;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&kt.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&kt.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,u;for(s=t,s=t;(n=s.next)!==t;s=n){Gt(n.prev===s),l=n.anEdge;do Gt(l.Sym!==l),Gt(l.Sym.Sym===l),Gt(l.Lnext.Onext.Sym===l),Gt(l.Onext.Sym.Lnext===l),Gt(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Gt(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Gt(a.prev===o),l=a.anEdge;do Gt(l.Sym!==l),Gt(l.Sym.Sym===l),Gt(l.Lnext.Onext.Sym===l),Gt(l.Onext.Sym.Lnext===l),Gt(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Gt(a.prev===o&&a.anEdge===null),u=r,u=r;(l=u.next)!==r;u=l)Gt(l.Sym.next===u.Sym),Gt(l.Sym!==l),Gt(l.Sym.Sym===l),Gt(l.Org!==null),Gt(l.Dst!==null),Gt(l.Lnext.Onext.Sym===l),Gt(l.Onext.Sym.Lnext===l);Gt(l.Sym.next===u.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),yz=function(){function e(){this.handle=null}return e}(),xz=function(){function e(){this.key=null,this.node=0}return e}(),hue=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new yz,this.handles[r]=new xz;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Gt(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new yz;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new xz}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;Gt(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),jA=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),bz=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),cue=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new bz,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new bz;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),due=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?kt.vertLeq(s.Org,a.Org)?kt.edgeSign(a.Dst,s.Org,a.Org)<=0:kt.edgeSign(s.Dst,a.Org,s.Org)>=0:kt.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return kt.edgeSign(s.Dst,n,s.Org)>=0;var o=kt.edgeEval(s.Dst,n,s.Org),l=kt.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Gt(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Gt(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new jA;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case Zi.ODD:return(i&1)!==0;case Zi.NONZERO:return i!==0;case Zi.POSITIVE:return i>0;case Zi.NEGATIVE:return i<0;case Zi.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,u,h,c=!0;u=r;do Gt(kt.vertLeq(u.Org,u.Dst)),e.addRegionBelow(t,i,u.Sym),u=u.Onext;while(u!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,h=s;o=e.regionBelow(l),u=o.eUp.Sym,u.Org===h.Org;)u.Onext!==h&&(t.mesh.splice(u.Oprev,u),t.mesh.splice(h.Oprev,u)),o.windingNumber=l.windingNumber-u.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!c&&e.checkForRightSplice(t,l)&&(e.addWinding(u,h),e.deleteRegion(t,l),t.mesh.delete(h)),c=!1,l=o,h=u;l.dirty=!0,Gt(l.windingNumber-u.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=kt.vertL1dist(i,t),s=kt.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(kt.vertLeq(n.Org,s.Org)){if(kt.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;kt.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(kt.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Gt(!kt.vertEq(n.Dst,s.Dst)),kt.vertLeq(n.Dst,s.Dst)){if(kt.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(kt.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,u=s.Dst,h,c,f=new Tp,m,g;if(Gt(!kt.vertEq(u,l)),Gt(kt.edgeSign(l,t.event,a)<=0),Gt(kt.edgeSign(u,t.event,o)>=0),Gt(a!==t.event&&o!==t.event),Gt(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(h=Math.min(a.t,l.t),c=Math.max(o.t,u.t),h>c))return!1;if(kt.vertLeq(a,o)){if(kt.edgeSign(u,a,o)>0)return!1}else if(kt.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),kt.intersect(l,a,u,o,f),Gt(Math.min(a.t,l.t)<=f.t),Gt(f.t<=Math.max(o.t,u.t)),Gt(Math.min(u.s,l.s)<=f.s),Gt(f.s<=Math.max(o.s,a.s)),kt.vertLeq(f,t.event)&&(f.s=t.event.s,f.t=t.event.t),m=kt.vertLeq(a,o)?a:o,kt.vertLeq(m,f)&&(f.s=m.s,f.t=m.t),kt.vertEq(f,a)||kt.vertEq(f,o)?(e.checkForRightSplice(t,i),!1):!kt.vertEq(l,t.event)&&kt.edgeSign(l,t.event,f)>=0||!kt.vertEq(u,t.event)&&kt.edgeSign(u,t.event,f)<=0?u===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),g=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,g,!0),!0):(kt.edgeSign(l,t.event,f)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),kt.edgeSign(u,t.event,f)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=f.s,n.Org.t=f.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,u),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,u=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),kt.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),u=!0),kt.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),u=!0),u){e.addRightEdges(t,i,r.Onext,s,s,!0);return}kt.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,kt.vertEq(n.Org,r)){Gt(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!kt.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}Gt(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Gt(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),kt.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,u=new jA;if(u.eUp=i.anEdge.Sym,r=t.dict.search(u).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,kt.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=kt.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var h=t.mesh.connect(o.Dnext,i.anEdge);l=h.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);Gt(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new jA,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new cue(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Gt(i.fixUpperEdge),Gt(++r===1)),Gt(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,kt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new hue(s,kt.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Gt(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!kt.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),fue=function(){function e(){this.mesh=new vz,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Zi.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],u=[0,0,0],h=[0,0,0],c=[0,0,0],f=[0,0,0],m=[null,null,null],g=[null,null,null],y=this.mesh.vHead;i=y.next;for(var v=0;v<3;++v)s=i.coords[v],u[v]=s,g[v]=i,l[v]=s,m[v]=i;for(i=y.next;i!==y;i=i.next)for(var b=0;b<3;++b)s=i.coords[b],s<u[b]&&(u[b]=s,g[b]=i),s>l[b]&&(l[b]=s,m[b]=i);var S=0;if(l[1]-u[1]>l[0]-u[0]&&(S=1),l[2]-u[2]>l[S]-u[S]&&(S=2),u[S]>=l[S]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=g[S],n=m[S],h[0]=r.coords[0]-n.coords[0],h[1]=r.coords[1]-n.coords[1],h[2]=r.coords[2]-n.coords[2],i=y.next;i!==y;i=i.next)c[0]=i.coords[0]-n.coords[0],c[1]=i.coords[1]-n.coords[1],c[2]=i.coords[2]-n.coords[2],f[0]=h[1]*c[2]-h[2]*c[1],f[1]=h[2]*c[0]-h[0]*c[2],f[2]=h[0]*c[1]-h[1]*c[0],a=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],a>o&&(o=a,t[0]=f[0],t[1]=f[1],t[2]=f[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,u=t.next;u!==t;u=u.next)l?(this.bmin[0]=this.bmax[0]=u.s,this.bmin[1]=this.bmax[1]=u.t,l=!1):(u.s<this.bmin[0]&&(this.bmin[0]=u.s),u.s>this.bmax[0]&&(this.bmax[0]=u.s),u.t<this.bmin[1]&&(this.bmin[1]=u.t),u.t>this.bmax[1]&&(this.bmax[1]=u.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;kt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;kt.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(kt.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(kt.edgeGoesLeft(n.Lnext)||kt.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(kt.edgeGoesRight(r.Lprev)||kt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var u=t.vHead.next;u!==t.vHead;u=u.next)u.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,!!h.inside){s=h.anEdge,l=0;do{var u=s.Org;u.n===-1&&(u.n=o,o++),l++,s=s.Lnext}while(s!==h.anEdge);if(l>r)throw"Face vertex greater that support polygon";h.n=a,++a}this.elementCount=a,i===Kr.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var u=t.vHead.next;u!==t.vHead;u=u.next)if(u.n!==-1){var c=u.n*n;this.vertices[c+0]=u.coords[0],this.vertices[c+1]=u.coords[1],n>2&&(this.vertices[c+2]=u.coords[2]),this.vertexIndices[u.n]=u.idx}for(var f=0,h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=h.anEdge,l=0;do{var u=s.Org;this.elements[f++]=u.n,l++,s=s.Lnext}while(s!==h.anEdge);for(var m=l;m<r;++m)this.elements[f++]=-1;if(i===Kr.CONNECTED_POLYGONS){s=h.anEdge;do this.elements[f++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==h.anEdge);for(var g=l;g<r;++g)this.elements[f++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,u=0,h=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[u++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[h++]=s,this.elements[h++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new vz),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=Zi.ODD),i===void 0&&(i=Kr.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),due.computeInterior(this,a);var o=this.mesh;return i===Kr.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Kr.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function lc(e){var t=e.windingRule,i=t===void 0?Zi.ODD:t,r=e.elementType,n=r===void 0?Kr.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,u=e.normal,h=u===void 0?[0,0,1]:u,c=e.contours,f=c===void 0?[]:c,m=e.strict,g=m===void 0?!0:m,y=e.debug,v=y===void 0?!1:y;if(!f&&g)throw new Error("Contours can't be empty");if(f){var b=new fue;e.edgeCreateCallback&&(b.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(b.vertexIdCallback=e.vertexIdCallback);for(var S=0;S<f.length;S++)b.addContour(l||2,f[S]);return b.tesselate(i,n,a,l,h,g),{vertices:b.vertices,vertexIndices:b.vertexIndices,vertexCount:b.vertexCount,elements:b.elements,elementCount:b.elementCount,mesh:v?b.mesh:void 0}}}Zi.ODD;Zi.NONZERO;Zi.POSITIVE;Zi.NEGATIVE;Zi.ABS_GEQ_TWO;Kr.POLYGONS;Kr.CONNECTED_POLYGONS;Kr.BOUNDARY_CONTOURS;var E2=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*E2.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*E2.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},EV=E2;EV.eSize=8*Float32Array.BYTES_PER_ELEMENT;var pue=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function mue(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[S,_]of e[0])S<n&&(n=S),_<s&&(s=_),S>a&&(a=S),_>o&&(o=_);let l=a-n,u=o-s,h=Math.max(i,Math.min(l,u));if(h===i){let S=[n,s];return S.distance=0,S.distance}let c=new pue([],(S,_)=>_.max-S.max),f=vue(e),m=new Cw(n+l/2,s+u/2,0,e);m.d>f.d&&(f=m);let g=2;function y(S,_,T){let M=new Cw(S,_,T,e);if(g++,M.max>f.d+i&&c.push(M),M.d>f.d&&(f=M,r&&console.log(`found best ${Math.round(1e4*M.d)/1e4} after ${g} probes`),f.d>t))return t}let v=h/2;for(let S=n;S<a;S+=h)for(let _=s;_<o;_+=h)y(S+v,_+v,v);for(;c.length;){let{max:S,x:_,y:T,h:M}=c.pop();if(S-f.d<=i)break;v=M/2,y(_-v,T-v,v),y(_+v,T-v,v),y(_-v,T+v,v),y(_+v,T+v,v)}r&&console.log(`num probes: ${g}
best distance: ${f.d}`);let b=[f.x,f.y];return b.distance=f.d,b.distance}function Cw(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=gue(e,t,r),this.max=this.d+this.h*Math.SQRT2}function gue(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let u=s[a],h=s[l];u[1]>t!=h[1]>t&&e<(h[0]-u[0])*(t-u[1])/(h[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,yue(e,t,u,h))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function vue(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let u=n[a],h=n[l],c=u[0]*h[1]-h[0]*u[1];i+=(u[0]+h[0])*c,r+=(u[1]+h[1])*c,t+=c*3}let s=new Cw(i/t,r/t,0,e);return t===0||s.d<0?new Cw(n[0][0],n[0][1],0,e):s}function yue(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var LM={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},AV={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},CV={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},HA=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),zM=class extends St{constructor(e,t,i=0,r=12,n=3,s=Zi.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(D=>{let I=D.extractShapePointsToFlatArray([],r),O=[];for(let N=I.length-1;N>=1;N-=2){let k=I[N-1],U=I[N-0];O.push(k,U)}return O}),u=[],h=[];for(let D=0;D<o.length;D+=2)h.push([o[D],o[D+1]]);u.push(h);for(let D=0;D<l.length;D++){let I=l[D],O=[];for(let N=0;N<I.length;N+=2)O.push([I[N],I[N+1]]);u.push(O)}let c;e.isText?c=new tM().setFromPoints(e.points.map(D=>D.position)).getSize(new oe).length()*.1:u[0].length===0?c=i:i>0?c=mue(u,i):c=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,c,t/2),this._bevelSegments=Math.floor(n));let f;try{f=lc({windingRule:s,elementType:Kr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{f=LM}let m;try{m=lc({windingRule:Zi.ODD,elementType:Kr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{m=AV}if(!f)throw new Error("error generating geometry");let g=f.elementCount;if(m){f.elementCount+=m.elementCount;for(let D=0;D<m.elements.length;D++){let I=m.elements[D],O=D%2===0?f.vertexCount:0;f.elements.push(I+O)}for(let D=0;D<m.vertexIndices.length;D++){let I=m.vertexIndices[D],O=f.vertexCount;f.vertexIndices.push(I+O)}for(let D=0;D<m.vertices.length;D++){let I=m.vertices[D];f.vertices.push(I)}}let y=1/0,v=-1/0,b=1/0,S=-1/0;for(let D=0,I=f.vertexCount;D<I;D++){let O=D*2,N=f.vertices[O+0],k=f.vertices[O+1];N<y&&(y=N),N>v&&(v=N),k<b&&(b=k),k>S&&(S=k)}this._minX=y,this._minY=b,this._width=v-y,this._height=S-b,this._buffer=new EV(this._computeBufferEstimatedSize(f));let _=[],T=[];for(let D=f.elementCount-1;D>=0;D--){let I=D>=g,O=D*2,N=f.elements[O+0],k=f.elements[O+1],U=N+k,Q={start:N,count:k,normals:[],continuous:[],concave:[]},se=N,K=U-1,H=N+1,ie=this._shape.roundedCurves.length;do{let ne=se-N,he=f.vertices[K*2+0],te=f.vertices[K*2+1],me=f.vertices[se*2+0],de=f.vertices[se*2+1],fe=f.vertices[H*2+0],ye=f.vertices[H*2+1],Te=me-he,Ie=de-te,Ne=Math.sqrt(Te*Te+Ie*Ie);Te/=Ne,Ie/=Ne;let st=me-fe,We=de-ye,ct=Math.sqrt(st*st+We*We);st/=ct,We/=ct,Q.normals[ne*2+0]=-We,Q.normals[ne*2+1]=st,Q.concave[ne]=Te*We-Ie*st>0;let ut=f.vertexIndices[se];if(Array.isArray(ut))Q.continuous[ne]=!1;else{let[Ke,Ye]=this._shape.getCurveIndexFromVertexId(ut-1,!0);if(Ye>0&&Ye<1)Q.continuous[ne]=!0;else{let yt=Ye===1?Ke+1:Ke-1;yt=(yt+ie)%ie;let pt=Ye===1?0:1,re=this._shape.roundedCurves[Ke].getTangent(Ye),Y=this._shape.roundedCurves[yt].getTangent(pt);Q.continuous[ne]=re.dot(Y)>.95}}I&&(Q.normals[ne*2+0]*=-1,Q.normals[ne*2+1]*=-1),[K,se,H]=[se,H,H+1],H>=U&&(H-=k)}while(H!==N+1);let $=[];$.push({bevelI:0,angle:0,size:0,boundary:{vertices:f.vertices.slice(N*2,U*2),vertexCount:k,vertexIndices:new Array(k).fill(!0).map((ne,he)=>[he,he]),elements:[0,k],elementCount:1,mesh:null},reverseMap:[],insetPoints:f.vertices.slice(N*2,U*2)});let V=0;for(let ne=1;ne<=this._bevelSegments;ne++){let he=ne/this._bevelSegments*Math.PI/2,te=(1-Math.cos(he))*this._bevel,me=[],de=[],fe=0;for(let Te=0;Te<k;Te++){let Ie=Te*2,Ne=(Te-1+k)%k*2,st=f.vertices[Q.start*2+Ie+0],We=f.vertices[Q.start*2+Ie+1],ct=-Q.normals[Ne+0]*te,ut=-Q.normals[Ne+1]*te,Ke=-Q.normals[Ie+0]*te,Ye=-Q.normals[Ie+1]*te;if(Q.concave[Te]||!Q.concave[Te]&&I){let yt=Math.atan2(ut,ct),pt=Math.atan2(Ye,Ke);pt>yt&&(pt-=Math.PI*2);let re=pt-yt;if(Q.continuous[Te]||I){let Y=yt+re/2,Ee=Math.cos(Y)*te,Ve=Math.sin(Y)*te;me[2*fe+0]=st+Ee*(I?-1:1),me[2*fe+1]=We+Ve*(I?-1:1),de[fe]=Te,fe++}else{let Y=Math.max(1,Math.floor(r/4*Math.abs(re)/Math.PI));for(let Ee=0;Ee<=Y;Ee++){let Ve=yt+re*(Ee/Y),W=Math.cos(Ve)*te,Ge=Math.sin(Ve)*te;me[2*fe+0]=st+W,me[2*fe+1]=We+Ge,de[fe]=Te,fe++}}}else me[2*fe+0]=st+ct,me[2*fe+1]=We+ut,de[fe]=Te,fe++,me[2*fe+0]=st,me[2*fe+1]=We,de[fe]=Te,fe++,me[2*fe+0]=st+Ke,me[2*fe+1]=We+Ye,de[fe]=Te,fe++}let ye=lc({windingRule:Zi.POSITIVE,elementType:Kr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[me],edgeCreateCallback:Te=>{let Ie=Te.Org.idx,Ne=de[Ie],st=de[(Ie+1)%de.length];Te.idx=[Ne,st],Te.Sym.idx=[st,Ne]},vertexIdCallback:Te=>{let Ie=Te.Lprev.idx;return[Ie?Ie[1]:0,Te.idx?Te.idx[0]:0]}});if(!ye)throw console.log("Error"),new Error(`error generating bevel geometry for ${ne}'th loop`);if(!ye.vertexCount){let Te=(ne-1)/this._bevelSegments*Math.PI/2;V=(1-Math.sin(Te))*this._bevel;break}for(let Te=0;Te<ye.vertexIndices.length;Te++){let[Ie,Ne]=ye.vertexIndices[Te];if(Ie===Ne)continue;let st=Ne;Ne<Ie&&(st+=k);for(let We=Ie;We<st;We++){let ct=We%k,ut=(We+1)%k;if(!Q.continuous[ct]||!Q.continuous[ut]){ye.vertexIndices[Te]=[Ie,ct],ye.vertexIndices.splice(Te+1,0,[ut,Ne]),ye.vertices.splice((Te+1)*2,0,ye.vertices[Te*2],ye.vertices[Te*2+1]);break}}}$.push({bevelI:ne,angle:he,size:te,boundary:ye,reverseMap:de,insetPoints:me})}let X=(ne,he,te)=>{let me=0,de=ne.boundary.vertexIndices.length;for(;me<de&&te(ne.boundary.vertexIndices[he]);)he=(he+1)%de,me++;return me},ue=_.length;for(let ne=1;ne<$.length;ne++){let he=$[ne-1],te=$[ne],me=he.boundary.vertexIndices.length,de=te.boundary.vertexIndices.length;if(!me||!de)break;let fe=Q.concave.length,ye=0,Te=HA(ye,k);for(;!he.boundary.vertexIndices.filter(Te).length||!te.boundary.vertexIndices.filter(Te).length;)ye++,Te=HA(ye,k);let Ie=he.boundary.vertexIndices.findIndex(Te),Ne=te.boundary.vertexIndices.findIndex(Te);do Ie=(Ie+1)%me;while(Te(he.boundary.vertexIndices[Ie]));do Ne=(Ne+1)%de;while(Te(te.boundary.vertexIndices[Ne]));ye=(ye+1)%k;let st=ye,We=0,ct=this._buildBevelVert(Q,he,(Ie-1+me)%me,void 0,We),ut=this._buildBevelVert(Q,te,(Ne-1+de)%de,void 0,We),Ke=ct,Ye=ut,yt,pt,re=!1;do{We=(ye||fe)/fe,Te=HA(ye,k);let Y=X(he,Ie,Te),Ee=X(te,Ne,Te),Ve=re;if(re=!1,Y&&!Ee){for(let W=0;W<Y;W++)yt=this._buildBevelVert(Q,he,(Ie+W)%me,W/(Y-1),We),_.push(Ke.topN,yt.topP,Ye.topN),a===!1&&_.push(yt.bottomP,Ke.bottomN,Ye.bottomN),Ke=yt;re=!0}else if(!Y&&Ee)for(let W=0;W<Ee;W++)pt=this._buildBevelVert(Q,te,(Ne+W)%de,W/(Ee-1),We),_.push(Ye.topN,Ke.topP,pt.topP),a===!1&&_.push(Ke.bottomP,Ye.bottomN,pt.bottomP),Ye=pt;else if(Y&&Ee)if(yt=this._buildBevelVert(Q,he,Ie,0,We),pt=this._buildBevelVert(Q,te,Ne,0,We),Ve?(_.push(Ke.topN,pt.topP,Ye.topN),_.push(Ke.topN,yt.topP,pt.topP),a===!1&&(_.push(pt.bottomP,Ke.bottomN,Ye.bottomN),_.push(pt.bottomP,yt.bottomP,Ke.bottomN))):(_.push(Ye.topN,Ke.topN,yt.topP),_.push(Ye.topN,yt.topP,pt.topP),a===!1&&(_.push(yt.bottomP,Ke.bottomN,Ye.bottomN),_.push(yt.bottomP,Ye.bottomN,pt.bottomP))),Ke=yt,Ye=pt,Y===Ee)for(let W=1;W<Y;W++)yt=this._buildBevelVert(Q,he,(Ie+W)%me,W/(Y-1),We),pt=this._buildBevelVert(Q,te,(Ne+W)%de,W/(Ee-1),We),_.push(Ke.topN,yt.topP,Ye.topN),_.push(Ye.topN,yt.topP,pt.topP),a===!1&&(_.push(yt.bottomP,Ke.bottomN,Ye.bottomN),_.push(yt.bottomP,Ye.bottomN,pt.bottomP)),Ke=yt,Ye=pt;else if(Y>Ee){let W=Y/Ee,Ge=0;for(let lt=1;lt<Y;lt++)yt=this._buildBevelVert(Q,he,(Ie+lt)%me,lt/(Y-1),We),_.push(Ke.topN,yt.topP,Ye.topN),a===!1&&_.push(yt.bottomP,Ke.bottomN,Ye.bottomN),Ke=yt,lt>(Ge+1)*W&&(Ge++,pt=this._buildBevelVert(Q,te,(Ne+Ge)%de,Ge/(Ee-1),We),_.push(Ye.topN,yt.topP,pt.topP),a===!1&&_.push(yt.bottomP,Ye.bottomN,pt.bottomP),Ye=pt)}else{let W=Ee/Y,Ge=0;for(let lt=1;lt<Ee;lt++)pt=this._buildBevelVert(Q,te,(Ne+lt)%de,lt/(Ee-1),We),_.push(Ye.topN,yt.topP,pt.topP),a===!1&&_.push(yt.bottomP,Ye.bottomN,pt.bottomP),Ye=pt,lt>(Ge+1)*W&&(Ge++,yt=this._buildBevelVert(Q,he,(Ie+Ge)%me,Ge/(Y-1),We),_.push(Ke.topN,yt.topP,Ye.topN),a===!1&&_.push(yt.bottomP,Ke.bottomN,Ye.bottomN),Ke=yt)}Ie=(Ie+Y)%me,Ne=(Ne+Ee)%de,ye=(ye+1)%fe}while(ye!==st)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall($,Q,_),I){let ne=[];for(let he=_.length-1;he>=ue+2;he-=3){let te=_[he-2],me=_[he-1],de=_[he-0];ne.push(de,me,te)}_.splice(ue,_.length-ue,...ne)}if(I){let ne=[];for(let he=$[$.length-1].boundary.vertices.length-1;he>=1;he-=2){let te=$[$.length-1].boundary.vertices[he-1],me=$[$.length-1].boundary.vertices[he-0];ne.push(te,me)}T.push(ne)}if(!I){let ne=$[$.length-1],he;try{he=lc({windingRule:$.length>1?Zi.POSITIVE:Zi.ODD,elementType:Kr.POLYGONS,vertexSize:2,strict:!0,contours:[ne.insetPoints,...T]})}catch{he=CV}if(!he)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<c&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let te=0;te<he.elementCount*3;te+=3){let me=this._buildSurfaceVert(he,he.elements[te+0],V),de=this._buildSurfaceVert(he,he.elements[te+1],V),fe=this._buildSurfaceVert(he,he.elements[te+2],V);_.push(me.top,de.top,fe.top),a===!1&&_.push(fe.bottom,de.bottom,me.bottom)}}this.vertexCache={}}this._buffer.shrink();let M=new Bt(Uint32Array.from(_),1),C=new Bt(this._buffer.positions,3),P=new Bt(this._buffer.normals,3),E=new Bt(this._buffer.uvs,2);C.needsUpdate=!0,P.needsUpdate=!0,E.needsUpdate=!0,M.needsUpdate=!0,this.setAttribute("position",C),this.setAttribute("normal",P),this.setAttribute("uv",E),this.setIndex(M)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),u=l*3,h=l*2,c={top:l+0,bottom:l+1};return this._buffer.positions[u+0]=n,this._buffer.positions[u+1]=s,this._buffer.positions[u+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[u+0]=0,this._buffer.normals[u+1]=0,this._buffer.normals[u+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,this.forPathBevel===!1&&(this._buffer.positions[u+3]=n,this._buffer.positions[u+4]=s,this._buffer.positions[u+5]=i,this._buffer.normals[u+3]=0,this._buffer.normals[u+4]=0,this._buffer.normals[u+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[r]=c,c}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,u,h,c;a!==o?(u=a,l=o,c=!1,h=e.continuous[u]&&e.continuous[l]):(l=a,u=(l-1+e.count)%e.count,c=e.concave[l]&&t.bevelI>0,h=e.continuous[l]||c);let f=Math.cos(t.angle),m=Math.sin(t.angle),g=i*2,y=l*2,v=u*2,b=t.boundary.vertices[g+0],S=t.boundary.vertices[g+1],_=(1-m)*this._bevel,T=(b-this._minX)/this._width,M=(S-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(T=n),M=1);let C=e.normals[y+0],P=e.normals[y+1],E=e.normals[v+0],D=e.normals[v+1];if(c){let U=E-C,Q=D-P;C=C+U*(1-r),P=P+Q*(1-r);let se=Math.sqrt(C*C+P*P);C/=se,P/=se}let I=this.forPathBevel?this._buffer.get(h?1:2):this._buffer.get(h?2:4),O=I*3,N=I*2,k={i,fi:l,topP:I+0,topN:I+0,bottomP:I+1,bottomN:I+1,pathBevelUCoord:n};return this._buffer.positions[O+0]=b,this._buffer.positions[O+1]=S,this._buffer.positions[O+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[O+0]=C*f,this._buffer.normals[O+1]=P*f,this._buffer.normals[O+2]=m,this._buffer.uvs[N+0]=T,this._buffer.uvs[N+1]=M,this.forPathBevel===!1&&(this._buffer.positions[O+3]=b,this._buffer.positions[O+4]=S,this._buffer.positions[O+5]=_,this._buffer.normals[O+3]=C*f,this._buffer.normals[O+4]=P*f,this._buffer.normals[O+5]=-m,this._buffer.uvs[N+2]=M,this._buffer.uvs[N+3]=T),h||(this.forPathBevel?(I+=1,O+=3,N+=2):(I+=2,O+=6,N+=4),k.topP=I+0,k.bottomP=I+1,this._buffer.positions[O+0]=b,this._buffer.positions[O+1]=S,this._buffer.positions[O+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[O+0]=E*f,this._buffer.normals[O+1]=D*f,this._buffer.normals[O+2]=m,this._buffer.uvs[N+0]=T,this._buffer.uvs[N+1]=M,this.forPathBevel===!1&&(this._buffer.positions[O+3]=b,this._buffer.positions[O+4]=S,this._buffer.positions[O+5]=_,this._buffer.normals[O+3]=E*f,this._buffer.normals[O+4]=D*f,this._buffer.normals[O+5]=-m,this._buffer.uvs[N+2]=M,this._buffer.uvs[N+3]=T)),this.vertexCache[s]=k,k}clone(){let e=new zM(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=E_(this.userData),e}},TV=class extends St{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Zi.ODD,this.elementType=Kr.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Zi.ODD,elementType:Kr.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(f=>f.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,u;for(let f=0,m=r.length/2;f<m;f++){let g=f*2,y=r[g+0],v=r[g+1];if(l!==void 0&&y!==l&&(a=!1),u!==void 0&&v!==u&&(o=!1),l=y,u=v,!a&&!o)break}if(!a&&!o)try{s=lc({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=LM}let h=(s==null?void 0:s.vertexCount)??1,c=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Bt(new Float32Array(h*3),3),this._normalAttribute=new Bt(new Float32Array(h*3),3),this._uvAttribute=new Bt(new Float32Array(h*2),2),this._indexAttribute=new Bt(new Uint32Array(c*3),1),s){let f=1/0,m=-1/0,g=1/0,y=-1/0;for(let S=0,_=h;S<_;S++){let T=S*2,M=s.vertices[T+0],C=s.vertices[T+1];M<f&&(f=M),M>m&&(m=M),C<g&&(g=C),C>y&&(y=C)}let v=m-f,b=y-g;for(let S=0,_=h;S<_;S++){let T=S*2,M=s.vertices[T+0],C=s.vertices[T+1],P=(M-f)/v,E=(C-g)/b;this._positionAttribute.setXYZ(S,M,C,0),this._normalAttribute.setXYZ(S,0,0,1),this._uvAttribute.setXY(S,P,E)}for(let S=0,_=c;S<_;S++){let T=S*3,M=s.elements[T+0],C=s.elements[T+1],P=s.elements[T+2];this._indexAttribute.setX(T+0,M),this._indexAttribute.setX(T+1,C),this._indexAttribute.setX(T+2,P)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new TV(this._shape,this._curveSegments);return e.userData=E_(this.userData),e}},PV=class extends zM{constructor(e,t,i=0,r=12,n=3,s=Zi.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new PV(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=E_(this.userData),e}},sf=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var u,h;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Zi.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof Or?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Or(r,n).fromJSON(a),((u=e.parameters)==null?void 0:u.roundness)!==void 0&&((h=e.parameters)==null?void 0:h.roundness)>0&&a.update());let l=a??new Or(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new TV(e.shape,n,{windingRule:a}):o=new PV(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},MV=Math.PI*2,NM=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=ht.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Or?e.shape:new Or,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u=e.shape,h=t*.5,c=i*.5,f=xue(u,h,c,n*Math.PI/180,r,s);u.isClosed=!0,u.update();let m;return n===0?(m=new St,m.setAttribute("position",new ot([],3))):m=sf.create({shape:u,parameters:{subdivisions:f,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(m,{userData:{...e,type:"EllipseGeometry"}})}};function xue(e,t,i,r,n,s){if(r>=MV)return n>30||n%4===0?(wue(e,t,i,s),Math.round(n/4)):wz(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},u=uue({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%u.length===0?bue(e,a.x,a.y,u,n,t,i,s):wz(e,r,n,t,i,s)}function bue(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(Qp(t,i));for(let u=0,h=r.length;u<h;u++){let c=r[u],f=e.points[u],m=Qp(c.x,c.y);f.controls[1].position.set(c.x1,c.y1),m.controls[0].position.set(c.x2,c.y2),e.addPoint(m)}return o>0?DV(e,s,a,o):e.addPoint(Qp(0,0)),l}function wz(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,u=Math.sin(l)*r,h=Math.cos(l)*n;e.addPoint(Qp(u,h))}return t<MV?s>0?DV(e,r,n,s):e.addPoint(Qp(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&IV(e,r,n,s)),1}function wue(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(px(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(px(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(px(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(px(n,s-i,n+o,s-i,n-o,s-i)),r>0&&IV(e,t,i,r)}function Qp(e,t){return new Yp(ht.generateUUID(),new oe(e,t))}function px(e,t,i,r,n,s){let a=Qp(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function DV(e,t,i,r){RV(e,t,i,r).forEach(n=>e.addPoint(n))}function IV(e,t,i,r){let n=RV(e,t,i,r),s=new Or;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function RV(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new oe(n/t,s/i),o=e.points.map(l=>{let u=l.clone();return u.uuid=ht.generateUUID(),u}).reverse();return o.forEach(l=>{l.position.multiply(a);let u=l.controls[0].position.clone().multiply(a),h=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(h),l.controls[1].position.copy(u)}),o}var _ue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:u,cornerRadius:h,cornerSegments:c}=e.parameters,f=new OV(!1,t,i,r,n,s,a,o,l,u,h,c);return Object.assign(f,{userData:{...e,type:"HelixGeometry"}})}},GA=new Hp([0,0,0],1),OV=class extends St{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,u=1,h=1,c=1){if(super(),s===0)return;let f=e&&s===1;f&&(c=0),h>100&&(h=100),h===0&&(c=0);let m=()=>new L,g=new L,y=m(),v=m(),b=m(),S,_,T,M,C,P,E,D,I=m(),O=m(),N=m(),k=m(),U=m(),Q=m(),se=m(),K=m(),H=i-2*o+.001,ie=H/s,$=Math.ceil(a*s),V=$+1,X=H/$,ue=-H/2,ne=u+1,he=2*Math.PI/u,te=Math.PI/2/c,me=.01,de=Math.min((1-h/100)*o,o-me),fe=o-de,ye=0,Te=2,Ie=c*Te+Te,Ne=ne*Ie/Te,st=Ne+ne*V,We=Math.max(0,ne*(V+Ie)),[ct,ut,Ke]=[3,3,2].map(De=>Array(We*De).fill(0)),Ye=[],yt=n-o;function pt(De,dt){let at=Math.PI/2;P=dt*X,D=2*Math.PI*(P%ie)/ie+at,P+=ue,E=Math.sin(D)*yt,C=Math.cos(D)*yt,e?De.set(C,E,P):De.set(C,P,E)}pt(g,-1e-10),pt(y,0),I.copy(g),pt(g,1);let re=g.distanceTo(y),Y=f?0:fe+de,Ee=re*$+2*Y,Ve=de,W=Ee-Y;for(let De=0;De<=$;De++){pt(v,De),K.subVectors(v,I).normalize(),I.copy(v),Q.copy(v).setComponent(+e+1,0).normalize(),se.crossVectors(K,Q).normalize();let dt=De===0,at=De===$,bt=dt?3*Math.PI/2:te,Dt=dt?Ve:W,Ct=dt?ne:st,Pt=dt?0:We-ne,Oi=K.clone().multiplyScalar(dt?-fe:fe).add(v),ji=K.clone().multiplyScalar(dt?-1:1).normalize();for(let pe=0;pe<ne;pe++){let Oe=pe*he;if(O.addVectors(g.copy(Q).multiplyScalar(o*Math.cos(Oe)),y.copy(se).multiplyScalar(o*Math.sin(Oe))),N.copy(O).normalize(),dt||at){f||(ye=Pt+pe,[0,1,2].forEach(Be=>{ct[ye*3+Be]=Oi.getComponent(Be),ut[ye*3+Be]=ji.getComponent(Be)}),Ke[ye*2]=+at,Ke[ye*2+1]=pe/u),y.copy(N).multiplyScalar(de),b.addVectors(v,y);for(let Be=0;Be<c;Be++){let et=Be*te+bt;k.addVectors(g.copy(K).multiplyScalar(fe*Math.sin(et)),y.copy(N).multiplyScalar(fe*Math.cos(et))),U.copy(k).normalize(),y.addVectors(b,k),k.normalize(),ye=Ct+Be*ne+pe,[0,1,2].forEach(ti=>{ct[ye*3+ti]=y.getComponent(ti),ut[ye*3+ti]=U.getComponent(ti)});let Ot=+dt+Math.sin(et);Ke[ye*2]=(Dt+fe*Ot)/Ee,Ke[ye*2+1]=pe/u}}y.addVectors(v,O),ye=Ne+De*ne+pe,[0,1,2].forEach(Be=>{ct[ye*3+Be]=y.getComponent(Be),ut[ye*3+Be]=N.getComponent(Be)}),Ke[ye*2]=(Y+De*re)/Ee,Ke[ye*2+1]=pe/u}}let Ge=V+2*c+Te,[lt,it]=[+f,Ge-1];for(let De=lt;De<=it-1;De++){let dt=f&&De===it-1;for(let at=0;at<ne-1;at++)S=De*ne+at,_=S+1,T=(dt?at:S)+ne,M=(dt?at+1:_)+ne,De===0?Ye.push(_,M,T):De===Ge-2?Ye.push(S,_,T):Ye.push(S,_,T,_,M,T)}this.setIndex(Ye),this.setAttribute("position",new ot(ct,3)),this.setAttribute("normal",new ot(ut,3)),this.setAttribute("uv",new ot(Ke,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,u=t,h=u===t;for(let c=0;c<e.radialSegments;c++)n=u*i+c,s=n+1,a=(h?c:n)+i,o=(h?c+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,GA.array=r,GA.count=r.length,GA}},Sue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new kV(t*.5,s,a):new R5(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},kV=class extends RM{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new kV(e.radius,e.corner,e.cornerSides)}},Eue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new Hb;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new C5(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},cl=new je,WA=new qi,mx=new L,Tw=class extends as{constructor(){super(),this.uuid=ht.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Zr().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return cl.makeRotationX(e),this.applyMatrix4(cl),this}rotateY(e){return cl.makeRotationY(e),this.applyMatrix4(cl),this}rotateZ(e){return cl.makeRotationZ(e),this.applyMatrix4(cl),this}translate(e,t,i){return cl.makeTranslation(e,t,i),this.applyMatrix4(cl),this}scale(e,t,i){return cl.makeScale(e,t,i),this.applyMatrix4(cl),this}lookAt(e){return WA.lookAt(e),WA.updateMatrix(),this.applyMatrix4(WA.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let c=0;c<n.count;c++)t.vertices.push(new L().fromBufferAttribute(n,c)),a!==void 0&&t.colors.push(new Nt().fromBufferAttribute(a,c));function u(c,f,m,g){let y=a===void 0?[]:[t.colors[c].clone(),t.colors[f].clone(),t.colors[m].clone()],v=s===void 0?[]:[new L().fromBufferAttribute(s,c),new L().fromBufferAttribute(s,f),new L().fromBufferAttribute(s,m)],b=new A2(c,f,m,v,y,g);t.faces.push(b),o!==void 0&&t.faceVertexUvs[0].push([new oe().fromBufferAttribute(o,c),new oe().fromBufferAttribute(o,f),new oe().fromBufferAttribute(o,m)]),l!==void 0&&t.faceVertexUvs[1].push([new oe().fromBufferAttribute(l,c),new oe().fromBufferAttribute(l,f),new oe().fromBufferAttribute(l,m)])}let h=e.groups;if(h.length>0)for(let c=0;c<h.length;c++){let f=h[c],m=f.start,g=f.count;for(let y=m,v=m+g;y<v;y+=3)i!==void 0?u(i.getX(y),i.getX(y+1),i.getX(y+2),f.materialIndex):u(y,y+1,y+2,f.materialIndex)}else if(i!==void 0)for(let c=0;c<i.count;c+=3)u(i.getX(c),i.getX(c+1),i.getX(c+2));else for(let c=0;c<n.count;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mx).negate(),this.translate(mx.x,mx.y,mx.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new je;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new L,t=new L;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new L;if(e){let i=new L,r=new L;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c];i.subVectors(u,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new Tw;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new L,u={a:new L,b:new L,c:new L};n.push(l),s.push(u)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jr),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ua),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,u=this.colors,h=e.colors;t!==void 0&&(r=new Zr().getNormalMatrix(t));for(let c=0,f=a.length;c<f;c++){let m=a[c].clone();t!==void 0&&m.applyMatrix4(t),s.push(m)}for(let c=0,f=h.length;c<f;c++)u.push(h[c].clone());for(let c=0,f=l.length;c<f;c++){let m=l[c],g,y,v=m.vertexNormals,b=m.vertexColors,S=new A2(m.a+n,m.b+n,m.c+n);S.normal.copy(m.normal),r!==void 0&&S.normal.applyMatrix3(r).normalize();for(let _=0,T=v.length;_<T;_++)g=v[_].clone(),r!==void 0&&g.applyMatrix3(r).normalize(),S.vertexNormals.push(g);S.color.copy(m.color);for(let _=0,T=b.length;_<T;_++)y=b[_],S.vertexColors.push(y.clone());S.materialIndex=m.materialIndex+i,o.push(S)}for(let c=0,f=e.faceVertexUvs.length;c<f;c++){let m=e.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let g=0,y=m.length;g<y;g++){let v=m[g],b=[];for(let S=0,_=v.length;S<_;S++)b.push(v[S].clone());this.faceVertexUvs[c].push(b)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let u=this.vertices[o],h=Math.round(u.x*n)+"_"+Math.round(u.y*n)+"_"+Math.round(u.z*n);t[h]===void 0?(t[h]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[h]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let u=this.faces[o];u.a=r[u.a],u.b=r[u.b],u.c=r[u.c];let h=[u.a,u.b,u.c];for(let c=0;c<3;c++)if(h[c]===h[(c+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let u=0,h=this.faceVertexUvs.length;u<h;u++)this.faceVertexUvs[u].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new L(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let m=this.parameters;for(let g in m)m[g]!==void 0&&(e[g]=m[g]);return e}let t=[];for(let m=0;m<this.vertices.length;m++){let g=this.vertices[m];t.push(g.x,g.y,g.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let m=0;m<this.faces.length;m++){let g=this.faces[m],y=!0,v=!1,b=this.faceVertexUvs[0][m]!==void 0,S=g.normal.length()>0,_=g.vertexNormals.length>0,T=g.color.r!==1||g.color.g!==1||g.color.b!==1,M=g.vertexColors.length>0,C=0;if(C=u(C,0,0),C=u(C,1,y),C=u(C,2,v),C=u(C,3,b),C=u(C,4,S),C=u(C,5,_),C=u(C,6,T),C=u(C,7,M),i.push(C),i.push(g.a,g.b,g.c),i.push(g.materialIndex),b){let P=this.faceVertexUvs[0][m];i.push(f(P[0]),f(P[1]),f(P[2]))}if(S&&i.push(h(g.normal)),_){let P=g.vertexNormals;i.push(h(P[0]),h(P[1]),h(P[2]))}if(T&&i.push(c(g.color)),M){let P=g.vertexColors;i.push(c(P[0]),c(P[1]),c(P[2]))}}function u(m,g,y){return y?m|1<<g:m&~(1<<g)}function h(m){let g=m.x.toString()+m.y.toString()+m.z.toString();return n[g]!==void 0||(n[g]=r.length/3,r.push(m.x,m.y,m.z)),n[g]}function c(m){let g=m.r.toString()+m.g.toString()+m.b.toString();return a[g]!==void 0||(a[g]=s.length,s.push(m.getHex())),a[g]}function f(m){let g=m.x.toString()+m.y.toString();return l[g]!==void 0||(l[g]=o.length/2,o.push(m.x,m.y)),l[g]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new Tw().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let c=0,f=t.length;c<f;c++)this.vertices.push(t[c].clone());let i=e.colors;for(let c=0,f=i.length;c<f;c++)this.colors.push(i[c].clone());let r=e.faces;for(let c=0,f=r.length;c<f;c++)this.faces.push(r[c].clone());for(let c=0,f=e.faceVertexUvs.length;c<f;c++){let m=e.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let g=0,y=m.length;g<y;g++){let v=m[g],b=[];for(let S=0,_=v.length;S<_;S++){let T=v[S];b.push(T.clone())}this.faceVertexUvs[c].push(b)}}let n=e.morphTargets;for(let c=0,f=n.length;c<f;c++){let m={};if(m.name=n[c].name,n[c].vertices!==void 0){m.vertices=[];for(let g=0,y=n[c].vertices.length;g<y;g++)m.vertices.push(n[c].vertices[g].clone())}if(n[c].normals!==void 0){m.normals=[];for(let g=0,y=n[c].normals.length;g<y;g++)m.normals.push(n[c].normals[g].clone())}this.morphTargets.push(m)}let s=e.morphNormals;for(let c=0,f=s.length;c<f;c++){let m={};if(s[c].vertexNormals!==void 0){m.vertexNormals=[];for(let g=0,y=s[c].vertexNormals.length;g<y;g++){let v=s[c].vertexNormals[g],b={};b.a=v.a.clone(),b.b=v.b.clone(),b.c=v.c.clone(),m.vertexNormals.push(b)}}if(s[c].faceNormals!==void 0){m.faceNormals=[];for(let g=0,y=s[c].faceNormals.length;g<y;g++)m.faceNormals.push(s[c].faceNormals[g].clone())}this.morphNormals.push(m)}let a=e.skinWeights;for(let c=0,f=a.length;c<f;c++)this.skinWeights.push(a[c].clone());let o=e.skinIndices;for(let c=0,f=o.length;c<f;c++)this.skinIndices.push(o[c].clone());let l=e.lineDistances;for(let c=0,f=l.length;c<f;c++)this.lineDistances.push(l[c]);let u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());let h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new Aue().fromGeometry(this),t=new St,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",gx.call(new Bt(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",gx.call(new Bt(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",_z.call(new Bt(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",Sz.call(new Bt(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",Sz.call(new Bt(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],u=new ot(l.data.length*3,3);u.name=l.name,n.push(gx.call(u,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new ot(e.skinIndices.length*4,4);t.setAttribute("skinIndex",Ez.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new ot(e.skinWeights.length*4,4);t.setAttribute("skinWeight",Ez.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new St,i=e.geometry;if(e.isPoints||e.isLine){let r=new ot(i.vertices.length*3,3),n=new ot(i.colors.length*3,3);if(t.setAttribute("position",gx.call(r,i.vertices)),t.setAttribute("color",_z.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new ot(i.lineDistances.length,1);t.setAttribute("lineDistance",Cue.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};Tw.prototype.isGeometry=!0;var Aue=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let v=0;v<o;v++)l[v]={name:a[v].name,data:[]};this.morphTargets.position=l}let u=e.morphNormals,h=u.length,c;if(h>0){c=[];for(let v=0;v<h;v++)c[v]={name:u[v].name,data:[]};this.morphTargets.normal=c}let f=e.skinIndices,m=e.skinWeights,g=f.length===i.length,y=m.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let v=0;v<t.length;v++){let b=t[v];this.vertices.push(i[b.a],i[b.b],i[b.c]);let S=b.vertexNormals;if(S.length===3)this.normals.push(S[0],S[1],S[2]);else{let T=b.normal;this.normals.push(T,T,T)}let _=b.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let T=b.color;this.colors.push(T,T,T)}if(n===!0){let T=r[0][v];T!==void 0?this.uvs.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new oe,new oe,new oe))}if(s===!0){let T=r[1][v];T!==void 0?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new oe,new oe,new oe))}for(let T=0;T<o;T++){let M=a[T].vertices;l[T].data.push(M[b.a],M[b.b],M[b.c])}for(let T=0;T<h;T++){let M=u[T].vertexNormals[v];c[T].data.push(M.a,M.b,M.c)}g&&this.skinIndices.push(f[b.a],f[b.b],f[b.c]),y&&this.skinWeights.push(m[b.a],m[b.b],m[b.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},A2=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new L,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Nt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function Cue(e){return this.array.set(e),this}function _z(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Nt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function Sz(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new oe),t[i++]=s.x,t[i++]=s.y}return this}function gx(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new L),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function Ez(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new Yt),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var Tue=["a","b","c"];function Pue(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function qA(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function XA(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,u;if(r.has(l))u=r.get(l);else{let h=i[a],c=i[o];u={a:h,b:c,newEdge:null,faces:[]},r.set(l,u)}u.faces.push(n),s[e].edges.push(u),s[t].edges.push(u)}function Mue(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],XA(a.a,a.b,e,r,a,i),XA(a.b,a.c,e,r,a,i),XA(a.c,a.a,e,r,a,i)}function vx(e,t,i,r,n){e.push(new A2(t,i,r,void 0,void 0,n))}function lp(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function yx(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var Due=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof St?e=new Tw().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new L,i,r,n,s,a,o=e.vertices,l=e.faces,u=e.faceVertexUvs[0],h=u!==void 0&&u.length>0,c=[],f=new Map;Mue(o,l,c,f);let m=[],g,y,v,b,S,_,T;for(let me of Array.from(f.keys())){for(y=f.get(me),v=new L,S=3/8,_=1/8,T=y.faces.length,T!=2&&(S=.5,_=0,T!=1),v.addVectors(y.a,y.b).multiplyScalar(S),t.set(0,0,0),s=0;s<T;s++){for(b=y.faces[s],a=0;a<3&&(g=o[Pue(b,Tue[a])],!(g!==y.a&&g!==y.b));a++);g&&t.add(g)}t.multiplyScalar(_),v.add(t),y.newEdge=m.length,m.push(v)}let M,C,P,E,D,I,O,N=[];for(r=0,n=o.length;r<n;r++){for(I=o[r],D=c[r].edges,i=D.length,i==3?M=3/16:i>3&&(M=3/(8*i)),C=1-i*Number(M),P=M,i<=2&&(i==2?(C=3/4,P=1/8):i==1||i==0),O=I.clone().multiplyScalar(C),t.set(0,0,0),s=0;s<i;s++)E=D[s],g=E.a!==I?E.a:E.b,t.add(g);t.multiplyScalar(Number(P)),O.add(t),N.push(O)}let k=N.concat(m),U=N.length,Q,se,K,H=[],ie=[],$,V,X,ue,ne=new oe,he=new oe,te=new oe;for(r=0,n=l.length;r<n;r++)b=l[r],Q=Number(qA(b.a,b.b,f).newEdge)+U,se=Number(qA(b.b,b.c,f).newEdge)+U,K=Number(qA(b.c,b.a,f).newEdge)+U,vx(H,Q,se,K,b.materialIndex),vx(H,b.a,Q,K,b.materialIndex),vx(H,b.b,se,Q,b.materialIndex),vx(H,b.c,K,se,b.materialIndex),h&&($=u[r],V=$[0],X=$[1],ue=$[2],ne.set(lp(V.x,X.x),lp(V.y,X.y)),he.set(lp(X.x,ue.x),lp(X.y,ue.y)),te.set(lp(V.x,ue.x),lp(V.y,ue.y)),yx(ie,ne,he,te),yx(ie,V,ne,te),yx(ie,X,he,ne),yx(ie,ue,te,he));e.vertices=k,e.faces=H,h&&(e.faceVertexUvs[0]=ie)}},ln=new L,Iue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new St().copy(new jo(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(ln),r={width:ln.x,height:ln.y,depth:ln.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new St().copy(new jo(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(ln)):ln.set(a.width,a.height,a.depth),(t!==ln.x||i!==ln.y||r!==ln.z)&&s.scale(ln.x===0?1:t/ln.x,ln.y===0?1:i/ln.y,ln.z===0?1:r/ln.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new Due(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new V5(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(ln);let s=100/ln.x;Object.assign(n.parameters,{width:100,height:ln.y*s,depth:ln.z*s}),t(this.build(n))})}},LV=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Or?e.shape:new Or,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,u=t*.5,h=i*.5,c=0,f=0,m=2*Math.PI/r;for(let y=0;y<r;y++){let v=m*y,b=c+Math.sin(v)*u,S=f+Math.cos(v)*h;l.addPoint(l.createPoint(b,S))}l.isClosed=!0;for(let y=0,v=l.points.length;y<v;y++)l.points[y].roundness=n;l.roundness=n,l.update();let g=sf.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(g,{userData:{...e,type:"PolygonGeometry"}})}},Rue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=new kue(t*.5,i,n,s,a,o,l);return u.scale(1,1,r/t),Object.assign(u,{userData:{...e,type:"PyramidGeometry"}})}};function tv(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function YA(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let u=a.add(o).normalize();s.copy(e).addScaledVector(u,r/Math.sin(l/2))}else{let u=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(u)),s.addScaledVector(o,r/Math.sin(u))}}function Oue(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var kue=class extends St{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],u=[],h=[],c=0,f=t/2,m=Math.PI/i,g=e*Math.cos(Math.PI/i),y=2*Math.PI/i,v=(i-2)*Math.PI/i,b=Math.PI-v,S=new L(0,-f,0),_=new L(0,f,0),T=new oe(e,-f),M=new oe(g,-f),C=new oe(0,_.y).sub(M),P=new oe(0,_.y).sub(T),E=new oe(C.y,-C.x).normalize(),D=new oe(P.y,-P.x).normalize(),I=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-C.angle())/2)-1e-8;s=Math.min(s,I);let O;{let K=new L(E.x,E.y,0),H=new L(Math.cos(y)*K.x,K.y,Math.sin(y)*K.x);O=K.angleTo(H)}let N=s/Math.tan((Math.PI-C.angle())/2),k=s/Math.tan((Math.PI-O)/2),U=new L;if(!n){l.push(S.x,S.y,S.z),u.push(0,-1,0),h.push(0,0);let K=c++,H=[],ie=T.clone(),$=N/Math.cos(Math.PI/i);ie.x-=$;for(let V=0;V<i;V++){let X=V/i*Math.PI*2+m,ue=new oe(Math.sin(X),Math.cos(X));tv(ie,ue,U),l.push(U.x,U.y,U.z),u.push(0,-1,0),h.push(0,0),H.push(c++)}for(let V=0;V<H.length;V++)o.push(H[V],K,H[(V+1)%H.length])}{let K=new L,H=new L,ie=new L,$=new L,V=new L,X=new L;for(let ue=0;ue<i;ue++){let ne=ue/i*Math.PI*2+m,he=(ue+.5)/i*Math.PI*2+m,te=(ue+1)/i*Math.PI*2+m,me=new oe(Math.sin(ne),Math.cos(ne)),de=new oe(Math.sin(he),Math.cos(he)),fe=new oe(Math.sin(te),Math.cos(te));tv(T,me,H),tv(T,fe,ie),tv(E,de,K),YA(_,H,ie,k,k,$),l.push($.x,$.y,$.z),YA(H,_,ie,k,N,V),l.push(V.x,V.y,V.z),YA(ie,H,_,N,k,X),l.push(X.x,X.y,X.z),u.push(K.x,K.y,K.z),u.push(K.x,K.y,K.z),u.push(K.x,K.y,K.z),h.push(0,0),h.push(0,0),h.push(0,0);let ye=c++,Te=c++,Ie=c++;if(o.push(ye,Te,Ie),s>0){{let We=H.clone().add(ie).multiplyScalar(.5),ct=_.clone().sub(We).normalize(),ut=S.clone().sub(We).normalize().add(ct).normalize().multiplyScalar(-1),Ke=X.clone().sub(V);Q(We,Ke,ut,C.angle())}let Ne,st;{let We=new L;tv(D,fe,We);let ct=X.clone().add($).multiplyScalar(.5);ct=Oue(ct,ie,_);let ut=X.clone().sub($);[Ne,st]=Q(ct,ut,We,O,$.y)}{let We=Ne,ct=We.clone().setY(0).normalize(),ut=new L(0,-1,0),Ke=ct.clone().cross(ut);se(We,ct,ut,Ke)}{let We=C.angle(),ct=Math.PI-We,ut=_.clone();ut.y-=s/Math.sin(We-Math.PI/2);let Ke=new L,Ye=[];for(let pt=0;pt<a;pt++){let re=[],Y=Math.PI/2-ct*pt/a,Ee=Math.cos(Y),Ve=Math.sin(Y),W=he;for(let Ge=0;Ge<=pt;Ge++){let lt=Math.cos(W),it=Math.sin(W);K.x=Ee*it,K.y=Ve,K.z=Ee*lt,Ke.copy(ut).addScaledVector(K,s),l.push(Ke.x,Ke.y,Ke.z),u.push(K.x,K.y,K.z),h.push(0,0),re.push(c++),W+=Math.PI*2/pt/i}Ye.push(re)}st.reverse(),Ye.push(st);let yt=Ye.length-1;for(let pt=0;pt<yt;pt++){let re=Ye[pt],Y=Ye[pt+1],Ee=re.length-1;o.push(Y[1],re[0],Y[0]);for(let Ve=1;Ve<=Ee;Ve++)o.push(re[Ve],re[Ve-1],Y[Ve]),o.push(Y[Ve+1],re[Ve],Y[Ve])}}}}}this.setIndex(o),this.setAttribute("position",new ot(l,3)),this.setAttribute("normal",new ot(u,3)),this.setAttribute("uv",new ot(h,2));function Q(K,H,ie,$,V){let X=-$/2,ue=(Math.PI-$)/2,ne=H.clone().normalize().cross(ie);K.addScaledVector(ie,-s/Math.sin(ue));let he=new L,te=new L,me=1,de=c,fe=[];for(let ye=0;ye<=a;ye++){let Te=X+ye/a*$;te.set(0,0,0),te.addScaledVector(ne,Math.sin(Te)),te.addScaledVector(ie,Math.cos(Te));for(let Ie=0;Ie<=me;Ie++){let Ne=Ie/me-.5;if(he.copy(K),he.addScaledVector(H,Ne),he.addScaledVector(te,s),V!=null){let st=Math.max(0,he.y-V);he.addScaledVector(H,-st/H.y)}l.push(he.x,he.y,he.z),u.push(te.x,te.y,te.z),h.push(0,0),Ie===0&&fe.push(c),c++}}for(let ye=0;ye<a;ye++)for(let Te=0;Te<me;Te++){let Ie=de+Te+(me+1)*ye,Ne=Ie+(me+1),st=Ne+1,We=Ie+1;o.push(Ie,Ne,We),o.push(Ne,st,We)}return[K.clone().addScaledVector(H,.5),fe]}function se(K,H,ie,$){let V=Math.PI/2,X=P.angle()-V,ue=[],ne=new L,he=new L;for(let me=0;me<=a;me++){let de=[],fe=me/a;for(let ye=0;ye<=me;ye++){let Te=((me?ye/me:0)-.5)*b,Ie=Math.cos(Te),Ne=Math.sin(Te),st=Math.atan(Math.tan(X)*Ie),We=(V+st)*fe,ct=Math.cos(We),ut=Math.sin(We);ne.set(0,0,0),ne.addScaledVector(H,ut*Ie),ne.addScaledVector(ie,ct),ne.addScaledVector($,ut*Ne),he.copy(K).addScaledVector(ne,s),l.push(he.x,he.y,he.z),u.push(ne.x,ne.y,ne.z),h.push(0,0),de.push(c++)}ue.push(de)}let te=ue.length-1;for(let me=0;me<te;me++){let de=ue[me],fe=ue[me+1],ye=de.length-1;o.push(de[0],fe[1],fe[0]);for(let Te=1;Te<=ye;Te++)o.push(de[Te-1],de[Te],fe[Te]),o.push(de[Te],fe[Te+1],fe[Te])}}}},BM=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Or?e.shape:new Or,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u={x:i*.5,y:r*.5},h={x:-u.x,y:-u.y},c={x:u.x,y:u.y};function f(T,M,C){return M>i&&C>r?Math.min(T*i/M,T*r/C):M>i?T*i/M:C>r?T*r/C:T}let m=[];m[0]=n[0]===0?0:f(n[0],n[0]+n[3],n[0]+n[1]),m[1]=n[1]===0?0:f(n[1],n[1]+n[2],n[1]+n[0]),m[2]=n[2]===0?0:f(n[2],n[2]+n[1],n[2]+n[3]),m[3]=n[3]===0?0:f(n[3],n[3]+n[0],n[3]+n[2]);let g=h.x,y=c.x,v=c.y,b=h.y;t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(y,v)),t.addPoint(t.createPoint(y,b)),t.addPoint(t.createPoint(g,b)),t.isClosed=!0;let S=!0;for(let T=0,M=t.points.length;T<M;T++)t.points[T].roundness=m[T],T>0&&m[T]!==m[T-1]&&(S=!1);S&&(t.roundness=m[0]),t.useCubicForRoundedCorners=s!==1,t.update();let _=sf.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},Lue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=ht.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:u}=e.parameters,h;return u===0?(h=new St,h.setAttribute("position",new ot([],3))):h=new Gp(.5*t,n,s,a,o,l,u*ht.DEG2RAD),h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"SphereGeometry"}})}},zue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new Vl(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},Nue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new Bue(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},Bue=class extends St{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],u=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-u,r),r*=Math.PI/180;let h=[],c=Math.PI/2,f=(me=0,de=0,fe=0)=>new L(me,de,fe),m=f(),g=f(),[y,v,b]=[t/2,e/2,i/2],S=-v,_=+v,[T,M,C]=[f(S,-y,+b),f(S,-y,-b),f(S,+y,-b)],P=(me,de=!1)=>Math.sin(me-Math.PI/(1+ +de)),E=(me,de=!1)=>Math.cos(me-Math.PI/(1+ +de));C.y=Math.sin(r)*t-y;let D=Math.cos(r)*t-b,I=T.z-u;r<=c?(C.z=Math.min(D,I),C.z==I&&(C.y-=(D-I)/Math.tan(c-r))):M.z=Math.min(M.z-D-b,T.z-u),m.subVectors(T,M),g.subVectors(C,M);let O=Math.min(m.length(),g.length())*n/100,N=O*Math.tan(r/2),k=O/Math.cos(r/2),U=m.clone().normalize().add(g.normalize()).setLength(k).add(M);m.set(0,P(r,!0),E(r,!0)),h.push([C,m.clone()]);let Q=(Math.PI-r)/s;for(let me=0;me<=s;me++){let de=c+r+me*Q;m.set(0,Math.sin(de)*N,Math.cos(de)*N),m.add(U),g.set(0,P(de),E(de)),h.push([m.clone(),g.clone()])}h.push([T,f(0,1,0)]);let se=Math.sin(Q/2)*N*2,K=h.length-1,H=h[0][0].distanceTo(h[1][0]),ie=h[K-1][0].distanceTo(h[K][0]),$=H+se*s+ie;h[0].push(1);for(let me=0;me<=s;me++)h[me+1].push(1-(H+me*se)/$);h[K].push(0);let[V,X,ue]=h[0],ne,he,te;for(let me=1;me<h.length;me++)[ne,he,te]=h[me],a.push(S,V.y,V.z,S,ne.y,ne.z,_,V.y,V.z,_,V.y,V.z,S,ne.y,ne.z,_,ne.y,ne.z),o.push(0,X.y,X.z,0,he.y,he.z,0,X.y,X.z,0,X.y,X.z,0,he.y,he.z,0,he.y,he.z),l.push(0,ue,0,te,1,ue,1,ue,0,te,1,te),[V,X,ue]=[ne,he,te];this.setAttribute("position",new ot(a,3)),this.setAttribute("normal",new ot(o,3)),this.setAttribute("uv",new ot(l,2))}},zV=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Or?e.shape:new Or,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}=e.parameters,h=e.shape,c=t*.5,f=i*.5,m=0,g=0,y=a*Math.PI/360/n,v=Math.PI/2*3*-1,b=c*r/100,S=f*r/100;if(n===3&&r===50){y=2*Math.PI/n;for(let T=0;T<n;T++){let M=y*T,C=m+Math.sin(M)*c,P=g+Math.cos(M)*f;h.addPoint(h.createPoint(C,P))}}else for(let T=0;T<n;T++){let M=m+Math.cos(v)*c,C=g+Math.sin(v)*f;h.addPoint(h.createPoint(M,C)),v+=y,M=m+Math.cos(v)*b,C=g+Math.sin(v)*S,h.addPoint(h.createPoint(M,C)),v+=y}h.isClosed=!0;for(let T=0,M=h.points.length;T<M;T++)h.points[T].roundness=s;h.roundness=s,h.update();let _=sf.create({shape:h,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},Fue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Vl(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},Uue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=Vue(t,i,r,t*.5,a,s,0,0,n,o,l);return u.scale(1,i/t,1),Object.assign(u,{userData:{...e,type:"TorusGeometry"}})}};function Vue(e,t,i,r,n,s,a,o,l,u,h){[t,i]=[i,t],a=t/2;let c=ht.clamp(n/360,0,1);if(c===0){let f=new St;return f.setAttribute("position",new ot([],3)),f}return c===1&&(u=0),new OV(!0,e,t,i,r,c,s,a,o,l,u,h)}var jue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new k5(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},Hue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Or?e.shape:new Or,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,u=t*.5,h=i*.5;o?(l.addPoint(l.createPoint(-u,h)),l.addPoint(l.createPoint(u,-h)),l.addPoint(l.createPoint(-u,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(u,-h)),l.addPoint(l.createPoint(-u,-h))),l.isClosed=!0;for(let f=0,m=l.points.length;f<m;f++)l.points[f].roundness=r;l.roundness=r,l.update();let c=sf.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(c,{userData:{...e,type:"TriangleGeometry"}})}};function Gue(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function Wue(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function que(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),u=i*(1-o*t),h=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=h,s=l;break;case 1:r=u,n=i,s=l;break;case 2:r=l,n=i,s=h;break;case 3:r=l,n=u,s=i;break;case 4:r=h,n=l,s=i;break;case 5:default:r=i,n=l,s=u;break}return{r:r*255,g:n*255,b:s*255}}function Xue(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function Yue(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function Que(e,t,i){return(e<<16)+(t<<8)+i}function Kue(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function Zue(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var Jue={parseRgba:Wue,hsvToRgb:que,rgbToHsv:Xue,hexToRgb:Yue,rgbToHex:Que,rgbToHexString:Kue,hexStringToRgb:Zue},$ue=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},ehe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},Le=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Le.version}static addUnaryOp(e){return Le.max_unop_len=Math.max(e.length,Le.max_unop_len),Le.unary_ops[e]=1,Le}static addBinaryOp(e,t,i){return Le.max_binop_len=Math.max(e.length,Le.max_binop_len),Le.binary_ops[e]=t,i?Le.right_associative.add(e):Le.right_associative.delete(e),Le}static addIdentifierChar(e){return Le.additional_identifier_chars.add(e),Le}static addLiteral(e,t){return Le.literals[e]=t,Le}static removeUnaryOp(e){return delete Le.unary_ops[e],e.length===Le.max_unop_len&&(Le.max_unop_len=Le.getMaxKeyLen(Le.unary_ops)),Le}static removeAllUnaryOps(){return Le.unary_ops={},Le.max_unop_len=0,Le}static removeIdentifierChar(e){return Le.additional_identifier_chars.delete(e),Le}static removeBinaryOp(e){return delete Le.binary_ops[e],e.length===Le.max_binop_len&&(Le.max_binop_len=Le.getMaxKeyLen(Le.binary_ops)),Le.right_associative.delete(e),Le}static removeAllBinaryOps(){return Le.binary_ops={},Le.max_binop_len=0,Le}static removeLiteral(e){return delete Le.literals[e],Le}static removeAllLiterals(){return Le.literals={},Le}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new Le(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return Le.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!Le.binary_ops[String.fromCharCode(e)]||Le.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return Le.isIdentifierStart(e)||Le.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(Le.hooks[e]){let i={context:this,node:t};return Le.hooks.run(e,i),i.node}return t}searchHook(e){if(Le.hooks[e]){let t={context:this};return Le.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===Le.SPACE_CODE||e===Le.TAB_CODE||e===Le.LF_CODE||e===Le.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:Le.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===Le.SEMCOL_CODE||i===Le.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,Le.max_binop_len),t=e.length;for(;t>0;){if(Le.binary_ops.hasOwnProperty(e)&&(!Le.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Le.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(n={value:t,prec:Le.binaryPrecedence(t),right_a:Le.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),r=[s,n,a];t=this.gobbleBinaryOp();){if(i=Le.binaryPrecedence(t),i===0){this.index-=t.length;break}n={value:t,prec:i,right_a:Le.right_associative.has(t)},l=t;let u=h=>n.right_a&&h.right_a?i>h.prec:i<=h.prec;for(;r.length>2&&u(r[r.length-2]);)a=r.pop(),t=r.pop().value,s=r.pop(),e={type:Le.BINARY_EXP,operator:t,left:s,right:a},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),r.push(n,e)}for(o=r.length-1,e=r[o];o>1;)e={type:Le.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,Le.isDecimalDigit(e)||e===Le.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===Le.SQUOTE_CODE||e===Le.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===Le.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,Le.max_unop_len),i=t.length;i>0;){if(Le.unary_ops.hasOwnProperty(t)&&(!Le.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Le.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Le.UNARY_EXP,operator:t,argument:n,prefix:!0})}t=t.substr(0,--i)}Le.isIdentifierStart(e)?(r=this.gobbleIdentifier(),Le.literals.hasOwnProperty(r.name)?r={type:Le.LITERAL,value:Le.literals[r.name],raw:r.name}:r.name===Le.this_str&&(r={type:Le.THIS_EXP})):e===Le.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===Le.PERIOD_CODE||t===Le.OBRACK_CODE||t===Le.OPAREN_CODE||t===Le.QUMARK_CODE;){let i;if(t===Le.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Le.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===Le.OBRACK_CODE?(e={type:Le.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==Le.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===Le.OPAREN_CODE?e={type:Le.CALL_EXP,arguments:this.gobbleArguments(Le.CPAREN_CODE),callee:e}:(t===Le.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:Le.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;Le.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===Le.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);Le.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));Le.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);Le.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,Le.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===Le.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===Le.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Le.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=n}else e+=n}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:Le.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(Le.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,Le.isIdentifierPart(e));)this.index++;return{type:Le.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===e){i=!0,this.index++,e===Le.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(n===Le.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===Le.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===Le.CBRACK_CODE)for(let s=t.length;s<r;s++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===Le.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(Le.CPAREN_CODE);if(this.code===Le.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:Le.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Le.ARRAY_EXP,elements:this.gobbleArguments(Le.CBRACK_CODE)}}},the=new $ue;Object.assign(Le,{hooks:the,plugins:new ehe(Le),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Le.max_unop_len=Le.getMaxKeyLen(Le.unary_ops);Le.max_binop_len=Le.getMaxKeyLen(Le.binary_ops);var bm=e=>new Le(e).parse(),ihe=Object.getOwnPropertyNames(Le);ihe.forEach(e=>{bm[e]===void 0&&e!=="prototype"&&(bm[e]=Le[e])});bm.Jsep=Le;var rhe="ConditionalExpression",nhe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:rhe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};bm.plugins.register(nhe);function R_(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var NV=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=R_(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await uhe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let u=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=u,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=cy(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?cy(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return fn.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?fn.zoom(this.result,e):this.result;if(lhe(t))return Object.entries(t);if(ohe(t))return t.map((i,r)=>[r.toString(),i]);throw ahe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function she(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function ahe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function ohe(e){return Array.isArray(e)}function lhe(e){return typeof e=="object"&&e!==null}async function uhe(e,t,i=new AbortController){var l,u,h,c;let r,n=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((u=e.integration)==null?void 0:u.type)==="OpenAI"){let f=Sv(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),m=e.integration.behavior===""?[]:Sv(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${m}"
		},`:""}
		{
			"role": "user",
			"content": "${f}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let f;a!==void 0?f=a:e.method==="POST"&&e.body&&(f=Sv(JSON.parse(e.body),t)),f!==void 0&&(n+=`&data=${encodeURIComponent(f.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((h=e.integration)==null?void 0:h.type)==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=Sv(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:she(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let f=await o.json();return s&&(f=f.response),{content:f.choices[0].message.content}}else{let f=await o.json();return s&&(f=f.response),f}}var BV=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return BV(i,t)}return is.isBoolean(e)?is.getDisplayedValue(e).toLowerCase():is.getDisplayedValue(e)},Sv=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+Sv(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return BV(n,t)}}return""}).join(""),hhe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],che=["0","1","2","3","4","5","6","7","8","9","."],dhe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function fhe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}bm.addBinaryOp("^",11,!0);function FV(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),u=l[0],h=t.getUserAPI(u);if(h!==void 0&&h instanceof NV){let c=h.retrieveValue(l.slice(1));c!==void 0&&(r+=c)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[u,h]=l,c=t.getUserWebhook(u);if(c!==void 0){let f=c.getParameterValue(h);f!==void 0&&(r+=f)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let u;if(t.scene.data.objects.traverse((h,c)=>{var m;let f=(m=c.events)==null?void 0:m.find(g=>g.id===o.objId);f&&(u=f)}),u!==void 0&&u.data.type==="AIAssistantListener"){let h=l==null?void 0:l.computeAnalysisForListenerEvent(u.data);if(h!==void 0){r+=h;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let u=t.getVariable(o.id),h=is.getDisplayedValue(u);i==="number"&&is.isTextValue(u)&&Array.isArray(u.textValue)&&u.textValue.length===1?h=parseFloat(h).toString():i==="boolean"&&is.isBoolean(u)?h=u?"true":"false":i==="boolean"&&is.isTextValue(u)&&!Array.isArray(u.textValue)&&(h='"'+h+'"'),r+=h;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!fhe(o.name)&&!che.includes(o.name)&&!hhe.includes(o.name)&&!dhe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=bm(r)}catch(a){console.error(r,a);return}let s;try{s=zi(n)}catch(a){console.error(r,n,a)}return s}function zi(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(zi(e.left)===zi(e.right));case"!=":return+(zi(e.left)!==zi(e.right));case">":return+(zi(e.left)>zi(e.right));case">=":return+(zi(e.left)>=zi(e.right));case"<":return+(zi(e.left)<zi(e.right));case"<=":return+(zi(e.left)<=zi(e.right));case"+":return zi(e.left)+zi(e.right);case"-":return zi(e.left)-zi(e.right);case"*":return zi(e.left)*zi(e.right);case"/":return zi(e.left)/zi(e.right);case"%":return zi(e.left)%zi(e.right);case"&&":return zi(e.left)&&zi(e.right);case"||":return zi(e.left)||zi(e.right);case"^":return Math.pow(zi(e.left),zi(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-zi(e.argument);case"!":return+!zi(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=zi(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=zi(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(zi))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var phe=new je,mhe=new je;function ghe(e,t,i){let r=[new L,new L,new L],n=[new L,new L,new L];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=ht.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new je().makeBasis(r[0],r[1],r[2])}var vhe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??NM.create({parameters:oV}).userData.shape;return{path:e.path??dw.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...lV,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new yhe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new St,{userData:{...e,type:"PathGeometry"}})}},yhe=class extends St{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!Gue(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],u=[];for(let K=0;K<o;K++){let H=this.inputs.path.isClosed?(K+s)%e.length:Math.min(K+s,e.length-1);l.push(e[H].clone()),u.push(t[H].clone())}let h=(K,H,ie)=>{l[K]=l[K].clone().lerp(l[H],ie),u[K]=ghe(u[K],u[H],ie)},c=0,f=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(f||r===0)&&(c=f,h(0,1,c));let m=0,g=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&g&&(m=g,h(l.length-1,l.length-2,1-m)),i===0){let K=l.length-1;l[K].copy(l[0]),u[K].copy(u[0])}this._applyPathModifiers(u,c,m);let{bevel:y,bevelSides:v}=this.inputs.parameters.extrusion,b=y>0?this.inputs.parameters.extrusion.capType:"flat",S=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(S=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:_,infos:T,vertices:M}=this._computeShapePoints(S),C=0,P;b==="round"&&(P=new zM(this.inputs.shapeData,2*y,y,S,v,void 0,!0),C=P.getAttribute("position").count);let E=0,D=0;T.sort((K,H)=>K.start-H.start),T.forEach(K=>{K.verticesStart=E,K.verticesCount=K.continuous.reduce((H,ie,$)=>H+($===0||!ie?2:1),0),D+=K.verticesCount,E=D});let I=D*o,O,N=0;if(this._isOpenEnded()&&b==="flat"){try{O=lc({windingRule:Zi.ODD,elementType:Kr.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:_})}catch{O=CV}N=O.vertexCount}let k=I+2*N+C*2,U=I+2*N,Q={positions:new Float32Array(k*3),normals:new Float32Array(k*3),uvs:new Float32Array(k*2)},se=[];if(T.forEach(K=>{this._extrudeRegion(K,M,u,l,Q,se,this._isGeometryClosed()&&!this._isOpenEnded())}),O&&(this._closeEnd(O,I,se,Q,u[0],l[0],!1),this._closeEnd(O,I+N,se,Q,u[u.length-1],l[l.length-1],!0)),P){Q.positions.set(P.getAttribute("position").array,U*3),Q.normals.set(P.getAttribute("normal").array,U*3),Q.uvs.set(P.getAttribute("uv").array,U*2);for(let $=U;$<U+C;$++)Q.uvs[$*2+1]=1e-4;let K=se.length;se.push(...P.getIndex().array.map($=>$+U)),U+=C,Q.positions.set(P.getAttribute("position").array,U*3),Q.normals.set(P.getAttribute("normal").array,U*3),Q.uvs.set(P.getAttribute("uv").array,U*2);let H=se.length;se.push(...P.getIndex().array.map($=>$+U)),this.setAttribute("position",new Bt(Q.positions,3)),this.setAttribute("normal",new Bt(Q.normals,3)),this.setAttribute("uv",new Bt(Q.uvs,2)),this.setIndex(se);let ie=phe;ie.copy(u[u.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(ie,U,k),ie.copy(u[0]).setPosition(l[0]).multiply(mhe.makeScale(1,1,-1)),this.applyMatrix4OnRange(ie,U-C,U),this.reverseIndicesOnRange(K,H)}else this.setAttribute("position",new Bt(Q.positions,3)),this.setAttribute("normal",new Bt(Q.normals,3)),this.setAttribute("uv",new Bt(Q.uvs,2)),this.setIndex(se)}_extractPathPoints(){let e=vV(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new L,s=new L,a=new L,o=new L,l=new L(0,1,0);for(let g=0;g<i;g++){let y=e[g],v;g===0?v=r?e[e.length-2]:y.clone().multiplyScalar(2).sub(e[1]):v=e[g-1];let b;g===i-1?b=r?e[1]:y.clone().multiplyScalar(2).sub(e[g-1]):b=e[g+1];let S=y.clone().sub(v).normalize(),_=b.clone().sub(y).normalize(),T=S.clone().add(_).normalize();a.copy(T),g===0&&(T.equals(l)||T.clone().negate().equals(l))&&l.set(0,0,1);let M=l.clone().cross(T).normalize(),C=T.clone().cross(M).normalize();l.copy(C),o.copy(M),g===0&&(n.copy(C),s.copy(T));let P=new je().makeBasis(M,C,T);t.push(P)}let u=r?s:a,h=r?n:new L(0,1,0),c=u.clone().cross(o).normalize(),f=Math.acos(h.dot(c));if(isNaN(f))return t;let m=h.clone().cross(c);u.dot(m)>0&&(f*=-1);for(let g=1;g<t.length;g++){let y=new je().makeRotationZ(f*g/t.length);t[g].multiply(y)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new je,u=new je;return e.forEach((h,c)=>{let f=c===0?0:c===r-1?1:(c-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(ht.lerp(n,n+s,f)*ht.DEG2RAD);let m=ht.lerp(a,o,f);u.makeScale(m,m,m),h.multiply(l).multiply(u)}),e}_computeShapePoints(e=12,t=Zi.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(u=>{let h=u.extractShapePointsToFlatArray([],e),c=[];for(let f=h.length-1;f>=1;f-=2){let m=h[f-1],g=h[f-0];c.push(m,g)}return c}),s;try{s=lc({windingRule:t,elementType:Kr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=LM}let a;try{a=lc({windingRule:Zi.ODD,elementType:Kr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=AV}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let u=0;u<a.elements.length;u++){let h=a.elements[u],c=u%2===0?s.vertexCount:0;s.elements.push(h+c)}for(let u=0;u<a.vertexIndices.length;u++){let h=a.vertexIndices[u],c=s.vertexCount;s.vertexIndices.push(h+c)}for(let u=0;u<a.vertices.length;u++){let h=a.vertices[u];s.vertices.push(h)}}for(let u=0,h=s.vertexCount;u<h;u++){let c=u*2;s.vertices[c+0],s.vertices[c+1]}let l=[];for(let u=s.elementCount-1;u>=0;u--){let h=u>=o,c=u*2,f=s.elements[c+0],m=s.elements[c+1],g=f+m,y={start:f,count:m,normals:[],isHole:h,continuous:[],verticesStart:0,verticesCount:0};l.push(y);let v=f,b=g-1,S=f+1,_=i.roundedCurves.length;do{let T=v-f;s.vertices[b*2+0],s.vertices[b*2+1];let M=s.vertices[v*2+0],C=s.vertices[v*2+1],P=s.vertices[S*2+0],E=s.vertices[S*2+1],D=M-P,I=C-E,O=Math.sqrt(D*D+I*I);D/=O,I/=O,y.normals[T*2+0]=-I,y.normals[T*2+1]=D;let N=s.vertexIndices[v];if(Array.isArray(N))y.continuous[T]=!1;else{let[k,U]=i.getCurveIndexFromVertexId(N-1,!0);if(U>0&&U<1)y.continuous[T]=!0;else{let Q=U===1?k+1:k-1;Q=(Q+_)%_;let se=U===1?0:1,K=i.roundedCurves[k].getTangent(U),H=i.roundedCurves[Q].getTangent(se);y.continuous[T]=K.dot(H)>.95}}h&&(y.normals[T*2+0]*=-1,y.normals[T*2+1]*=-1),[b,v,S]=[v,S,S+1],S>=g&&(S-=m)}while(S!==f+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new L,l=new L,u=new L,h=new L,c=new oe;i.forEach((m,g)=>{let y=r[g],v=e.verticesStart*i.length+e.verticesCount*g;for(let b=0;b<e.count;b++){let S=(e.start+b)*2;if(o.set(t[S+0],t[S+1],0),u.copy(o).applyMatrix4(m).add(y),e.continuous[b])h.set(e.normals[b*2+0],e.normals[b*2+1],0);else{let _=b===0?(e.start+e.count-1)*2:S-2;l.set(t[_+0],t[_+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(m).normalize(),c.set(b===0?1:b/e.count,g/(i.length-1)),this._insertVertex(n,v,u,h,c),v++,!e.continuous[b]||b===0){if(b===0)h.set(e.normals[b*2+0],e.normals[b*2+1],0),c.set(0,g/(i.length-1));else{let _=b===e.count-1?e.start*2:S+2;l.set(t[_+0],t[_+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(m).normalize(),this._insertVertex(n,v,u,h,c),v++}}});let f=i.length-1;for(let m=0;m<f;m++){let g=e.verticesStart*i.length+e.verticesCount*m,y=e.verticesStart*i.length+e.verticesCount*(m+1),v=0;for(let b=0;b<e.count;b++){(!e.continuous[b]||b===0)&&v++;let S=b===e.count-1?0:v+1,_=g+v,T=g+S,M=y+S,C=y+v;e.isHole?s.push(_,M,T,_,C,M):s.push(_,T,M,_,M,C),v++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new L(0,0,a?-1:1).applyMatrix4(n),u=new L,h=new oe;for(let f=0;f<o;f++){let m=2*f;u.set(e.vertices[m+0],e.vertices[m+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+f,u,l,h)}let c=e.elements;for(let f=0;f<e.elementCount;f++){let m=3*f,g=c[m+0]+t,y=c[m+(a?1:2)]+t,v=c[m+(a?2:1)]+t;i.push(g,y,v)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new Zr().getNormalMatrix(e).elements,s,a,o,l,u=this.attributes.position,h=this.attributes.normal;if(!u||!h)return;let c=u.array,f=h.array,m=u.itemSize;for(let g=t*m,y=i*m;g<y;g+=m){if(g===t)debugger;s=c[g+0],a=c[g+1],o=c[g+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),c[g+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,c[g+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,c[g+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=f[g+0],a=f[g+1],o=f[g+2],f[g+0]=n[0]*s+n[3]*a+n[6]*o,f[g+1]=n[1]*s+n[4]*a+n[7]*o,f[g+2]=n[2]*s+n[5]*a+n[8]*o}u.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function UV(){let e=new St;return e.setAttribute("position",new Bt(new Float32Array([]),3)),e.setIndex(new Bt(new Uint16Array([]),1)),e}var xhe=UV().attributes,bhe=12,whe=1,C2=class extends St{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,xhe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,u=is.getDisplayedValue(o),h=l===2?u.toUpperCase():l===3?u.toLowerCase():u,c=_he(e,t,h),{shapes:f,charWidths:m,charCoords:g}=t.generateShapes(c,e),y=(typeof i=="number"?i:1)*.5,v=(typeof r=="number"?r:1)*.5,b=f.map(T=>new Or().fromShape(T,!0));this.vectorShapes=b;let S=b.map(T=>sf.create({shape:T,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?Zi.NONZERO:Zi.ODD,subdivisions:this.isLowResolution&&n>0?whe:bhe}})),_=S.length?Td(S):UV();_.translate(-y,v,0),this.dispose(),this.wrappedText=c,this.charCoords=g,this.charWidths=m,this.deleteAttribute("extrudeNormal"),Object.entries(_.attributes).forEach(([T,M])=>{this.setAttribute(T,M)}),this.setIndex(_.index),this.computeBoundingSphere()}clone(){let e=no(new St,C2.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function _he(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var VV,jV=new Promise(e=>{VV=e}),Az=!1,xx;function She(){if(Az)return;if(xx)return xx;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.59/build",i=Es(()=>import("./process-DLQUZ-E7.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});VV(a),Az=!0}return xx=e(),xx}var Ehe=["font"];function _y(e,t,i,r){var u,h;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let c of a){let f=s;for(let m of c)f=f[m];for(n in f){let m=f[n];PL(m)&&!Ehe.includes(n)&&(f[n]=t.getVariable(m,[r.uuid,"geometry",...c,n]),PL(f[n])&&(f[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let c=Or.createFromState(s.shape,s.width,s.height);o.shape=c}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((u=s.data.groups)==null||u.forEach(c=>c.materialIndex=Math.max(c.materialIndex??0,0))),o.geometry=new V5().parse(s),o.geometry.groups.length===0){let c=o.geometry;c.addGroup(0,Math.max(((h=c.getIndex())==null?void 0:h.count)??0,c.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let c=new zs(s,i);return c.data=e,c}else{if(s.type==="TextGeometry")return new C2(s,t);if(s.type==="InputGeometry")return new C2(s,t);if(s.type==="UIGeometry")return BM.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=Dz(o)}catch(c){console.error(c)}if(!l){let c=Or.createFromState(cw.defaultData(),100,100);o.shape=c,l=Dz(o)}return l}var Ahe=new je;function T2(e,t,i,r){let n=e.position.array,s=e.normal.array,a=Ahe.makeScale(t,i,r).invert().elements,o,l,u;for(var h=0,c=n.length;h<c;h+=3)n[h]*=t,n[h+1]*=i,n[h+2]*=r,o=s[h],l=s[h+1],u=s[h+2],s[h]=a[0]*o+a[4]*l+a[8]*u,s[h+1]=a[1]*o+a[5]*l+a[9]*u,s[h+2]=a[2]*o+a[6]*l+a[10]*u;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var bx=new jr,up=new L,Ft;jV.then(e=>{Ft=e});var Cz=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Tz=new Uint32Array([0,1,2,3]),Pz=new Uint8Array([4]),zs=class extends St{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Ld.div(t,i);this.subdividedGeometry&&T2(this.subdividedGeometry.attributes,...r),this.originalGeometry&&T2(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(up.fromArray(r));let s=up.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=zs.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new jo(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(zs.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new ua,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;bx.setFromBufferAttribute(t),bx.getCenter(i),e.boundingSphere.radius=i.distanceTo(bx.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),bx.getSize(up);let r={width:up.x,height:up.y,depth:up.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(Ft.free_bvh(t),Ft.free_subdivision_surface(t));try{n=zs.allocate(e,r)}catch(l){console.error(l,e),n=zs.allocate({positionWASM:Cz,indexWASM:Tz,verticesPerFaceWASM:Pz},r)}if(Ft.set_destination_refinement_level(n,0),s=zs.buildLevel(n,!0,o),e.subdivisions>0)try{Ft.set_destination_refinement_level(n,e.subdivisions),a=zs.buildLevel(n,!1,o)}catch{try{Ft.set_destination_refinement_level(n,e.subdivisions-1),a=zs.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:_y(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=O_(r.getAttribute("position"),n));let u;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let h=e.radialSegments*e.heightSegments*3*2,c=h+e.radialSegments*3;u=[h,c]}return{indices:a,verticesPerFace:o}=HV(s,l,r,u),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var _;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=Cz,r=Tz,n=Pz);let o=i.length,l=r.length,u=n.length,h=i.length+s.length+a.length,c=r.length+n.length,f=h*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,m=h*Float32Array.BYTES_PER_ELEMENT,g=Ft._malloc(f),y=new Float32Array(Ft.HEAPF32.buffer,g,h),v=new Uint32Array(Ft.HEAPU32.buffer,g+m,c);y.set(i,0),y.set(s,i.length),y.set(a,i.length+s.length),v.set(r,0),v.set(n,r.length);let b;(_=e==null?void 0:e.scaleBaked)!=null&&_.some(T=>T!==1)&&(b=new je().makeScale(...e.scaleBaked)),t&&(b?b.premultiply(t):b=t);let S=b?Ft.alloc_subdivision_surface2(g,o,g+m,l,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,u,b.elements):Ft.alloc_subdivision_surface(g,o,g+m,l,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,u);return Ft._free(g),S}static buildLevel(e,t,i,r,n){let s=n?Ft.get_mesh_data2(e,t?Ft.Level.CONTROL:Ft.Level.REFINED,i,n.elements):Ft.get_mesh_data(e,t?Ft.Level.CONTROL:Ft.Level.REFINED,i),a=8,o=Ft.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),u=0,h=Ft.HEAPU32[o[u]>>2],c=Ft.HEAPF32.subarray(h>>2,(h>>2)+l[u]);u++;let f=Ft.HEAPU32[o[u]>>2],m=Ft.HEAPF32.subarray(f>>2,(f>>2)+l[u]);u++;let g=Ft.HEAPU32[o[u]>>2],y=Ft.HEAPU32.subarray(g>>2,(g>>2)+l[u]);u++;let v=Ft.HEAPU32[o[u]>>2],b=Ft.HEAPU32.subarray(v>>2,(v>>2)+l[u]);if(u++,r===void 0){let S=new St;if(S.setIndex(new Hp(b,1)),S.setAttribute("position",new ot(c,3)),S.setAttribute("normal",new ot(m,3)),t){S.setAttribute("faceMap",new Hp(y,1));let _=new Float32Array(m.length/3*4).fill(0);S.setAttribute("color",new Bt(_,4))}return Ft.free_mesh_data(s),S.userData.type="SubdivGeometry",S}r.getAttribute("position").copyArray(c),r.getAttribute("normal").copyArray(m),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Ft.free_mesh_data(s)}static freeSubdivPointer(e){Ft.free_bvh(e),Ft.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Ft.get_wireframe_data_for_base_level(e),n=4,s=Ft.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Ft.HEAPU32[s[o]>>2],u=Ft.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let h=Ft.HEAPU32[s[o]>>2],c=Ft.HEAPU32.subarray(h>>2,(h>>2)+a[o]);if(t===void 0){let f=new St;f.setAttribute("position",new ot(u,3));let m=new Float32Array(u.length);for(let g=0,y=u.length;g<y;)m[g++]=i.r,m[g++]=i.g,m[g++]=i.b;return f.setAttribute("color",new Bt(m,3)),f.setIndex(new Hp(c,1)),Ft.free_wireframe_data_for_base_level(r),f}t.getAttribute("position").copyArray(u),t.attributes.position.needsUpdate=!0,Ft.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Ft.set_destination_refinement_level(e,t);let n=i?Ft.get_topological_data2(e,r?Ft.Level.CONTROL:Ft.Level.REFINED,i.elements):Ft.get_topological_data(e,r?Ft.Level.CONTROL:Ft.Level.REFINED),s=6,a=Ft.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,u=Ft.HEAPU32[a[l]>>2],h=new Float32Array(Ft.HEAPF32.subarray(u>>2,(u>>2)+o[l]));l++;let c=Ft.HEAPU32[a[l]>>2],f=new Uint32Array(Ft.HEAPU32.subarray(c>>2,(c>>2)+o[l]));l++;let m=Ft.HEAPU32[a[l]>>2],g=new Uint8Array(Ft.HEAPU32.subarray(m>>2,(m>>2)+o[l]));return Ft.free_topological_data(n),{positions:h,indices:f,verticesPerFace:g}}},Mz=["getX","getY","getZ"];function O_(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let u=0;u<r;u++){let h=t?t.getX(u):u,c="";for(let f=0;f<3;f++)c+=`${~~(e[Mz[f]](h)*o)},`;if(c in i)s.push(i[c]);else{for(let f=0;f<3;f++)a.push(e[Mz[f]](h));i[c]=n,s.push(n),n++}}let l=[];for(let u=0;u<s.length;u+=3)s[u]===s[u+1]||s[u]===s[u+2]||s[u+1]===s[u+2]||l.push(s[u],s[u+1],s[u+2]);return{positions:a,triIndices:l}}var wx=new L,QA=new L,KA=new L,ZA=new L;function HV(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),u=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&u<=24&&u%4===0&&i.userData.parameters.angle>=360){let f=l.length/2/u;l=l.filter((m,g)=>Math.floor(g/2)%f===0)}let h=0;for(let f=0;f<l.length;f+=2)h+=(l[f]-l[(f===0?l.length:f)-2])*(l[f+1]+l[(f===0?l.length:f)-1]);e.length=0;let c=0;if(h<0)for(let f=0;f<l.length;f+=2)e.push(l[f],l[f+1],0),n.push(c++);else for(let f=l.length-2;f>=0;f-=2)e.push(l[f],l[f+1],0),n.push(c++);return s.push(c),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){wx.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),QA.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),KA.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),ZA.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),QA.sub(wx).normalize(),KA.sub(wx).normalize(),ZA.sub(wx).normalize();let l=QA.cross(KA).dot(ZA);Math.abs(l)>.005||r&&r.some((u,h)=>h%2===1?!1:o>=r[h]&&o<r[h+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],u=[],h=0;for(let c=0,f=0;c<e.length;c+=3,f++)e[c+2]===0&&(l.push(f),h++),e[c+2]===a&&u.push(f);if(i.userData.parameters.extrudeBevelSize===0){let c=u[0];u[0]=u[1],u[1]=c}l.reverse(),n.push(...l,...u),s.push(h,h)}return{indices:n,verticesPerFace:s}}var Su={};y8(Su,{calcBoolean:()=>Dhe,calcBooleanTopological:()=>Mhe,freeMeshSet:()=>khe,getMeshSet:()=>Ihe,hasOpenEdges:()=>Rhe,transformMeshSet:()=>Ohe});var GV,Che=new Promise(e=>{GV=e}),_x;function The(){if(_x)return _x;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.59/build",i=Es(()=>import("./boolean-CynEgfvK.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});GV(a)}return _x=e(),_x}var _i,Kp;Che.then(e=>_i=e);function Phe(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=O_(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:u}=HV(s,a,e);o=u.length,r=[];for(let h=0,c=0;h<o;h++){r.push(u[h]);for(let f=0;f<u[h];f++)r.push(l[c++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let u=0,h=0;h<r.length;)r[h++]=3,o++,r[h++]=a[u++],r[h++]=a[u++],r[h++]=a[u++]}return{positions:s,faceIndices:r,nFaces:o}}function WV(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=_i._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(_i.HEAPU32.buffer,s,t):new Float32Array(_i.HEAPF32.buffer,s,t)).set(e,0),s}function qV(e){switch(e){case 0:return _i.OP.UNION;case 1:return _i.OP.INTERSECTION;case 2:return _i.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function Mhe(e,t){Kp===void 0&&(Kp=_i.init_csg());let i=WV(e),r=_i.csg_calc_topological(Kp,i,e.length,qV(t));_i._free(i);let n=6,s=_i.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=_i.HEAPU32[s[o]>>2],u=new Float32Array(_i.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=_i.HEAPU32[s[o]>>2],c=new Uint32Array(_i.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let f=_i.HEAPU32[s[o]>>2],m=new Uint8Array(_i.HEAPU32.subarray(f>>2,(f>>2)+a[o]));return _i.free_mesh_data(r),{positions:u,indices:c,verticesPerFace:m}}function Dhe(e,t,i,r){Kp===void 0&&(Kp=_i.init_csg());let n=WV(e),s=_i.csg_calc(Kp,n,e.length,r,qV(t));_i._free(n);let a=5,o=_i.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),u=0,h=_i.HEAPU32[o[u]>>2],c=_i.HEAPF32.subarray(h>>2,(h>>2)+l[u]);u++;let f=_i.HEAPU32[o[u]>>2],m=_i.HEAPF32.subarray(f>>2,(f>>2)+l[u]);u++;let g=l[u];i.setAttribute("position",new ot(c,3)),i.setAttribute("normal",new ot(m,3));let y=_i.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new ua),i.boundingSphere.center.set(y[0],y[1],y[2]),i.boundingSphere.radius=(y[3]**2+y[4]**2+y[5]**2)**.5,i.userData.parameters={width:y[3]*2,height:y[4]*2,depth:y[5]*2},_i.free_mesh_data(s),g}function Ihe(e,t,i){if(_i===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let v=e.userData;s=v.verticesPerFace.length,r=v.positions,n=Array(v.verticesPerFace.reduce((b,S)=>b+S,0)+s);for(let b=0,S=0,_=0;b<v.verticesPerFace.length;b++){n[_++]=v.verticesPerFace[b];for(let T=0;T<v.verticesPerFace[b];T++)n[_++]=v.indices[S++]}}else({positions:r,faceIndices:n,nFaces:s}=Phe(e,t,i));let a=r.length,o=n.length,l=r.length,u=n.length,h=l*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,c=l*Float32Array.BYTES_PER_ELEMENT,f=_i._malloc(h),m=new Float32Array(_i.HEAPF32.buffer,f,l),g=new Uint32Array(_i.HEAPU32.buffer,f+c,u);m.set(r,0),g.set(n,0);let y=_i.get_csg_mesh(f,a,f+c,o,s);return _i._free(f),y}function Rhe(e){return _i.has_open_edges(e)}function Ohe(e,t){_i.transform_csg_mesh(e,t.elements)}function khe(e){_i.free_csg_mesh(e)}var Lhe={ConeGeometry:Nle,CubeGeometry:Ble,CylinderGeometry:yV,DodecahedronGeometry:Ule,EllipseGeometry:NM,HelixGeometry:_ue,IcosahedronGeometry:Sue,LatheGeometry:Eue,NonParametricGeometry:Iue,PolygonGeometry:LV,PyramidGeometry:Rue,RectangleGeometry:BM,SphereGeometry:Lue,PlaneGeometry:zue,BackdropGeometry:Nue,StarGeometry:zV,TextFrameGeometry:Fue,TorusGeometry:Uue,TorusKnotGeometry:jue,TriangleGeometry:Hue,PathGeometry:vhe,VectorGeometry:sf},Dz=e=>Lhe[e.type].create(e);function hp(e){return e!==null&&"booleanOp"in e}var XV=class extends IM(ar){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new je}updateVisible(e){super.updateVisible(e),this.visible=!hp(this.parent)&&this.visible,hp(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Su.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),hp(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof XV&&(e.freeBooleanPointer(),hp(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&hp(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),hp(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},Sx=new jr;function FM(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c=t;c<i;c++){let f=e.getX(c),m=e.getY(c),g=e.getZ(c);f<s&&(s=f),m<a&&(a=m),g<o&&(o=g),f>l&&(l=f),m>u&&(u=m),g>h&&(h=g)}Sx.min.set(s,a,o),Sx.max.set(l,u,h),Sx.getCenter(r),Sx.getSize(n).multiplyScalar(.5)}var zhe=new St,Nhe=new Wu,js=class extends XV{constructor(e,t){super(zhe,Nhe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?FM(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Wh=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Wh.uuidContext===null)throw new Error("plz startContext");Wh.uuidContext===Wh.globalContext?this.uuid="_gid"+Wh.uuidContext.nodeContextUuid++:this.uuid="_uid"+Wh.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===Wh.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},cn=Wh;cn.globalContext={nodeContextUuid:0},cn.uuidContext=Wh.globalContext;var Iz=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},Bhe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},sa=new Bhe,$i=class extends cn{constructor(t,i){super(t),this.scope="",i=i??{},this.shared=i.shared!==void 0?i.shared:!0,this.unique=i.unique!==void 0?i.unique:!1}build(t,i,r,n){if(i=i??this.getType(t),this.getShared(t,i)){let s=this.getUnique(t,i);s&&this.uuid===void 0&&(this.uuid=ht.generateUUID()),r=t.getUUID(r??this.getUUID(),!s);let a=t.getNodeData(r),o=a.output||this.getType(t);if(t.analyzing)return(a.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,a,i),this.generate(t,i,r)):super.build(t,i,r);if(s)return a.name=a.name||super.build(t,i,r),a.name;if(!this.getLabel()&&(!this.getShared(t,o)||t.context.ignoreCache||a.deps===1))return super.build(t,i,r);r=this.getUUID(!1);let l=this.getTemp(t,r);if(l)return t.format(l,o,i);{l=super.generate(t,i,r,a.output,n);let u=this.generate(t,o,r);return t.addNodeCode(l+" = "+u+";"),t.format(l,o,i)}}return super.build(t,i,r)}getShared(t,i){return i!=="sampler2D"&&i!=="samplerCube"&&this.shared}getUnique(t,i){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let i=this.uuid;return typeof this.scope=="string"&&(i=this.scope+"-"+i),i}getTemp(t,i){i=i||this.uuid;let r=t.getVars()[i];return r?r.name:void 0}generate(t,i,r,n,s){return this.getShared(t,i)||console.error("TempNode is not shared"),r=r??this.uuid,t.getTempVar(r,n??this.getType(t),s,this.getLabel()).name}},ha=class extends $i{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},Qn=class extends ha{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof oe?e:new oe(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Ga=class extends ha{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof L?e:new L(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},ns=class extends Nt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Eu=class extends ha{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof ns?e:new ns(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},Fhe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Rz=/[a-z_0-9]+/gi,rt=class extends $i{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let u=0;u<this.includes.length;u++)e.include(this.includes[u],this);for(let u in this.extensions)e.extensions[u]=!0;let l=[];for(;s=Rz.exec(this.src);)l.push(s);for(let u=0;u<l.length;u++){let h=l[u],c=h[0],f=this.isMethod?!this.getInputByName(c):!0,m=c;if(this.keywords[c]||this.useKeywords&&f&&sa.containsKeyword(c)){let g=this.keywords[c];if(!g){let y=sa.getKeywordData(c);y.cache&&(g=e.keywords[c]),g=g||sa.getKeyword(c,e),y.cache&&(e.keywords[c]=g)}m=g.build(e)}c!==m&&o[h.index+a-1]!=="."&&(o=o.substring(0,h.index+a)+m+o.substring(h.index+c.length+a),a+=m.length-c.length),this.getIncludeByName(m)===void 0&&sa.contains(m)&&e.include(sa.get(m))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=Fhe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(Rz);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let u=s[a++];this.inputs.push({name:u,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},Uhe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,YV=class extends $i{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||YV.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=Uhe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},Gi=YV;Gi.PI="PI",Gi.PI2="PI2",Gi.RECIPROCAL_PI="RECIPROCAL_PI",Gi.RECIPROCAL_PI2="RECIPROCAL_PI2",Gi.LOG2="LOG2",Gi.EPSILON="EPSILON";var Vhe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),jhe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),QV=class extends $i{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=Vhe.exec(e);if(t){let i=t[2],r;for(;r=jhe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},UM=class extends $i{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};sa.addKeyword("uv",function(){return new UM});sa.addKeyword("uv2",function(){return new UM(1)});var Pp=class extends $i{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Pp.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Vo:return["Linear"];case ui:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=Pp.Nodes[this.method],s=e.include(n);if(s===Pp.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Pp.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Pp.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Ml=Pp;Ml.Nodes={LinearToLinear:new rt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new rt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new rt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Ml.LINEAR_TO_LINEAR="LinearToLinear",Ml.SRGB_TO_LINEAR="sRGBToLinear",Ml.LINEAR_TO_SRGB="LinearTosRGB";var hr=class extends rt{constructor(t="",i,r,n,s){super(t,s,n,r,i),this.nodeType="Expression"}},Du=class extends ha{constructor(e=new Ar,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new UM,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Ml(new hr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},ft=class extends ha{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},Oz=class extends $i{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let u=s.inputs[l],h=this.inputs[l]||this.inputs[u.name];o.push(h.build(e,e.getTypeByFormat(u.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},KV=class extends $i{constructor(e,t,i=KV.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},ea=KV;ea.ADD="+",ea.SUB="-",ea.MUL="*",ea.DIV="/";var Qi=class extends $i{constructor(e,t=Qi.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Qi.MIX:case Qi.CLAMP:case Qi.REFRACT:case Qi.SMOOTHSTEP:case Qi.FACEFORWARD:return 3;case Qi.MIN:case Qi.MAX:case Qi.MOD:case Qi.STEP:case Qi.REFLECT:case Qi.DISTANCE:case Qi.DOT:case Qi.CROSS:case Qi.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Qi.LENGTH:case Qi.DISTANCE:case Qi.DOT:return"f";case Qi.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),u=this.getType(e);switch(this.type=u,this.method){case Qi.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Qi.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Qi.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Qi.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Qi.MIN:case Qi.MAX:case Qi.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case Qi.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case Qi.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let h=[];h.push(i),r&&h.push(r),n&&h.push(n);let c=this.getNumInputs(e);if(h.length!==c)throw Error(`Arguments not match used in "${this.method}". Require ${c}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",u,t)}},oi=Qi;oi.RAD="radians",oi.DEG="degrees",oi.EXP="exp",oi.EXP2="exp2",oi.LOG="log",oi.LOG2="log2",oi.SQRT="sqrt",oi.INV_SQRT="inversesqrt",oi.FLOOR="floor",oi.CEIL="ceil",oi.NORMALIZE="normalize",oi.FRACT="fract",oi.SATURATE="saturate",oi.SIN="sin",oi.COS="cos",oi.TAN="tan",oi.ASIN="asin",oi.ACOS="acos",oi.ARCTAN="atan",oi.ABS="abs",oi.SIGN="sign",oi.LENGTH="length",oi.NEGATE="negate",oi.INVERT="invert",oi.MIN="min",oi.MAX="max",oi.MOD="mod",oi.STEP="step",oi.REFLECT="reflect",oi.DISTANCE="distance",oi.DOT="dot",oi.CROSS="cross",oi.POW="pow",oi.MIX="mix",oi.CLAMP="clamp",oi.REFRACT="refract",oi.SMOOTHSTEP="smoothstep",oi.FACEFORWARD="faceforward";var Ev=class extends $i{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new Oz(Ev.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Ml(new hr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Ml(new hr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Ml(new hr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Ml(new hr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new hr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new hr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new hr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new hr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new hr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new Oz(Ev.Nodes.roughnessToMip,[r]),s=new oi(n,Ev.Nodes.m0,Ev.Nodes.cubeUV_maxMipLevel,oi.CLAMP),a=new oi(s,oi.FLOOR),o=new oi(s,oi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),u=this.bilinearCubeUV(e,this.value,i,new ea(a,new ft(1).setReadonly(!0),ea.ADD)),h=new oi(l,u,o,oi.MIX);return e.format(h.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},P2=Ev;P2.Nodes=function(){let e=new QV(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Gi("float cubeUV_maxMipLevel 8.0",!0),i=new Gi("float cubeUV_minMipLevel 4.0",!0),r=new Gi("float cubeUV_maxTileSize 256.0",!0),n=new Gi("float cubeUV_minTileSize 16.0",!0),s=new rt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new rt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new rt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new Gi("float r0 1.0",!0),u=new Gi("float v0 0.339",!0),h=new Gi("float m0 -2.0",!0),c=new Gi("float r1 0.8",!0),f=new Gi("float v1 0.276",!0),m=new Gi("float m1 -1.0",!0),g=new Gi("float r4 0.4",!0),y=new Gi("float v4 0.046",!0),v=new Gi("float m4 2.0",!0),b=new Gi("float r5 0.305",!0),S=new Gi("float v5 0.016",!0),_=new Gi("float m5 3.0",!0),T=new Gi("float r6 0.21",!0),M=new Gi("float v6 0.0038",!0),C=new Gi("float m6 4.0",!0),P=[l,u,h,c,f,m,g,y,v,b,S,_,T,M,C],E=new rt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,P);return{bilinearCubeUV:o,roughnessToMip:E,m0:h,cubeUV_maxMipLevel:t}}();var Mp=class extends $i{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Mp.VIEW}getShared(){return this.scope===Mp.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case Mp.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Mp.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Mp.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},aa=Mp;aa.LOCAL="local",aa.WORLD="world",aa.VIEW="view",aa.NORMAL="normal";sa.addKeyword("viewNormal",function(){return new aa(aa.VIEW)});sa.addKeyword("localNormal",function(){return new aa(aa.NORMAL)});sa.addKeyword("worldNormal",function(){return new aa(aa.WORLD)});var wu=class extends $i{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??wu.LOCAL}getType(){switch(this.scope){case wu.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case wu.LOCAL:case wu.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case wu.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case wu.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case wu.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case wu.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},ko=wu;ko.LOCAL="local",ko.WORLD="world",ko.VIEW="view",ko.PROJECTION="projection";sa.addKeyword("position",function(){return new ko});sa.addKeyword("worldPosition",function(){return new ko(ko.WORLD)});sa.addKeyword("viewPosition",function(){return new ko(ko.VIEW)});var xl=class extends $i{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??xl.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case xl.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case xl.VECTOR:{let n=new aa(aa.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new ko(ko.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,u=`reflect( -normalize( ${o} ), ${a} )`;l&&(u=`normalize( mix( ${u}, ${a}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${u}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${h};`),r="reflectVec"):r=h;break}case xl.CUBE:{let n=new xl(xl.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case xl.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new xl(xl.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Zp=xl;Zp.CUBE="cube",Zp.SPHERE="sphere",Zp.VECTOR="vector";var Hhe=class extends $i{constructor(e=new Du,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new P2(this.value,t??new Zp(Zp.VECTOR),i),this.irradianceNode=new P2(this.value,new aa(aa.WORLD),new ft(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},Ghe=class extends ha{constructor(e=new HP,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Zp,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Ml(new hr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},Whe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,qhe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,Xhe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,Yhe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,Qhe=`
layout(location = 1) out vec4 gVelocity;
`,Khe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,kz=["x","y","z","w"],Zhe=["float","vec2","vec3","vec4"],Jhe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},$he={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},ZV=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(Whe),this.addFragmentParsCode(qhe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(Xhe),this.addFragmentFinalCode(Yhe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,u=this.getFormatByType(a);if(u===void 0)throw new Error("Node pars "+u+" not found.");u.includes("[]")?i+=t+" "+u.substring(0,u.length-2)+" "+o+`[${l}];
`:i+=t+" "+u+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof cn?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Iz({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Iz({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?sa.get(e):e,this.context.include===!1)return e.name;e instanceof rt?r=this.includes.functions:e instanceof Gi?r=this.includes.consts:e instanceof QV&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof rt&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return Zhe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Bd:case Fd:return new Ghe(i);case Fy:return new Hhe(new Du(i));default:return new Du(i)}else{if(i.isVector2)return new Qn(i);if(i.isVector3)return new Ga(i);if(i.isVector4)return new Eu(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return Jhe[e]||e}getFormatByType(e){return $he[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return kz[e]}getIndexByElement(e){return kz.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Vo,t===Vo&&this.context.gamma&&(t=ui),t}},kr=class extends ha{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof ns?e:new ns(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},tr=class extends ha{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},Ns=class extends ha{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},dd=class extends ha{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},VM=class extends ha{},ece=class extends VM{constructor(e){super("v3"),this.image=e,this._value=new L}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},M2=class extends VM{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},JV=class extends ha{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Zr}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Gl=class extends ha{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new je}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function Lz(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Zr().makeRotation(r*ht.DEG2RAD))}var tce=class extends JV{constructor(e,t,i=0){super(new Zr),this.repeat=e,this.offset=t,this.rotation=i,Lz(this.value,e,t,i)}updateMatrix(){Lz(this.value,this.repeat,this.offset,this.rotation)}},fd=class extends ha{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Yt?new Array(e).fill(t):new Array(e).fill(new Yt(0))}},zz=class extends $i{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},$V=class extends $i{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include($V.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},D2=$V;D2.Nodes=function(){return{customColor:new rt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var ej=class extends $i{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(ej.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},tj=ej;tj.Nodes=function(){return{customNormal:new rt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var Av=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h,c){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=c,this.alpha=u,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Av.Nodes.cylindrical);break;case 2:r=e.include(Av.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new rt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(Av.Nodes.triplanar);break;default:r=e.include(Av.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",u=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(u,"vec3"),n.push(a),n.push(o),n.push(l),n.push(u)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},jM=Av;jM.Nodes=function(){let e=new rt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new rt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new rt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new rt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var Cv=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h,c){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=u,this.isMask=c,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new rt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[Cv.Nodes.vectorLinearWorldSpaceDepth,Cv.Nodes.vectorLinearObjectSpaceDepth,Cv.Nodes.vectorSphericalObjectSpaceDepth,Cv.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ij=Cv;ij.Nodes=function(){let e=new rt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new rt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new rt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new rt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var ice=class extends $i{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new rt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},rj=class extends $i{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(rj.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},nj=rj;nj.Nodes=function(){return{gradient:new rt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var sj=class extends $i{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(sj.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},aj=sj;aj.Nodes=function(){return{matcap:new rt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var ra=function(){let e=new rt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new rt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Gi("float F3 0.3333333"),t.keywords.G3=new Gi("float G3 0.1666667");let i=new rt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new Gi("float F3 0.3333333"),i.keywords.G3=new Gi("float G3 0.1666667");let r=new rt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new rt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new rt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new rt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new rt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new rt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),u=new rt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),h=new rt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[u]);h.keywords.NUM_OCTAVES=new Gi("int NUM_OCTAVES 5");let c=new rt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),f=new rt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,c]),m=new rt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),g=new rt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),y=new rt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),v=new rt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),b=new rt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),S=new rt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),_=new rt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[m,g,y,v,b,S]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:h,perlin:f,voronoi:_}}(),oj=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h,c,f,m,g,y,v,b,S){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=u,this.noiseType=c,this.voronoiStyle=m,this.highCut=g,this.lowCut=y,this.smoothness=v,this.seed=b,this.quality=S,this.isMask=f,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new rt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[ra.simplexFast,ra.simplexFractal,ra.simplexAshima,ra.fbm,ra.perlin,ra.voronoi]),l=e.include(o),u=[];return u.push(this.scale.build(e,"f")),u.push(this.size.build(e,"v3")),u.push(this.move.build(e,"f")),u.push(this.fA.build(e,"v2")),u.push(this.fB.build(e,"v2")),u.push(this.distortion.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.colorC.build(e,"v4")),u.push(this.colorD.build(e,"v4")),u.push(this.voronoiStyle.build(e,"i")),u.push(this.highCut.build(e,"f")),u.push(this.lowCut.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.seed.build(e,"f")),u.push(this.quality.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}};oj.numOctaves=5;var lj=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h,c,f,m,g,y){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=u,this.compensation=h,this.resolution=c,this.normalMap=f,this.depthMap=m,this.pixelRatio=g,this.alpha=y,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(lj.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},uj=lj;uj.Nodes=function(){let e=new rt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new rt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var _u=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h,c,f,m,g,y,v,b){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=u,this.smoothness=h,this.zigzag=c,this.rotation=f,this.vertical=m,this.horizontal=g,this.sides=y,this.isMask=b,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new rt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new rt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let h=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,f=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${h};
				float d1 = ${c};
				float d2 = ${f};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let h=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c="";this.axis.value===0?c=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?c=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,c=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let f="";switch(this.projection.value){case 0:f="custom_uv = vUv.st;";break;case 1:break;case 2:f=`
							vec3 p = position;
							${c}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${f}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${h};
				`}let o=new rt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,_u.DrawFunctions.circle,_u.DrawFunctions.ring,_u.DrawFunctions.polygon,_u.DrawFunctions.cross,_u.DrawFunctions.diamond,_u.DrawFunctions.checkerboard,_u.DrawFunctions.line,_u.DrawFunctions.wave]),l=e.include(o),u=[];return u.push("normal"),u.push(this.blending.build(e,"f")),u.push(this.style.build(e,"i")),u.push(this.offset.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.frequency.build(e,"v2")),u.push(this.size.build(e,"f")),u.push(this.variation.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.zigzag.build(e,"f")),u.push(this.rotation.build(e,"f")),u.push(this.vertical.build(e,"v2")),u.push(this.horizontal.build(e,"v2")),u.push(this.sides.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},hj=_u;hj.DrawFunctions=function(){let e=new rt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new rt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new rt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new rt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new rt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new rt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new rt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new rt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new rt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),u=new rt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:u}}();var cj=class extends $i{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(cj.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},dj=cj;dj.Nodes=function(){let e=new rt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[ra.simplexFast]);return{rainbow:new rt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var fj=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(fj.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pj=fj;pj.Nodes=function(){let e=new rt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new rt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new rt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new rt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new rt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new rt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[ra.simplexFast,e,i,n])}}();var rce=function(){return{textureBicubic:new rt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function nce(e,t){return e>=t?new oe(t/e,1):new oe(1,e/t)}var mj=class extends $i{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Ut.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(mj.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},gj=mj;gj.Nodes=function(){let e=new rt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new rt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new rt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new rt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[rce.textureBicubic,i,e]),n=new rt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new rt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var I2=(e=>(e.NOISE="noise",e.MAP="map",e))(I2||{}),vj=class extends $i{constructor(e,t,i,r,n,s,a,o,l,u,h){super("v3"),this.displacementTypeIndex=new tr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(I2)[this.displacementTypeIndex.value]==="map"&&(this.mat=new JV(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=u,this.noiseFunctionIndex=h,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(I2)[this.displacementTypeIndex.value]){case"map":{i=e.include(vj.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new rt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new rt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[ra.simplexPrecise,ra.simplexFractal,ra.simplexAshima,ra.fbm,ra.perlin,ra.voronoi]),l=new rt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},yj=vj;yj.Nodes=function(){let e=new rt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new rt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new rt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Ut={normalRenderTarget:new Du,normalRenderTargetDepth:new Du,transmissionRenderTarget:new Du,aspectRatio:new Qn,transmissionSize:new Qn(2048,2048),transmissionRenderTargetDepth:new Du,aoRenderTarget:new Du,aoEnabled:new Ns,pixelRatioNode:new ft(1),resolution:new Qn,penumbraSize:new dd(5,.5),frameIndex:new tr(0),transmissionLod:new tr(2)};for(let e of Object.values(Ut))e.isRenderGlobal=!0;var xj={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.59/build/ui.wasm"},HM=class extends cn{constructor(){super("basic"),this.nodeType="Basic",this.color=new kr(Ma),this.shadingAlpha=new ft(1),this.shadingBlend=new tr(0),this.previousModelViewMatrix=new Gl,this.previouseProjectionMatrix=new Gl}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({resolution:Ut.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Rm.merge([tt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new kr(Ma)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},sce=class extends cn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new kr(Ma),this.emissive=new kr(0),this.emissiveIntensity=new ft(1),this.previousModelViewMatrix=new Gl,this.previouseProjectionMatrix=new Gl,this.shadingAlpha=new ft(1),this.shadingBlend=new tr(0),this.occlusion=new Ns(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({resolution:Ut.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Rm.merge([tt.fog,tt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ut.penumbraSize}),e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({aoMap:Ut.aoRenderTarget}),e.mergeUniform({aoEnabled:Ut.aoEnabled}),this.color===void 0&&(this.color=new kr(Ma)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];c.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&c.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),c.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${f}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&c.push(`gl_FragColor.a *= ${h.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},wm=function(){let e=new rt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new rt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),ace=class extends cn{constructor(){super("phong"),this.nodeType="Phong",this.color=new kr(Ma),this.specular=new kr(1118481),this.shininess=new ft(30),this.previousModelViewMatrix=new Gl,this.previouseProjectionMatrix=new Gl,this.shadingAlpha=new ft(1),this.shadingBlend=new tr(0),this.occlusion=new Ns(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({resolution:Ut.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Rm.merge([tt.fog,tt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ut.penumbraSize}),e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({aoMap:Ut.aoRenderTarget}),e.mergeUniform({aoEnabled:Ut.aoEnabled}),this.color===void 0&&(this.color=new kr(Ma)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(wm.dHdxy),e.include(wm.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),y=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${y});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${y});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${y});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${y});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${v}
					`)}c.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${f}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result});`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&c.push(`gl_FragColor.a *= ${h.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},oce=class extends cn{constructor(){super("standard"),this.nodeType="Standard",this.color=new kr(Ma),this.roughness=new ft(.3),this.metalness=new ft(0),this.reflectivity=new ft(.5),this.previousModelViewMatrix=new Gl,this.previouseProjectionMatrix=new Gl,this.shadingAlpha=new ft(1),this.shadingBlend=new tr(0),this.occlusion=new Ns(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({resolution:Ut.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Rm.merge([tt.fog,tt.lights])),tt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ut.penumbraSize}),e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({aoMap:Ut.aoRenderTarget}),e.mergeUniform({aoEnabled:Ut.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new kr(Ma)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,f=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=h!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let m=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(wm.dHdxy),e.include(wm.perturbNormalArb);let y=this.bumpMap.texture.flow(e,"t"),v=this.bumpMap.flow(e,"v3"),b=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",S="";this.bumpMap.projection.value===4?S=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${y.result}, uv0, ${b});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${y.result}, uv1, ${b});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${y.result}, uv2, ${b});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:S=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${y.result}, bumpMapCachedUv, ${b});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,m.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};
					${S}
					`)}if(m.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let y=this.roughnessMap.texture.flow(e,"t"),v=this.roughnessMap.flow(e,"v3"),b="";this.roughnessMap.projection.value===4?b=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${y.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${y.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${y.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:b=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${y.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,m.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};

					const float roughnessScale = 1.0;

					${b}
				`)}else m.push(s.code,"	float roughnessFactor = "+s.result+";");h&&m.push(h.code,"#ifdef ALPHATEST","	if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),m.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),m.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),f?m.push(f.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+f.result+" ) ), diffuseColor, metalnessFactor );"):m.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),m.push("#include <lights_fragment_begin>"),m.push("#include <lights_fragment_end>"),m.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let g="1.0";this.mask&&(this.mask.analyze(e),g=`luminance(${this.mask.flow(e,"v3").result})`),m.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${g} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${g}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),u&&m.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),h?m.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&m.push(`gl_FragColor.a *= ${c.result};`),m.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=m.join(`
`)}return t}},lce=class extends cn{constructor(){super("toon"),this.nodeType="Toon",this.color=new kr(Ma),this.specular=new kr(1118481),this.shininess=new ft(30),this.previousModelViewMatrix=new Gl,this.previouseProjectionMatrix=new Gl,this.shadingAlpha=new ft(1),this.shadingBlend=new tr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({resolution:Ut.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Rm.merge([tt.fog,tt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Ut.penumbraSize}),e.mergeUniform({frameIndex:Ut.frameIndex}),e.mergeUniform({aoMap:Ut.aoRenderTarget}),e.mergeUniform({aoEnabled:Ut.aoEnabled}),this.color===void 0&&(this.color=new kr(Ma)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(wm.dHdxy),e.include(wm.perturbNormalArb);let f=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${y}
					`)}h.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let c="1.0";this.mask&&(this.mask.analyze(e),c=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${c} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${c}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},uce=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},hce=class extends uce{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},JA;function cce(e){return typeof e=="string"?e:(JA||(JA=new hce),JA.load(e))}var dce=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},fce=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},bj=class extends dce{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=cce(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new OK(this.img,void 0,e,e):a=new Ar(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},Zh=class extends bj{};function pce(e,t){var i=yce(t);return i.formatToParts?gce(i,e):vce(i,e)}var mce={year:0,month:1,day:2,hour:3,minute:4,second:5};function gce(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=mce[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function vce(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var $A={};function yce(e){if(!$A[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";$A[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return $A[e]}function wj(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var Nz=36e5,xce=6e4,eC={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function _j(e,t,i){var r,n;if(!e||(r=eC.timezoneZ.exec(e),r))return 0;var s;if(r=eC.timezoneHH.exec(e),r)return s=parseInt(r[1],10),Bz(s)?-(s*Nz):NaN;if(r=eC.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return Bz(s,a)?(n=Math.abs(s)*Nz+a*xce,s>0?-n:n):NaN}if(_ce(e)){t=new Date(t||Date.now());var o=i?t:bce(t),l=R2(o,e),u=i?l:wce(t,l,e);return-u}return NaN}function bce(e){return wj(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function R2(e,t){var i=pce(e,t),r=wj(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function wce(e,t,i){var r=e.getTime(),n=r-t,s=R2(new Date(n),i);if(t===s)return t;n-=s-t;var a=R2(new Date(n),i);return s===a?s:Math.max(s,a)}function Bz(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var Fz={};function _ce(e){if(Fz[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Fz[e]=!0,!0}catch{return!1}}var Sce=Oc(w8(),1),Uz=Oc(_8(),1),Ece=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Ace=Ece,tC=36e5,Vz=6e4,Cce=2,Bs={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Ace};function Tce(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?Cce:(0,Sce.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=Pce(e),s=Mce(n.date,r),a=s.year,o=s.restDateString,l=Dce(o,a);if(isNaN(l))return new Date(NaN);if(l){var u=l.getTime(),h=0,c;if(n.time&&(h=Ice(n.time),isNaN(h)))return new Date(NaN);if(n.timeZone||i.timeZone){if(c=_j(n.timeZone||i.timeZone,new Date(u+h)),isNaN(c))return new Date(NaN)}else c=(0,Uz.default)(new Date(u+h)),c=(0,Uz.default)(new Date(u+h+c));return new Date(u+h+c)}else return new Date(NaN)}function Pce(e){var t={},i=Bs.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=Bs.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=Bs.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function Mce(e,t){var i=Bs.YYY[t],r=Bs.YYYYY[t],n;if(n=Bs.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=Bs.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function Dce(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=Bs.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,Hz(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=Bs.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return kce(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=Bs.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return Hz(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=Bs.Www.exec(e),i)return s=parseInt(i[1],10)-1,Gz(t,s)?jz(t,s):new Date(NaN);if(i=Bs.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return Gz(t,s,l)?jz(t,s,l):new Date(NaN)}return null}function Ice(e){var t,i,r;if(t=Bs.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),iC(i)?i%24*tC:NaN;if(t=Bs.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),iC(i,r)?i%24*tC+r*Vz:NaN;if(t=Bs.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return iC(i,r,n)?i%24*tC+r*Vz+n*1e3:NaN}return null}function jz(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var Rce=[31,28,31,30,31,30,31,31,30,31,30,31],Oce=[31,29,31,30,31,30,31,31,30,31,30,31];function Sj(e){return e%400===0||e%4===0&&e%100!==0}function Hz(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=Sj(e);if(r&&i>Oce[t]||!r&&i>Rce[t])return!1}return!0}function kce(e,t){if(t<1)return!1;var i=Sj(e);return!(i&&t>366||!i&&t>365)}function Gz(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function iC(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function Lce(e,t,i){var r=Tce(e,i),n=_j(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function Us(e,t){return t.color(e)}function Wz(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=Lce(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let u,h;switch(i){case"HH:mm:ss":u=[l,a,r];break;case"HH:mm":u=[l,a];break;case"HH":u=[l],o=void 0;break;case"mm":u=[a],o=void 0;break;case"ss":u=[r],o=void 0;break;case"year":h=n.getFullYear();break;case"month":h=n.getMonth()+1;break;case"dayOfYear":h=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":h=n.getDate();break;case"secondOfDay":h=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),h=0;break}return u!==void 0?{textValue:u,suffix:o}:h}function zce(e,t){switch(e.type){case"fresnel":return Fce(e,t);case"gradient":return Uce(e,t);case"depth":return Vce(e,t);case"normal":return jce(e,t);case"noise":return Hce(e,t);case"rainbow":return Gce(e,t);case"toon":return Wce(e,t);case"outline":return qce(e,t);case"transmission":return Xce(e,t);case"color":return Bce(e,t);case"pattern":return Yce(e,t)}}function Nce(e){return{type:e.type}}function Xo(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...Nce(e),alpha:s,mode:r,isMask:n}}function Bce(e,t){return{...Xo(e,t),color:Us(e.color,t)}}function Fce(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...Xo(e,t),color:Us(a,t),bias:i,scale:r,intensity:n,factor:s}}function Uce(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...Xo(e,t),gradientType:i,smooth:r,colors:n.map(u=>new Yt(u[0],u[1],u[2],u[3])),num:n.length,steps:s,offset:new oe(...o),morph:new oe(...l),angle:a}}function Vce(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:u,steps:h,smooth:c}=e;return{...Xo(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new L(...o),direction:l?new L(...l):new L(1,0,0),colors:u.map(f=>f!==void 0?new Yt(f[0],f[1],f[2],f[3]):new Yt(0,0,0,0)),steps:h.slice(0,u.length),smooth:c}}function jce(e,t){let{cnormal:i}=e;return{...Xo(e,t),cnormal:new L(i[0],i[1],i[2])}}function Hce(e,t){return{...Xo(e,t),scale:e.scale,move:e.move,fA:new oe(...e.fA),fB:new oe(...e.fB),size:new L(...e.size),distortion:new oe(...e.distortion),colorA:Us(e.colorA,t),colorB:Us(e.colorB,t),colorC:Us(e.colorC,t),colorD:Us(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function Gce(e,t){return{...Xo(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new L(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new L(...e.offset)}}function Wce(e,t){return{...Xo(e,t),positioning:e.positioning,colors:e.colors.map(i=>new Yt(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new L(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:Us(e.shadowColor,t),offset:new L(...e.offset)}}function qce(e,t){return{...Xo(e,t),outlineColor:Us(e.outlineColor,t),contourColor:Us(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new L(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function Xce(e,t){return{...Xo(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function Yce(e,t){return{...Xo(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new oe(...e.offset),colorA:Us(e.colorA,t),colorB:Us(e.colorB,t),frequency:new oe(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new oe(...e.vertical),horizontal:new oe(...e.horizontal),sides:e.sides}}var Pw=class extends ns{},Qce={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},Kce={depth:["colors"]};function Zce(e,t,i){var s,a;if(t==="isMask")return!0;let r=Qce[e.type],n=Kce[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function Ej(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof Zh||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof Zh||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*ht.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function Jce(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(Cj(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof VM))switch(n=n||Zce(i,s,a),o.constructor){case kr:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Pw?o.value=new ns(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Eu:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Pw?o.value=new ns(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Qn:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Ga:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Du:{Ej(a,t,i);break}case fd:{o.value=a.map(l=>new Yt(...l));break}default:{o.value=a;break}}}return n}var Gd=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,Qy=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)Cj(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return _l.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new M2(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new ece(n),o=new tce(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new ft(i.crop?1:0),u=new tr(i.projection??0),h=new tr(["x","y","z"].indexOf(i.axis)??0),c=new tr(i.side??0),f=new Qn(i.size?new oe(i.size[0],i.size[1]):new oe(100,100)),m=new ft(i.blending??0),g=new ft(Gd(i.alpha,r)),y=new tr(i.mode??0),v=new Ns(i.isMask??!1),b=new jM(s,a,l,u,h,c,f,m,o,g,y,v),S=new hr(b.calpha,"f");return new Dr(e,t,i,{texture:s,textureSize:a,crop:l,projection:u,axis:h,side:c,size:f,blending:m,mat:o,alpha:g,mode:y,isMask:v},b,y,S,v,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new M2(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new ft(Gd(i.alpha,r)),o=new tr(i.mode??0),l=new Ns(i.isMask??!1),u=new ft((i.texture.rotation??0)*ht.DEG2RAD),h=new aj(s,a,o,l,u),c=new hr(h.calpha,"f");return new Dr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:u},h,o,c,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Ga(new L(...i.offset)),s=new ft(i.scale??10),a=new ft(i.intensity??8),o=new ft(i.movement??1),l=new tr(i.noiseType??0),u=new tr(i.voronoiStyle??0),h=new ft(i.smoothness??.5),c=new ft(i.seed??0),f=new ft(i.highCut??1),m=new ft(i.lowCut??0),g=new tr(i.quality??1),y=new yj(a,o,n,u,h,c,f,m,g,s,l);return new Aj(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:u,smoothness:h,seed:c,highCut:f,lowCut:m,quality:g},y,r)}else throw new Error;else return tde(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):Jce(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?Ej(r.props,i.shared,this):!0;return!1}dispose(){if($ce(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Zh||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Dr=class extends Qy{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},Aj=class extends Qy{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},_l=class extends Qy{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new ft(Gd(i.alpha,r)),a=new tr(i.mode),o=new ft(i.bumpMapIntensity),l=new ft(Gd(i.alphaOverride,r)),u;if(!i.visible)n=new HM,u={};else if(i.category==="lambert"){n=new sce;let h=new kr(r.color(i.emissive)??0),c=new Ns(i.occlusion??!0);u={emissive:h,occlusion:c},n.emissive=h,n.occlusion=c}else if(i.category==="toon"){n=new lce;let h=new ft(i.shininess??30),c=new kr(r.color(i.specular)??1118481);u={shininess:h,specular:c},n.shininess=h,n.specular=c}else if(i.category==="physical"){n=new oce;let h=new ft(i.roughness??.3),c=new ft(i.metalness??0),f=new ft(i.reflectivity??.5),m=new Ns(i.occlusion??!0);u={roughness:h,metalness:c,reflectivity:f,occlusion:m},n.roughness=h,n.metalness=c,n.reflectivity=f,n.occlusion=m}else{n=new ace;let h=new ft(i.shininess??30),c=new kr(i.specular!==void 0?r.color(i.specular)??1118481:1118481),f=new Ns(i.occlusion??!0);u={shininess:h,specular:c,occlusion:f},n.shininess=h,n.specular=c,n.occlusion=f}return n.alpha=new ft(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,u.alpha=n.shadingAlpha,u.mode=n.shadingBlend,u.bumpMapIntensity=n.bumpMapIntensity,u.alphaOverride=n.alphaOverride,new _l(e,t,i,n,u,r)}get category(){return this.node.category}};function $ce(e){let t=e instanceof Qy?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Ua(e){return{alpha:new ft(e.alpha??1),mode:new tr(e.mode??0),isMask:new Ns(e.isMask??!1)}}function ede(e,t,i,r,n){switch(e.type){case"color":{let s=new kr(r.color??Ma),a=Ua(r),o=new D2(s,a.alpha),l=new hr(o.calpha,"f");return new Dr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new kr(r.color??16777215),a=new ft(r.bias??.1),o=new ft(r.scale??1),l=new ft(r.intensity??2),u=new ft(r.factor??1),h=Ua(r),c=new ice(s,a,o,l,u,h.alpha,h.mode,h.isMask),f=new hr(c.calpha,"f");return new Dr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:u,...h},c,h.mode,f,h.isMask,n)}case"rainbow":{let s=new ft(r.filmThickness??30),a=new ft(r.movement??0),o=new Ga(r.wavelengths??new L(0,0,0)),l=new ft(r.noiseStrength??0),u=new ft(r.noiseScale??1),h=new Ga(r.offset??new L(0,0,0)),c=Ua(r),f=new dj(s,a,o,l,u,h,c.alpha,c.isMask),m=new hr(f.calpha,"f");return new Dr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:u,offset:h,...c},f,c.mode,m,c.isMask,n)}case"transmission":{let s=new ft(r.thickness??10),a=new ft(r.ior??1.5),o=new ft(r.roughness??.5),l=Ut.transmissionSize,u=Ut.transmissionRenderTarget,h=Ut.transmissionRenderTargetDepth,c=window.innerWidth,f=window.innerHeight,m=c>=f?new Qn(f/c,1):new Qn(1,c/f),g=Ua(r),y=new gj(s,a,o,l,u,h,m,g.alpha),v=new hr(y.calpha,"f");return new Dr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:m,...g},y,g.mode,v,g.isMask,n)}case"toon":{let s=new tr(r.positioning??0),a;r.colors?a=new fd(r.colors.length,r.colors):(a=new fd(10,new Yt(0,0,0,1)),a.value[1]=new Yt(1,1,1,1));let o;r.steps?o=new dd(r.steps.length,r.steps):(o=new dd(10,1),o.value[0]=0);let l=new Ga(r.source??new L(0,0,0)),u=new Ns(r.isWorldSpace??!0),h=new ft(r.noiseStrength??0),c=new ft(r.noiseScale??1),f=new Eu(r.shadowColor),m=new Ga(r.offset??new L(0,0,0)),g=Ua(r),y=new pj(s,a,o,l,u,h,c,f,m,g.alpha),v=new hr(y.calpha,"f");return new Dr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:u,noiseStrength:h,noiseScale:c,shadowColor:f,offset:m,...g},y,g.mode,v,g.isMask,n)}case"outline":{let s=new kr(r.outlineColor??16777215),a=new kr(r.contourColor??16777215),o=new ft(r.outlineWidth??.1),l=new ft(r.contourWidth??.1),u=new ft(r.outlineThreshold??.1),h=new ft(r.contourThreshold??.1),c=new ft(r.outlineSmoothing??.1),f=new ft(r.contourFrequency??.1),m=new Ga(r.contourDirection??new L(0,1,0)),g=new Ns(r.positionalLines??!1),y=new Ns(r.compensation??!0),v=Ut.normalRenderTarget,b=Ut.normalRenderTargetDepth,S=Ut.pixelRatioNode,_=Ut.resolution,T=Ua(r),M=new uj(s,a,o,l,u,h,c,f,m,g,y,_,v,b,S,T.alpha),C=new hr(M.calpha,"f");return new Dr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:u,contourThreshold:h,outlineSmoothing:c,contourFrequency:f,contourDirection:m,positionalLines:g,compensation:y,...T},M,T.mode,C,T.isMask,n)}case"depth":{let s=new tr(r.gradientType??0),a=new Ns(r.smooth??!1),o=new ft(r.near??50),l=new ft(r.far??200),u=new ft(r.isVector??1),h=new ft(r.isWorldSpace??0),c=new Ga(r.origin??new L),f=new Ga(r.direction??new L),m;r.colors?m=new fd(r.colors.length,r.colors):(m=new fd(2,new Yt(0,0,0,1)),m.value[1]=new Yt(1,1,1,1));let g;r.steps?g=new dd(r.steps.length,r.steps):(g=new dd(2,1),g.value[0]=0);let y=Ua(r),v=new ij(s,a,o,l,u,h,c,f,m,g,y.alpha,y.isMask),b=new hr(v.calpha,"f");return new Dr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:u,isWorldSpace:h,origin:c,direction:f,colors:m,steps:g,...y},v,y.mode,b,y.isMask,n)}case"noise":{let s=new ft(r.scale??1),a=new Ga(r.size??new L(100,100,100)),o=new ft(r.move??1),l=new Qn(r.fA??new oe(1.7,9.2)),u=new Qn(r.fB??new oe(8.3,2.8)),h=new Qn(r.distortion??new oe(1,1)),c=new Eu(r.colorA),f=new Eu(r.colorB),m=new Eu(r.colorC),g=new Eu(r.colorD),y=new tr(r.noiseType??0),v=new tr(r.voronoiStyle??0),b=new ft(r.highCut??1),S=new ft(r.lowCut??0),_=new ft(r.smoothness??.5),T=new ft(r.seed??.5),M=new tr(r.quality??1),C=Ua(r),P=new oj(s,a,o,l,u,h,c,f,m,g,C.alpha,y,C.isMask,v,b,S,_,T,M),E=new hr(P.calpha,"f");return new Dr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:u,distortion:h,colorA:c,colorB:f,colorC:m,colorD:g,noiseType:y,...C,voronoiStyle:v,highCut:b,lowCut:S,smoothness:_,seed:T,quality:M},P,C.mode,E,C.isMask,n)}case"normal":{let s=new Ga(r.cnormal??new L(1,1,1)),a=Ua(r),o=new tj(s,a.alpha),l=new hr(o.calpha,"f");return new Dr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new tr(r.gradientType??0),a=new Ns(r.smooth??!1),o;r.colors?o=new fd(r.colors.length,r.colors):(o=new fd(10,new Yt(0,0,0,1)),o.value[1]=new Yt(1,1,1,1));let l;r.steps?l=new dd(r.steps.length,r.steps):(l=new dd(10,1),l.value[0]=0);let u=new Qn(r.offset??new oe(0,0)),h=new Qn(r.morph??new oe(0,0)),c=new ft(r.angle??0),f=Ua(r),m=new nj(s,a,o,l,u,h,c,f.alpha,f.isMask),g=new hr(m.calpha,"f");return new Dr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:u,morph:h,angle:c,...f},m,f.mode,g,f.isMask,n)}case"pattern":{let s=new tr(r.style??0),a=new tr(r.projection??0),o=new tr(["x","y","z"].indexOf(r.axis)??0),l=new ft(r.blending??0),u=new Qn(r.offset??new oe(0,0)),h=new Eu(r.colorA),c=new Eu(r.colorB),f=new Qn(r.frequency??new oe(10,10)),m=new ft(r.size??.5),g=new ft(r.variation??0),y=new ft(r.smoothness??.5),v=new ft(r.zigzag??0),b=new ft(r.rotation??0),S=new Qn(r.vertical??new oe(0,1)),_=new Qn(r.horizontal??new oe(0,1)),T=new tr(r.sides??6),M=Ua(r),C=new hj(s,a,o,l,u,h,c,f,m,g,y,v,b,S,_,T,M.alpha,M.isMask),P=new hr(C.calpha,"f");return new Dr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:u,colorA:h,colorB:c,frequency:f,size:m,variation:g,smoothness:y,zigzag:v,rotation:b,vertical:S,horizontal:_,sides:T,...M},C,M.mode,P,M.isMask,n)}default:{let s=new kr(1,0,0,1),a=Ua(r),o=new D2(s,a.alpha),l=new hr(o.calpha,"f");return new Dr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function tde(e,t,i,r){let n=zce(i,r);return ede(i,e,t,n,r)}function Cj(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=Gd(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function Up(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,u=t.color(n.data.colorD).a,h=Math.min(a,Math.min(o,Math.min(l,u)));h<1&&(s=h)}i+=(1-i)*s}}return i<1}var Ec=class extends Mi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},ide=class extends Ec{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},GM=class extends Ec{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,cn.startContext(this),this.reset0(e,t),cn.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new ide(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){cn.startContext(this),(this.data!==e||i)&&this.reset0(e,t),cn.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??Ln.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>Qy.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=Up(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=Up(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=Up(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof _l),this.lightLayer===void 0&&(this.lightLayer=new _l(0,"",{...Dn.defaultData("light","phong"),visible:!1},new HM,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof _l);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof Dr&&s.color instanceof jM&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(cn.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=Up(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:Gd(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:Gd(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);cn.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Dr?t.color.mask=void 0:t instanceof _l&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Dr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof _l?r.node.mask=new ea(t.color,t.alpha,ea.MUL):r instanceof Dr&&(r.isMask.value||(r.color.mask=new ea(t.color,t.alpha,ea.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Dr),t=this.layers.findIndex(i=>i instanceof _l);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof Dr){if(n.isMask.value)continue;i=new zz(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new hr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof _l);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof Dr){if(r.isMask.value)continue;e=new zz(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof Aj);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new ea(t,e[i].position,ea.ADD),t=new ea(t,new ft(.5).setReadonly(!0),ea.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new ZV;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Dr){let t=e.params.texture;if(t instanceof M2&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Ec.prototype,{properties:{get:function(){return this.fragment.properties}}});var O2=class extends GM{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},qz=new Map;function rde(e){if(typeof e=="string")return e;let t=qz.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},qz.set(e,t)),t.url}var Tj,nde=new Promise(e=>{Tj=e}),Xz=!1,Ex;function sde(){if(Xz)return;if(Ex)return Ex;async function e(){await Es(()=>import("./howler-BXtf1s0q.js").then(t=>t.h),[]),Tj(window!==void 0?window:global),Xz=!0}return Ex=e(),Ex}var Pj;nde.then(e=>Pj=e);function ade(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var Tv=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:rde(e),format:"wav"},this.sound=new Pj.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},ode=class{constructor(){this.type="ShapePath",this.color=new Nt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new jb,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(m,g,y,v){let b=m.x,S=g.x,_=y.x,T=v.x,M=m.y,C=g.y,P=y.y,E=v.y,D=(T-_)*(M-P)-(E-P)*(b-_),I=(S-b)*(M-P)-(C-M)*(b-_),O=(E-P)*(S-b)-(T-_)*(C-M),N=D/O,k=I/O;if(O===0&&D!==0||N<=0||N>=1||k<0||k>1)return null;if(D===0&&O===0){for(let U=0;U<2;U++)if(r(U===0?y:v,m,g),t.loc===e.ORIGIN){let Q=U===0?y:v;return{x:Q.x,y:Q.y,t:t.t}}else if(t.loc===e.BETWEEN){let Q=+(b+t.t*(S-b)).toPrecision(10),se=+(M+t.t*(C-M)).toPrecision(10);return{x:Q,y:se,t:t.t}}return null}else{for(let se=0;se<2;se++)if(r(se===0?y:v,m,g),t.loc===e.ORIGIN){let K=se===0?y:v;return{x:K.x,y:K.y,t:t.t}}let U=+(b+N*(S-b)).toPrecision(10),Q=+(M+N*(C-M)).toPrecision(10);return{x:U,y:Q,t:N}}}function r(m,g,y){let v=y.x-g.x,b=y.y-g.y,S=m.x-g.x,_=m.y-g.y,T=v*_-S*b;if(m.x===g.x&&m.y===g.y){t.loc=e.ORIGIN,t.t=0;return}if(m.x===y.x&&m.y===y.y){t.loc=e.DESTINATION,t.t=1;return}if(T<-Number.EPSILON){t.loc=e.LEFT;return}if(T>Number.EPSILON){t.loc=e.RIGHT;return}if(v*S<0||b*_<0){t.loc=e.BEHIND;return}if(Math.sqrt(v*v+b*b)<Math.sqrt(S*S+_*_)){t.loc=e.BEYOND;return}let M;v!==0?M=S/v:M=_/b,t.loc=e.BETWEEN,t.t=M}function n(m,g){let y=[],v=[];for(let b=1;b<m.length;b++){let S=m[b-1],_=m[b];for(let T=1;T<g.length;T++){let M=g[T-1],C=g[T],P=i(S,_,M,C);P!==null&&y.find(E=>E.t<=P.t+Number.EPSILON&&E.t>=P.t-Number.EPSILON)===void 0&&(y.push(P),v.push(new oe(P.x,P.y)))}}return v}function s(m,g,y){let v=new oe;g.getCenter(v);let b=[];return y.forEach(S=>{S.boundingBox.containsPoint(v)&&n(m,S.points).forEach(_=>{b.push({identifier:S.identifier,isCW:S.isCW,point:_})})}),b.sort((S,_)=>S.point.x-_.point.x),b}function a(m,g,y,v,b){(b==null||b==="")&&(b="nonzero");let S=new oe;m.boundingBox.getCenter(S);let _=[new oe(y,S.y),new oe(v,S.y)],T=s(_,m.boundingBox,g);T.sort((I,O)=>I.point.x-O.point.x);let M=[],C=[];T.forEach(I=>{I.identifier===m.identifier?M.push(I):C.push(I)});let P=M[0].point.x,E=[],D=0;for(;D<C.length&&C[D].point.x<P;)E.length>0&&E[E.length-1]===C[D].identifier?E.pop():E.push(C[D].identifier),D++;if(E.push(m.identifier),b==="evenodd"){let I=E.length%2===0,O=E[E.length-2];return{identifier:m.identifier,isHole:I,for:O}}else if(b==="nonzero"){let I=!0,O=null,N=null;for(let k=0;k<E.length;k++){let U=E[k];g[U]&&(I?(N=g[U].isCW,I=!1,O=U):N!==g[U].isCW&&(N=g[U].isCW,I=!0))}return{identifier:m.identifier,isHole:I,for:O}}else console.warn('fill-rule: "'+b+'" is currently not implemented.')}let o=0,l=999999999,u=-999999999,h=[];this.subPaths.forEach(m=>{let g=m.getPoints(),y=-999999999,v=999999999,b=-999999999,S=999999999;for(let _=0;_<g.length;_++){let T=g[_];T.y>y&&(y=T.y),T.y<v&&(v=T.y),T.x>b&&(b=T.x),T.x<S&&(S=T.x)}u<=b&&(u=b+1),l>=S&&(l=S-1),g.length&&h.push({curves:m.curves,points:g,isCW:I5.isClockWise(g),identifier:o++,boundingBox:new tM(new oe(S,v),new oe(b,y))})});let c=h.map(m=>{var g;return a(m,h,l,u,(g=this.userData)==null?void 0:g.style.fillRule)}),f=[];return h.forEach(m=>{let g=c[m.identifier];if(g&&!g.isHole){let y=new Hb;y.curves=m.curves,c.filter(v=>(v==null?void 0:v.isHole)&&v.for===m.identifier).forEach(v=>{if(v){let b=h[v.identifier],S=new jb;S.curves=b.curves,y.holes.push(S)}}),f.push(y)}}),f}},Mj=!1,Dj,Yz=new Promise(e=>{Dj=e}),Qz=!1,Ax;function lde(){if(Mj=!0,Qz)return;if(Ax)return Ax;async function e(){let t=await Es(()=>import("./opentype-DeuPKl_n.js"),[]);Dj(t),Qz=!0}return Ax=e(),Ax}var ude=class{async load(e,t,i=()=>{}){let{load:r}=await Yz;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await Yz;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function hde(e){return await(await fetch(e)).arrayBuffer()}var cde=new ude;async function Kz(e){let t,i,r=!1;if(e.url?(t=await hde(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(Mj){let n=await cde.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function dde(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var fde=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Kz(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Kz(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let u=i[l].index,h=String.fromCharCode(i[l].unicode),c=n[a];if(dde(u,c)||o)s.push({char:h,index:u,replacements:[c.state.glyphIndex],replacementChars:[c.char]}),a++;else{let f=c.char,m="",g=[c.state.glyphIndex],y=[],v=!1;for(;!v;)a++,m=t.charAt(a),f+=m,g.push(e.charToGlyphIndex(m)),y=e.stringToGlyphs(f),y.length===1&&y[0].index===u&&(v=!0),a>t.length&&(v=!0);s.push({char:h,index:u,replacements:g,replacementChars:Array.from(f)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(b=>this.getTextWidth(b,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,u=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),c=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),f=[],m=e.map(b=>[]),g=e.map(b=>[]),y;for(let b=0;b<e.length;b++){let S=e[b],_={features:{liga:!0}},T=[];try{T=i.stringToGlyphs(S,_)}catch(C){console.warn(C)}h=this.getLineInitialOffsetX(s[b],a,t.horizontalAlign,S,o);let M=[];try{M=this.reverseLigaturesTable(i,S,T)}catch(C){console.warn(C)}u=this.computeSpaceWidthForLine(e,b,t);for(let C=0;C<T.length;C++){let P=T[C],E=P.index===0?`
`:P.unicode?String.fromCharCode(P.unicode):void 0,D=M[C],I=0,O=0;C===0&&t.horizontalAlign===2&&P.leftSideBearing!==void 0&&(O=-P.leftSideBearing*r),y&&(I=i.getKerningValue(P,y)*r),h+=O+I;let N=0;if(E===`
`)N=l;else if(E===" ")N=u;else{let k=this.createPath(P,r,h,c,t);k&&(N=k.offsetX-(I+O),f.push(k.path))}if(D.replacements.length===1)g[b].push([h,c]),m[b].push(N);else{let k=D.replacements.map(K=>(i.glyphs.get(K).advanceWidth??0)*r),U=k.reduce((K,H)=>K+=H,0),Q=k.map(K=>K/U),se=h;for(let K=0;K<Q.length;K++){let H=N*Q[K];g[b].push([se,c]),m[b].push(H),se+=H}}h+=N,y=P}c-=n}let v=[];for(let b=0,S=f.length;b<S;b++)v.push(...f[b].toShapes());return{shapes:v,charWidths:m,lineWidths:s,charCoords:g}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new ode,o=(e.advanceWidth??1)*t;if(e)for(let u of s.commands){let h=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(h&&u.type!=="Z"&&h.x===u.x&&-h.y===u.y))switch(u.type){case"M":a.moveTo(u.x,-u.y);break;case"L":a.lineTo(u.x,-u.y);break;case"Q":a.quadraticCurveTo(u.x1,-u.y1,u.x,-u.y);break;case"C":a.bezierCurveTo(u.x1,-u.y1,u.x2,-u.y2,u.x,-u.y);break}}return a.subPaths.forEach(u=>{let h=pde(u.curves);h!==void 0&&u.currentPoint.distanceTo(h)>0&&u.lineTo(h.x,h.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function pde(e){if(e.length){let t=e[0];if(t instanceof Fo)return t.v1;if(t instanceof Oo||t instanceof _c)return t.v0}}var mde=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Zz=class extends mde{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=_y(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},gde={markNeedsUpdateRendererDirty:()=>{}},mb=1e3,Jz=512*mb;function vde(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var yde="https://hooks.spline.design",xde=`${yde}/events?hashFile=`,bde=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=R_(),this.reconnectWaitFor=mb,this._onError=i=>{var r,n,s;(r=this.eventSource)==null||r.removeEventListener("message",this._onMessage),(n=this.eventSource)==null||n.removeEventListener("error",this._onError),(s=this.eventSource)==null||s.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=mb,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=mb,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&vde(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(xde+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,i,r;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(t=this.eventSource)==null||t.removeEventListener("error",this._onError),(i=this.eventSource)==null||i.removeEventListener("open",this._onConnected),(r=this.eventSource)==null||r.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>Jz&&(this.reconnectWaitFor=Jz),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var t;if(this.getParametersKeys().includes(e)){if(this.result)return(t=this.result)==null?void 0:t[e];for(let i of this.userWebhook.parametersSchemas)if(i.data.name===e)return a2.defaultParameterValueByType(i.data.type)}}},wde=globalThis.atob,_de=globalThis.btoa,Jp=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(e.length*2),i=new DataView(t),r=0;for(let n=0;n<e.length;n++,r+=2){let s=Math.max(-1,Math.min(1,e[n]));i.setInt16(r,s<0?s*32768:s*32767,!0)}return t}static base64ToArrayBuffer(e){let t=wde(e),i=t.length,r=new Uint8Array(i);for(let n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer}static arrayBufferToBase64(e){e instanceof Float32Array?e=this.floatTo16BitPCM(e):e instanceof Int16Array&&(e=e.buffer);let t="",i=new Uint8Array(e),r=32768;for(let n=0;n<i.length;n+=r){let s=i.subarray(n,n+r);t+=String.fromCharCode.apply(null,s)}return _de(t)}static mergeInt16Arrays(e,t){if(e instanceof ArrayBuffer&&(e=new Int16Array(e)),t instanceof ArrayBuffer&&(t=new Int16Array(t)),!(e instanceof Int16Array)||!(t instanceof Int16Array))throw new Error("Both items must be Int16Array");let i=new Int16Array(e.length+t.length);for(let r=0;r<e.length;r++)i[r]=e[r];for(let r=0;r<t.length;r++)i[e.length+r]=t[r];return i}static generateId(e,t=21){let i="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",r=Array(t-e.length).fill(0).map(n=>i[Math.floor(Math.random()*i.length)]).join("");return`${e}${r}`}},Sde=e=>new Promise(t=>setTimeout(()=>t(),e)),Ij=class{constructor(){this.eventHandlers={},this.nextEventHandlers={}}clearEventHandlers(){return this.eventHandlers={},this.nextEventHandlers={},!0}on(e,t){return this.eventHandlers[e]=this.eventHandlers[e]||[],this.eventHandlers[e].push(t),t}onNext(e,t){return this.nextEventHandlers[e]=this.nextEventHandlers[e]||[],this.nextEventHandlers[e].push(t),t}off(e,t){let i=this.eventHandlers[e]||[];if(t){let r=i.indexOf(t);if(r===-1)throw new Error(`Could not turn off specified event listener for "${e}": not found as a listener`);i.splice(r,1)}else delete this.eventHandlers[e];return!0}offNext(e,t){let i=this.nextEventHandlers[e]||[];if(t){let r=i.indexOf(t);if(r===-1)throw new Error(`Could not turn off specified next event listener for "${e}": not found as a listener`);i.splice(r,1)}else delete this.nextEventHandlers[e];return!0}async waitForNext(e,t=null){let i=Date.now(),r;for(this.onNext(e,n=>r=n);!r;){if(t&&Date.now()-i>t)return null;await Sde(1)}return r}dispatch(e,t){let i=[].concat(this.eventHandlers[e]||[]);for(let n of i)n(t);let r=[].concat(this.nextEventHandlers[e]||[]);for(let n of r)n(t);return delete this.nextEventHandlers[e],!0}},Ede=class extends Ij{constructor({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}={}){if(super(),this.defaultUrl="wss://api.openai.com/v1/realtime",this.url=e||this.defaultUrl,this.apiKey=t||null,this.debug=!!r,this.ws=null,globalThis.document&&this.apiKey&&!i)throw new Error('Can not provide API key in the browser without "dangerouslyAllowAPIKeyInBrowser" set to true')}isConnected(){return!!this.ws}log(...e){let t=[`[Websocket/${new Date().toISOString()}]`].concat(e).map(i=>typeof i=="object"&&i!==null?JSON.stringify(i,null,2):i);return this.debug&&console.log(...t),!0}async connect({model:e}={model:"gpt-4o-realtime-preview-2024-10-01"}){if(!this.apiKey&&this.url===this.defaultUrl&&console.warn(`No apiKey provided for connection to "${this.url}"`),this.isConnected())throw new Error("Already connected");if(globalThis.document){this.apiKey&&console.warn("Warning: Connecting using API key in the browser, this is not recommended");let t=globalThis.WebSocket,i=new t(`${this.url}${e?`?model=${e}`:""}`,["realtime",`openai-insecure-api-key.${this.apiKey}`,"openai-beta.realtime-v1"]);return i.addEventListener("message",r=>{let n=JSON.parse(r.data);this.receive(n.type,n)}),new Promise((r,n)=>{let s=()=>{this.disconnect(i),n(new Error(`Could not connect to "${this.url}"`))};i.addEventListener("error",s),i.addEventListener("open",()=>{this.log(`Connected to "${this.url}"`),i.removeEventListener("error",s),i.addEventListener("error",()=>{this.disconnect(i),this.log(`Error, disconnected from "${this.url}"`),this.dispatch("close",{error:!0})}),i.addEventListener("close",()=>{this.disconnect(i),this.log(`Disconnected from "${this.url}"`),this.dispatch("close",{error:!1})}),this.ws=i,r(!0)})})}}disconnect(e){if(!e||this.ws===e)return this.ws&&this.ws.close(),this.ws=null,!0}receive(e,t){return this.log("received:",e,t),this.dispatch(`server.${e}`,t),this.dispatch("server.*",t),!0}send(e,t){if(!this.isConnected())throw new Error("RealtimeAPI is not connected");if(t=t||{},typeof t!="object")throw new Error("data must be an object");let i={event_id:Jp.generateId("evt_"),type:e,...t};return this.dispatch(`client.${e}`,i),this.dispatch("client.*",i),this.log("sent:",e,i),this.ws.send(JSON.stringify(i)),!0}},Ade=class{constructor(){wd(this,"defaultFrequency",24e3),wd(this,"EventProcessors",{"conversation.item.created":e=>{let{item:t}=e,i=JSON.parse(JSON.stringify(t));if(this.itemLookup[i.id]||(this.itemLookup[i.id]=i,this.items.push(i)),i.formatted={},i.formatted.audio=new Int16Array(0),i.formatted.text="",i.formatted.transcript="",this.queuedSpeechItems[i.id]&&(i.formatted.audio=this.queuedSpeechItems[i.id].audio,delete this.queuedSpeechItems[i.id]),i.content){let r=i.content.filter(n=>["text","input_text"].includes(n.type));for(let n of r)i.formatted.text+=n.text}return this.queuedTranscriptItems[i.id]&&(i.formatted.transcript=this.queuedTranscriptItems.transcript,delete this.queuedTranscriptItems[i.id]),i.type==="message"?i.role==="user"?(i.status="completed",this.queuedInputAudio&&(i.formatted.audio=this.queuedInputAudio,this.queuedInputAudio=null)):i.status="in_progress":i.type==="function_call"?(i.formatted.tool={type:"function",name:i.name,call_id:i.call_id,arguments:""},i.status="in_progress"):i.type==="function_call_output"&&(i.status="completed",i.formatted.output=i.output),{item:i,delta:null}},"conversation.item.truncated":e=>{let{item_id:t,audio_end_ms:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`item.truncated: Item "${t}" not found`);let n=Math.floor(i*this.defaultFrequency/1e3);return r.formatted.transcript="",r.formatted.audio=r.formatted.audio.slice(0,n),{item:r,delta:null}},"conversation.item.deleted":e=>{let{item_id:t}=e,i=this.itemLookup[t];if(!i)throw new Error(`item.deleted: Item "${t}" not found`);delete this.itemLookup[i.id];let r=this.items.indexOf(i);return r>-1&&this.items.splice(r,1),{item:i,delta:null}},"conversation.item.input_audio_transcription.completed":e=>{let{item_id:t,content_index:i,transcript:r}=e,n=this.itemLookup[t],s=r||" ";return n?(n.content[i].transcript=r,n.formatted.transcript=s,{item:n,delta:{transcript:r}}):(this.queuedTranscriptItems[t]={transcript:s},{item:null,delta:null})},"input_audio_buffer.speech_started":e=>{let{item_id:t,audio_start_ms:i}=e;return this.queuedSpeechItems[t]={audio_start_ms:i},{item:null,delta:null}},"input_audio_buffer.speech_stopped":(e,t)=>{let{item_id:i,audio_end_ms:r}=e;this.queuedSpeechItems[i]||(this.queuedSpeechItems[i]={audio_start_ms:r});let n=this.queuedSpeechItems[i];if(n.audio_end_ms=r,t){let s=Math.floor(n.audio_start_ms*this.defaultFrequency/1e3),a=Math.floor(n.audio_end_ms*this.defaultFrequency/1e3);n.audio=t.slice(s,a)}return{item:null,delta:null}},"response.created":e=>{let{response:t}=e;return this.responseLookup[t.id]||(this.responseLookup[t.id]=t,this.responses.push(t)),{item:null,delta:null}},"response.output_item.added":e=>{let{response_id:t,item:i}=e,r=this.responseLookup[t];if(!r)throw new Error(`response.output_item.added: Response "${t}" not found`);return r.output.push(i.id),{item:null,delta:null}},"response.output_item.done":e=>{let{item:t}=e;if(!t)throw new Error('response.output_item.done: Missing "item"');let i=this.itemLookup[t.id];if(!i)throw new Error(`response.output_item.done: Item "${t.id}" not found`);return i.status=t.status,{item:i,delta:null}},"response.content_part.added":e=>{let{item_id:t,part:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`response.content_part.added: Item "${t}" not found`);return r.content.push(i),{item:r,delta:null}},"response.audio_transcript.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.audio_transcript.delta: Item "${t}" not found`);return n.content[i].transcript+=r,n.formatted.transcript+=r,{item:n,delta:{transcript:r}}},"response.audio.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.audio.delta: Item "${t}" not found`);let s=Jp.base64ToArrayBuffer(r),a=new Int16Array(s);return n.formatted.audio=Jp.mergeInt16Arrays(n.formatted.audio,a),{item:n,delta:{audio:a}}},"response.text.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.text.delta: Item "${t}" not found`);return n.content[i].text+=r,n.formatted.text+=r,{item:n,delta:{text:r}}},"response.function_call_arguments.delta":e=>{let{item_id:t,delta:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`response.function_call_arguments.delta: Item "${t}" not found`);return r.arguments+=i,r.formatted.tool.arguments+=i,{item:r,delta:{arguments:i}}}}),this.clear()}clear(){return this.itemLookup={},this.items=[],this.responseLookup={},this.responses=[],this.queuedSpeechItems={},this.queuedTranscriptItems={},this.queuedInputAudio=null,!0}queueInputAudio(e){return this.queuedInputAudio=e,e}processEvent(e,...t){if(!e.event_id)throw console.error(e),new Error('Missing "event_id" on event');if(!e.type)throw console.error(e),new Error('Missing "type" on event');let i=this.EventProcessors[e.type];if(!i)throw new Error(`Missing conversation event processor for "${e.type}"`);return i.call(this,e,...t)}getItem(e){return this.itemLookup[e]||null}getItems(){return this.items.slice()}},$z=class extends Ij{constructor({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}={}){super(),this.defaultSessionConfig={modalities:["text","audio"],instructions:"",voice:"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:null,turn_detection:null,tools:[],tool_choice:"auto",temperature:.8,max_response_output_tokens:4096},this.sessionConfig={},this.transcriptionModels=[{model:"whisper-1"}],this.defaultServerVadConfig={type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:200},this.realtime=new Ede({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}),this.conversation=new Ade,this._resetConfig(),this._addAPIEventHandlers()}_resetConfig(){return this.sessionCreated=!1,this.tools={},this.sessionConfig=JSON.parse(JSON.stringify(this.defaultSessionConfig)),this.inputAudioBuffer=new Int16Array(0),!0}_addAPIEventHandlers(){this.realtime.on("client.*",r=>{let n={time:new Date().toISOString(),source:"client",event:r};this.dispatch("realtime.event",n)}),this.realtime.on("server.*",r=>{let n={time:new Date().toISOString(),source:"server",event:r};this.dispatch("realtime.event",n)}),this.realtime.on("server.session.created",()=>this.sessionCreated=!0);let e=(r,...n)=>{let{item:s,delta:a}=this.conversation.processEvent(r,...n);return{item:s,delta:a}},t=(r,...n)=>{let{item:s,delta:a}=e(r,...n);return s&&this.dispatch("conversation.updated",{item:s,delta:a}),{item:s,delta:a}},i=async r=>{try{let n=JSON.parse(r.arguments),s=this.tools[r.name];if(!s)throw new Error(`Tool "${r.name}" has not been added`);let a=await s.handler(n);this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:r.call_id,output:JSON.stringify(a)}})}catch(n){this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:r.call_id,output:JSON.stringify({error:n.message})}})}this.createResponse()};return this.realtime.on("server.response.created",e),this.realtime.on("server.response.output_item.added",e),this.realtime.on("server.response.content_part.added",e),this.realtime.on("server.input_audio_buffer.speech_started",r=>{e(r),this.dispatch("conversation.interrupted")}),this.realtime.on("server.input_audio_buffer.speech_stopped",r=>e(r,this.inputAudioBuffer)),this.realtime.on("server.conversation.item.created",r=>{let{item:n}=t(r);this.dispatch("conversation.item.appended",{item:n}),n.status==="completed"&&this.dispatch("conversation.item.completed",{item:n})}),this.realtime.on("server.conversation.item.truncated",t),this.realtime.on("server.conversation.item.deleted",t),this.realtime.on("server.conversation.item.input_audio_transcription.completed",t),this.realtime.on("server.response.audio_transcript.delta",t),this.realtime.on("server.response.audio.delta",t),this.realtime.on("server.response.text.delta",t),this.realtime.on("server.response.function_call_arguments.delta",t),this.realtime.on("server.response.output_item.done",async r=>{let{item:n}=t(r);n.status==="completed"&&this.dispatch("conversation.item.completed",{item:n}),n.formatted.tool&&i(n.formatted.tool)}),!0}isConnected(){return this.realtime.isConnected()}reset(){return this.disconnect(),this.clearEventHandlers(),this.realtime.clearEventHandlers(),this._resetConfig(),this._addAPIEventHandlers(),!0}async connect(){if(this.isConnected())throw new Error("Already connected, use .disconnect() first");return await this.realtime.connect(),this.updateSession(),!0}async waitForSessionCreated(){if(!this.isConnected())throw new Error("Not connected, use .connect() first");for(;!this.sessionCreated;)await new Promise(e=>setTimeout(()=>e(),1));return!0}disconnect(){this.sessionCreated=!1,this.realtime.isConnected()&&this.realtime.disconnect(),this.conversation.clear()}getTurnDetectionType(){var e;return((e=this.sessionConfig.turn_detection)==null?void 0:e.type)||null}addTool(e,t){if(!(e!=null&&e.name))throw new Error("Missing tool name in definition");let i=e==null?void 0:e.name;if(this.tools[i])throw new Error(`Tool "${i}" already added. Please use .removeTool("${i}") before trying to add again.`);if(typeof t!="function")throw new Error(`Tool "${i}" handler must be a function`);return this.tools[i]={definition:e,handler:t},this.updateSession(),this.tools[i]}removeTool(e){if(!this.tools[e])throw new Error(`Tool "${e}" does not exist, can not be removed.`);return delete this.tools[e],!0}deleteItem(e){return this.realtime.send("conversation.item.delete",{item_id:e}),!0}updateSession({modalities:e=void 0,instructions:t=void 0,voice:i=void 0,input_audio_format:r=void 0,output_audio_format:n=void 0,input_audio_transcription:s=void 0,turn_detection:a=void 0,tools:o=void 0,tool_choice:l=void 0,temperature:u=void 0,max_response_output_tokens:h=void 0}={}){e!==void 0&&(this.sessionConfig.modalities=e),t!==void 0&&(this.sessionConfig.instructions=t),i!==void 0&&(this.sessionConfig.voice=i),r!==void 0&&(this.sessionConfig.input_audio_format=r),n!==void 0&&(this.sessionConfig.output_audio_format=n),s!==void 0&&(this.sessionConfig.input_audio_transcription=s),a!==void 0&&(this.sessionConfig.turn_detection=a),o!==void 0&&(this.sessionConfig.tools=o),l!==void 0&&(this.sessionConfig.tool_choice=l),u!==void 0&&(this.sessionConfig.temperature=u),h!==void 0&&(this.sessionConfig.max_response_output_tokens=h);let c=[].concat((o||[]).map(m=>{let g={type:"function",...m};if(this.tools[g==null?void 0:g.name])throw new Error(`Tool "${g==null?void 0:g.name}" has already been defined`);return g}),Object.keys(this.tools).map(m=>({type:"function",...this.tools[m].definition}))),f={...this.sessionConfig};return f.tools=c,this.realtime.isConnected()&&this.realtime.send("session.update",{session:f}),!0}sendUserMessageContent(e=[]){if(e.length){for(let t of e)t.type==="input_audio"&&(t.audio instanceof ArrayBuffer||t.audio instanceof Int16Array)&&(t.audio=Jp.arrayBufferToBase64(t.audio));this.realtime.send("conversation.item.create",{item:{type:"message",role:"user",content:e}})}return this.createResponse(),!0}appendInputAudio(e){return e.byteLength>0&&(this.realtime.send("input_audio_buffer.append",{audio:Jp.arrayBufferToBase64(e)}),this.inputAudioBuffer=Jp.mergeInt16Arrays(this.inputAudioBuffer,e)),!0}createResponse(){return this.getTurnDetectionType()===null&&this.inputAudioBuffer.byteLength>0&&(this.realtime.send("input_audio_buffer.commit"),this.conversation.queueInputAudio(this.inputAudioBuffer),this.inputAudioBuffer=new Int16Array(0)),this.realtime.send("response.create"),!0}cancelResponse(e,t=0){if(e){if(e){let i=this.conversation.getItem(e);if(!i)throw new Error(`Could not find item "${e}"`);if(i.type!=="message")throw new Error('Can only cancelResponse messages with type "message"');if(i.role!=="assistant")throw new Error('Can only cancelResponse messages with role "assistant"');this.realtime.send("response.cancel");let r=i.content.findIndex(n=>n.type==="audio");if(r===-1)throw new Error("Could not find audio on item to cancel");return this.realtime.send("conversation.item.truncate",{item_id:e,content_index:r,audio_end_ms:Math.floor(t/this.conversation.defaultFrequency*1e3)}),{item:i}}}else return this.realtime.send("response.cancel"),{item:null}}async waitForNextItem(){let e=await this.waitForNext("conversation.item.appended"),{item:t}=e;return{item:t}}async waitForNextCompletedItem(){let e=await this.waitForNext("conversation.item.completed"),{item:t}=e;return{item:t}}},Cde=`
class AudioProcessor extends AudioWorkletProcessor {

  constructor() {
    super();
    this.port.onmessage = this.receive.bind(this);
    this.initialize();
  }

  initialize() {
    this.foundAudio = false;
    this.recording = false;
    this.chunks = [];
  }

  /**
   * Concatenates sampled chunks into channels
   * Format is chunk[Left[], Right[]]
   */
  readChannelData(chunks, channel = -1, maxChannels = 9) {
    let channelLimit;
    if (channel !== -1) {
      if (chunks[0] && chunks[0].length - 1 < channel) {
        throw new Error(
          \`Channel \${channel} out of range: max \${chunks[0].length}\`
        );
      }
      channelLimit = channel + 1;
    } else {
      channel = 0;
      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);
    }
    const channels = [];
    for (let n = channel; n < channelLimit; n++) {
      const length = chunks.reduce((sum, chunk) => {
        return sum + chunk[n].length;
      }, 0);
      const buffers = chunks.map((chunk) => chunk[n]);
      const result = new Float32Array(length);
      let offset = 0;
      for (let i = 0; i < buffers.length; i++) {
        result.set(buffers[i], offset);
        offset += buffers[i].length;
      }
      channels[n] = result;
    }
    return channels;
  }

  /**
   * Combines parallel audio data into correct format,
   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]
   */
  formatAudioData(channels) {
    if (channels.length === 1) {
      // Simple case is only one channel
      const float32Array = channels[0].slice();
      const meanValues = channels[0].slice();
      return { float32Array, meanValues };
    } else {
      const float32Array = new Float32Array(
        channels[0].length * channels.length
      );
      const meanValues = new Float32Array(channels[0].length);
      for (let i = 0; i < channels[0].length; i++) {
        const offset = i * channels.length;
        let meanValue = 0;
        for (let n = 0; n < channels.length; n++) {
          float32Array[offset + n] = channels[n][i];
          meanValue += channels[n][i];
        }
        meanValues[i] = meanValue / channels.length;
      }
      return { float32Array, meanValues };
    }
  }

  /**
   * Converts 32-bit float data to 16-bit integers
   */
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);
    let offset = 0;
    for (let i = 0; i < float32Array.length; i++, offset += 2) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  /**
   * Retrieves the most recent amplitude values from the audio stream
   * @param {number} channel
   */
  getValues(channel = -1) {
    const channels = this.readChannelData(this.chunks, channel);
    const { meanValues } = this.formatAudioData(channels);
    return { meanValues, channels };
  }

  /**
   * Exports chunks as an audio/wav file
   */
  export() {
    const channels = this.readChannelData(this.chunks);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const audioData = this.floatTo16BitPCM(float32Array);
    return {
      meanValues: meanValues,
      audio: {
        bitsPerSample: 16,
        channels: channels,
        data: audioData,
      },
    };
  }

  receive(e) {
    const { event, id } = e.data;
    let receiptData = {};
    switch (event) {
      case 'start':
        this.recording = true;
        break;
      case 'stop':
        this.recording = false;
        break;
      case 'clear':
        this.initialize();
        break;
      case 'export':
        receiptData = this.export();
        break;
      case 'read':
        receiptData = this.getValues();
        break;
      default:
        break;
    }
    // Always send back receipt
    this.port.postMessage({ event: 'receipt', id, data: receiptData });
  }

  sendChunk(chunk) {
    const channels = this.readChannelData([chunk]);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const rawAudioData = this.floatTo16BitPCM(float32Array);
    const monoAudioData = this.floatTo16BitPCM(meanValues);
    this.port.postMessage({
      event: 'chunk',
      data: {
        mono: monoAudioData,
        raw: rawAudioData,
      },
    });
  }

  process(inputList, outputList, parameters) {
    // Copy input to output (e.g. speakers)
    // Note that this creates choppy sounds with Mac products
    const sourceLimit = Math.min(inputList.length, outputList.length);
    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {
      const input = inputList[inputNum];
      const output = outputList[inputNum];
      const channelCount = Math.min(input.length, output.length);
      for (let channelNum = 0; channelNum < channelCount; channelNum++) {
        input[channelNum].forEach((sample, i) => {
          output[channelNum][i] = sample;
        });
      }
    }
    const inputs = inputList[0];
    // There's latency at the beginning of a stream before recording starts
    // Make sure we actually receive audio data before we start storing chunks
    let sliceIndex = 0;
    if (!this.foundAudio) {
      for (const channel of inputs) {
        sliceIndex = 0; // reset for each channel
        if (this.foundAudio) {
          break;
        }
        if (channel) {
          for (const value of channel) {
            if (value !== 0) {
              // find only one non-zero entry in any channel
              this.foundAudio = true;
              break;
            } else {
              sliceIndex++;
            }
          }
        }
      }
    }
    if (inputs && inputs[0] && this.foundAudio && this.recording) {
      // We need to copy the TypedArray, because the \`process\`
      // internals will reuse the same buffer to hold each input
      const chunk = inputs.map((input) => input.slice(sliceIndex));
      this.chunks.push(chunk);
      this.sendChunk(chunk);
    }
    return true;
  }
}

registerProcessor('audio_processor', AudioProcessor);
`,Tde=new Blob([Cde],{type:"application/javascript"}),Pde=URL.createObjectURL(Tde),Mde=Pde,eN=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],Dde=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],gc=[],WM=[];for(let e=1;e<=8;e++)for(let t=0;t<eN.length;t++){let i=eN[t];gc.push(i/Math.pow(2,8-e)),WM.push(Dde[t]+e)}var Mw=[32,2e3],tN=gc.filter((e,t)=>gc[t]>Mw[0]&&gc[t]<Mw[1]),Ide=WM.filter((e,t)=>gc[t]>Mw[0]&&gc[t]<Mw[1]),qM=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,u,h;if(r==="music"||r==="voice"){let f=r==="voice"?tN:gc,m=Array(f.length).fill(n);for(let g=0;g<i.length;g++){let y=g*o,v=i[g];for(let b=f.length-1;b>=0;b--)if(y>f[b]){m[b]=Math.max(m[b],v);break}}l=m,u=r==="voice"?tN:gc,h=r==="voice"?Ide:WM}else l=Array.from(i),u=l.map((f,m)=>o*m),h=u.map(f=>`${f.toFixed(2)} Hz`);let c=l.map(f=>Math.max(0,Math.min((f-n)/(s-n),1)));return{values:new Float32Array(c),frequencies:u,labels:h}}constructor(e,t=null){if(this.fftResults=[],t){let{length:i,sampleRate:r}=t,n=new OfflineAudioContext({length:i,sampleRate:r}),s=n.createBufferSource();s.buffer=t;let a=n.createAnalyser();a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a);let o=1/60,l=i/r,u=h=>{let c=o*h;c<l&&n.suspend(c).then(()=>{let f=new Float32Array(a.frequencyBinCount);a.getFloatFrequencyData(f),this.fftResults.push(f),u(h+1)}),h===1?n.startRendering():n.resume()};s.start(0),u(1),this.audio=e,this.context=n,this.analyser=a,this.sampleRate=r,this.audioBuffer=t}else{let i=new AudioContext,r=i.createMediaElementSource(e),n=i.createAnalyser();n.fftSize=8192,n.smoothingTimeConstant=.1,r.connect(n),n.connect(i.destination),this.audio=e,this.context=i,this.analyser=n,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(e="frequency",t=-100,i=-30){let r=null;if(this.audioBuffer&&this.fftResults.length){let n=this.audio.currentTime/this.audio.duration,s=Math.min(n*this.fftResults.length|0,this.fftResults.length-1);r=this.fftResults[s]}return qM.getFrequencies(this.analyser,this.sampleRate,r,e,t,i)}async resumeIfSuspended(){return this.context.state==="suspended"&&await this.context.resume(),!0}},cp=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(e.length*2),i=new DataView(t),r=0;for(let n=0;n<e.length;n++,r+=2){let s=Math.max(-1,Math.min(1,e[n]));i.setInt16(r,s<0?s*32768:s*32767,!0)}return t}static mergeBuffers(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer}_packData(e,t){return[new Uint8Array([t,t>>8]),new Uint8Array([t,t>>8,t>>16,t>>24])][e]}pack(e,t){if(t!=null&&t.bitsPerSample)if(t!=null&&t.channels){if(!(t!=null&&t.data))throw new Error('Missing "data"')}else throw new Error('Missing "channels"');else throw new Error('Missing "bitsPerSample"');let{bitsPerSample:i,channels:r,data:n}=t,s=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,r.length),this._packData(1,e),this._packData(1,e*r.length*i/8),this._packData(0,r.length*i/8),this._packData(0,i),"data",this._packData(1,r[0].length*r.length*i/8),n],a=new Blob(s,{type:"audio/mpeg"}),o=URL.createObjectURL(a);return{blob:a,url:o,channelCount:r.length,sampleRate:e,duration:n.byteLength/(r.length*e*2)}}},iN=class{constructor({sampleRate:e=44100,outputToSpeakers:t=!1,debug:i=!1}={}){this.scriptSrc=Mde,this.sampleRate=e,this.outputToSpeakers=t,this.debug=!!i,this._deviceChangeCallback=null,this._devices=[],this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(e,t=44100,i=-1){let r=new AudioContext({sampleRate:t}),n,s;if(e instanceof Blob){if(i!==-1)throw new Error('Can not specify "fromSampleRate" when reading from Blob');s=e,n=await s.arrayBuffer()}else if(e instanceof ArrayBuffer){if(i!==-1)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');n=e,s=new Blob([n],{type:"audio/wav"})}else{let u,h;if(e instanceof Int16Array){h=e,u=new Float32Array(e.length);for(let f=0;f<e.length;f++)u[f]=e[f]/32768}else if(e instanceof Float32Array)u=e;else if(e instanceof Array)u=new Float32Array(e);else throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');if(i===-1)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(i<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');h||(h=cp.floatTo16BitPCM(u));let c={bitsPerSample:16,channels:[u],data:h};s=new cp().pack(i,c).blob,n=await s.arrayBuffer()}let a=await r.decodeAudioData(n),o=a.getChannelData(0),l=URL.createObjectURL(s);return{blob:s,url:l,values:o,audioBuffer:a}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,t={},i=null){if(i=i||this.processor,!i)throw new Error("Can not send events without recording first");let r={event:e,id:this._lastEventId++,data:t};i.port.postMessage(r);let n=new Date().valueOf();for(;!this.eventReceipts[r.id];){if(new Date().valueOf()-n>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(a=>setTimeout(()=>a(!0),1))}let s=this.eventReceipts[r.id];return delete this.eventReceipts[r.id],s}listenForDeviceChange(e){if(e===null&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(e!==null){let t=0,i=[],r=s=>s.map(a=>a.deviceId).sort().join(","),n=async()=>{let s=++t,a=await this.listDevices();s===t&&r(i)!==r(a)&&(i=a,e(a.slice()))};navigator.mediaDevices.addEventListener("devicechange",n),n(),this._deviceChangeCallback=n}return!0}async requestPermission(){let e=await navigator.permissions.query({name:"microphone"});if(e.state==="denied")window.alert("You must grant microphone access to use this feature.");else if(e.state==="prompt")try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop())}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");await this.requestPermission();let e=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput"),t=e.findIndex(r=>r.deviceId==="default"),i=[];if(t!==-1){let r=e.splice(t,1)[0],n=e.findIndex(s=>s.groupId===r.groupId);n!==-1&&(r=e.splice(n,1)[0]),r.default=!0,i.push(r)}return i.concat(e)}async begin(e){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");try{let a={audio:!0};e&&(a.audio={deviceId:{exact:e}}),this.stream=await navigator.mediaDevices.getUserMedia(a)}catch{throw new Error("Could not start media stream")}let t=new AudioContext({sampleRate:this.sampleRate}),i=t.createMediaStreamSource(this.stream);try{await t.audioWorklet.addModule(this.scriptSrc)}catch(a){throw console.error(a),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let r=new AudioWorkletNode(t,"audio_processor");r.port.onmessage=a=>{let{event:o,id:l,data:u}=a.data;if(o==="receipt")this.eventReceipts[l]=u;else if(o==="chunk")if(this._chunkProcessorSize){let h=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:cp.mergeBuffers(h.raw,u.raw),mono:cp.mergeBuffers(h.mono,u.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(u)};let n=i.connect(r),s=t.createAnalyser();return s.fftSize=8192,s.smoothingTimeConstant=.1,n.connect(s),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),s.connect(t.destination)),this.source=i,this.node=n,this.analyser=s,this.processor=r,!0}getFrequencies(e="frequency",t=-100,i=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return qM.getFrequencies(this.analyser,this.sampleRate,null,e,t,i)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},t=8192){if(this.processor){if(this.recording)throw new Error("Already recording: please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=t,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");let t=await this._event("export");return new cp().pack(this.sampleRate,t.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");let e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach(i=>i.stop()),this.log("Exporting ...");let t=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new cp().pack(this.sampleRate,t.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}},Rde=`
class StreamProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.hasStarted = false;
    this.hasInterrupted = false;
    this.outputBuffers = [];
    this.bufferLength = 128;
    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };
    this.writeOffset = 0;
    this.trackSampleOffsets = {};
    this.port.onmessage = (event) => {
      if (event.data) {
        const payload = event.data;
        if (payload.event === 'write') {
          const int16Array = payload.buffer;
          const float32Array = new Float32Array(int16Array.length);
          for (let i = 0; i < int16Array.length; i++) {
            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32
          }
          this.writeData(float32Array, payload.trackId);
        } else if (
          payload.event === 'offset' ||
          payload.event === 'interrupt'
        ) {
          const requestId = payload.requestId;
          const trackId = this.write.trackId;
          const offset = this.trackSampleOffsets[trackId] || 0;
          this.port.postMessage({
            event: 'offset',
            requestId,
            trackId,
            offset,
          });
          if (payload.event === 'interrupt') {
            this.hasInterrupted = true;
          }
        } else {
          throw new Error(\`Unhandled event "\${payload.event}"\`);
        }
      }
    };
  }

  writeData(float32Array, trackId = null) {
    let { buffer } = this.write;
    let offset = this.writeOffset;
    for (let i = 0; i < float32Array.length; i++) {
      buffer[offset++] = float32Array[i];
      if (offset >= buffer.length) {
        this.outputBuffers.push(this.write);
        this.write = { buffer: new Float32Array(this.bufferLength), trackId };
        buffer = this.write.buffer;
        offset = 0;
      }
    }
    this.writeOffset = offset;
    return true;
  }

  process(inputs, outputs, parameters) {
    const output = outputs[0];
    const outputChannelData = output[0];
    const outputBuffers = this.outputBuffers;
    if (this.hasInterrupted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else if (outputBuffers.length) {
      this.hasStarted = true;
      const { buffer, trackId } = outputBuffers.shift();
      for (let i = 0; i < outputChannelData.length; i++) {
        outputChannelData[i] = buffer[i] || 0;
      }
      if (trackId) {
        this.trackSampleOffsets[trackId] =
          this.trackSampleOffsets[trackId] || 0;
        this.trackSampleOffsets[trackId] += buffer.length;
      }
      return true;
    } else if (this.hasStarted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else {
      return true;
    }
  }
}

registerProcessor('stream_processor', StreamProcessor);
`,Ode=new Blob([Rde],{type:"application/javascript"}),kde=URL.createObjectURL(Ode),Lde=kde,zde=class{constructor({sampleRate:e=44100}={}){this.scriptSrc=Lde,this.sampleRate=e,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),this.context.state==="suspended"&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(t){throw console.error(t),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let e=this.context.createAnalyser();return e.fftSize=8192,e.smoothingTimeConstant=.1,this.analyser=e,!0}getFrequencies(e="frequency",t=-100,i=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return qM.getFrequencies(this.analyser,this.sampleRate,null,e,t,i)}_start(){let e=new AudioWorkletNode(this.context,"stream_processor");return e.connect(this.context.destination),e.port.onmessage=t=>{let{event:i}=t.data;if(i==="stop")e.disconnect(),this.stream=null;else if(i==="offset"){let{requestId:r,trackId:n,offset:s}=t.data,a=s/this.sampleRate;this.trackSampleOffsets[r]={trackId:n,offset:s,currentTime:a}}},this.analyser.disconnect(),e.connect(this.analyser),this.stream=e,!0}add16BitPCM(e,t="default"){if(typeof t!="string")throw new Error("trackId must be a string");if(this.interruptedTrackIds[t])return;this.stream||this._start();let i;if(e instanceof Int16Array)i=e;else if(e instanceof ArrayBuffer)i=new Int16Array(e);else throw new Error("argument must be Int16Array or ArrayBuffer");return this.stream.port.postMessage({event:"write",buffer:i,trackId:t}),i}async getTrackSampleOffset(e=!1){if(!this.stream)return null;let t=crypto.randomUUID();this.stream.port.postMessage({event:e?"interrupt":"offset",requestId:t});let i;for(;!i;)i=this.trackSampleOffsets[t],await new Promise(n=>setTimeout(()=>n(),1));let{trackId:r}=i;return e&&r&&(this.interruptedTrackIds[r]=!0),i}async interrupt(){return this.getTrackSampleOffset(!0)}},rN=()=>"https://relayserver.spline.design/",nN=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.items=[],this.isConnected=!1,this.rafId=0,this.emitter=R_(),this.voice=0,this.frequencies=new Float32Array([0]),this.onRealTimeEvent=({time:r,source:n,event:s})=>{n==="server"&&s.type==="spline.ready"?this.onSessionCreated(s):n==="server"&&s.type==="session.created"&&(this.client.createResponse(),this.client.on("realtime.event",this.onRealTimeEvent))},this.onSessionCreated=async r=>{let n=Object.values(this.client.tools).map(s=>({type:"function",...s.definition}));this.client.realtime.send("spline.tools",{tools:n}),this.client.realtime.send("spline.connect",{}),await this.wavRecorder.record(s=>this.client.isConnected()&&this.client.appendInputAudio(s.mono))},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected){let r=this.wavStreamPlayer.analyser?this.wavStreamPlayer.getFrequencies("voice"):{values:new Float32Array([0])},n=r.values.reduce((s,a)=>s+a,0)/r.values.length;this.voice=n,this.frequencies=r.values,this.emitter.emit("voice",{value:n,frequencies:r.values})}},this.client=new $z({url:rN()+"?uuidfile="+e.integration.hash}),this.wavRecorder=new iN({sampleRate:24e3}),this.wavStreamPlayer=new zde({sampleRate:24e3})}update(e){this.data=e,this.client=new $z({url:rN()+"?uuidfile="+e.integration.hash})}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=Jue.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}connect(){if(this.isConnected)return;this.isConnected=!0,this.client.updateSession({turn_detection:{type:"server_vad"}}),this.client.addTool({name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.client.addTool({name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.client.addTool({name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.client.addTool({name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.client.on("error",n=>console.error(n)),this.client.on("conversation.interrupted",async()=>{let n=await this.wavStreamPlayer.interrupt();if(n!=null&&n.trackId){let{trackId:s,offset:a}=n;await this.client.cancelResponse(s,a)}}),this.client.on("conversation.updated",async({item:n,delta:s})=>{var o;let a=this.client.conversation.getItems();if(s!=null&&s.audio&&this.wavStreamPlayer.add16BitPCM(s.audio,n.id),n.status==="completed"&&((o=n.formatted.audio)==null?void 0:o.length)){let l=await iN.decode(n.formatted.audio,24e3,24e3);n.formatted.file=l}this.items=a}),this.animate()}disconnect(){cancelAnimationFrame(this.rafId),this.voice=0,this.isConnected=!1}async start(){try{await this.wavRecorder.end()}catch{}await this.wavRecorder.begin(),this.client.on("realtime.event",this.onRealTimeEvent),await this.wavStreamPlayer.connect(),await this.client.connect()}async stop(){try{this.client.off("realtime.event",this.onRealTimeEvent)}catch(e){console.error(e)}this.client.disconnect(),await this.wavRecorder.end(),await this.wavStreamPlayer.interrupt()}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function k2(e){return"variable_"+e}var Nde=class extends fce{constructor(e){super(),this.shared=e}create(e){return new bj(e,this.shared)}},XM=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new Zz(!0),this.geometryCache2=new Zz(!1),this.imageHolderCache=new Nde(this),this.thisContext={scene:gde,shared:this},this.deletedMaterial=new O2(Ln.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Zh(l2.emptyImage,this),this.deletedVideo=new Zh(hw.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new O2(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new GM(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Zh(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new Zh(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Zh(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new Pw(t.r,t.g,t.b,t.a):this.colors[e]=new Pw(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new ns(0,0,0,0))}else return"a"in e?new ns(e.r,e.g,e.b,e.a):new ns(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof Tv)return t;{let i=new Tv({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof Tv&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new fde(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof Tv&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(k2(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(k2(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},u=s.slice(2);r.traverseMaterial(c=>{let f=c.root??c;f.uuid===a&&f.onVariableUpdate(u,o,l)});let h=this.materials[a];h&&h.onVariableUpdate(u,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*ht.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Si.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(u=>{let h=u.dataPatched;u.chooseGeoemtryCache(this).forceDelete(h.geometry),u.createGeometryDelayed(this.entityOpContext),u.onVariableUpdate(!0),u.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=ht.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>fn.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(kn.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let n=t.userAPIs[e.path[1]];if(n){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof nN?a.update(n):a==null||a.update(n,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let n=t.userWebhooks[e.path[1]];n&&((r=this.getUserWebhook(e.path[1]))==null||r.update(n))}}else e.path[0]==="lib"&&this.updateLibByOp(kn.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,r;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((r=t.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new nN(t,e,this),!1):(this.userAPIs[e]=new NV(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new bde(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new XM(Xa.emptyData());var Wm=class extends js{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),Uae(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(ir(e.path,["material"])&&this.material instanceof Ec)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(kn.drop(e,1),t.material,i);else if(ir(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(kn.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var n,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=e.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&TU(this.material).forEach(e=>{e instanceof Ec&&(e instanceof O2||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},sN=new L,aN=new Yt,oN=new Yt,Bde=new L,lN=new je,Jr=class extends Wm{constructor(t,i,r){super(t,i),this.data=i,this.isSkinnedMesh=!1,this.localGeometry=void 0,i.bindMode&&i.bindMatrix&&(this.bindMode=i.bindMode,this.bindMatrix=new je().fromArray(i.bindMatrix),this.bindMatrixInverse=new je)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof St&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof XM){let t=this.geometryCreateDeleyed,i=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=i.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return fw.is2DParametricMesh(t.type)&&t.depth===0}get is2DType(){return fw.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(t,i,r){super.updateByPatchedOp(t,i,r),ir(t.path,["geometry"])&&this.updateByPatchedOpGeometry(kn.drop(t,1),i.geometry,r)}removeInteractionGeometry(t){var i;(i=this.localGeometry)==null||i.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,i){var n;this.invalidateDownstreamBooleanData();let r=this.data.geometry.type;if(r==="NonParametricGeometry"||r==="SubdivGeometry"){let s=t;if(this.localGeometry===void 0){let h={...this.data.geometry,...s};this.localGeometry=_y(h,i,this.data.flatShading,this)}let a,o,l;s.scaleBaked?[a,o,l]=s.scaleBaked:{width:a,height:o,depth:l}=s;let u=this.localGeometry.userData;u.sxPrev!==void 0&&T2(this.localGeometry.attributes,a/u.sxPrev,o/u.syPrev,l/u.szPrev),u.sxPrev=a,u.syPrev=o,u.szPrev=l}else{let s={...this.data.geometry,...t};(n=this.localGeometry)==null||n.dispose(),this.localGeometry=_y(s,i,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let i of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(i.object)}refreshAttachedPaths(t){for(let i of this.attachedPaths)t.scene.addPendingCommand(()=>i.updateShape())}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,i,r){var s;let n=!1;t.type===0&&t.path.length===0&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof zs&&this.chooseGeoemtryCache(r.shared).mutateIfUnique(this.geometryCreateDeleyed.data,i)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(i,t.props.scaleBaked),this.refreshAttachedCloners(r),this.refreshAttachedPaths(r)),n||((s=r.scene)==null||s.markGeometryCacheDirty(),this.createGeometryDelayed(r)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,i){this.createGeometryDelayed(i)}updateState(t,i){t.geometry!==void 0&&this.updateGeometryOnStateUpdate(t.geometry,i);let r=t.morphTargetInfluences;if(r){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:n,value:s}}of r)this.updateMorphInfluences(n,i.shared.getVariable(s,[this.uuid,"morphTargetInfluences",n]))}super.updateState(t,i)}updateMorphInfluences(t,i){if(this.morphTargetDictionary===void 0)return;let r=this.morphTargetDictionary[t];r!==void 0&&(this.morphTargetInfluences[r]=i)}updateGeometryGroupsIfNeeded(){var t;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((t=this.geometry.getIndex())==null?void 0:t.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,i){let r=this.geometry.userData.parameters;this.is2DType?t.set(0,0,r.depth*.5):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),i.set(r.width,r.height,r.depth??0).multiplyScalar(.5)):r.centerOffset?t.fromArray(r.centerOffset):t.setScalar(0),i.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,i){this.skeleton=t,this.isSkinnedMesh=!0,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let i=new Yt,r=this.geometry.attributes.skinWeight;for(let n=0,s=r.count;n<s;n++){i.fromBufferAttribute(r,n);let a=1/i.manhattanLength();a!==1/0?i.multiplyScalar(a):i.set(1,0,0,0),r.setXYZW(n,i.x,i.y,i.z,i.w)}}boneTransform(t,i){let r=this.skeleton;if(r===void 0)return;let n=this.geometry;aN.fromBufferAttribute(n.attributes.skinIndex,t),oN.fromBufferAttribute(n.attributes.skinWeight,t),sN.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){let a=oN.getComponent(s);if(a!==0){let o=aN.getComponent(s);lN.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(Bde.copy(sN).applyMatrix4(lN),a)}}return i.applyMatrix4(this.bindMatrixInverse)}};function Fde(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let u=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=new L(n[l],n[l+1],n[l+2]);t.has(u)?(a=t.get(u))==null||a.normals.push(h):t.set(u,{normals:[h],result:new L})}t.forEach((l,u)=>{for(let h of l.normals)l.result.add(h);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let u=`${r[l]}_${r[l+1]}_${r[l+2]}`,h=(o=t.get(u))==null?void 0:o.result;h&&(s[l]=h.x,s[l+1]=h.y,s[l+2]=h.z)}e.geometry.setAttribute("extrudeNormal",new ot(s,3))}function Ude(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new L;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new ot(i,3))}function YM(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Ec)||e.material.getLayersOfType("outline").length===0)return;e instanceof Jr&&e.is2DAndNoDepth?Ude(e):Fde(e)}function QM(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[ht.seededRandom(r),ht.seededRandom(r+1e4),ht.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new Bt(i,3))}var dl=new jr,iv=new L;function Vde(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Sy=class extends Jr{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new je,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=zs.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,YM(this),QM(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){zs.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&zs.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=zs.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=zs.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,js.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new ua,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;dl.setFromBufferAttribute(t),dl.getCenter(i),e.boundingSphere.radius=i.distanceTo(dl.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),dl.getSize(iv),this.hasNonUniformScale&&iv.divide(this.scale);let r={width:iv.x,height:iv.y,depth:iv.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;dl.min.set(e[0],e[2],e[4]),dl.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(dl.min.applyMatrix4(this.shearScaleInv),dl.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new ua);let i=t.boundingSphere.center;dl.getCenter(i),t.boundingSphere.radius=i.distanceTo(dl.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(zs.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},uN=-1,jde=1,Hde={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Gde={polygon_center:0,edge:1,vertex:2},Cx=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,li=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-uN)*(i-r)/(jde-uN)+r},Wde=new L,Tx=new L,qde=new L,Xde=new L;function $p(e,t){let i=qde.fromArray(e),r=Xde.fromArray(t);Tx.copy(r).sub(i);let n=Tx.length();return Tx.normalize().multiplyScalar(n*.5),Wde.copy(i).add(Tx).toArray()}var Ya=new $n,Px=new L,Dw=new L,yd=new L;function Yde(e){let t=[];for(let i=0;i<=e.index.count;i++)if(Px.fromArray(e.index.array,i*3),Ya.setFromAttributeAndIndices(e.attributes.position,Px.x,Px.y,Px.z),Ya.getNormal(Dw),Ya.getMidpoint(yd),!(isNaN(yd.x)||isNaN(yd.y)||isNaN(yd.z))){let{a:r,b:n,c:s}=Ya,a=r.toArray(),o=n.toArray(),l=s.toArray(),u=r.distanceTo(n),h=n.distanceTo(s),c=s.distanceTo(r),f=$p(a,o),m=$p(o,l),g=$p(l,a),y=[u,h,c],v=Math.max(...y),b=y.filter(T=>Math.round(T)===Math.round(v)).length>1,S=[],_=Ya.getMidpoint(yd).toArray();v===u&&!b&&(S=[m,g,g],_=f),v===h&&!b&&(S=[f,g,g],_=m),v===c&&!b&&(S=[f,m,m],_=g),b&&(S=[f,m,g]),t.push({vertices:[a,o,l],faceCenters:S,midpoint:_,norm:Ya.getNormal(Dw).toArray()})}return t}function Qde(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Ya.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Ya.getNormal(Dw),Ya.getMidpoint(yd);let n=Ya.a.toArray(),s=Ya.b.toArray(),a=Ya.c.toArray();t.push({vertices:[n,s,a],faceCenters:[$p(n,s),$p(s,a),$p(a,n)],midpoint:yd.toArray(),norm:Dw.toArray()})}return t}var Kde=4,Zde=.5,rC=e=>.5*(1-Math.cos(e*Math.PI)),Jde=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let v=0;v<4096;v++)this.perlin[v]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,u,h,c=0,f=.5,m,g,y;for(let v=0;v<Kde;v++){let b=r+(n<<4)+(s<<8);u=rC(a),h=rC(o),m=this.perlin[b&4095],m+=u*(this.perlin[b+1&4095]-m),g=this.perlin[b+16&4095],g+=u*(this.perlin[b+16+1&4095]-g),m+=h*(g-m),b+=256,g=this.perlin[b&4095],g+=u*(this.perlin[b+1&4095]-g),y=this.perlin[b+16&4095],y+=u*(this.perlin[b+16+1&4095]-y),g+=h*(y-g),m+=rC(l)*(g-m),c+=m*f,f*=Zde,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return c}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},$de=Jde,hN=new L,cN=new je,dN=new Im;function fN(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var KM=class extends Jr{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(cN.copy(i).invert(),dN.copy(e.ray).applyMatrix4(cN),dN.intersectBox(this.singleBBox,hN))){let r=hN.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},Os=1e-4,fl,Rj,Oj,kj,pN=new L,mN=new L;jV.then(e=>{fl=e,Rj=[fl.get_face_center,fl.get_edge_midpoint,fl.get_vertex_position],Oj=[fl.get_face_normal,fl.get_edge_normal,fl.get_vertex_normal],kj=[fl.face_count,fl.edge_count,fl.vertex_count]});var efe=new je,tfe=new je,kh=new L,Mx=new L,rv=new L,nC=new L,ife=new L,rfe=new L,nfe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new $de,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=Sle((0,y2.default)(e.seed)):this.noise=_le((0,y2.default)(e.seed))}},Ja=class extends DM(qi){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof rs&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof rs&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new rs(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new rs(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new nfe(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*ht.DEG2RAD,r=t.end*ht.DEG2RAD,n=i-r,s=new dn(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new L(0,0,1);break;case"y":a=new L(0,1,0);break;default:case"x":a=new L(1,0,0);break}let o=e.randomnessObject??nc.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),u=Cx(o.strength,this.parameters.randomness);for(let[h,c]of this.children.entries()){let f=h*(o.freqScale/10)+o.movement,m=l.noise(f,f,f),g=h+1;c.scale.x=t.scale[0]+u(g,li(m,o.scale[0]))||Os,c.scale.y=t.scale[1]+u(g,li(m,o.scale[1]))||Os,c.scale.z=t.scale[2]+u(g,li(m,o.scale[2]))||Os,c.position.setScalar(0);let y=n/e.count*h-i;switch(t.axis){case"x":c.rotation.set(0,y,0);break;case"y":c.rotation.set(0,0,y);break;case"z":c.rotation.set(y,0,0);break}c.translateOnAxis(a,t.radius),c.position.x+=t.position[0]+u(g,li(m,o.position[0])),c.position.y+=t.position[1]+u(g,li(m,o.position[1])),c.position.z+=t.position[2]+u(g,li(m,o.position[2]));let v=u(g,li(m,o.rotation[0])),b=u(g,li(m,o.rotation[1])),S=u(g,li(m,o.rotation[2]));t.alignment===!0?(c.rotation.x+=s.x+v,c.rotation.y+=s.y+b,c.rotation.z+=s.z+S):c.rotation.set(s.x+v,s.y+b,s.z+S)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new dn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??nc.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=Cx(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,u=n.noise(l,l,l),h=a+1,c=s(h,li(u,r.rotation[0])),f=s(h,li(u,r.rotation[1])),m=s(h,li(u,r.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(h,li(u,r.scale[0]))||Os,o.scale.y=1+(t.scale[1]-1)*a+s(h,li(u,r.scale[1]))||Os,o.scale.z=1+(t.scale[2]-1)*a+s(h,li(u,r.scale[2]))||Os,o.rotation.x=i.x*a+c,o.rotation.y=i.y*a+f,o.rotation.z=i.z*a+m,o.position.x=t.position[0]*a+s(h,li(u,r.position[0])),o.position.y=t.position[1]*a+s(h,li(u,r.position[1])),o.position.z=t.position[2]*a+s(h,li(u,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??nc.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=Cx(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new L(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let u=0;u<i.count[1];u++)for(let h=0;h<i.count[2];h++){let c=n.noise((l+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement,(h+1)*(r.freqScale/10)+r.movement),f=this.children[t++];f.scale.x=1+s(t,li(c,r.scale[0]))||Os,f.scale.y=1+s(t,li(c,r.scale[1]))||Os,f.scale.z=1+s(t,li(c,r.scale[2]))||Os;let m=s(t,li(c,r.rotation[0])),g=s(t,li(c,r.rotation[1])),y=s(t,li(c,r.rotation[2]));f.rotation.set(m,g,y),f.position.x=i.size[0]*l-o.x+s(t,li(c,r.position[0])),f.position.y=i.size[1]*u-o.y+s(t,li(c,r.position[1])),f.position.z=i.size[2]*h-o.z+s(t,li(c,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let u=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),h=this.children[t++];h.scale.x=1+s(t,li(u,r.scale[0]))||Os,h.scale.y=1+s(t,li(u,r.scale[1]))||Os,h.scale.z=1+s(t,li(u,r.scale[2]))||Os;let c=s(t,li(u,r.rotation[0])),f=s(t,li(u,r.rotation[1])),m=s(t,li(u,r.rotation[2]));h.rotation.set(c,f,m),h.position.x=i.size[0]*a+s(t,li(u,r.position[0])),h.position.y=-i.size[1]*o+s(t,li(u,r.position[1])),h.position.z=-i.size[2]*l+s(t,li(u,r.position[2]))}}_updateToObject(e){var h;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new dn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??nc.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=Cx(r.strength,this.parameters.randomness);if(!t.object){for(let[,c]of this.children.entries())c.position.set(0,0,0),c.scale.setScalar(1),c.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof KM)if(!((h=this.objectForSample.font)!=null&&h.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let c=Math.round(a.length*t.count/100);this._updateCount(c)}else{let c=this.objectForSample.geometry.getAttribute("position");if(!c||isNaN(c.count)||c.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new Ele(this.objectForSample).build(),l=Hde[t.axis],u=this.children;o.setRandomGenerator((0,y2.default)(this.object.uuid+t.seed));for(let[c,f]of u.entries()){let m=c*(r.freqScale/10)+r.movement,g=n.noise(m,m,m),y=c+1,v=s(y,li(g,r.rotation[0])),b=s(y,li(g,r.rotation[1])),S=s(y,li(g,r.rotation[2]));t.spreadType==="random"?o.sample(rv,nC):(a.length&&(rv.fromArray(a[c].pos),nC.fromArray(a[c].norm)),this.objectForSample instanceof Sy&&rv.applyMatrix4(efe.copy(this.objectForSample.matrixWorld).invert())),rv.applyMatrix4(this.object.hiddenMatrix.clone().invert()),f.position.copy(rv),kh.fromArray(l);let _=t.align==="normal"?nC:this.object.getWorldDirection(rfe),T=Mx.fromArray(t.position);Mx.x+=s(y,li(g,r.position[0])),Mx.y+=s(y,li(g,r.position[1])),Mx.z+=s(y,li(g,r.position[2]));let M=Math.acos(_.dot(kh)),C=ife.crossVectors(kh,_).normalize(),P=tfe.makeRotationAxis(C,M),E=_.clone().cross(this.object.up).normalize(),D=E.clone().cross(_).normalize(),I=new je().makeBasis(E,_,D),O=new L(kh.y,kh.z,kh.x).normalize(),N=O.clone().cross(kh).normalize(),k=new je().makeBasis(O,kh,N).invert(),U=new je().multiplyMatrices(I,k);f.rotation.setFromRotationMatrix(U),T.applyMatrix4(P),f.position.add(T),f.rotation.x=f.rotation.x+i.x+v,f.rotation.y=f.rotation.y+i.y+b,f.rotation.z=f.rotation.z+i.z+S,f.scale.setScalar(1),f.scale.x=f.scale.x+t.scale[0]+s(y,li(g,r.scale[0]))||Os,f.scale.y=f.scale.y+t.scale[1]+s(y,li(g,r.scale[1]))||Os,f.scale.z=f.scale.z+t.scale[2]+s(y,li(g,r.scale[2]))||Os,f.scale.multiply(this.object.scale),f.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof Sy){let n=this.objectForSample,s=Gde[e],a=kj[s],o=Rj[s],l=Oj[s],u=a(n.subdivPointerNew);for(let h=0;h<=u-1;h++){let c=o(n.subdivPointerNew,h),f=l(n.subdivPointerNew,h);pN.fromArray(c).applyMatrix4(n.matrixWorld),mN.fromArray(f),i(pN.toArray(),mN.toArray())}}else(this.objectForSample.geometry.index?Yde(this.objectForSample.geometry):Qde(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){var i;if(this.parameters=E_(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof js?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new je,this.hiddenMatrix=new je,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Ky=e=>{var t;return t=class extends e{},t.geometryHelper=new jo(30,30,30),t},Dx=new Im,sC=new ua,gN=new je,Zy=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),sC.copy(a.boundingSphere),sC.applyMatrix4(o),i.ray.intersectsSphere(sC)===!1||(gN.copy(o).invert(),Dx.copy(i.ray).applyMatrix4(gN),a.boundingBox!==null&&Dx.intersectsBox(a.boundingBox)===!1))return;let l,u,h,c,f=a.index,m=a.attributes.position,g=a.drawRange,y,v;if(n===!1){let S=Math.max(0,g.start),_=Math.min(f.count,g.start+g.count);for(y=S,v=_;y<v;y+=3)if(u=f.getX(y),h=f.getX(y+1),c=f.getX(y+2),l=b(e,i,Dx,m,u,h,c),l){l.faceIndex=Math.floor(y/3),r.push(l);return}}else{let S=a.attributes.position,_=new L,T=new L,M=new L,C=new L,P=2,E=1/((s.scale.x+s.scale.y+s.scale.z)/3),D=E*E,I=Math.max(0,g.start),O=Math.min(S.count,g.start+g.count);for(let N=I,k=O-1;N<k;N+=P){if(_.fromBufferAttribute(S,N),T.fromBufferAttribute(S,N+1),Dx.distanceSqToSegment(_,T,C,M)>D)continue;C.applyMatrix4(s.matrixWorld);let U=i.ray.origin.distanceTo(C);U<i.near||U>i.far||r.push({distance:U,point:M.clone().applyMatrix4(s.matrixWorld),object:e})}}function b(S,_,T,M,C,P,E){let D=new L,I=new L,O=new L,N=new L,k=new L;if(D.fromBufferAttribute(M,C),I.fromBufferAttribute(M,P),O.fromBufferAttribute(M,E),T.intersectTriangle(D,I,O,!1,N)===null)return null;k.copy(N),k.applyMatrix4(S.matrixWorld);let U=_.ray.origin.distanceTo(k);return U<_.near||U>_.far?null:{faceIndex:1,distance:U,point:k.clone(),object:S}}},Ix=new L,Va=new kc,sfe=class extends Vy{constructor(e){let t=new St,i=new Lc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Nt(15711266),o=new Nt(15711266),l=new Nt(2857471);u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l);function u(c,f,m){h(c,m),h(f,m)}function h(c,f){r.push(0,0,0),n.push(f.r,f.g,f.b),s[c]===void 0&&(s[c]=[]),s[c].push(r.length/3-1)}t.setAttribute("position",new ot(r,3)),t.setAttribute("color",new ot(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Va.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;So("n1",t,e,Va,-1,-1,n),So("n2",t,e,Va,i,-1,n),So("n3",t,e,Va,-1,r,n),So("n4",t,e,Va,i,r,n);let s=n;So("f1",t,e,Va,-1,-1,s),So("f2",t,e,Va,i,-1,s),So("f3",t,e,Va,-1,r,s),So("f4",t,e,Va,i,r,s);let a=s,o=.5;So("u1",t,e,Va,i*.7*o,r*1.1,a),So("u2",t,e,Va,-1*.7*o,r*1.1,a),So("u3",t,e,Va,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function So(e,t,i,r,n,s,a){Ix.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let u=0,h=o.length;u<h;u++)l.setXYZ(o[u],Ix.x,Ix.y,Ix.z)}}var afe=class extends Ky(sfe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Zy(this.object,this.geometry,e,t,!0)}},L2;(e=>e.is=t=>"objectHelper"in t)(L2||(L2={}));var qm=(e,t)=>class extends IM(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Yb&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof jo?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Yb&&(r.visible=!1)}}},vN=790,dp=new L,aC=new L,oC=new Wt,lC=new L,nv=new L,uC=new L,ws=class extends qm(kc,afe){constructor(e="",t={...my.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=pm.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new je,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new p_(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new vs(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new L(e,t,i)),super.lookAt(e),this.getWorldPosition(dp),this.targetOffset=dp.distanceTo(e)}getTarget(e=new L){return this.getWorldDirection(aC),this.getWorldPosition(dp),aC.multiplyScalar(this.targetOffset),e.copy(dp).add(aC),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(dp),dp.distanceTo(e)}updateUp(){this.getWorldQuaternion(oC),lC.set(0,0,1).applyQuaternion(oC),nv.copy(qi.DEFAULT_UP),this.isUpVectorFlipped&&nv.negate(),nv.applyQuaternion(oC),uC.copy(qi.DEFAULT_UP).projectOnPlane(lC),this.angleOffsetFromUp=uC.angleTo(nv),this.angleOffsetFromUp*=uC.cross(nv).dot(lC)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new L),i=e.getWorldDirection(new L).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new L).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new L;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-790*.5*r,this.right=vN*.5*r,this.top=vN*.5*(1/n),this.bottom=-790*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return TT(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},fp=new je,ofe=new je;function yN(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var Wd=class extends Wm{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new St,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof Wd&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof js&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){fp.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=Su.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;Su.transformMeshSet(s.booleanMeshSetAddress,fp),s.booleanMatrixInvOld.copy(fp).invert(),s.booleanWasTransformed=!1}else s instanceof Wd&&s.needsTransformForDownstream===!0?(Su.transformMeshSet(s.booleanMeshSetAddress,fp),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(Su.transformMeshSet(s.booleanMeshSetAddress,ofe.multiplyMatrices(fp,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(fp).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}Su.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new ot([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return Su.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new St,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Su.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,YM(this),QM(this)}dispose(){super.dispose(),this.geometry.dispose()}},z2;(e=>{function t(i){return Si.is(i)&&i instanceof Gy}e.is=t})(z2||(z2={}));var ZM=(e,t)=>class extends qm(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Io=e=>e instanceof js,zu=e=>e!==null&&e instanceof Wd,lfe=e=>e instanceof ws,ufe=e=>z2.is(e),N2=e=>L2.is(e),hfe=new L(1,1,1),xN=new L,cfe=new L,bN=new Wt,Jy=class extends Ky(GZ){constructor(e,t=15){super(t),this.object=e,this.dummy=new ku,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Zy(this.object,Jy.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(xN,bN,cfe),this.matrix.compose(xN,bN,hfe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},em=class extends qm(ku,Jy){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},Hv=class extends qm(ku,Jy){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Lj={RED:0,GREEN:1,BLUE:2,ALPHA:3},$y="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",dfe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,Rx=class extends Mi{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new Fe(null),kernel16:new Fe(null),inputBuffer:new Fe(null),cocBuffer:new Fe(null),texelSize:new Fe(new oe),scale:new Fe(1)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:dfe,vertexShader:$y}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,u=Math.sqrt(o)/Math.sqrt(80),h=u*Math.cos(l),c=u*Math.sin(l);o%5===0?(i[n++]=h,i[n++]=c):(t[r++]=h,t[r++]=c)}let s=[],a=[];for(let o=0;o<128;)s.push(new Yt(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new Yt(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function wN(e,t,i){return e*(t-i)-t}function B2(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var ffe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,pfe=class extends Mi{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Fe(null),focusDistance:new Fe(0),focusRange:new Fe(0),cameraNear:new Fe(.3),cameraFar:new Fe(1e3)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:ffe,vertexShader:$y}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=eh){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-wN(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=B2(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-wN(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=B2(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof vs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},mfe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,gfe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",_N=class extends Mi{constructor(e=new oe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Fe(null),texelSize:new Fe(new oe),halfTexelSize:new Fe(new oe),kernel:new Fe(0),scale:new Fe(1)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:mfe,vertexShader:gfe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},vfe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,yfe=class extends Mi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Fe(null),opacity:new Fe(1)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:vfe,vertexShader:$y}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},xfe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,bfe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,k_={DEPTH:0,LUMA:1,COLOR:2},wfe={DISABLED:0,DEPTH:1,CUSTOM:2},_fe=class extends Mi{constructor(e=new oe,t=k_.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Dm.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Fe(null),depthBuffer:new Fe(null),predicationBuffer:new Fe(null),texelSize:new Fe(e)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:xfe,vertexShader:bfe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=eh){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Sfe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,Efe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Eo={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},F2=class extends Mi{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Dm.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Fe(null),depthBuffer:new Fe(null),resolution:new Fe(new oe),texelSize:new Fe(new oe),cameraNear:new Fe(.3),cameraFar:new Fe(1e3),aspect:new Fe(1),time:new Fe(0)},blending:$r,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=eh){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=Sfe.replace(Eo.FRAGMENT_HEAD,e.get(Eo.FRAGMENT_HEAD)).replace(Eo.FRAGMENT_MAIN_UV,e.get(Eo.FRAGMENT_MAIN_UV)).replace(Eo.FRAGMENT_MAIN_IMAGE,e.get(Eo.FRAGMENT_MAIN_IMAGE)),this.vertexShader=Efe.replace(Eo.VERTEX_HEAD,e.get(Eo.VERTEX_HEAD)).replace(Eo.VERTEX_MAIN_SUPPORT,e.get(Eo.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof vs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Eo}},Afe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Cfe=class extends Mi{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Dm.replace(/\D+/g,"")},uniforms:{inputBuffer:new Fe(null),threshold:new Fe(0),smoothing:new Fe(1),range:new Fe(null)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:Afe,vertexShader:$y}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Tfe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,zj={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},Pfe=class extends Mi{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Fe(e),inputBuffer:new Fe(null),strength:new Fe(1)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:Tfe,vertexShader:$y}),this.toneMapped=!1,this.setColorChannel(Lj.RED),this.setMaskFunction(zj.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==_s&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},Mfe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Dfe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Ife=class extends Mi{constructor(e=new oe,t=new oe){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Fe(null),searchTexture:new Fe(null),areaTexture:new Fe(null),resolution:new Fe(t),texelSize:new Fe(e)},blending:$r,depthWrite:!1,depthTest:!1,fragmentShader:Mfe,vertexShader:Dfe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},Rfe=new kc,Lh=null;function Ofe(){if(Lh===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Lh=new St,Lh.setAttribute!==void 0?(Lh.setAttribute("position",new Bt(e,3)),Lh.setAttribute("uv",new Bt(t,2))):(Lh.addAttribute("position",new Bt(e,3)),Lh.addAttribute("uv",new Bt(t,2)))}return Lh}var Gs=class{constructor(e="Pass",t=new la,i=Rfe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new ar(Ofe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new la),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=eh){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof la||t===this.renderer)continue;this[e].dispose()}}}},U2=class extends Gs{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new yfe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Pi(1,1,{minFilter:fi,magFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==_s?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===ui&&(this.renderTarget.texture.encoding=ui))}},kfe=class extends Gs{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},hC=new Nt,JM=class extends Gs{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,u=a>=0;l?(hC.copy(e.getClearColor(hC)),e.setClearColor(s,u?a:o)):u&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(hC,o):u&&e.setClearAlpha(o)}},zh=-1,oa=class extends as{constructor(e,t=zh,i=zh,r=1){super(),this.resizable=e,this.base=new oe(1,1),this.preferred=new oe(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==zh?r=t.width:t.height!==zh?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==zh?r=t.height:t.width!==zh?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(zh),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return zh}},cC=!1,SN=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case bs:i=this.materialsFlatShadedDoubleSide;break;case zn:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case bs:i=this.materialsDoubleSide;break;case zn:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Uo;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=zn,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=bs,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=zn,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=bs,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,cC){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return cC}static set workaroundEnabled(e){cC=e}},Lfe=class extends Gs{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new JM,this.overrideMaterialManager=i===null?null:new SN(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new SN(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,u=s.background,h=e.shadowMap.autoUpdate,c=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(c),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=u,e.shadowMap.autoUpdate=h}},EN=class extends Gs{constructor(e,t,{resolutionScale:i=1,width:r=oa.AUTO_SIZE,height:n=oa.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Lfe(e,t,new b5({depthPacking:s5}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Nt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Pi(1,1,{minFilter:vi,magFilter:vi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new oa(this,r,n,i);l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Ri={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},zfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",Nfe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",Bfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",Ffe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Ufe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Vfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",jfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",Hfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",Gfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",Wfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",qfe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Xfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",Yfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",Qfe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Kfe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Zfe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",Jfe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",$fe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",epe=new Map([[Ri.SKIP,null],[Ri.ADD,zfe],[Ri.ALPHA,Nfe],[Ri.AVERAGE,Bfe],[Ri.COLOR_BURN,Ffe],[Ri.COLOR_DODGE,Ufe],[Ri.DARKEN,Vfe],[Ri.DIFFERENCE,jfe],[Ri.EXCLUSION,Hfe],[Ri.LIGHTEN,Gfe],[Ri.MULTIPLY,Wfe],[Ri.DIVIDE,qfe],[Ri.NEGATION,Xfe],[Ri.NORMAL,Yfe],[Ri.OVERLAY,Qfe],[Ri.REFLECT,Kfe],[Ri.SCREEN,Zfe],[Ri.SOFT_LIGHT,Jfe],[Ri.SUBTRACT,$fe]]),tpe=class extends as{constructor(e,t=1){super(),this.f=e,this.opacity=new Fe(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return epe.get(this.blendFunction)}},Ll={NONE:0,DEPTH:1,CONVOLUTION:2},Ql=class extends as{constructor(e,t,{attributes:i=Ll.NONE,blendFunction:r=Ri.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new tpe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=eh){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof la||t===this.renderer)continue;this[e].dispose()}}}};function AN(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function ipe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),u=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),h=[],c=[],f=!1,m=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(u&&(a&Ll.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!u)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let g=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,y=F2.Section;if(u){let b=`	${e}MainUv(UV);
`;i.set(y.FRAGMENT_MAIN_UV,i.get(y.FRAGMENT_MAIN_UV)+b),f=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let b=`	${e}MainSupport(`;b+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(y.VERTEX_MAIN_SUPPORT,i.get(y.VERTEX_MAIN_SUPPORT)+b),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(S=>S[1])),c=c.concat(h).concat([...o.get("vertex").matchAll(g)].map(S=>S[1]))}c=c.concat([...o.get("fragment").matchAll(g)].map(b=>b[1])),c=c.concat([...t.defines.keys()].map(b=>b.replace(/\([\w\s,]*\)/g,""))),c=c.concat([...t.uniforms.keys()]),t.uniforms.forEach((b,S)=>s.set(e+S.charAt(0).toUpperCase()+S.slice(1),b)),t.defines.forEach((b,S)=>n.set(e+S.charAt(0).toUpperCase()+S.slice(1),b)),AN(e,c,n),AN(e,c,o);let v=t.blendMode;if(r.set(v.blendFunction,v),l){let b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,S=`${e}MainImage(color0, UV, `;(a&Ll.DEPTH)!==0&&b.test(o.get("fragment"))&&(S+="depth, ",m=!0),S+=`color1);
	`;let _=e+"BlendOpacity";s.set(_,v.opacity),S+=`color0 = blend${v.blendFunction}(color0, color1, ${_});

	`,i.set(y.FRAGMENT_MAIN_IMAGE,i.get(y.FRAGMENT_MAIN_IMAGE)+S),S=`uniform float ${_};

`,i.set(y.FRAGMENT_HEAD,i.get(y.FRAGMENT_HEAD)+S)}i.set(y.FRAGMENT_HEAD,i.get(y.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(y.VERTEX_HEAD,i.get(y.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:h,transformedUv:f,readDepth:m}}var Iw=class extends Gs{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new F2(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=F2.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,u=!1,h=!1;for(let f of this.effects)if(f.blendMode.blendFunction===Ri.SKIP)l|=f.getAttributes()&Ll.DEPTH;else if((l&f.getAttributes()&Ll.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",f);else{l|=f.getAttributes();let m="e"+a++,g=ipe(m,f,t,i,r,n,l);if(o+=g.varyings.length,u=u||g.transformedUv,h=h||g.readDepth,f.extensions!==null)for(let y of f.extensions)s.add(y)}let c=/\bblend\b/g;for(let f of i.values()){let m=f.getShaderCode().replace(c,`blend${f.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+m+`
`)}(l&Ll.DEPTH)!==0?(h&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,u?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((f,m,g)=>g.set(m,f.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=eh){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==_s&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},rpe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],$M=class extends Gs{constructor({resolutionScale:e=.5,width:t=oa.AUTO_SIZE,height:i=oa.AUTO_SIZE,kernelSize:r=L_.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Pi(1,1,{minFilter:fi,magFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new oa(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new _N,this.ditheredBlurMaterial=new _N,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,u=rpe[this.kernelSize],h=this.blurMaterial,c=t,f,m;for(this.fullscreenMaterial=h,f=0,m=u.length-1;f<m;++f){let g=(f&1)===0?o:l;h.kernel=u[f],h.inputBuffer=c.texture,e.setRenderTarget(g),e.render(s,a),c=g}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=u[f],h.inputBuffer=c.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==_s?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===ui&&(this.renderTargetA.texture.encoding=ui,this.renderTargetB.texture.encoding=ui))}static get AUTO_SIZE(){return oa.AUTO_SIZE}},npe=class extends Gs{constructor({width:e=oa.AUTO_SIZE,height:t=oa.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new Cfe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Pi(1,1,{minFilter:fi,magFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new oa(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==_s&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},spe=class extends Gs{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new JM(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,u=this.clearPass,h=this.inverted?0:1,c=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,h,4294967295),a.stencil.setClear(c),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(e,null):(u.render(e,t),u.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Qa=class extends Gs{constructor(t,i="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(i)}setInput(t){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let i=this.fullscreenMaterial.uniforms;i!==void 0&&i[t]!==void 0&&(this.inputBufferUniform=i[t])}}render(t,i,r,n,s){this.inputBufferUniform!==null&&i!==null&&(this.inputBufferUniform.value=i.texture),t.setRenderTarget(this.renderToScreen?null:r),t.render(this.scene,this.camera)}initialize(t,i,r){r!==void 0&&r!==_s&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},dC=1/1e3,ape=1e3,ope=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*dC}getFixedDelta(){return this.fixedDelta*dC}setFixedDelta(e){return this.fixedDelta=e*ape,this}getElapsed(){return this.elapsed*dC}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},L_={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},lpe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,upe=class extends Ql{constructor({blendFunction:e=Ri.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=oa.AUTO_SIZE,height:a=oa.AUTO_SIZE,kernelSize:o=L_.LARGE}={}){super("BloomEffect",lpe,{blendFunction:e,uniforms:new Map([["map",new Fe(null)],["intensity",new Fe(n)]])}),this.renderTarget=new Pi(1,1,{minFilter:fi,magFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new npe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new $M({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===ui&&(this.renderTarget.texture.encoding=ui))}},hpe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",cpe=class extends Ql{constructor({blendFunction:e=Ri.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",hpe,{blendFunction:e,uniforms:new Map([["brightness",new Fe(t)],["contrast",new Fe(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},dpe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",fpe=class extends Ql{constructor(e=Ri.NORMAL){super("ColorAverageEffect",dpe,{blendFunction:e})}},ppe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",mpe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",gpe=class extends Ql{constructor({blendFunction:e=Ri.NORMAL,offset:t=new oe(.001,5e-4)}={}){super("ChromaticAberrationEffect",ppe,{vertexShader:mpe,blendFunction:e,attributes:Ll.CONVOLUTION,uniforms:new Map([["offset",new Fe(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},vpe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,ype=class extends Ql{constructor(e,{blendFunction:t=Ri.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=oa.AUTO_SIZE,height:u=oa.AUTO_SIZE}={}){super("DepthOfFieldEffect",vpe,{blendFunction:t,attributes:Ll.DEPTH,uniforms:new Map([["nearColorBuffer",new Fe(null)],["farColorBuffer",new Fe(null)],["nearCoCBuffer",new Fe(null)],["scale",new Fe(1)]])}),this.camera=e,this.renderTarget=new Pi(1,1,{minFilter:fi,magFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Qa(new pfe(e));let h=this.cocMaterial;h.focusDistance=n,h.focusRange=a,i!==void 0&&(h.worldFocusDistance=i),r!==void 0&&(h.worldFocusRange=r),this.blurPass=new $M({kernelSize:L_.MEDIUM,width:l,height:u});let c=this.blurPass.getResolution();c.addEventListener("change",m=>this.setSize(c.getBaseWidth(),c.getBaseHeight())),this.maskPass=new Qa(new Pfe(this.renderTargetCoC.texture));let f=this.maskPass.fullscreenMaterial;f.maskFunction=zj.MULTIPLY,f.colorChannel=Lj.GREEN,this.bokehNearBasePass=new Qa(new Rx(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Qa(new Rx(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Qa(new Rx(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Qa(new Rx(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return B2(-i,t.near,t.far)}setDepthTexture(e,t=eh){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,_s),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===ui&&(this.renderTarget.texture.encoding=ui,this.renderTargetNear.texture.encoding=ui,this.renderTargetFar.texture.encoding=ui,this.renderTargetMasked.texture.encoding=ui))}};new L;new je;var xpe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",bpe=class extends Ql{constructor({blendFunction:e=Ri.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",xpe,{blendFunction:e,uniforms:new Map([["hue",new Fe(new L)],["saturation",new Fe(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new Nt;var wpe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,_pe=class extends Ql{constructor({blendFunction:e=Ri.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",wpe,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},Spe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",Epe=class extends Ql{constructor(e=30){super("PixelationEffect",Spe,{uniforms:new Map([["active",new Fe(!1)],["d",new Fe(new oe)]])}),this.resolution=new oe,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new L;new L;var CN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",TN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",Ape="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Cpe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",xd={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Nj=class extends Ql{constructor({preset:e=xd.MEDIUM,edgeDetectionMode:t=k_.COLOR,predicationMode:i=wfe.DISABLED}={}){super("SMAAEffect",Ape,{vertexShader:Cpe,blendFunction:Ri.NORMAL,attributes:Ll.CONVOLUTION|Ll.DEPTH,uniforms:new Map([["weightMap",new Fe(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Pi(1,1,{minFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new JM(!0,!1,!1),this.clearPass.overrideClearColor=new Nt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Qa(new _fe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Qa(new Ife);let s=new F5;s.onLoad=()=>{let a=new Ar(r);a.name="SMAA.Search",a.magFilter=vi,a.minFilter=vi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Ar(n);o.name="SMAA.Area",o.magFilter=fi,o.minFilter=fi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=CN,n.src=TN),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case xd.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case xd.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case xd.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case xd.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=eh){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return CN}static get areaImageDataURL(){return TN}},Tpe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Ox={DEFAULT:0,ESKIL:1},Ppe=class extends Ql{constructor({blendFunction:e=Ri.NORMAL,technique:t=Ox.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",Tpe,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Fe(r)],["darkness",new Fe(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Ox.ESKIL}set eskil(e){this.technique=e?Ox.ESKIL:Ox.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},th=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Ri.NORMAL}},Mpe=class extends th{constructor(){super(upe),this.blendFunction=Ri.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},Dpe=class extends th{constructor(){super(cpe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},Ipe=class extends th{constructor(){super(gpe),this.effect.offset=new oe(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Rpe=class extends th{constructor(){super(fpe)}},Ope=class extends th{constructor(){super(bpe),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},kpe=class extends th{constructor(){super(_pe),this.blendFunction=Ri.OVERLAY}},Lpe=class extends th{constructor(){super(Ppe)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},zpe=class extends th{constructor(e){super(ype)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},Npe=class extends th{constructor(){super(Epe)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Bpe=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Fpe=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Upe=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Vpe=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,V2=class extends Mi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Fe(null)},blending:$r,depthWrite:!1,depthTest:!1,vertexShader:Upe,fragmentShader:Vpe})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},jpe=class extends Gs{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new V2,this.resolutionVector=new oe,this.resolveMaterial=new Mi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Fe(null),historyBuffer:new Fe(null),velocityBuffer:new Fe(null),depthBuffer:new Fe(null),resolution:new Fe(new oe)},blending:$r,depthWrite:!1,depthTest:!1,vertexShader:Bpe,fragmentShader:Fpe}),this.historyRenderTarget=new Pi(1024,1024,{minFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Pi(1024,1024,{minFilter:fi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},Hpe=class extends Gs{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new EN(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new V2,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new V2,this.depthPass=new EN(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},PN=new la,Gpe=new Mi({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),j2=class extends Gs{constructor(e,t,i){super("OpaquePass",t??PN,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??PN}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof js&&(this.originalMaterials.push([r,r.material]),r.material=Gpe)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},Wpe=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new U2,this.depthTexture=null,this.timer=new ope,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new oe),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===_s&&e.outputEncoding===ui&&(this.inputBuffer.texture[0].encoding=ui,this.outputBuffer.texture[0].encoding=ui,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new um(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Ud,e.type=Rd):e.type=Ru,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new oe:a.getDrawingBufferSize(new oe),l={minFilter:fi,magFilter:fi,wrapS:gr,wrapT:gr,stencilBuffer:t,depthBuffer:e},u;return r>0?(u=new Pi(o.width,o.height,l),u.samples=r):(n?(u=new d5(o.width,o.height,2,l),u.texture[1].type=Gu):u=new Pi(o.width,o.height,l),u.depthTexture=new um(2048,2048),u.depthTexture.type=Ki),i===_s&&a!==null&&a.outputEncoding===ui&&(Array.isArray(u.texture)?u.texture.forEach(h=>h.encoding=ui):u.texture.encoding=ui),Array.isArray(u.texture)?u.texture.forEach((h,c)=>{h.name=`EffectComposer.Buffer ${n} ${c}`,h.generateMipmaps=!1}):(u.texture.name=`EffectComposer.Buffer ${n}`,u.texture.generateMipmaps=!1),u.name=s,u}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new oe),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,u,h,c;e===void 0&&(e=this.timer.update().getDelta());for(let f of this.passes)f.enabled&&(f.MRTCompatible?f.render(t,r,n,e,o):f.render(t,s,a,e,o),f.needsSwap&&(o&&(i.renderToScreen=f.renderToScreen,l=t.getContext(),u=t.state.buffers.stencil,u.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),u.setFunc(l.EQUAL,1,4294967295)),h=r,c=s,r=n,s=a,n=h,a=c),f instanceof spe?o=!0:f instanceof kfe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new oe);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new oe);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},qpe=new Mi({name:"CombineMaterial",uniforms:{inputBufferA:new Fe(null),inputBufferB:new Fe(null)},blending:$r,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Xpe=class extends Gs{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=qpe,this.helperPass=new j2(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new j2(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new Nj({preset:xd.LOW,edgeDetectionMode:k_.COLOR});this.effectPass=new Iw(this.camera,t),this.rt=new Pi(10,10,{minFilter:fi,magFilter:fi,wrapS:gr,wrapT:gr,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Ype=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,Qpe=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Kpe=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,Zpe=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Jpe=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,$pe=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,sv=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],eme=new Mi({vertexShader:Ype,fragmentShader:Qpe}),pp=new Mi({vertexShader:Jpe,fragmentShader:$pe,uniforms:{texture_ao_lrez:new Fe(null),texture_depth_lrez:new Fe(null),texture_depth_hrez:new Fe(null),near:new Fe(null),far:new Fe(null)}}),tme=class extends Gs{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Pi(i,r,{type:Xy?Gu:Ki,depthTexture:new um(i,r),minFilter:fi,magFilter:fi}),this.depthBufferHighRes=new Pi(i,r,{depthTexture:new um(i,r)}),this.aoBuffer=new Pi(i,r,{minFilter:fi,magFilter:fi}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(sv.length*2);for(let a=0;a<sv.length;a++){let o=a*2;n[o+0]=sv[a][0],n[o+1]=sv[a][1]}this.blueNoiseInDiskTexture=new Fs(n,sv.length,1,Lb,Ki),this.blueNoiseInDiskTexture.wrapS=Iu,this.blueNoiseInDiskTexture.wrapT=Iu,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Mi({vertexShader:Kpe,fragmentShader:Zpe,uniforms:{near:new Fe(null),far:new Fe(null),fov:new Fe(null),proj_info:new Fe(new Yt),is_ortho:new Fe(!1),resolution:new Fe(new oe),radius_of_influence:new Fe(8),radius_in_screen_space:new Fe(1),exponent:new Fe(1),ao_color:new Fe(new L),bias:new Fe(.5),texture_depth:new Fe(null),texture_normals:new Fe(null),texture_blue_noise:new Fe(null),texture_blue_noise_in_disk:new Fe(this.blueNoiseInDiskTexture),frame_index:new Fe(0),fog_enabled:new Fe(!1),fog_near:new Fe(1),fog_far:new Fe(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Pi(i,r,{minFilter:fi,magFilter:fi,wrapS:gr,wrapT:gr,depthBuffer:!1,type:Ki});let s=new Nj({preset:xd.ULTRA,edgeDetectionMode:k_.COLOR});this.effectPass=new Iw(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,pp.uniforms.texture_depth_hrez.value=e,pp.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=eme;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(u*.5)*2),c=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*h;this.hbaoMaterial.uniforms.radius_in_screen_space.value=c,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),h=this.hbaoMaterial.uniforms.radius_of_influence.value*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=pp,pp.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,pp.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,pp.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},ime=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,rme=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,nme=class extends Qa{constructor(){super(new Mi({vertexShader:ime,fragmentShader:rme,uniforms:{tInput:new Fe(null),tMap:new Fe(null),uResolution:new Fe(new oe),uSize:new Fe(new oe),uCoords:new Fe(new oe),uScale:new Fe(1),uSceneColor:new Fe(new Nt(16711680)),uDPR:new Fe(1),uCurrent:new Fe(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},sme=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ame=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,ome=[],lme=class extends Qa{constructor(){super(new Mi({vertexShader:sme,fragmentShader:ame,uniforms:{toScene:new Fe(null),fromScene:new Fe(null),uResolution:new Fe(new oe),uDPR:new Fe(1),mixRatio:new Fe(0),threshold:new Fe(.1),useTexture:new Fe(0),tMixTexture:{value:ome[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},ume=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hme=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,cme=class extends Qa{constructor(){super(new Mi({vertexShader:ume,fragmentShader:hme,uniforms:{inputBuffer:new Fe(null),blurredInputBuffer:new Fe(null),overlay:new Fe(null),uResolution:new Fe(new oe),uDPR:new Fe(1),blurIntensity:new Fe(0)}})),this._blurEnabled=!1,this.blurTarget=new Pi(1,1,{minFilter:fi,magFilter:fi,wrapS:gr,wrapT:gr}),this.blurPass=new $M({width:window.innerWidth,height:window.innerHeight,kernelSize:L_.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},dme=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,fme=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,pme=class extends Qa{constructor(){super(new Mi({vertexShader:dme,fragmentShader:fme,uniforms:{tInput:new Fe(null),tOverlayImage:new Fe(null),uResolution:new Fe(new oe),uImageSize:new Fe(new oe),uRightBottom:new Fe(new oe(20,20)),uScale:new Fe(.25),uDPR:new Fe(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function MN(e,t){return t&&t.enabled&&e.push(t.effect),e}var mme=e=>Object.values(Ri).includes(e)?e:Ri.NORMAL,gme=class extends as{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=pw.defaultData,this._scene=new la,this._camera=new ws,this.effects=new Map,this.blueNoiseTexture=new Fs,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new TZ,this.renderer=e,this.debug=!1,this.effects.set("bloom",new Mpe),this.effects.set("chromaticAberration",new Ipe),this.effects.set("vignette",new Lpe),this.effects.set("noise",new kpe),this.effects.set("colorAverage",new Rpe),this.effects.set("hueSaturation",new Ope),this.effects.set("brightnessContrast",new Dpe),this.effects.set("depthOfField",new zpe),this.effects.set("pixelation",new Npe),this.effectComposer=new Wpe(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new j2(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new Hpe(this.scene,this.camera,this.renderer),this.aoPass=new tme(this.scene,this.camera),this.taaPass=new jpe,this.taaPass.renderToScreen=!1,this.helperPass=new Xpe(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new nme,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new cme,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new pme,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new lme,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Fs(e,128,128),this.blueNoiseTexture.wrapS=Iu,this.blueNoiseTexture.wrapT=Iu,this.blueNoiseTexture.minFilter=vi,this.blueNoiseTexture.magFilter=vi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(MN,[]);r.length>0&&(this.uvEffectPass=new Iw(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(MN,[]);if(n.length>0&&(this.effectPass=new Iw(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new oe;this.renderer.getDrawingBufferSize(e),this._rt=new Pi(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Iu,wrapT:Iu}),this._rt.samples=0,this._savePass=new U2(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new U2(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=mme(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof Yt?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof Yt?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},vme=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,yme=di.lights_fragment_begin,xme=di.shadowmask_pars_fragment,DN=null,bme=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},wme=(e="medium")=>{if(DN===e)return!1;DN=e;let t=bme(e);di.shadowmap_pars_fragment=vme(t);let i=yme.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),di.lights_fragment_begin=i;let r=xme.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),di.shadowmask_pars_fragment=r,!0},_me=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,Sme=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,fC=new Mi({vertexShader:_me,fragmentShader:Sme,uniforms:{depthContrast:{value:1}}}),IN=new Ar,RN=new oe,Eme=class extends w5{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new oe,this.dummyCamera=new ws,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new gme(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=BP,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Pi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:fi,magFilter:fi,wrapS:gr,wrapT:gr,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return Ut.transmissionLod.value===1}set hdTransmission(e){Ut.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Pi(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:om,magFilter:fi,wrapS:gr,wrapT:gr,depthBuffer:!1}),this.transmissionDepthTarget=new Pi(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:vi,magFilter:vi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Pi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:vi,magFilter:vi,type:Ki,depthTexture:new um(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof ws?fC.uniforms.depthContrast.value=(i.far-i.near)/1e4:fC.uniforms.depthContrast.value=1,t.overrideMaterial=fC,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?Q2:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var f;let a=e instanceof oD?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((m,g)=>{Ut.penumbraSize.value[g]=m}),Ut.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Ut.resolution.value.set(this.resolution.x,this.resolution.y):Ut.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(Ut.normalRenderTarget.value=s,Ut.normalRenderTargetDepth.value=IN):l.needsNormal()&&(this.createNormalRenderTarget(),Ut.normalRenderTarget.value=this.normalRenderTarget.texture,Ut.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let u=a.data.ao,h=u.occlusion;if(h&&(this.createAORenderTarget(),Ut.aoRenderTarget.value=this.aoRenderTarget.texture),Ut.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(u.occlusion,u.radius,u.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,u.aoFullRes&&!Xy),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((f=a.uiCanvas)==null?void 0:f.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let m=this.getSize(RN),g=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==g)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},g),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(m.x,m.y,g),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let m=this.getSize(RN),g=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(m.x,m.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=g}let c=!1;if(n!==void 0)Ut.transmissionRenderTarget.value=n,Ut.transmissionRenderTargetDepth.value=IN,this.pipeline.setTransmissionPassEnabled(!1);else{let m=l.needsTransmission();m&&(this.transmissionRenderTarget===void 0&&(c=!0),this.createTransmissionRenderTarget(),Ut.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Ut.aspectRatio.value=nce(this.viewportWidth,this.viewportHeight),Ut.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(m)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,c&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(m=>{m.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?Q2:null,this.pipeline.render(),Ut.frameIndex.value=(Ut.frameIndex.value+1)%16,t instanceof ws&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},Bj=class extends Ky(HZ){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Zy(this.object,Bj.geometryHelper,e,t)}},Fj=class extends Ky(jZ){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Zy(this.object,Fj.geometryHelper,e,t)}},H2=class extends Ky(VZ){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Zy(this.object,H2.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=H2._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},Uj=H2;Uj._vector=new L;var Vj=class extends ku{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new ar(new Vl(1,1),new Wu({transparent:!0,opacity:0,side:bs})),this.add(this.caretMesh),this.selectionMesh=new ar(new Vl(1,1),new Wu({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:bs})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=Rw(i,e),[s,a]=e>0?Rw(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=pC(this.object,r,n),{AD:u,descender:h}=this.object,c=h+u*.5,{width:f,height:m,depth:g}=this.object.geometry.userData.parameters,y=typeof f=="string"?0:f,v=typeof m=="string"?0:m;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-y*.5,l+c+v*.5,g),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=Ame(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,u=l+o*.5-a*.5;for(let[v,b,S]of s)if(b!==S){let[_,T]=pC(this.object,v,b),[M,C]=pC(this.object,v,S);T+=u,C+=u,C+=a;let P=r.length/3;r.push(_,T,0),r.push(M,T,0),r.push(M,C,0),r.push(_,C,0),n.push(P+0,P+1,P+2),n.push(P+2,P+3,P+0)}let h=new St;h.setIndex(n),h.setAttribute("position",new ot(r,3));let{width:c,height:f,depth:m}=this.object.geometry.userData.parameters,g=typeof c=="string"?0:c,y=typeof f=="string"?0:f;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=h,this.selectionMesh.position.x=-g*.5,this.selectionMesh.position.y=y*.5,this.selectionMesh.position.z=m,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,u=typeof o=="string"?0:o,h=0;l===3?h=u-a:l===2&&(h=u*.5-a*.5);let c=Math.min(Math.floor(Math.max(Math.min(-t-h,a),0)/s),n-1),f=this.object.charCoords[c],m=this.object.charWidths[c],g=0,y=!1;if(i==="previous"){for(let v=0;v<f.length;v++)if(f[v][0]+m[v]*.5-e>0){g=v,y=!0;break}}else if(i==="closest"){let v=1/0;for(let b=0;b<f.length;b++){let S=f[b][0]+m[b]*.5,_=Math.abs(S-e);_<v&&(v=_,g=b,y=!0)}}else for(let v=0;v<f.length;v++){let b=f[v][0],S=f[v][0]+m[v];if(e>=b&&e<S){g=v,y=!0;break}}return y||(g=f.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,c,g),lineIndex:c,characterIndex:g}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function pC(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let h=0,{horizontalAlign:c}=e.data.geometry,f=e.wrappedText,{width:m}=e.geometry.userData.parameters;return f.length===1&&f[0].length===0&&(c===3?h=m*.5:c===2&&(h=m)),[h,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,u]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,u]}function Rw(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function Ame(e,t,i){let[r,n]=Rw(e,t),[s,a]=Rw(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let u=e[l],h=l===r?n:0,c=l===s?a:u.length;o.push([l,h,c])}return o}function Cme(e,t){let i=Jn.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=Tme(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=Pme(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function Tme(e,t){return typeof e=="string"?t.data.colors[e]:e}function Pme(e){return e.colors[0]}function Mme(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var jj=class extends ZM(CZ,Bj){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new Xb(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Xb&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&Mme(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},ON=new L,kN=new L,LN=new Wt,Hj=class extends ZM(_Z,Uj){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=ht.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new Xb(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Xb&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),kN.setFromMatrixPosition(this.matrixWorld),LN.setFromRotationMatrix(this.matrixWorld),ON.copy(this.up).applyQuaternion(LN).negate().multiplyScalar(this.distance),this.target.position.copy(kN).add(ON),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function Dme(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,u=Math.atan2(r,i),h=Math.atan2(n,t),c=(h-u)/2,f=(h+u)/2,m=[[Math.cos(f),Math.sin(f)],[-Math.sin(f),Math.cos(f)]],g=[[o,0],[0,l]],y=[[Math.cos(c),Math.sin(c)],[-Math.sin(c),Math.cos(c)]];return m[0][0]*=-1,m[0][1]*=-1,y[0][0]*=-1,y[1][0]*=-1,[m,g,y]}function gb(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function zN(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function Ime(e){let[t,i,r]=Dme(e),n=gb(t,zN(r)),s=gb(gb(r,i),zN(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function Rme({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=gb(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Ni;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(C,P=e.identity()){for(let E=0,D=C.length;E<D;E++)P[E]=C[E];return P}e.copy=i;function r(C,P,E,D,I,O){return e.setAbcdef(e.identity(),C,P,E,D,I,O)}e.create=r;function n(C,P,E,D,I,O,N){return C[0]=P,C[1]=D,C[2]=O,C[3]=E,C[4]=I,C[5]=N,C}e.setAbcdef=n;function s(C,P){let[E,D,I,O,N,k]=o(C),[U,Q,se,K,H,ie]=o(P),$=U*E+Q*I,V=U*D+Q*O,X=se*E+K*I,ue=se*D+K*O,ne=H*E+ie*I+N,he=H*D+ie*O+k;return e.create($,V,X,ue,ne,he)}e.append=s;function a(C,P){let[E,D,I,O,N,k]=o(C),[U,Q,se,K,H,ie]=o(P),$=E,V=D,X=I,ue=O;(U!==1||Q!==0||se!==0||K!==1)&&($=E*U+D*se,V=E*Q+D*K,X=I*U+O*se,ue=I*Q+O*K);let ne=N*U+k*se+H,he=N*Q+k*K+ie;return e.create($,V,X,ue,ne,he)}e.prepend=a;function o(C){return[C[0],C[3],C[1],C[4],C[2],C[5]]}e.getAbcdef=o;function l(C){let[P,E,D,I,O,N]=e.getAbcdef(C),k=P*I-E*D,U=I/k,Q=-E/k,se=-D/k,K=P/k,H=(D*N-I*O)/k,ie=-(P*N-E*O)/k;return e.create(U,Q,se,K,H,ie)}e.invert=l;function u([C,P],E){let[D,I,O,N,k,U]=e.getAbcdef(E);return[D*C+O*P+k,I*C+N*P+U]}e.apply=u;function h(C,P){let[E,D,I,O,N,k]=e.getAbcdef(P),U=1/(E*O+I*-D),[Q,se]=C;return[O*U*Q+-I*U*se+(k*I-N*O)*U,E*U*se+-D*U*Q+(-k*E+N*D)*U]}e.applyInverse=h;function c(C,P,E=P){let[D,I,O,N,k,U]=e.getAbcdef(C);return e.setAbcdef(C,D*P,I*E,O*P,N*E,k*P,U*E),C}e.scale=c;function f(C,P){let E=Math.cos(P),D=Math.sin(P),[I,O,N,k,U,Q]=e.getAbcdef(C);return e.setAbcdef(C,I*E-O*D,I*D+O*E,N*E-k*D,N*D+k*E,U*E-Q*D,U*D+Q*E),C}e.rotate=f;function m(C,P,E){let[D,I]=E,O=e.translate(C,-D,-I);return O=e.rotate(O,P),O=e.translate(O,D,I),O}e.rotateAround=m;function g(C,P,E){let[D,I,O,N,k,U]=e.getAbcdef(C);return e.setAbcdef(C,D,I,O,N,k+P,U+E),C}e.translate=g;function y(C,P,E){let[D,I,O,N]=e.getAbcdef(C);return e.setAbcdef(C,D,I,O,N,P,E),C}e.setTranslate=y;function v(C,P,E){let[D,I,O,N]=e.getAbcdef(C);return e.setAbcdef(C,D,I,O,N,P,E),C}e.setPosition=v;function b(C){let[P,E,D,I]=e.getAbcdef(C),O=Math.sqrt(P*P+E*E),N=Math.sqrt(D*D+I*I);return[O,N]}e.getScale=b;function S(C){let[,,,,P,E]=e.getAbcdef(C);return[P,E]}e.getPosition=S;function _(C,P){return e.decompose(C,P).rotation}e.getRotation=_;function T(C,P){let[E,D,I,O,N,k]=e.getAbcdef(C),{rotation:U,scale:Q,shear:se}=Ime([[E,I],[D,O]]);return{position:[N+(P[0]*E+P[1]*I)-P[0],k+(P[0]*D+P[1]*O)-P[1]],scale:Q,rotation:U,shear:se,pivot:P}}e.decompose=T;function M(C,P,E,D,I=[0,0]){let[O,N]=C,[k,U]=D,[Q,se,K,H]=Rme({rotation:E,scale:P,shear:I}),ie=O-(k*Q+U*K)+k,$=N-(k*se+U*H)+U;return e.create(Q,se,K,H,ie,$)}e.compose=M})(Ni||(Ni={}));var Ome=Math.PI/180;function kme(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function Lme(e){return e*Ome}var Bn=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Ni.identity(),this.worldMatrix=Ni.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new G2,this._recursiveBBox=new G2,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=R_(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Ni.append(t.worldMatrix,i)),Ni.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Ni.compose(this.position,this.scale,Lme(this.rotation),zd.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Ni.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Ni.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return zd.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=ir(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=fn.zoom(o,e.path.slice(2));if(l)for(let u in e.props)e.props[u]===void 0&&u in l&&(a[u]=l[u])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=fn.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,Cd.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Cd.toOps(this.data,r.data).forEach(n=>{let s=nw.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=Cd.patch(this.data,r),Cd.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new Bn(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof Bn&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Ro=class extends Bn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Ro&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Ro?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Ro&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Ro&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Ro(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Ac=class extends Ro{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Ac(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function zme(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,u]]=t,h=(i-n)*(o-u)-(r-s)*(a-l);if(h===0)return!1;let c=((i-a)*(o-u)-(r-o)*(a-l))/h,f=-((i-n)*(r-o)-(r-s)*(i-a))/h;return c>=0&&c<=1&&f>=0&&f<=1}var Gj=[[-1,1],[-1,-1],[1,-1],[1,1]],NN=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=Ni.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(Ni.apply(r,s)):Gj.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Ni.apply(o,s))})},G2=class{constructor(){this.matrix=Ni.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Ni.copy(e.worldMatrix,this.matrix);let i=Ni.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Ro?e.traverse(n=>{n.visible&&NN(n,t,r)}):NN(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Ni.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Ni.apply([0,0],i),Ni.apply([0,t],i),Ni.apply([e,t],i),Ni.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Ni.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Ni.getAbcdef(this.matrix),o=Ni.create(r,n,s,a,i[0],i[1]);this.vertices=Gj.map(([l,u])=>Ni.apply([l*e,u*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Ni.append(t.worldMatrix,i)),Ni.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(zme(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Ni.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new G2;return e.copy(this),e}},Wj,Nme=new Promise(e=>{Wj=e}),BN=!1,kx;function Bme(){if(BN)return;if(kx)return kx;async function e(){let t=await Es(()=>import("./ui-CBnIuqmk.js"),[]);Wj(t.default??t),BN=!0}return kx=e(),kx}function FN(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var ri,mC;async function Fme(e){let t=await Nme;ri||(mC||(mC=t({locateFile:()=>e})),ri=await mC)}var UN=Ni.identity(),qj=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=Ji.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=Ji.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=UN,this._currentTransform=new Float32Array(UN)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await Fme(this.wasmURL),this._surface=ri.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new ri.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(ri.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(ri.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=ri.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(Lx(e),ri.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(Lx(e),ri.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(ri.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new ri.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var u,h;let l=ri.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(u=this.ctx)==null||u.clipRect(l,ri.ClipOp.Intersect,!0);else{let c=ri.RRectXY(l,n,n);c[4]=c[5]=n,c[6]=c[7]=s,c[8]=c[9]=a,c[10]=c[11]=o,(h=this.ctx)==null||h.clipRRect(c,ri.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Ni.invert(this.currentTransform);this.ctx.concat(e);let t=Ni.translate(Ni.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let u=e.copy();u.setColor(Lx(this._dropShadowColor));let h;this._dropShadowBlur>0&&(h=ri.MaskFilter.MakeBlur(ri.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),u.setMaskFilter(h)),this.ctx.save(),this.ctx.clipPath(this._currentPath,ri.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(u),this.ctx.restore(),u.delete(),h==null||h.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,ri.ClipOp.Intersect,!0);let u=ri.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,ri.TileMode.Clamp,null),h=e.copy();h.setImageFilter(u),h.setAlphaf(1);let c=this._currentPath.computeTightBounds();this.ctx.saveLayer(h,c,null,ri.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),h.delete(),u.delete(),l=!0}if(this._layerBlur>0){let u=e.copy();o=ri.MaskFilter.MakeBlur(ri.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),u.setMaskFilter(o),t(u),u.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let u=new ri.Paint;u.setAntiAlias(!0),u.setStyle(ri.PaintStyle.Fill),u.setColor(Lx(this._innerShadowColor));let h;this._innerShadowBlur>0&&(h=ri.MaskFilter.MakeBlur(ri.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),u.setMaskFilter(h));let c=this._currentPath.computeTightBounds(),[f,m,g,y]=c,v=g-f,b=y-m;this.ctx.save(),this.ctx.clipPath(this._currentPath,ri.ClipOp.Intersect,!0),this.ctx.saveLayer(u,c,null,ri.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(ri.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+v+Math.abs(this._innerShadowOffsetX*2),2e3+b+Math.abs(this._innerShadowOffsetY*2)),u),u.setBlendMode(ri.BlendMode.Clear),this.ctx.drawPath(this._currentPath,u),this.ctx.restore(),this.ctx.restore(),u.delete(),h==null||h.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?ri.ClipOp.Difference:ri.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(ri.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var u;if(!VN([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=ri.XYWHRect(e-i,t-r,i*2,r*2);(u=this._currentPath)==null||u.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var u,h;let l=ri.XYWHRect(e,t,i,r);if(VN(l))if(n===0&&s===0&&o===0&&a===0)(u=this._currentPath)==null||u.addRect(l);else{let c=ri.RRectXY(l,n,n);c[4]=c[5]=n,c[6]=c[7]=s,c[8]=c[9]=a,c[10]=c[11]=o,(h=this._currentPath)==null||h.addRRect(c)}}getHorizontalAlign(e){switch(e){case 2:return ri.TextAlign.Right;case 3:return ri.TextAlign.Center;case 4:return ri.TextAlign.Justify;case 1:default:return ri.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,u=!0){let h=0,{ctx:c}=this;if(!c)return h;let f=l.copy(),m=l.copy();return m.setAlphaf(0),this._applyEffectsToPaint(f,g=>{t.pushPaintStyle(i,g,m),t.addText(e);let y=t.build();y.layout(s);let v=n;o===2?v+=(a-y.getHeight())/2:o===3&&(v+=a-y.getHeight()),c.drawParagraph(y,r,v),h=y.getHeight(),t.reset(),y.delete()},u),f.delete(),m.delete(),h}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new ri.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new ri.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),u=ri.XYWHRect(t.x,t.y,t.width,t.height),h=ri.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,h,o,u,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,h,o,u,t.verticalAlign,a,!1)),h.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Ni.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let u=Ni.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/u[0],1/u[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=ri.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function VN(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function Lx({r:e,g:t,b:i,a:r}){return ri.Color4f(e,t,i,r)}var jN=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Ji.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},HN=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},Ume=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Ji.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},Vme=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Ji.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},On=class extends Bn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new Ume(e+"-fill",t.fill,i),this.stroke=new Vme(e+"-stroke",t.stroke,i),this.dropShadow=new jN(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new jN(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new HN(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new HN(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Ji.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Ji.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=Ji.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=Ji.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(ir(e.path,["fill"])?this.fill.update(e.props):ir(e.path,["stroke"])?this.stroke.update(e.props):ir(e.path,["dropShadow"])?this.dropShadow.update(e.props):ir(e.path,["innerShadow"])?this.innerShadow.update(e.props):ir(e.path,["layerBlur"])?this.layerBlur.update(e.props):ir(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new On(this.uuid,this.data,e);return t.parent=void 0,t}},eD=class extends On{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return kme(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new eD(this.uuid,this.data,e);return t.parent=void 0,t}},e0=class extends On{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new e0(this.uuid,this.data,e);return t.parent=void 0,t}},tD=class extends On{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Ji.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Ji.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new tD(this.uuid,this.data,e);return t.parent=void 0,t}},Xj=class extends On{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>Ow.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[u,h]=s.controlPrevious.position,[c,f]=s.position,m={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};Ow.derive(m),e.bezierCurveTo(o,l,u,h,c,f)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new Xj(this.uuid,this.data,e);return t.parent=void 0,t}},Ow;(e=>{function t(a){let o=a.start,l=a.cp1,u=a.cp2,h=a.end,c=[3*(l[0]-o[0]),3*(l[1]-o[1])],f=[3*(u[0]-l[0]),3*(u[1]-l[1])],m=[3*(h[0]-u[0]),3*(h[1]-u[1])],g={start:c,cp:f,end:m};return a.derivative=g,g.derivative=W2.derive(g),g}e.derive=t;function i(a,o,l,u=!1){let h=a-2*o+l;if(h!==0){let c=-Math.sqrt(Math.abs(o*o-a*l)),f=-a+o,m=-(c+f)/h,g=-(-c+f)/h;return[m,g]}else if(o!==l&&h===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,u=o.cp,h=o.end;return[i(l[0],u[0],h[0]),i(l[1],u[1],h[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),u=[a.start[0],a.end[0]],h=[a.start[1],a.end[1]];for(let c of o)u.push(e.compute(a,Math.min(1,Math.max(0,c)))[0]);for(let c of l)h.push(e.compute(a,Math.min(1,Math.max(0,c)))[1]);return u.sort((c,f)=>c-f),h.sort((c,f)=>c-f),[[u[0],h[0]],[u[u.length-1],h[h.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,u=l*l,h=o*o,c=u*l,f=u*o*3,m=l*h*3,g=o*h;return[c*a.start[0]+f*a.cp1[0]+m*a.cp2[0]+g*a.end[0],c*a.start[1]+f*a.cp1[1]+m*a.cp2[1]+g*a.end[1]]}e.compute=s})(Ow||(Ow={}));var W2;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],u=[2*(o[0]-a[0]),2*(o[1]-a[1])],h={start:l,end:u};return h.derivative=q2.derive(h),n.derivative=h,h}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,u=o,h=a*s*2,c=l;return[u*n.start[0]+h*n.cp[0]+c*n.end[0],u*n.start[1]+h*n.cp[1]+c*n.end[1]]}e.compute=r})(W2||(W2={}));var q2;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(q2||(q2={}));var zl=class extends Ro{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new e0(e+"-background",yy.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(ir(e.path,["fill"])?this.fill.update(e.props):ir(e.path,["stroke"])?this.stroke.update(e.props):ir(e.path,["dropShadow"])?this.dropShadow.update(e.props):ir(e.path,["innerShadow"])?this.innerShadow.update(e.props):ir(e.path,["layerBlur"])?this.layerBlur.update(e.props):ir(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new zl(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},jme=Oc(KF(),1),z_=class extends On{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new z_(this.uuid,this.data,e);return t.parent=void 0,t}};function Hme(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,jme.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return Gme(r)}function Gme(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function Wme(e,t,i){switch(t.type){case"ellipse2d":return new eD(e,t,i);case"rectangle2d":return new e0(e,t,i);case"text2d":return new tD(e,t,i);case"vector2d":return new Xj(e,t,i);case"path2d":return new z_(e,t,i);case"frame2d":return new zl(e,t,i);case"group2d":default:return new Ac(e,t,i)}}var Yj=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Ac(Yj.GROUP_ID,{...Sw.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=Wme(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Ac||a instanceof zl)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Ro&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Ro){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Ro||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>PU(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},iD=Yj;iD.GROUP_ID="scene2d";function Qj({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:u}=e,h=t-r,c=i-n,f=s,m=a,g=o[0],y=o[1];if(l!==0){if(l===1)g+=h;else if(l===3)g+=h/2;else if(l===2)f=Math.max(1,f+h);else if(l===4){let v=t/r;f*=v,g*=v}}if(u!==0){if(u===1)y+=c;else if(u===3)y+=c/2;else if(u===2)m=Math.max(1,m+c);else if(u===4){let v=i/n;m*=v,y*=v}}return{width:f,height:m,position:[g,y]}}Oc(KF(),1);var qme=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,Xme=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,Yme=new p_(-1,1,1,-1,0,1),Qme=class extends St{constructor(){super(),this.setAttribute("position",new ot([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ot([0,2,0,0,2,0],2))}},Kme=new Qme,Zme=class{constructor(e){this._mesh=new ar(Kme,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Yme)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},Kj=new Mi({defines:{},uniforms:{tDiffuse:new Fe(null)},vertexShader:qme,fragmentShader:Xme}),Jme=new Zme(Kj),gC=null,vC=null,$me=()=>(gC===null&&(gC=document.createElement("canvas")),gC),ege=e=>(vC===null&&(vC=new qj(e)),vC),tge=Ni.identity(),Zj=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new iD(ht.generateUUID(),p2.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=$me(),this.renderer=ege(this.canvas),this.promise=this.init(),this.renderTarget=new Pi(1,1,{type:Gu,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new kK(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof qj&&(this.renderer.wasmURL=xj.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),Kj.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),Jme.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=tge,this.isScreenSpace&&(this.frameOverride.fill.color=Ji.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},Jj({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof zl)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function Jj({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof zl&&t instanceof zl||e instanceof Ac&&t instanceof Ac)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],u=t.children[a];l&&u&&l.uuid===u.uuid&&rge({objectOverride:l,objectRoot:u,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function ige(e){if(X2(e))return[e.width,e.height];if(e instanceof z_){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Ac){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function rge({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=ige(t),{width:l,height:u,position:h}=Qj({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=h,e.data={...e.data,position:h},e.states)for(let c in e.states)nge({stateId:c,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(X2(e)||e instanceof Ac)X2(e)&&(e.width=l,e.height=u,e.data={...e.data,width:l,height:u}),Jj({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:u,initialParentWidth:a,initialParentHeight:o});else if(e instanceof z_){let c=t,f=a!==0?l/a:1,m=o!==0?u/o:1;e.path=Hme(c.path,f,m),e.data={...e.data,path:e.path}}}function nge({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var u,h;let o=(u=t.states)==null?void 0:u[e],l=(h=i.states)==null?void 0:h[e];if(o&&l){let{width:c,height:f,position:m}=Qj({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:zd.isResizeable(l)?l.width:0,objectInitialHeight:zd.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:m}),zd.isResizeable(o)&&Object.assign(t.states[e],{width:c,height:f})}}function X2(e){return e instanceof e0||e instanceof zl||e instanceof eD||e instanceof tD}var Rn=class extends IM(la){constructor(e,t,i){super(),this.data=t,this.bgColor=new ns(1,1,1,1),this.fog=null,this.backupFog=new _5(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Nt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new ws(jm,{...my.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new bZ(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new iD((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new Zj(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=Us(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof Wd&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Wm)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&wme(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Us(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=Us(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;ir(e.path,["fog"])?this.updateFog(s.fog,i.shared):ir(e.path,["ao"])?this.updateAo(s.ao,i.shared):ir(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):ir(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(Us(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof jj&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof Hj&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Si.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Io(n)||N2(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),Y2(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(e,t,i,r)}},sge=class extends ZM(EZ,Fj){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new L(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new L(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new jr(n,s),o=new Yb(a,new Nt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Yb){let i=this.shadow.camera,r=new L(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new L(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},age=class extends Jr{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?FM(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},rD=class extends Jr{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=BM;break;case"Ellipse":n=NM;break;case"Polygon":n=LV;break;case"Star":n=zV;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?FM(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},nD=class extends KM{constructor(e,t,i){super(e,t,i),this.data=t}},tm=class extends qm(ku,Jy){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=xw.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of sc.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=dc.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...pn.defaultData,...e,...kl(pn.defaultData,sc.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of sc.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&sc.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Si.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),sD(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};$j(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Si.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof Jr&&l.bones&&l.boneInverses){let u=o.dataPatched;if(u.bones&&u.boneInverses){let h=u.bones.map(m=>e.scene.find(n[m])),c=u.boneInverses.map(m=>new je().fromArray(m)),f=new qP(h,c);o.bind(f,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function sD(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Si.is(i)&&sD(i)}}function GN(e,t,i,r){return e.component===t&&yM(e.identity,r)?e.overrideData===i?2:1:0}function $j(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let h=r.component.instances.indexOf(r);h>=0&&r.component.instances.splice(h,1)}n.instances.find(h=>h===r)||n.instances.push(r),r.component=n}n instanceof tm&&n.isInstanceRoot&&n.expandInstanceChildren(e);let u=0;for(let h of n.children)if(Si.is(h)){let c=[...t,...typeof h.identity=="string"?[h.identity]:h.identity],f=mw.resolve(i,c,1);f!=null&&!(f instanceof en)&&(Object.setPrototypeOf(f,en.prototype),console.error("wrong prototype"));let m=null,g;if(!o){let y=r.children[u];if(m=Si.is(y)?y:null,m!==null){let v=GN(m,h,f,c);g=v>=1?m.stateSelection:void 0,v!==2&&(m=null)}if(m===null&&(m=e.scene.findInstance(c)??null,m!==null)){let v=GN(m,h,f,c);if(g=v>=1?m.stateSelection:void 0,v!==2)m=null;else{let b=m.parent.children.indexOf(m);m.parent.children.splice(b,1),r.children.splice(u,0,m),m.parent===r?b<=u&&console.error("not possible"):(m.parent=r,m.matrixWorldNeedsUpdate=!0,m.resetBBoxNeedsUpdate(),m.updateVisible(),e.pendingDeletes.delete(m))}}}if(m===null){let y=f?dc.apply(h.data,f):h.data;jd.is(y.type)&&(y={...y,type:"Empty"}),m=oc.createEntity(c,y,e),m.overrideData=f,r.add(m),r.children.splice(r.children.length-1,1),r.children.splice(u,0,m),m.updateState(m.data,e),g&&m.changeSelectedState(g,e),e.scene.registerInstanceAndSetUuid(m)}if(m.isBone){let y=m.identity[m.identity.length-1];l[y]=m.uuid}u+=1,$j(e,t,i,m,h,s,a+1,o,l)}if(!o){let h=u;for(;;){let c=r.children[u];if(Si.is(c))e.pendingDeletes.add(c);else break;u+=1}r.children.splice(h,u-h)}return!0}var oge=class extends qm(S5,Jy){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},xs=class extends Jr{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new Zj(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,r=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=_y(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):ir(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},lge=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=Ki,n=new la,s=new kc;s.position.z=1;let a={passThruTexture:{value:null}},o=h(f(),a),l=new ar(new Vl(2,2),o);n.add(l),this.setDataType=function(m){return r=m,this},this.addVariable=function(m,g,y){let v=this.createShaderMaterial(g),b={name:m,initialValueTexture:y,material:v,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:vi,magFilter:vi};return this.variables.push(b),b},this.setVariableDependencies=function(m,g){m.dependencies=g},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let m=0;m<this.variables.length;m++){let g=this.variables[m];g.renderTargets[0]=this.createRenderTarget(e,t,g.wrapS,g.wrapT,g.minFilter,g.magFilter),g.renderTargets[1]=this.createRenderTarget(e,t,g.wrapS,g.wrapT,g.minFilter,g.magFilter),this.renderTexture(g.initialValueTexture,g.renderTargets[0]),this.renderTexture(g.initialValueTexture,g.renderTargets[1]);let y=g.material,v=y.uniforms;if(g.dependencies!==null)for(let b=0;b<g.dependencies.length;b++){let S=g.dependencies[b];if(S.name!==g.name){let _=!1;for(let T=0;T<this.variables.length;T++)if(S.name===this.variables[T].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+g.name+", dependency="+S.name}v[S.name]={value:null},y.fragmentShader=`
uniform sampler2D `+S.name+`;
`+y.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let m=this.currentTextureIndex,g=this.currentTextureIndex===0?1:0;for(let y=0,v=this.variables.length;y<v;y++){let b=this.variables[y];if(b.dependencies!==null){let S=b.material.uniforms;for(let _=0,T=b.dependencies.length;_<T;_++){let M=b.dependencies[_];S[M.name].value=M.renderTargets[m].texture}}this.doRenderTarget(b.material,b.renderTargets[g])}this.currentTextureIndex=g},this.getCurrentRenderTarget=function(m){return m.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(m){return m.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let m=this.variables;for(let g=0;g<m.length;g++){let y=m[g];y.initialValueTexture&&y.initialValueTexture.dispose();let v=y.renderTargets;for(let b=0;b<v.length;b++)v[b].dispose()}};function u(m){m.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=u;function h(m,g){g=g||{};let y=new Mi({uniforms:g,vertexShader:c(),fragmentShader:m});return u(y),y}this.createShaderMaterial=h,this.createRenderTarget=function(m,g,y,v,b,S){return m=m||e,g=g||t,y=y||gr,v=v||gr,b=b||vi,S=S||vi,new Pi(m,g,{wrapS:y,wrapT:v,minFilter:b,magFilter:S,format:br,type:r,depthBuffer:!1})},this.createTexture=function(){let m=new Float32Array(e*t*4),g=new Fs(m,e,t,br,Ki);return g.needsUpdate=!0,g},this.renderTexture=function(m,g){a.passThruTexture.value=m,this.doRenderTarget(o,g),a.passThruTexture.value=null},this.doRenderTarget=function(m,g){let y=i.getRenderTarget(),v=i.xr.enabled,b=i.shadowMap.autoUpdate,S=i.outputEncoding,_=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Vo,i.toneMapping=Ol,l.material=m,i.setRenderTarget(g),i.render(n,s),l.material=o,i.xr.enabled=v,i.shadowMap.autoUpdate=b,i.outputEncoding=S,i.toneMapping=_,i.setRenderTarget(y)};function c(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function f(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},qn=new $n,zx=new L,uge=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),qn.a.fromBufferAttribute(e,n),qn.b.fromBufferAttribute(e,n+1),qn.c.fromBufferAttribute(e,n+2),s*=qn.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),qn.a.fromBufferAttribute(this.positionAttribute,e*3),qn.b.fromBufferAttribute(this.positionAttribute,e*3+1),qn.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(qn.a,n).addScaledVector(qn.b,s).addScaledVector(qn.c,1-(n+s)),i!==void 0&&qn.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(qn.a.fromBufferAttribute(this.colorAttribute,e*3),qn.b.fromBufferAttribute(this.colorAttribute,e*3+1),qn.c.fromBufferAttribute(this.colorAttribute,e*3+2),zx.set(0,0,0).addScaledVector(qn.a,n).addScaledVector(qn.b,s).addScaledVector(qn.c,1-(n+s)),r.r=zx.x,r.g=zx.y,r.b=zx.z),this}};function hge(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function cge(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function dge(e,t){let i=new ar(e.geometry,e.material),r=[],n=[],s=new L,a=new L;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new uge(i).build();for(let h=0;h<t;h++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),u=new Float32Array(n);return{positions:l,normals:u}}function WN(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new Fs(r,t,t,br,Ki);return n.needsUpdate=!0,n}function fge({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Fs(t,e,e,br,Ki);return i.needsUpdate=!0,i}function pge(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Fs(t,e,e,br,Ki);return i.needsUpdate=!0,i}var mge=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,gge=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,vge=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,yge=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,xge=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,bge=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+gge+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${vge}
      // ATTRACTION
      ${yge}  
      // VORTEX
      ${xge}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,e6=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,wge=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,_ge=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,Sge=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${wge}
  ${e6}
`,Ege=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,Age=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+e6+`  
  ${_ge}

`,Cge=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,Tge=class extends Mi{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],cn.startContext(cn.globalContext),this.lightLayer=new _l(0,"",{...Dn.defaultData("light","phong"),visible:!1},new HM,{},t.shared),cn.endContext(cn.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new ZV;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(Qhe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(Khe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(Sge),e.addFragmentParsCode(Age),e.addVertexFinalCode(Ege({easeSize:this.easeSize})),e.addFragmentFinalCode(Cge({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},yC=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=cge(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=dge(t,e*e),n=WN(i,e),s=WN(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new Gp(t*.5,32,32);break}case"TorusEmitterShape":{i=new O5(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new KP(t,t,15);break}case"BoxEmitterShape":{i=new jo(t,t,t);break}case"PlaneEmitterShape":{i=new Vl(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new Gp(t,32,32);break}default:{i=new Gp(t,32,32);break}}return new ar(i,new Wu({color:16711680}))}applyToShader(e,t){this.size=new L().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Dp(e){let t={...e},i=uw.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var Pge=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,xC=10,Mge=class extends qi{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new xZ,this.currentWorldPosition=new L,this.systemQuaternion=new Wt,this.worldGravity=new L(0,0,0),this.directionAxis=new L(0,0,0),this.colliderV3=new L(0,0,0),this.colliderQuaternion=new Wt(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new Tge(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new L(0,0,0)},uEmissionData:{value:new L(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new L(0,0,0)},uWorldQuaternion:{value:new Yt(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new Ar(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Ar(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=hge(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new ny(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(Dp({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/xC),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(Dp(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/xC),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...Dp(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*ht.DEG2RAD,Number(e[1])*ht.DEG2RAD,Number(e[2])*ht.DEG2RAD],i=new dn(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:u}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||u!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new lge(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+mge,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+bge,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",Pge,pge(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=fge({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new L(0,0,0)},uWorldQuaternion:{value:new Yt(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new L(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let u=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(u),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let h=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),c={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Yt(0,0,0,1)},uColliderPos:{value:new L(0,0,0)},uColliderSize:{value:new L(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new Yt(0,0,0,1)},uColliderQuaternionInvert:{value:new Yt(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/xC}};s.material.uniforms=c;let f={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=f;let m=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],g={...Dp(this.system.data).shape,size:m};this.emitterShape.applyToShader(n.material.uniforms,g),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new L(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new yC(i,t,e.type,r):new yC(i,t,"SphereEmitterShape")}else return new yC(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new RK(new Vl(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Dp(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},Gv=class extends js{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new St,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...Dp(t)},this.geometry.setAttribute("position",new ot([],3)),this.material=new Wu({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new Mge(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),ir(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...kn.drop(e,1).props}}),ir(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...kn.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function Dge(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var bC=Dge();function Ige(e,t,i){var n;bC!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>bC&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=bC);let r;return t.geometry.type==="TextGeometry"?new KM(e,t,i):t.geometry.type==="InputGeometry"?new nD(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Sy(e,t,i):t.geometry.type==="PathGeometry"?r=new rD(e,t,i):t.geometry.type==="VectorGeometry"?r=new age(e,t,i):t.geometry.type==="BooleanGeometry"?r=new Wd(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new qd(e,t,i):t.geometry.type==="UIGeometry"?r=new xs(e,t,i):r=new Jr(e,t,i),r)}function aD(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?Ige(e,t,i):t.type==="Empty"?new em(e,t):t.type==="Particle"?new Gv(e,t,i):t.type==="ParticleCollider"?new Hv(e,t,i):t.type==="Splat"?new em(e,t):t.type==="Bone"?new oge(e,t):t.type==="Page"?new Rn(e,t,i):t.type==="PointLight"?new sge(e,t,i):t.type==="SpotLight"?new Hj(e,t,i):t.type==="DirectionalLight"?new jj(e,t,i):t.type==="Component"||t.type==="Instance"?new tm(e,t,i):jd.is(t.type)?new ws(e,t):(console.error(t),new em(e,t))}oc.createEntity=aD;function Rge(e,t,i){let r=aD(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,u=e.overrideData,h=e.uuid,c=e.stateSelection;e.dispose();for(let f of Object.keys(e))delete e[f];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let f of Object.keys(r))e[f]=r[f];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=h,e.overrideData=u,e.updateState(e.data,i),c&&e.changeSelectedState(c,i),e.resetBBoxNeedsUpdate()}oc.changeEntityProptotype=Rge;oc.Cloner=Ja;function Oge(e,t,i,r){e.updateByOp(t,i,r,!1)}var bd=5,Wv=new St;Wv.setAttribute("position",new Bt(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var vb=class extends uZ{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:hT,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function kge(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/bd};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/bd};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/bd};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/bd};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/bd}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var yb=new kc,Lge=class{constructor(){this.pyramidPassScene=new la,this.pyramidPassMaterial=new vb({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new ar(Wv,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new tM().min.setScalar(0);let s=t.length-1,a=new Yt;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let u=o;u>=0;u--){let h=u%2===o%2?n[0]:n[1],c=u===o?r:u%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(c.texture)?c.texture[1]:c.texture,this.pyramidPassUniforms.inputWidth.value=c.width,this.pyramidPassUniforms.inputHeight.value=c.height,i.setRenderTarget(h);let f=t[u],m=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/m,0,f/m,f/m),u===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/m,0,3/m,3/m),i.render(this.pyramidPassScene,yb);let g=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=g,u<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[u+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Ao=24,Yn=96,pl=kge(),pu=2,t6=class extends Jr{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new la,this.potentialPassScene=new la,this.voxelPassScene=new la,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new St,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new ar(Wv,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new Fs(pl.triTable,16,256,ab,Ki);r.needsUpdate=!0;let n=new Fs(pl.numTrisTable,256,1,ab,Ki);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new ar(Wv,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new ar(Wv,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(Uge.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Mi({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Mi({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new L},opacity:{value:0},...a.uniforms},defines:this.material.defines});let u=this.customDistanceMaterial;u.referencePosition=new L,u.nearDistance=0,u.farDistance=0,u.opacity=1,u.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let u=this.pyramidLevelSizes.length%2===0?0:1,h=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture2Size.value=new oe(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[h].texture,this.marchPassUniforms.pyramidTexture1Size.value=new oe(this.pyramidRenderTarget[h].width,this.pyramidRenderTarget[h].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,yb),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,yb),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,yb),t6.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(u=>{this.material.wireframe&&(u*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new St,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Bt(new Float32Array(u*3*2),3)),(u*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(u*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*Ao)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*pu,this.bboxOffset=8*pu*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*pu,this.bboxOffset=4*pu*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*pu,this.bboxOffset=2*pu*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*pu,this.bboxOffset=pu*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Pi(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:br,type:Ki,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Pi(this.basePyramidSize,this.basePyramidSize,{format:br,type:Ki,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new d5(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),e.texture[0].format=br,e.texture[0].type=Ki,e.texture[1].format=ab,e.texture[1].type=Ki,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new Pi(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:br,type:Ki,stencilBuffer:!1,depthBuffer:!1,magFilter:vi,minFilter:vi}),i=new Pi(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:br,type:Ki,stencilBuffer:!1,depthBuffer:!1,magFilter:vi,minFilter:vi});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Bt(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${pl.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Ao-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${Yn}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${pl.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Ao}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Ao}.);
				pc_FragColor.z = spatialKey(lowi+${2*Ao}.);
				pc_FragColor.w = spatialKey(lowi+${3*Ao}.);
			}
		`;return new vb({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${pl.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${pl.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Ao}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/Yn};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Ao}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Ao}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Ao}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Ao}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${pl.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new vb({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${pl.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${pl.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new vb({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${pu}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${pl.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Vl(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new oe(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},qd=t6;qd.streamCompaction=new Lge;var zge=new je,Nge=new je,mp=new Wt,Nh=new L,Nx=new L,Bge=new Wt;function Fge(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];Hd.is(r)&&i6.call(r,e,t+1)}}function i6(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];Hd.is(r)&&i6.call(r,e,t+1)}}}function Uge(){if(this.shapesDataTexture.value===void 0){let a=new Fs(new Float32Array(4*Yn*bd),Yn,bd,br,Ki);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=zge.copy(this.matrixWorld).invert(),s=0;Fge.call(this,a=>{var b;if(a.visible===!1)return!0;let o;if(a instanceof Ja||a instanceof Hv||a instanceof Gv)return;a instanceof rs?o=a.object:o=a;let l=(b=a.data)==null?void 0:b.cloner;if(Si.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof Jr))return;let u=o.geometry.userData.parameters,h=u.shapeBlendNode;if(h===void 0)return;if(Nge.multiplyMatrices(n,a.matrixWorld).decompose(Nx,mp,Nh),u.type==="TorusGeometry"&&u.arc!==360){let S=u.arc*Math.PI/180;S=S/4,mp.multiply(Bge.set(0,0,Math.sin(S),Math.cos(S)))}let c=h.overrideGlobalBlend?h.blendRange:r;c=c/this.bboxSize*2,t[s*4]=(Nx.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(Nx.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(Nx.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=h.operation===0?1:h.operation===2?-1:-2,t[Yn*4+s*4]=-mp.x,t[Yn*4+s*4+1]=-mp.y,t[Yn*4+s*4+2]=-mp.z,t[Yn*4+s*4+3]=mp.w;let f=new Float32Array(4),m=0;if(u.type==="SphereGeometry")u.width===u.height&&u.width===u.depth?f[0]=0:f[0]=1,f[1]=u.width/this.bboxSize,f[2]=u.height/this.bboxSize,f[3]=u.depth/this.bboxSize,i=Math.max(i,f[1]*Nh.x+c,f[2]*Nh.x+c,f[3]*Nh.x+c);else if(u.type==="CubeGeometry"){m=u.cornerRadius;let S=u.width,_=u.height,T=u.depth;f[0]=2,f[1]=(S-2*m)/this.bboxSize,f[2]=(_-2*m)/this.bboxSize,f[3]=(T-2*m)/this.bboxSize,i=Math.max(i,Math.sqrt(S**2+_**2+T**2)/this.bboxSize*Nh.x+c)}else if(u.type==="CylinderGeometry"){m=u.cornerRadius;let S=u.height,_=u.radiusBottom,T=u.radiusTop;if(T>=_){let M=Math.atan2(T-_,S),C=(Math.PI/2-M)/2;T-=m/Math.tan(C),_-=m*Math.tan(C)}else if(_>T){let M=Math.atan2(_-T,S),C=(Math.PI/2-M)/2;T-=m*Math.tan(C),_-=m/Math.tan(C)}f[1]=(u.height-2*m)/this.bboxSize,_===T?(f[0]=3,f[2]=_/this.bboxSize*2):(f[0]=4,f[2]=_/this.bboxSize*2,f[3]=T/this.bboxSize*2),i=Math.max(i,f[1]*4*Nh.x+c)}else if(u.type==="TorusGeometry"){if(f[0]=5,f[1]=(u.width-u.depth)/this.bboxSize,f[2]=u.depth/this.bboxSize,u.arc!==360){f[0]=6,f[3]=f[1],t[Yn*12+s*4+3]=f[2];let S=2*Math.atan2(f[2]/2,f[1]),_=u.arc*Math.PI/180/2-S;f[1]=Math.sin(_),f[2]=Math.cos(_)}i=Math.max(i,u.width*Nh.x/this.bboxSize+c)}t.set(f,Yn*8+s*4),t[Yn*12+s*4]=c,t[Yn*12+s*4+1]=m/this.bboxSize*2,t[Yn*12+s*4+2]=Nh.x;let g=o.material,y=g.uniforms.nodeU0.node.value,v=g.uniforms.nodeU1.value;h.operation!==0&&!h.useColor&&(v=-1),t[Yn*16+s*4]=y.r,t[Yn*16+s*4+1]=y.g,t[Yn*16+s*4+2]=y.b,t[Yn*16+s*4+3]=v,v<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var r6=512;function qN(e,t){let i=!1,r=e.layers.mask&r6,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,QM(e),YM(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof Wm&&e.needsAO&&e.layers.enable(5),i}function XN(e,t){if(!t.layers)return!1;let i=e.layers.mask&r6,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function Vge(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Wm)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)qN(i,i.material[r])&&(t=!0);else qN(i,i.material)&&(t=!0)}),t}function jge(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Wm)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)XN(i,i.material[r])&&(t=!0);else XN(i,i.material)&&(t=!0)}),t}var Hge=new j5,Gge=new je,Wge=new Im;function Y2(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=Gge.copy(s.matrixWorld).invert(),o=Wge.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let u=Hge;u.set(o.origin,o.direction),u.near=t.near,u.far=t.far;let h=u.intersectObject(e,!1);h.length>0&&i.push({...h[0],object:r?s:e})}}var qge=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},Xge="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",uc=class{};wd(uc,"DepthMapRange",65536),wd(uc,"MemoryPageSize",65536),wd(uc,"BytesPerFloat",4),wd(uc,"BytesPerInt",4);function Yge(e){let t,i,r,n,s,a,o,l,u,h,c,f,m,g,y,v;function b(O){let N=new Float64Array(h,a,16);for(let U=0;U<16;U++)N[U]=O[U];let k;if(r>1){t.exports.sortIndexes(n,s,u,a,o,l,f.DepthMapRange,r);let U=new Uint32Array(r);k=U.buffer,U.set(new Uint32Array(h,l,r))}else if(r===1){let U=new Uint32Array(r);U[0]=new Uint32Array(h,n,i)[0],k=U.buffer}else k=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:k},[k])}function S(O,N,k){let U=new Float32Array(h,s,i*3);r=0;let Q=new Uint32Array(h,n,i);for(let se=0;se<k.length-1;se++){let K=N[se],H=O[se].elements,ie=K.filter(V=>V.enabled&&V.mode==="Include").map(V=>V.type==="Box"?C(V):D(V)),$=K.filter(V=>V.enabled&&V.mode==="Exclude").map(V=>V.type==="Box"?C(V):D(V));for(let V=k[se];V<k[se+1];V++){let X=m[V*3],ue=m[V*3+1],ne=m[V*3+2];if((ie.length===0||T(X,ue,ne,ie))&&($.length===0||!T(X,ue,ne,$))){let he=1/(H[3]*X+H[7]*ue+H[11]*ne+H[15]);U[r*3]=(H[0]*X+H[4]*ue+H[8]*ne+H[12])*he,U[r*3+1]=(H[1]*X+H[5]*ue+H[9]*ne+H[13])*he,U[r*3+2]=(H[2]*X+H[6]*ue+H[10]*ne+H[14])*he,Q[r]=V,r++}}}}function _(O,N){let k=[],U=N.filter(K=>K.enabled&&K.mode==="Include").map(K=>K.type==="Box"?C(K):D(K)),Q=N.filter(K=>K.enabled&&K.mode==="Exclude").map(K=>K.type==="Box"?C(K):D(K)),se=O.length;for(let K=0;K<se;K+=3){let H=O[K],ie=O[K+1],$=O[K+2];(U.length===0||T(H,ie,$,U))&&(Q.length===0||!T(H,ie,$,Q))||k.push(K/3)}return k}function T(O,N,k,U,Q){return U[Q==="Intersect"?"every":"some"](se=>{let K=M(O,N,k,se.invRotationMatrix,se.cropCenter);return Array.isArray(se)?E(K.x,K.y,K.z,se):I(K.x,K.y,K.z,se)})}function M(O,N,k,U,Q){let se=O-Q[0],K=N-Q[1],H=k-Q[2],ie=1/(U[3]*se+U[7]*K+U[11]*H+U[15]);return{x:(U[0]*se+U[4]*K+U[8]*H+U[12])*ie+Q[0],y:(U[1]*se+U[5]*K+U[9]*H+U[13])*ie+Q[1],z:(U[2]*se+U[6]*K+U[10]*H+U[14])*ie+Q[2]}}function C(O){let N=O.cropSize[0]/2,k=O.cropSize[1]/2,U=O.cropSize[2]/2,Q=[O.cropCenter[0]-N,O.cropCenter[1]-k,O.cropCenter[2]-U,O.cropCenter[0]+N,O.cropCenter[1]+k,O.cropCenter[2]+U],se=P(O.cropRotation);return Object.assign(Q,{invRotationMatrix:se,cropCenter:O.cropCenter})}function P(O){let N=[],k=O[0]*Math.PI/180,U=O[1]*Math.PI/180,Q=O[2]*Math.PI/180,se=Math.cos(k),K=Math.sin(k),H=Math.cos(U),ie=Math.sin(U),$=Math.cos(Q),V=Math.sin(Q),X=se*$,ue=se*V,ne=K*$,he=K*V;return N[0]=H*$,N[1]=-H*V,N[2]=ie,N[4]=ue+ne*ie,N[5]=X-he*ie,N[6]=-K*H,N[8]=he-X*ie,N[9]=ne+ue*ie,N[10]=se*H,N[12]=0,N[13]=0,N[14]=0,N[3]=0,N[7]=0,N[11]=0,N[15]=1,N}function E(O,N,k,U){return O>=U[0]&&O<=U[3]&&N>=U[1]&&N<=U[4]&&k>=U[2]&&k<=U[5]}function D(O){let N=2/O.cropSize[0],k=2/O.cropSize[1],U=2/O.cropSize[2],Q=P(O.cropRotation);return{invRadiusX:N,invRadiusY:k,invRadiusZ:U,cropCenter:O.cropCenter,invRotationMatrix:Q}}function I(O,N,k,U){let Q=(O-U.cropCenter[0])*U.invRadiusX,se=(N-U.cropCenter[1])*U.invRadiusY,K=(k-U.cropCenter[2])*U.invRadiusZ;return Q*Q+se*se+K*K<=1}e.onmessage=O=>{if(O.data.getCroppedIndexes){let N=new Uint32Array(_(new Float32Array(O.data.positions),O.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:N},[N])}else if(O.data.positions)c=O.data.positions,m=new Float32Array(c),y=O.data.meshMatrixWorlds,v=O.data.cropsArray,g=O.data.meshIndexIntervals,S(y,v,g),e.postMessage({sortSetupComplete:!0});else if(O.data.sort||O.data.newMatrixWorlds||O.data.newCropsArray)(O.data.newMatrixWorlds||O.data.newCropsArray)&&(v=O.data.newCropsArray||v,y=O.data.newMatrixWorlds||y,S(y,v,g)),b(O.data.sort.view,O.data.sort.cameraPosition);else if(O.data.init){f=O.data.init.Constants,i=O.data.init.splatCount;let N=f.BytesPerInt,k=f.BytesPerFloat*3,U=new Uint8Array(O.data.init.sorterWasmBytes),Q=N+k,se=i*Q,K=i*f.BytesPerInt*2+f.DepthMapRange*f.BytesPerInt*2,H=f.MemoryPageSize*32,ie=se+K+H,$=Math.floor(ie/f.MemoryPageSize)+1,V={module:{},env:{memory:new WebAssembly.Memory({initial:$*2,maximum:$*3,shared:!0})}};WebAssembly.compile(U).then(X=>WebAssembly.instantiate(X,V)).then(X=>{t=X,n=0,s=i*N,a=s+i*k,u=a+16*f.BytesPerFloat*2,o=u+i*f.BytesPerInt,l=o+f.DepthMapRange*f.BytesPerInt,h=V.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function Qge(e){let t=new Worker(URL.createObjectURL(new Blob(["(",Yge.toString(),")(self)"],{type:"application/javascript"}))),i=atob(Xge),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:uc.BytesPerFloat,BytesPerInt:uc.BytesPerInt,DepthMapRange:uc.DepthMapRange,MemoryPageSize:uc.MemoryPageSize}}}),t}var wC=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),Kge=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},Bx=new oe;function YN(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var xb=class extends ar{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=xb.buildGeomtery(t),o=xb.buildMaterial(n);return new xb(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new oe},viewport:{type:"v2",value:new oe},basisViewport:{type:"v2",value:new oe},debugColor:{type:"v3",value:new Nt},covariancesTextureSize:{type:"v2",value:new oe(1024,1024)},centersColorsTextureSize:{type:"v2",value:new oe(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Mi({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:Id,depthTest:!0,depthWrite:!1,side:bs})}static buildGeomtery(e){let t=new St;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Bt(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new U5().copy(t),s=new Uint32Array(e),a=new ny(s,1,!1);return a.setUsage(v7),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new oe(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new oe(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let h=0;h<this.covariances.length;h++)n[h]=YZ.toHalfFloat(this.covariances[h]);r=new Fs(n,t.x,t.y,Lb,Gu)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new Fs(n,t.x,t.y,Lb,Ki);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let h=0;h<e;h++){let c=h*4,f=h*3,m=h*4;s[m]=Kge(this.colors[c],this.colors[c+1],this.colors[c+2],this.colors[c+3]),s[m+1]=wC(this.centers[f]),s[m+2]=wC(this.centers[f+1]),s[m+3]=wC(this.centers[f+2])}let a=new Fs(s,i.x,i.y,i5,Ru);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let h=0;h<this.meshMatrixWorlds.length;h++)l.set(this.meshMatrixWorlds[h].elements,h*16);let u=new Fs(l,o,1,br,Ki);u.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=u,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:u}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(Bx.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(Bx),this.material.uniforms.basisViewport.value.set(2/Bx.x,2/Bx.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},n6,Zge=new Promise(e=>{n6=e}),QN=!1,Fx;function Jge(){if(QN)return;if(Fx)return Fx;async function e(){let t=await Es(()=>import("./gaussian-splat-compression-ro4O0smp.js"),[]);n6(t),QN=!0}return Fx=e(),Fx}var s6;Zge.then(e=>s6=e);var $ge=class{constructor(e={}){wd(this,"updateView",function(){let t=new je,i=[],r=new L(0,0,-1),n=new L(0,0,-1),s=new L,a=new L;return function(o=!1,l){let u=this.updateMatrixWorldsInWorkerIfNeeded(),h=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let f=!1,m=!1;if(n.dot(r)<=.95&&(f=!0),a.copy(l.position).sub(s).length()>=1&&(m=!0),!f&&!m&&!u&&!h&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let c={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...u?{newMatrixWorlds:this.meshMatrixWorlds}:{},...h?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=c:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(c))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new je().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new oe;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new L().fromArray(e.position)),e.orientation&&(e.orientation=new Wt().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new s6.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((u,h)=>u!==this.cropsArray[i][s][a][h])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new L,r=new Wt,n=!1,s=1,a,o){this.splatMesh=xb.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,u,h)=>this.update(l,h)}setupSortWorker(e){this.sortWorker=Qge(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},Q2=new Wu;Q2.wireframe=!0;var KN=new L,oD=class extends la{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new qge,this.invisibleObjects=new em("jflkdsafjasdifjaslk",{...t2.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new Rn("fdasfa",{...ym.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=jge(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=Vge(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Rn&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>PU(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===jm)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof Rn&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof Rn&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof xs&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof Rn&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),Io(n)&&zu(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof qd&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),zu(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Io(r)&&(r.freeBooleanPointer(),n instanceof Wd&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof rD&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),Io(r)&&(r.invalidateUpstreamBooleanData(),zu(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Wd&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof Rn&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{Oge(n,t,i,{scene:this,shared:r}),n instanceof Jr&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof xs||a instanceof Rn)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof ws&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Si.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Si.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=py(l.data,u=>{let h=u.events.data(a.id),c=l.goUp(s);if(c){let f=[...TU(c.identity),e].join("-"),m=this.entityIdentityToEntity[f];if(m){let g=m.uuid,y=fn.zoom(h,t);y[i]=g}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof tm&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=py(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of vw.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof tm&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),sD(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof tm&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Si.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Si.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let u=s.matrixWorld.clone().invert();l.point.applyMatrix4(u),i.push(l)}}else(Io(s)||N2(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),Y2(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Si.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Io(n)||N2(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),Y2(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Si.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Si.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Si.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Jr&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();zu(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)Hd.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Si.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=aD(e,t,a);return o instanceof qd&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof Jr&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(u=>{let h=u.dataPatched;if(u instanceof Jr&&h.bones&&h.boneInverses){let c=h.bones.map(g=>this.find(g)),f=h.boneInverses.map(g=>new je().fromArray(g)),m=new qP(c,f);u.bind(m,u.bindMatrix)}else u.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new jr;return i.setFromPoints(t),i.getCenter(KN),KN}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof js)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Ec&&e(t.material[i]);else t.material instanceof Ec&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof ws&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new $ge({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},bb=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},eve=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return ive(Math.atan2(r,i))},tve=(e,t,i)=>{let r={x:0,y:0};return i=K2(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},K2=e=>e*(Math.PI/180),ive=e=>e*(180/Math.PI),rve=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,_C=new Map,ZN=e=>{_C.has(e)&&clearTimeout(_C.get(e)),_C.set(e,setTimeout(e,100))},kw=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},JN=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},a6=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),$N=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},Z2=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},lD=(e,t,i)=>{let r=o6(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},nve=(e,t)=>{let i=o6(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},o6=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},SC=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},sve=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},J2=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},ave=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(l6="ontouchstart"in window,u6=!!window.PointerEvent,h6=!!window.MSPointerEvent);var l6,u6,h6,av={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Vp,Ey={};u6?Vp=av.pointer:h6?Vp=av.MSPointer:l6?(Vp=av.touch,Ey=av.mouse):Vp=av.mouse;function af(){}af.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};af.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};af.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};af.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=sve(t.options,e))};af.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},kw(e,Vp[t],i._domHandlers_[t]),Ey[t]&&kw(e,Ey[t],i._domHandlers_[t]),i};af.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},JN(e,Vp[t],i._domHandlers_[t]),Ey[t]&&JN(e,Ey[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var uD=af;function bn(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=bn.id,bn.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}bn.prototype=new uD;bn.constructor=bn;bn.id=0;bn.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};bn.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=nve("borderRadius","50%"),i=lD("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},SC(r.el,i),this.options.shape==="circle"&&SC(r.back,t),SC(r.front,t),this.applyStyles(r),this};bn.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};bn.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};bn.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};bn.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};bn.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};bn.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};bn.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=lD("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};bn.prototype.restCallback=function(){var e=this,t={};t.front=lD("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};bn.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};bn.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var u={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(u[l]=!0);if(u.x&&u.y&&u.angle)return e;(!u.x||!u.y)&&this.trigger("plain",e),u.x||this.trigger("plain:"+s,e),u.y||this.trigger("plain:"+a,e),u.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var ove=bn;function Hr(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=Hr.id,Hr.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Hr.prototype=new uD;Hr.constructor=Hr;Hr.id=0;Hr.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};Hr.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};Hr.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};Hr.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var u=new ove(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(Z2(u.ui.el,n),Z2(u.ui.front,u.frontPosition)),i.nipples.push(u),i.trigger("added "+u.identifier+":added",u),i.manager.trigger("added "+u.identifier+":added",u),i.bindNipple(u),u};Hr.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};Hr.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Hr.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};Hr.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=a6(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return J2(e,n),t.manager.bindDocument(),!1};Hr.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(h){h.trigger("start",h),t.trigger("start "+h.id+":start",h),h.show(),s>0&&t.pressureFn(e,h,h.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var u=bb(a,o.position);if(u<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};Hr.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};Hr.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!rve(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var u=bb(l,n.position),h=eve(l,n.position),c=K2(h),f=u/o,m={distance:u,position:l},g,y;if(n.options.shape==="circle"?(g=Math.min(u,o),y=tve(n.position,g,h)):(y=ave(l,n.position,o),g=bb(y,n.position)),i.follow){if(u>o){let _=l.x-y.x,T=l.y-y.y;n.position.x+=_,n.position.y+=T,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",u=bb(l,n.position)}}else l=y,u=g;var v=l.x-n.position.x,b=l.y-n.position.y;n.frontPosition={x:v,y:b},i.dataOnly||Z2(n.ui.front,n.frontPosition);var S={identifier:n.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:c,degree:h},vector:{x:v/o,y:-b/o},raw:m,instance:n,lockX:i.lockX,lockY:i.lockY};S=n.computeDirection(S),S.angle={radian:K2(180-h),degree:180-h},n.trigger("move",S),t.trigger("move "+n.id+":move",S)};Hr.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};Hr.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};Hr.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var lve=Hr;function Fn(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=$N(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;kw(window,"resize",function(){ZN(i)});var r=function(){t.scroll=$N()};return kw(window,"scroll",function(){ZN(r)}),t.collections}Fn.prototype=new uD;Fn.constructor=Fn;Fn.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};Fn.prototype.create=function(e){return this.createCollection(e)};Fn.prototype.createCollection=function(e){var t=this,i=new lve(t,e);return t.bindCollection(i),t.collections.push(i),i};Fn.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Fn.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Fn.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Fn.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Fn.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Fn.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Fn.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Fn.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Fn.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=a6(t);var s=function(o,l,u){u.ids.indexOf(l)>=0&&(u[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),J2(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return J2(t,a),!1};Fn.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Fn.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var uve=Fn,eB=new uve,hve={create:function(e){return eB.create(e)},factory:eB},c6=new Map,qv=new Map,Pd=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new Tv({src:l,volume:s,delay:a,loop:o}),qv.has(i.uuid)?qv.get(i.uuid).push(this):qv.set(i.uuid,[this]),c6.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},$2=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=c6.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=qv.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...qv.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},d6=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new Pd(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new $2(t);else throw new Error("Missing property")}dispatchBasic(){if(cr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Pd?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(cr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Pd?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(cr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Pd&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},f6=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(cr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(cr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(cr(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},cve="text/plain",dve="us-ascii",tB=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),fve=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),u=[...a.map(h=>{let[c,f=""]=h.split("=").map(m=>m.trim());return c==="charset"&&(f=f.toLowerCase(),f===dve)?"":`${c}${f?`=${f}`:""}`}).filter(Boolean)];return o&&u.push("base64"),(u.length>0||l&&l!==cve)&&u.unshift(l),`data:${u.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function pve(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return fve(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let u=s.exec(r.pathname);if(!u)break;let h=u[0],c=u.index,f=r.pathname.slice(a,c);o+=f.replace(/\/{2,}/g,"/"),o+=h,a=c+h.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];tB(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])tB(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var mve=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:pve(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(cr(this.shared,this.condition)===!1)return!1;Xy?window.location.assign(this.url):(this.context==="tab"||CU&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(Vt[0]),_ae())}},p6=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var u,h;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(u=a.dataPatched.physics)==null?void 0:u.fusedBody:!0;if(a.cloner){for(let c of a.cloner.children)l?(c.playModeVisible=!1,c.rigidBody&&((h=a.dataPatched.physics)==null?void 0:h.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0)):this.clone===void 0||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):c.playModeVisible===void 0&&(c.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(cr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(cr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},m6=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(cr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),bD(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},g6={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},hD={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},gve=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Lw={CSS:{},springs:{}};function Lo(e,t,i){return Math.min(Math.max(e,t),i)}function Xv(e,t){return e.indexOf(t)>-1}function EC(e,t){return e.apply(null,t)}var qt={arr:function(e){return Array.isArray(e)},obj:function(e){return Xv(Object.prototype.toString.call(e),"Object")},pth:function(e){return qt.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||qt.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return qt.hex(e)||qt.rgb(e)||qt.hsl(e)},key:function(e){return!g6.hasOwnProperty(e)&&!hD.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function v6(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function y6(e,t){var i=v6(e),r=Lo(qt.und(i[0])?1:i[0],.1,100),n=Lo(qt.und(i[1])?100:i[1],.1,100),s=Lo(qt.und(i[2])?10:i[2],.1,100),a=Lo(qt.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),u=l<1?o*Math.sqrt(1-l*l):0,h=1,c=l<1?(l*o+-a)/u:-a+o;function f(g){var y=t?t*g/1e3:g;return l<1?y=Math.exp(-y*l*o)*(h*Math.cos(u*y)+c*Math.sin(u*y)):y=(h+c*y)*Math.exp(-y*o),g===0||g===1?g:1-y}function m(){var g=Lw.springs[e];if(g)return g;for(var y=1/6,v=0,b=0;;)if(v+=y,f(v)===1){if(b++,b>=16)break}else b=0;var S=v*y*1e3;return Lw.springs[e]=S,S}return t?f:m}function vve(e){return e===void 0&&(e=10),function(t){return Math.ceil(Lo(t,1e-6,1)*e)*(1/e)}}var yve=function(){var e=11,t=1/(e-1);function i(h,c){return 1-3*c+3*h}function r(h,c){return 3*c-6*h}function n(h){return 3*h}function s(h,c,f){return((i(c,f)*h+r(c,f))*h+n(c))*h}function a(h,c,f){return 3*i(c,f)*h*h+2*r(c,f)*h+n(c)}function o(h,c,f,m,g){var y,v,b=0;do v=c+(f-c)/2,y=s(v,m,g)-h,y>0?f=v:c=v;while(Math.abs(y)>1e-7&&++b<10);return v}function l(h,c,f,m){for(var g=0;g<4;++g){var y=a(c,f,m);if(y===0)return c;var v=s(c,f,m)-h;c-=v/y}return c}function u(h,c,f,m){if(!(0<=h&&h<=1&&0<=f&&f<=1))return;var g=new Float32Array(e);if(h!==c||f!==m)for(var y=0;y<e;++y)g[y]=s(y*t,h,f);function v(b){for(var S=0,_=1,T=e-1;_!==T&&g[_]<=b;++_)S+=t;--_;var M=(b-g[_])/(g[_+1]-g[_]),C=S+M*t,P=a(C,h,f);return P>=.001?l(b,C,h,f):P===0?C:o(b,S,S+t,h,f)}return function(b){return h===c&&f===m||b===0||b===1?b:s(v(b),c,m)}}return u}(),x6=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Lo(r,1,10),a=Lo(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function cD(e,t){if(qt.fnc(e))return e;var i=e.split("(")[0],r=x6[i],n=v6(e);switch(i){case"spring":return y6(e,t);case"cubicBezier":return EC(yve,n);case"steps":return EC(vve,n);default:return EC(r,n)}}function b6(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function N_(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function B_(e){return e.reduce(function(t,i){return t.concat(qt.arr(i)?B_(i):i)},[])}function iB(e){return qt.arr(e)?e:(qt.str(e)&&(e=b6(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function dD(e,t){return e.some(function(i){return i===t})}function fD(e){var t={};for(var i in e)t[i]=e[i];return t}function eP(e,t){var i=fD(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function F_(e,t){var i=fD(e);for(var r in t)i[r]=qt.und(e[r])?t[r]:e[r];return i}function xve(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function bve(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,u,h){return l+l+u+u+h+h}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function wve(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(f,m,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?f+(m-f)*6*g:g<1/2?m:g<2/3?f+(m-f)*(2/3-g)*6:f}var o,l,u;if(r==0)o=l=u=n;else{var h=n<.5?n*(1+r):n+r-n*r,c=2*n-h;o=a(c,h,i+1/3),l=a(c,h,i),u=a(c,h,i-1/3)}return"rgba("+o*255+","+l*255+","+u*255+","+s+")"}function _ve(e){if(qt.rgb(e))return xve(e);if(qt.hex(e))return bve(e);if(qt.hsl(e))return wve(e)}function Uu(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function Sve(e){if(Xv(e,"translate")||e==="perspective")return"px";if(Xv(e,"rotate")||Xv(e,"skew"))return"deg"}function tP(e,t){return qt.fnc(e)?e(t.target,t.id,t.total):e}function Dl(e,t){return e.getAttribute(t)}function pD(e,t,i){var r=Uu(t);if(dD([i,"deg","rad","turn"],r))return t;var n=Lw.CSS[t+i];if(!qt.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var u=l*parseFloat(t);return Lw.CSS[t+i]=u,u}function w6(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?pD(e,n,i):n}}function mD(e,t){if(qt.dom(e)&&!qt.inp(e)&&(Dl(e,t)||qt.svg(e)&&e[t]))return"attribute";if(qt.dom(e)&&dD(gve,t))return"transform";if(qt.dom(e)&&t!=="transform"&&w6(e,t))return"css";if(e[t]!=null)return"object"}function _6(e){if(qt.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function Eve(e,t,i,r){var n=Xv(t,"scale")?1:0+Sve(t),s=_6(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?pD(e,s,r):s}function gD(e,t,i,r){switch(mD(e,t)){case"transform":return Eve(e,t,r,i);case"css":return w6(e,t,i);case"attribute":return Dl(e,t);default:return e[t]||0}}function vD(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Uu(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function S6(e,t){if(qt.col(e))return _ve(e);if(/\s/g.test(e))return e;var i=Uu(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function yD(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Ave(e){return Math.PI*2*Dl(e,"r")}function Cve(e){return Dl(e,"width")*2+Dl(e,"height")*2}function Tve(e){return yD({x:Dl(e,"x1"),y:Dl(e,"y1")},{x:Dl(e,"x2"),y:Dl(e,"y2")})}function E6(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=yD(r,s)),r=s}return i}function Pve(e){var t=e.points;return E6(e)+yD(t.getItem(t.numberOfItems-1),t.getItem(0))}function A6(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return Ave(e);case"rect":return Cve(e);case"line":return Tve(e);case"polyline":return E6(e);case"polygon":return Pve(e)}}function Mve(e){var t=A6(e);return e.setAttribute("stroke-dasharray",t),t}function Dve(e){for(var t=e.parentNode;qt.svg(t)&&qt.svg(t.parentNode);)t=t.parentNode;return t}function C6(e,t){var i=t||{},r=i.el||Dve(e),n=r.getBoundingClientRect(),s=Dl(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function Ive(e,t){var i=qt.str(e)?b6(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:C6(i),totalLength:A6(i)*(r/100)}}}function Rve(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=C6(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function rB(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=S6(qt.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:qt.str(e)||t?r.split(i):[]}}function T6(e){var t=e?B_(qt.arr(e)?e.map(iB):iB(e)):[];return N_(t,function(i,r,n){return n.indexOf(i)===r})}function P6(e){var t=T6(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:_6(i)}}})}function Ove(e,t){var i=fD(t);if(/^spring/.test(i.easing)&&(i.duration=y6(i.easing)),qt.arr(e)){var r=e.length,n=r===2&&!qt.obj(e[0]);n?e={value:e}:qt.fnc(t.duration)||(i.duration=t.duration/r)}var s=qt.arr(e)?e:[e];return s.map(function(a,o){var l=qt.obj(a)&&!qt.pth(a)?a:{value:a};return qt.und(l.delay)&&(l.delay=o?0:t.delay),qt.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return F_(a,i)})}function kve(e){for(var t=N_(B_(e.map(function(s){return Object.keys(s)})),function(s){return qt.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var u in o)qt.key(u)?u==a&&(l.value=o[u]):l[u]=o[u];return l})},n=0;n<t.length;n++)r(n);return i}function Lve(e,t){var i=[],r=t.keyframes;r&&(t=F_(kve(r),t));for(var n in t)qt.key(n)&&i.push({name:n,tweens:Ove(t[n],e)});return i}function zve(e,t){var i={};for(var r in e){var n=tP(e[r],t);qt.arr(n)&&(n=n.map(function(s){return tP(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function Nve(e,t){var i;return e.tweens.map(function(r){var n=zve(r,t),s=n.value,a=qt.arr(s)?s[1]:s,o=Uu(a),l=gD(t.target,e.name,o,t),u=i?i.to.original:l,h=qt.arr(s)?s[0]:u,c=Uu(h)||Uu(l),f=o||c;return qt.und(a)&&(a=u),n.from=rB(h,f),n.to=rB(vD(a,h),f),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=cD(n.easing,n.duration),n.isPath=qt.pth(s),n.isColor=qt.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var M6={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function D6(e,t){var i=P6(e);i.forEach(function(r){for(var n in t){var s=tP(t[n],r),a=r.target,o=Uu(s),l=gD(a,n,o,r),u=o||Uu(l),h=vD(S6(s,u),l),c=mD(a,n);M6[c](a,n,h,r.transforms,!0)}})}function Bve(e,t){var i=mD(e.target,t.name);if(i){var r=Nve(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function Fve(e,t){return N_(B_(e.map(function(i){return t.map(function(r){return Bve(i,r)})})),function(i){return!qt.und(i)})}function I6(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var nB=0;function Uve(e){var t=eP(g6,e),i=eP(hD,e),r=Lve(i,e),n=P6(e.targets),s=Fve(n,r),a=I6(s,i),o=nB;return nB++,F_(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var to=[],sB=[],wb,Vve=function(){function e(){wb=requestAnimationFrame(t)}function t(i){var r=to.length;if(r){for(var n=0;n<r;){var s=to[n];s.paused?(to.splice(n,1),r-=1):(s.tick(i),n++)}e()}else wb=cancelAnimationFrame(wb)}return e}();function jve(e){document.hidden?(to.forEach(function(t){return t.pause(e.timeStamp)}),sB=to.slice(0),Vr.running=to=[]):sB.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",jve);function Vr(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(C){var P=window.Promise&&new Promise(function(E){return o=E});return C.finished=P,P}var u=Uve(e);l(u);function h(){var C=u.direction;C!=="alternate"&&(u.direction=C!=="normal"?"normal":"reverse"),u.reversed=!u.reversed,s.forEach(function(P){(P.loop===1||P.loop%2===0)&&(P.reversed=u.reversed)})}function c(){u.direction="normal",u.reversed=!1,s.forEach(function(C){return C.reversed=!1})}function f(C){return u.reversed?u.duration-C:C}function m(){t=0,i=f(u.currentTime)*(1/Vr.speed)}function g(C,P,E=!1){P&&(u.reversed?P.seek(P.duration*P.loop-(C-P.timelineOffset-P.pingPongDelayCorrection),E):P.seek(C-P.timelineOffset-P.startOnceDelay-P.pingPongDelayCorrection,E))}function y(C,P=!1){if(u.reversed)for(var E=a;E--;)g(C,s[E],P);else for(var D=0;D<a;D++)g(C,s[D],P)}function v(C){var me,de,fe,ye,Te,Ie,Ne,st,We,ct;var P=0,E=u.animations,D=E.length;for(u.direction!=="alternate"&&((me=u.parent)==null?void 0:me.direction)==="alternate"?((de=u.parent)==null?void 0:de.rewind)===!1&&u.reversePlayback===!0&&u.rewind===!1&&((fe=u.parent)!=null&&fe.reversed&&u.direction==="alternate"?C=u.duration-u.delay+u.endDelay-C:C=u.duration+u.delay-u.endDelay-C):T(!1,(ye=u.parent)==null?void 0:ye.rewind,u.rewind,(Te=u.parent)==null?void 0:Te.reversePlayback,u.reversePlayback)&&((Ie=u.parent)!=null&&Ie.reversed&&u.direction==="alternate"?C=u.duration-u.delay+u.endDelay-C:C=u.duration+u.delay-u.endDelay-C);P<D;){var I=E[P],O=I.animatable,N=I.tweens,k=N.length-1,U=N[k];k&&(U=N_(N,function(Ke){return C<Ke.end})[0]||U);let ut;(Ne=u.parent)!=null&&Ne.reversed&&u.direction==="alternate"?ut=Lo(C-U.start-U.endDelay,0,U.duration)/U.duration:ut=Lo(C-U.start-U.delay,0,U.duration)/U.duration;for(var Q=isNaN(ut)?1:U.easing(ut),se=U.to.strings,K=U.round,H=[],ie=U.to.numbers.length,$=void 0,V=0;V<ie;V++){var X=void 0;let Ke,Ye;u.direction!=="alternate"?((st=u.parent)==null?void 0:st.rewind)===!1&&u.reversePlayback===!0&&u.rewind===!1?(Ke=U.to.numbers[V],Ye=U.from.numbers[V]||0):(Ye=U.to.numbers[V],Ke=U.from.numbers[V]||0):T(!0,(We=u.parent)==null?void 0:We.rewind,u.rewind,(ct=u.parent)==null?void 0:ct.reversePlayback,u.reversePlayback)?(Ke=U.to.numbers[V],Ye=U.from.numbers[V]||0):(Ye=U.to.numbers[V],Ke=U.from.numbers[V]||0),U.isPath?X=Rve(U.value,Q*Ye):X=Ke+Q*(Ye-Ke),K&&(U.isColor&&V>2||(X=Math.round(X*K)/K)),H.push(X)}var ue=se.length;if(!ue)$=H[0];else{$=se[0];for(var ne=0;ne<ue;ne++){se[ne];var he=se[ne+1],te=H[ne];isNaN(te)||(he?$+=te+he:$+=te+" ")}}M6[I.type](O.target,I.property,$,O.transforms),I.currentValue=$,P++}}function b(C){u[C]&&!u.passThrough&&u[C](u)}function S(){u.remaining&&u.remaining!==!0&&u.remaining--}let _={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function T(C,P,E,D,I){return _[C<<4|P<<3|E<<2|D<<1|I]}function M(C,P=!1){var N;var E=u.duration;let D=u.delay,I=E-u.endDelay;(N=u.parent)!=null&&N.reversed&&u.direction==="alternate"&&(D=u.endDelay,I=E-u.delay);var O=f(C);if(u.progress=Lo(O/E*100,0,100),P||(u.reversePlayback=O<u.currentTime),a&&y(O,P),!u.began&&u.currentTime>=0&&(u.began=!0,b("begin")),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,b("loopBegin")),(u.reversed||O>=0)&&O<=D&&u.currentTime!==0&&(v(0),b("change")),(O>=I&&u.currentTime!==E+u.pingPongDelayCorrection||!E)&&(v(E),b("change")),O>D&&O<I?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,b("changeBegin")),v(O),b("change")):u.changeBegan?(u.changeCompleted=!0,u.changeBegan=!1,b("change"),a&&b("timelineChangeComplete")):u.began&&O>I&&b("changeComplete"),u.currentTime=Lo(O,0,E+u.pingPongDelayCorrection),u.began&&b("update"),C>=E)if(S(),!u.remaining)u.paused=!0,u.completed||(u.completed=!0,b("loopComplete"),b("complete"),!u.passThrough&&"Promise"in window&&(o(),l(u)));else{a?t+=u.duration/Vr.speed:t+=u.duration;for(let k of s)k.setStartTime(0),k.remaining=k.loop;b("loopComplete"),u.loopBegan=!1,u.direction==="alternate"?h():a&&c()}}return u.reset=function(){var C=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversePlayback=!1,u.reversed=C==="reverse",u.remaining=u.loop,s=u.children,a=s.length;for(var P=a;P--;)u.children[P].reset();v(u.reversed?u.duration:0)},u.setStartTime=function(C){t=C},u.set=function(C,P){return D6(C,P),u},u.tick=function(C){r=C,t||(t=r),M((r+(i-t))*Vr.speed)},u.seek=function(C,P=!1){M(C-t,P)},u.pause=function(C){u.paused=!0,a&&(n=C??performance.now())},u.play=function(C){!u.paused||(u.completed&&u.reset(),u.paused=!1,to.push(u),a&&n!==void 0&&(t+=(C??performance.now())-n),wb||Vve())},u.reverse=function(){h(),u.completed=!u.reversed,m()},u.restart=function(){u.reset(),u.play()},u.reset(),u.autoplay&&u.play(),u}function aB(e,t){for(var i=t.length;i--;)dD(e,t[i].animatable.target)&&t.splice(i,1)}function Hve(e){for(var t=T6(e),i=to.length;i--;){var r=to[i],n=r.animations,s=r.children;aB(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;aB(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function Gve(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?cD(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",u=a==="last",h=qt.arr(e),c=parseFloat(h?e[0]:e),f=h?parseFloat(e[1]):0,m=Uu(h?e[1]:e)||0,g=t.start||0+(h?c:0),y=[],v=0;return function(b,S,_){if(o&&(a=0),l&&(a=(_-1)/2),u&&(a=_-1),!y.length){for(var T=0;T<_;T++){if(!n)y.push(Math.abs(a-T));else{var M=l?(n[0]-1)/2:a%n[0],C=l?(n[1]-1)/2:Math.floor(a/n[0]),P=T%n[0],E=Math.floor(T/n[0]),D=M-P,I=C-E,O=Math.sqrt(D*D+I*I);s==="x"&&(O=-D),s==="y"&&(O=-I),y.push(O)}v=Math.max.apply(Math,y)}r&&(y=y.map(function(k){return r(k/v)*v})),i==="reverse"&&(y=y.map(function(k){return s?k<0?k*-1:-k:Math.abs(v-k)}))}var N=h?(f-c)/v:c;return g+N*(Math.round(y[S]*100)/100)+m}}function Wve(e){e===void 0&&(e={});var t=Vr(e);return t.duration=0,t.add=function(i,r){var n=to.indexOf(t),s=t.children;n>-1&&to.splice(n,1);function a(f){f.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=F_(i,eP(hD,e));l.targets=l.targets||e.targets;var u=t.duration;l.autoplay=!1,l.timelineOffset=qt.und(r)?u:vD(r,u),a(t);var h=Vr(l);a(h),s.push(h),h.parent=t;var c=I6(s,e);return t.delay=c.delay,t.endDelay=c.endDelay,t.duration=c.duration,h.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}Vr.version="3.2.0";Vr.speed=1;Vr.running=to;Vr.remove=Hve;Vr.get=gD;Vr.set=D6;Vr.convertPx=pD;Vr.path=Ive;Vr.setDashoffset=Mve;Vr.stagger=Gve;Vr.timeline=Wve;Vr.easing=cD;Vr.penner=x6;Vr.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var R6=Vr,oB=new L,lB=new L,uB=new Wt;function qve(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let h=1-r;return i.w=h*e.w+r*t.w,i.x=h*e.x+r*t.x,i.y=h*e.y+r*t.y,i.z=h*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,u=Math.sin(r*o)/a;return i.w=e.w*l+t.w*u,i.x=e.x*l+t.x*u,i.y=e.y*l+t.y*u,i.z=e.z*l+t.z*u,i}function Kn(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],u=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==u)return{update:h=>{let c=ht.lerp(l,u,h);s?t[e]=Math.trunc(c):t[e]=c},start:()=>{t[e]=l},end:()=>{t[e]=u}}}function xD(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],u=[...a??l].map(c=>typeof c=="string"?Number(n.getVariable(c)??0):c),h=[...o].map(c=>typeof c=="string"?Number(n.getVariable(c)??0):c);if(!(u.length!==h.length||yM(u,h)))return{update:c=>{u.forEach((f,m)=>{let g=ht.lerp(f,h[m],c);t[e][m]=s?Math.trunc(g):g})},start:()=>{Object.assign(t[e],u)},end:()=>{Object.assign(t[e],h)}}}function zw(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function hB(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?zw(new L,s,n):o.clone(),u=zw(new L,a,n);if(!l.equals(u))return{update:h=>{o.lerpVectors(l,u,h)},start:()=>{o.copy(l)},end:()=>{o.copy(u)}}}function cB(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function Nw(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof oe),u=o instanceof oe?o:new oe().fromArray(o),h=s?cB(new oe,s,n):u.clone(),c=cB(new oe,a,n);if(!h.equals(c))return{update:f=>{u.lerpVectors(h,c,f),l&&(t[e]=u.toArray())},start:()=>{u.copy(h),l&&(t[e]=u.toArray())},end:()=>{u.copy(c),l&&(t[e]=u.toArray())}}}function Xve(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new je().fromArray(n):a.clone(),l=new L,u=new Wt,h=new L;o.decompose(l,u,h);let c=new je().fromArray(s),f=new L,m=new Wt,g=new L;if(c.decompose(f,m,g),!o.equals(c))return{update:y=>{uB.slerpQuaternions(u,m,y),oB.lerpVectors(l,f,y),lB.lerpVectors(h,g,y),a.compose(oB,uB,lB)},start:()=>{a.compose(l,u,h)},end:()=>{a.compose(f,m,g)}}}function Yve(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new Nt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new Nt().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let h=o.clone();return{update:c=>{var f,m;h.lerpColors(l,u,c),(m=(f=t[e])==null?void 0:f.copy)==null||m.call(f,h)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function Ux(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new ns(o.r,o.g,o.b,o.a),u=s?typeof s=="string"?n.getColor(s).clone():new ns(s.r,s.g,s.b,s.a):l.clone(),h=typeof a=="string"?n.getColor(a).clone():new ns(a.r,a.g,a.b,a.a);if(!u.equals(h))return{update:c=>{l.lerpColors(u,h,c);let f=ht.lerp(u.a,h.a,c);l.a=f,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(u)},end:()=>{l.copy(h)}}}function zc(e,t,i,r,n){if(typeof t[e]=="number")return Kn(e,t,i??{},r,n);if(Array.isArray(t[e]))return xD(e,t,i??{},r,n)}function Qve(e,t,i,r){var o,l,u,h;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(u=i.orthographic)==null?void 0:u.zoom:(h=i.perspective)==null?void 0:h.zoom;if(a!==void 0){let c=s??e.zoom,f=a;c!==f&&n.push({update:m=>{e.zoom=ht.lerp(c,f,m),e.updateProjectionMatrix()},start:()=>{e.zoom=c,e.updateProjectionMatrix()},end:()=>{e.zoom=f,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let c=Kn("targetOffset",e,t,i,r);c&&n.push(c)}return n}function Kve(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Ld.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[ht.lerp(n[0],s[0],o),ht.lerp(n[1],s[1],o),ht.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function Zve(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return uV.forEach(l=>{let u=zc(l,n,s,a,r);u&&o.push(u)}),o}function Jve(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof Sy){let l=Kve(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,kl(s,DA),kl(a,DA)),DA.forEach(u=>{let h=zc(u,l,a,o,r);h&&n.push(h)}),e instanceof rD){Object.assign(l,{extrusion:{...s.extrusion}});let u=Zve(l,a,o,r);u&&n.push(...u)}n.length&&n.push({update:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:u=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function $ve(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=Kn("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=Yve("color",e,t,i,r);s&&n.push(s)}return n}function eye(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let u=s[l]??{},h=a[l];typeof u=="string"||typeof h=="string"||n.push(...dB(o,u,h,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...dB(e.material,s,a,r))}return n}function dB(e,t,i,r){var a;let n=[],s=Up(i,r)||!!t.layers&&Up(t,r);n.push(uye(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),u=i.layers.data(o.uuid);if(!u||o.type!=="light"&&(!(o.visible??!0)||!(u.visible??!0)))continue;let h=o.getNames().filter(c=>!aV.some(f=>c.includes(f)));for(let c of h)try{let f=o.getValue(c),m;if(c==="colors")m=oye(o,l,u,c);else if(Array.isArray(f))c==="steps"&&(m=aye(o,l,u,c));else if(typeof f=="number")m=tye(o,l,u,c,r);else{if(typeof f=="boolean")continue;f instanceof oe?m=iye(o,l,u,c):f instanceof L?m=rye(o,l,u,c,r):f instanceof ns?m=sye(o,l,u,c,r):f instanceof Nt?m=nye(o,l,u,c,r):"isTexture"in f&&(m=lye(o,l,u,c))}m&&(Array.isArray(m)?n.push(...m):n.push(m))}catch(f){console.error(`lerpMaterial: unexpected material layer for ${c}`,f)}}return n}function tye(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:u=>{e.setValue(r,ht.lerp(o,l,u))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function iye(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new oe().fromArray(t[r]):n.clone(),a=new oe().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function rye(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?zw(new L,a,n):s.clone(),u=zw(new L,o,n);if(!l.equals(u))return{update:h=>{s.lerpVectors(l,u,h)},start:()=>{s.copy(l)},end:()=>{s.copy(u)}}}function nye(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Nt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new Nt().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let h=o.clone();return{update:c=>{e.getValue(r)!==h&&e.setValue(r,h),h.lerpColors(l,u,c)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function sye(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Nt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new ns(a.r,a.g,a.b,a.a);if(l.equals(u))return;let h=o.clone();return{update:c=>{e.getValue(r)!==h&&e.setValue(r,h),h.lerpColors(l,u,c)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function aye(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return yM(a,o)||n.push({update:l=>{let u=[...s];for(let h=0;h<s.length;++h){let c=a[h],f=o[h];u[h]=ht.lerp(c,f,l)}e.setValue(r,u)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function oye(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let u=[...a[l]],h=[...o[l]];lw.isEqual(u,h)||n.push({update:c=>{s[l].fromArray(lw.lerp(u,h,c))},start:()=>{s[l].fromArray(u)},end:()=>{s[l].fromArray(h)}})}return n.length?n:void 0}function lye(e,t,i,r="texture"){var v,b;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((v=t==null?void 0:t[r])==null?void 0:v.rotation)??0,a=((b=i[r])==null?void 0:b.rotation)??0;if(n&&s!==a)return{update:S=>{n.value=ht.lerp(s,a,S)*ht.DEG2RAD},start:()=>{n.value=s*ht.DEG2RAD},end:()=>{n.value=a*ht.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,u=i[r],h=[...l.repeat],c=[...l.offset],f=[...u.repeat],m=[...u.offset],g=l.rotation??0,y=u.rotation??0;if(!Lu.isEqual(h,f)||!Lu.isEqual(c,m)||g!==y)return{update:S=>{o.repeat=Lu.lerp(h,f,S),o.offset=Lu.lerp(c,m,S),o.rotation=ht.lerp(g,y,S),o.updateMatrix()},start:()=>{o.repeat=[...h],o.offset=[...c],o.rotation=g,o.updateMatrix()},end:()=>{o.repeat=[...f],o.offset=[...m],o.rotation=y,o.updateMatrix()}}}function uye(e,t){return{update:()=>{e.transparent=t}}}var AC=new L,fB=new dn;function hye(e,t,i,r,n){var g,y,v,b,S,_;let s=[],a,o,l,u,h,c,f,m;if(e instanceof Bn?(a=Nw("position",e,t,i,n),a&&s.push(a),l=Kn("rotation",e,t,i,n),l&&s.push(l),u=Nw("shear",e,t,i,n),u&&s.push(u)):(m={slide:((g=t.pathSnapping)==null?void 0:g.slide)??((y=e.updatedPathSnapping)==null?void 0:y.slide)??((v=e.dataPatched.pathSnapping)==null?void 0:v.slide)??0,offset:((b=t.pathSnapping)==null?void 0:b.offset)??((S=e.updatedPathSnapping)==null?void 0:S.offset)??((_=e.dataPatched.pathSnapping)==null?void 0:_.offset)??0},c=Kn("slide",m,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),c&&s.push(c),f=Kn("offset",m,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),f&&s.push(f),!c&&!f&&(a=hB("position",e,t,i,n),a&&s.push(a),o=hB("scale",e,t,i,n),o&&s.push(o),l=cye(e,t,i,r,n),l&&s.push(l),h=Xve("hiddenMatrix",e,t,i),h&&s.push(h))),a||o||l||h||c||f){let T=e instanceof Bn?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var M;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(M=e.parent)!=null&&M.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Io(e)&&zu(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,m))};s.push({update:T,start:T,end:T})}return s}function cye(e,t,i,r,n){var h;let s=t!=null&&t.rotation?t.rotation.map(c=>(typeof c=="string"?Number(n.getVariable(c)??0):c)*ht.DEG2RAD):void 0,a=(h=i.rotation)==null?void 0:h.map(c=>(typeof c=="string"?Number(n.getVariable(c)??0):c)*ht.DEG2RAD);if(!a)return;let o=s?new L().fromArray(s):new L().setFromEuler(e.rotation),l=new L().fromArray(a);if(o.equals(l))return;let u=AC.subVectors(l,o);if(r&&u.toArray().every(c=>Math.abs(c)<2*Math.PI)){let c=new Wt().setFromEuler(fB.setFromVector3(o)),f=new Wt().setFromEuler(fB.setFromVector3(l));return{update:m=>{qve(c,f,e.quaternion,m)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:c=>{AC.lerpVectors(o,l,c),e.rotation.setFromVector3(AC)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function dye(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;eV.forEach(m=>{let g;m==="count"?g=Kn("count",s.parameters,a,o,r,!0):g=zc(m,s.parameters,a??{},o,r),g&&n.push(g)});let l=fye(s,a,o,r);l!=null&&l.length&&n.push(...l);let u=pye(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=mye(s,a,o,r);h!=null&&h.length&&n.push(...h);let c=gye(s,a,o,r);c!=null&&c.length&&n.push(...c);let f=vye(s,a,o,r);return f!=null&&f.length&&n.push(...f),n.length&&n.push({update:()=>{s.update()}}),n}function fye(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return tV.forEach(l=>{let u=zc(l,a,n??{},s,r);u&&o.push(u)}),o}function pye(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return iV.forEach(l=>{let u=zc(l,o,n??{},s,r);u&&a.push(u)}),a}function mye(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return rV.forEach(l=>{let u;l==="count"?u=xD(l,o,n??{},s,r,!0):u=zc(l,o,n??{},s,r),u&&a.push(u)}),a}function gye(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return nV.forEach(l=>{let u;l==="count"?u=Kn(l,o,n??{},s,r,!0):u=zc(l,o,n??{},s,r),u&&a.push(u)}),a}function vye(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return sV.forEach(l=>{let u=zc(l,o,n??{},s,r);u&&a.push(u)}),a}function yye(e,t){return{update:()=>{e instanceof On&&(e.fill.enabled=t)}}}function xye(e,t){return{update:()=>{e instanceof On&&(e.stroke.enabled=t)}}}function bye(e,t){return{update:()=>{e instanceof On&&(e.dropShadow.enabled=t)}}}function wye(e,t){return{update:()=>{e instanceof On&&(e.innerShadow.enabled=t)}}}function _ye(e,t){return{update:()=>{e instanceof On&&(e.backgroundBlur.enabled=t)}}}function Sye(e,t){return{update:()=>{e instanceof On&&(e.layerBlur.enabled=t)}}}function Eye(e,t,i,r,n){let s=[],a,o,l,u,h,c,f,m,g,y,v,b,S,_,T;if("width"in e&&(a=Kn("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=Kn("height",e,t,i,n),o&&s.push(o)),e instanceof On||e instanceof zl){let M={...t.fill},C={...i.fill};M.enabled!==void 0&&M.enabled!==C.enabled&&(s.push(yye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}})),l=Ux("color",e.fill,M,C,n),l&&s.push(l)}if(e instanceof On){let M={...t.stroke},C={...i.stroke};(M.enabled||C.enabled)&&(s.push(xye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}})),u=Ux("color",e.stroke,M,C,n),u&&s.push(u),h=Kn("thickness",e.stroke,M,C,n),h&&s.push(h)}if(e instanceof On){let M={...t.dropShadow},C={...i.dropShadow};(M.enabled||C.enabled)&&(s.push(bye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}})),c=Ux("color",e.dropShadow,M,C,n),c&&s.push(c),f=Kn("blurRadius",e.dropShadow,M,C,n),f&&s.push(f),g=Kn("spread",e.dropShadow,M,C,n),g&&s.push(g),m=Nw("offset",e.dropShadow,M,C,n),m&&s.push(m)}if(e instanceof On){let M={...t.innerShadow},C={...i.innerShadow};(M.enabled||C.enabled)&&(s.push(wye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),C.enabled||Object.assign(C,{enabled:!0,color:{...C.color,a:0}})),y=Ux("color",e.innerShadow,M,C,n),y&&s.push(y),v=Kn("blurRadius",e.innerShadow,M,C,n),v&&s.push(v),S=Kn("spread",e.innerShadow,M,C,n),S&&s.push(S),b=Nw("offset",e.innerShadow,M,C,n),b&&s.push(b)}if(e instanceof On||e instanceof zl){let M={...t.backgroundBlur},C={...i.backgroundBlur};(M.enabled||C.enabled)&&(s.push(_ye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),C.enabled||Object.assign(C,{enabled:!0,radius:0})),_=Kn("radius",e.backgroundBlur,M,C,n),_&&s.push(_)}if(e instanceof On){let M={...t.layerBlur},C={...i.layerBlur};(M.enabled||C.enabled)&&(s.push(Sye(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),C.enabled||Object.assign(C,{enabled:!0,radius:0})),T=Kn("radius",e.layerBlur,M,C,n),T&&s.push(T)}if(e instanceof zl||e instanceof e0){let M=xD("cornerRadius",e,t,i,n);M&&s.push(M)}return s}function pB(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...hye(e,t,i,n,r)),e instanceof Bn?s.push(...Eye(e,t,i,n,r)):(e.data.visible&&s.push(...dye(e,t,i,r)),Io(e)?(e instanceof Jr&&e.data.visible&&s.push(...Jve(e,t,i,r)),e.data.visible&&s.push(...eye(e,t,i,r))):ufe(e)?e.data.visible&&s.push(...$ve(e,t,i,r)):lfe(e)&&s.push(...Qve(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var mB=new L;function bD(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let u={...l.data};a.states||(a.states={}),a.states[l.id]=Cd.patch(o,u)}vB(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),gB(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var h,c,f,m,g,y;if(i&&((h=a.rigidBody)==null||h.setTranslation(a.position0,!0),(c=a.rigidBody)==null||c.setRotation(a.rotation0,!0),(f=a.rigidBody)==null||f.setLinvel(mB,!0),(m=a.rigidBody)==null||m.setAngvel(mB,!0)),!Si.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===jm)return;let u=!1;r.some(v=>{var b;return(b=e.scene.find(o))==null?void 0:b.isDescendantOf(v)})?u=!0:((g=l.physics)==null?void 0:g.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let v of l.states){let b={...v.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||u)&&(v.data.position!==void 0&&delete b.position,v.data.rotation!==void 0&&delete b.rotation,v.data.hiddenMatrix!==void 0&&delete b.hiddenMatrix),a.states||(a.states={}),a.states[v.id]=Sd.patch(l,b)}vB(e.scene,a,null,t,l.events.find(v=>v.data.type==="Follow"||v.data.type==="LookAt")!==void 0),a instanceof xs&&a.frame&&(a.frame.traverse(v=>n(v)),(y=a.uiCanvas)==null||y.applySize())}),gB(e),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function gB(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function vB(e,t,i,r,n=!1){if(t instanceof Jr&&!(t instanceof qd)&&t.removeInteractionGeometry(r),t instanceof Bn?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof Jr&&t.updateGeometryGroupsIfNeeded(),t instanceof ws&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof Bn)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function O6(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=Gh.linear;break;case 1:i=Gh.ease;break;case 2:i=Gh.easeIn;break;case 3:i=Gh.easeOut;break;case 4:i=Gh.easeInOut;break;default:i=Gh.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function iP(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var Aye={type:"beginState"},Cye={type:"completeState",isfromEntity:!1},yB=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof Bn||this.object.traverseEntity(o=>{o!==this.object&&o instanceof ws&&o.dispatchEvent(Aye)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof Bn||this.object.traverseEntity(o=>{o!==this.object&&o instanceof ws&&o.dispatchEvent(Cye)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=pB(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=_b(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=_b(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=_b(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...iP(r),...O6(r),change:this.onChange},this.callback=pB(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},k6=class extends as{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=_b(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&cL(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=iP(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=R6.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(u=>u==null?void 0:u.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let u=l===-1?0:l;for(let h=u;h<this.data.tweens.length-1;h++){let c=this.data.tweens[h],f=this.data.tweens[h+1],m;h===u&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(m=void 0,this.object instanceof ws&&(this.object.wasMovedByUser=!1)):m=c.data.state===void 0?this.currentState:c.data.state;let g=new yB(this.object,m,f.data.state===void 0?this.currentState:f.data.state,f.data,this.shared,this.data.allowSlerp??!1);l!==-1&&h===u&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[h]=g,this.timeline.add(g.params,this.timeline.duration+(h===u?o.delay:0))}this.timeline.duration+=o.endDelay}else{let u=l===-1?this.data.tweens.length-1:l+1;for(let h=u;h>0;h--){let c=this.data.tweens[h],f=this.data.tweens[h-1],m;h===u&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(m=void 0,this.object instanceof ws&&(this.object.wasMovedByUser=!1)):m=c.data.state===void 0?this.currentState:c.data.state;let g=new yB(this.object,m,f.data.state===void 0?this.currentState:f.data.state,c.data,this.shared,this.data.allowSlerp??!1);l!==-1&&h===u&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[h-1]=g,this.timeline.add(g.params,this.timeline.duration+(h===u?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(cr(this.shared,this.condition)===!1||cL(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=iP(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof Bn?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(cr(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(cr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function _b(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var Tye={type:"beginState"},xB={type:"completeState",isfromEntity:!1},bB={type:"requestRender"},L6=class extends as{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new L,this.posEnd=new L,this.qStart=new Wt,this.qEnd=new Wt,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=R6({targets:i,t:1,...O6(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(Tye));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(bB),i.t===1&&r.dispatchEvent(xB)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(cr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(cr(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(xB),this.page.activeCamera.dispatchEvent(bB))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function z6(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=qse(t);return i&&i>2?i:2}return 2}var N6=class extends as{constructor(e,t,i,r,n){var l,u,h;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let c=z6(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(c-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(c-1)*this.duration}else{let c=(h=(u=o==null?void 0:o.getClip())==null?void 0:u.tracks[0])==null?void 0:h.times.length;c&&c>1?(this.leftFrameTime=this.data.crop[0]/c*this.duration,this.rightFrameTime=this.data.crop[1]/c*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(cr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=ht.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(cr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},B6=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(cr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),bD(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},F6=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=cr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=FV(this.data.expression,this.shared,is.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},U6=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(cr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},Pye=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(cr(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(k2(e))})}dispose(){}},Mye=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if(cr(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function cr(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=FV(t.expression,e,"boolean");return t.negate?!i:!!i}function tn(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:u,data:h})=>{try{h.type==="Audio"?ps[e.type].includes("Audio")&&a.Audio.push(new d6(u,h,s,r,l)):h.type==="Video"&&!(s instanceof Bn)?ps[e.type].includes("Video")&&a.Video.push(new j6(u,h,s,r,l)):h.type==="Particles"?ps[e.type].includes("Particles")&&a.Particles.push(new f6(h,i,r,l)):h.type==="Link"?ps[e.type].includes("Link")&&a.Link.push(new mve(h,n.controlsManager,r,l)):h.type==="Create"?ps[e.type].includes("Create")&&a.Create.push(new H6(h,i,n.controlsManager,r,l)):h.type==="Destroy"?ps[e.type].includes("Destroy")&&a.Destroy.push(new p6(h,i,n.controlsManager,r,l)):h.type==="Reset"?ps[e.type].includes("Reset")&&a.Reset.push(new m6(h,i,r,n,l)):h.type==="Transition"?ps[e.type].includes("Transition")&&a.Transition.push(new k6(e.type,h,i,r,l)):h.type==="SwitchCamera"?ps[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new L6(h,i,r,l)):h.type==="SceneTransition"?ps[e.type].includes("SceneTransition")&&a.SceneTransition.push(new B6(h,i,n,r,l)):h.type==="Animation"?ps[e.type].includes("Animation")&&a.Animation.push(new N6(h,i,n.animationControls,r,l)):h.type==="SetVariable"?ps[e.type].includes("SetVariable")&&a.SetVariable.push(new F6(h,i,r,l)):h.type==="DynamicVariablePlay"?ps[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new U6(h,i,r,l)):h.type==="Conditional"?ps[e.type].includes("Conditional")&&(h.ifActions.forEach(o({expression:h.condition,negate:!1})),h.elseActions.forEach(o({expression:h.condition,negate:!0}))):h.type==="ClearLocalStorage"?ps[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new Pye(h,i,r,l)):h.type==="UserAPI"&&ps[e.type].includes("UserAPI")&&a.UserAPI.push(new Mye(h,i,r,l))}catch{}};return t.forEach(o()),a}function Nn(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof d6||i instanceof j6||i instanceof f6||i instanceof N6||i instanceof k6||i instanceof H6||i instanceof p6||i instanceof L6||i instanceof B6||i instanceof m6||i instanceof F6||i instanceof U6)&&i.dispose()})})}function Dye(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var V6=new Map,Yv=new Map,im=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=Dye(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,Xy&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),Yv.has(i.uuid)?Yv.get(i.uuid).push(this):Yv.set(i.uuid,[this]),V6.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},rP=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=V6.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=Yv.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...Yv.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},j6=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new im(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new rP(t);else throw new Error("Missing property")}dispatchBasic(){if(cr(this.shared,this.condition)===!1)return!1;this.interaction instanceof im?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(cr(this.shared,this.condition)===!1)return!1;this.interaction instanceof im?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},wB=(()=>{let e,t,i,r;function n(o){!e&&!_B()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,u=t.sharedGameControlGlobals.createdObjects,h=t.sharedGameControlGlobals.nCreatedPerAction,c=u.length,f=0;for(;f<c;){let m=u[f];m.userData.createdTime===void 0&&(m.userData.createdTime=o),m.userData.lifetime===void 0&&m.userData.quantity===void 0||m.userData.lifetime&&o-m.userData.createdTime<m.userData.lifetime||m.userData.quantity&&h[m.userData.actionId]<=m.userData.quantity?(m.userData.velocity&&(m.position.addScaledVector(m.userData.velocity,l/1e3),m.updateMatrix(),r()),f++):(h[m.userData.actionId]>m.userData.quantity&&h[m.userData.actionId]--,u.splice(f,1),m.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&m.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(m.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(m.rigidBody)):(m.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(g=>g.bvhGeometry!==void 0)),c--,r())}e=f>0?requestAnimationFrame(s):void 0,i=f>0?o:void 0}function a(){_B()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function _B(){return!!document&&document.hidden}var SB=new Wt,Iye=new L,Rye=new L,H6=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=ht.generateUUID(),this.dispatch=()=>{if(cr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(cr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=hae(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new rs(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,u=this.page.scene.find(l);u&&(u.updateMatrixWorldSVD(),a.hiddenMatrix.copy(u.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),wB(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var h,c,f,m;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Ja)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof rs)o=a.object;else if(o=a,(h=o.dataPatched.cloner)==null?void 0:h.hideBase)return!0}else{if(a instanceof Ja)return;a instanceof rs?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new L().fromArray(this.data.velocity),u=o.dataPatched;if(!(u.physics.enabled==="visibility"?!u.visible:!u.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((c=a.rigidBody)==null||c.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(Iye,SB,Rye),l.applyQuaternion(SB),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&((f=a.rigidBody)==null||f.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((m=o.dataPatched.physics)==null?void 0:m.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");wB(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},G6=200,CC=.02,TC=.3,Oye=65;new L;var EB=new L,AB=new L,kye=new L,ks=new L,$s=new L,Bh=new L,PC=new je,CB=new je,Lye=new je;new je;var Co=new Wt,mu=new Wt,ml=new dn(0,0,0,"YXZ"),zye=new L(1,0,0),To=new L(0,1,0),Nye=new L(0,0,1),TB=new L(1,1,1);new ua;var Bye=1,Fye=.025,Uye=16e-6,PB=12,Vye=20,Pn=new eo,ja=new jr,jye={type:"requestRender"},Hye={type:"updateMatrix"},MB=Math.PI/6,nP=class extends as{constructor(e,t,i,r,n,s,a,o,l){var g;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new je,this.target0=new L,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=G6,this.euler0=new dn(0,0,0,"YXZ"),this.position0Cam=new L,this.quat0Cam=new Wt,this.scale0Cam=new L,this.hiddenMatrix0Cam=new je,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new eo(new L(0,-40,0),new L(0,40,0)),matrix:new je,position:new L,rotation:new Wt},this.euler=new dn(0,0,0,"YXZ"),this.eulerDelta=new L,this.lastPosition=new L,this.lastCameraQuaternion=new Wt,this.lastCameraPosition=new L,this.PI_2=Math.PI/2,this.prevMouse=new oe,this.velocityTarget=new L,this.velocity=new L,this.directionXZ=new L,this.rotVelocityStick=new L,this.rotVelocityTarget=new L,this.rotVelocity=new L,this.rotDirection=new L,this.nonColliderRotOffset=new je,this.nonColliderPosOffset=new je,this.firstPointerId=-1,this.rot=new L,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new je,this.objectToTarget=new L,this.objectToTarget0=new L,this.objectToCamXZ=new L,this.objectToCamXZ0=new L,this.targetToCamera=new L,this.targetToCamera0=new L,this.cameraPolarAxis0=new L,this.targetPos=new L,this.targetQuat=new Wt,this.lerpFactorPos=new L().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Wt,this.objXZQuatInv=new Wt,this.objXZRotMat=new je,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new L,this.pushedVelocity=new L,this.groundYRotation=0,this.objectRealQuat=new Wt,this.colliderWorldQuat=new Wt,this.groundNormal=new L,this.groundTilt=new Wt,this.groundTiltInv=new Wt,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new L,this.quaternion=new Wt,this.scale=new L,this.initialAction=!0,this.onPointerDown=y=>{var v;!(y.target===this.domElement||y.target instanceof HTMLElement&&y.target.tagName==="SPLINE-VIEWER"&&((v=y.target.shadowRoot)!=null&&v.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=y.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!Pa&&!Kk&&this.domElement.requestPointerLock(),this.prevMouse.set(y.clientX,y.clientY))},this.onPointerUp=y=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),y.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=y=>{if(y.pointerId!==this.firstPointerId)return;let v=y.clientX-this.prevMouse.x,b=y.clientY-this.prevMouse.y;this.prevMouse.set(y.clientX,y.clientY),y.pointerType==="mouse"&&this.rotBy!=="keys"&&(Kk&&bae<15.5&&!Pa?(this.eulerDelta.y=-v*this.mouseOrbitSensitivity,this.eulerDelta.x=-b*this.mouseOrbitSensitivity):(this.eulerDelta.y=-y.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-y.movementY*this.mouseOrbitSensitivity)),y.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-v*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-b*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=y=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?nP.isLocked=!0:nP.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let y in this.movementState)this.movementState[y]=0},this.onKeyDown=y=>{!(y.target instanceof HTMLInputElement)&&(y.code==="ArrowLeft"||y.code==="ArrowUp"||y.code==="ArrowRight"||y.code==="ArrowDown"||y.code==="Space")&&y.preventDefault();for(let v of this.keyAssignments)if(y.key.toUpperCase()===v[1]||y.key===v[1]){this.movementState[v[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=y=>{for(let v of this.keyAssignments)if(y.key.toUpperCase()===v[1]||y.key===v[1]||y.code.slice(3,y.code.length).toUpperCase()===v[1]){this.movementState[v[0]]=0;break}},this.copyVRGamePadValues=(y,v)=>{for(let b=2;b<4;b++){let S=y.axes[b];v===0?b===2?this.movementState.movePosX=S:this.movementState.movePosZ=S:(y.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,b===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(S)>=.3&&(this.vrEulerYOffset+=S<0?1:-1),this.movementState.rotPosY=S):this.moveMode==="fly"&&(this.movementState.moveNegY=S))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let u=this.euler0.clone(),h=u.y;if(this.objectRealQuat.copy(this.quaternion),u.y=0,this.quaternion.setFromEuler(u),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),u.set(0,h,0),this.quaternion.setFromEuler(u),this.rot.setFromEuler(u),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((g=this.camera)==null?void 0:g.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let y=new L(0,0,-1).applyQuaternion(this.camera.quaternion),v=new L().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(v),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let b,S;Math.abs(y.y)<1e-6?(v.y=0,y.y=0,S=v.projectOnVector(y)):v.y/y.y>0?S=y.multiplyScalar(v.y/y.y):S=y.multiplyScalar(v.length()),this.targetToCamera0.copy(S).negate(),b=this.camera.position.clone().add(S),this.objectToTarget0.subVectors(b,this.position);let _=new dn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-_.x,_.x=0,_.z=0,_.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(_)}if(this.object instanceof ws&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*Bye,this.speedOrbit=(i.speedRotate??100)*Fye,this.mouseOrbitSensitivity=(i.speedRotate??100)*Uye,this.keyAssignments=i.keyAssignments.map(y=>{let v=[y[0],y[1]];return v[1]===""?v[1]="ArrowUp":v[1]===""?v[1]="ArrowLeft":v[1]===""?v[1]="ArrowDown":v[1]===""?v[1]="ArrowRight":v[1]===""?v[1]="Shift":v[1]===""?v[1]="Enter":v[1]==="Space"?v[1]=" ":v[1]===""?v[1]="Meta":v[1]==="Ctrl"?v[1]="Control":v[1]==="Esc"&&(v[1]="Escape"),v}),i.rotBy==="mouse"){let y;y=this.keyAssignments.findIndex(v=>v[0]==="rotNegX"),y!==-1&&(this.keyAssignments[y][1]=""),y=this.keyAssignments.findIndex(v=>v[0]==="rotPosX"),y!==-1&&(this.keyAssignments[y][1]=""),y=this.keyAssignments.findIndex(v=>v[0]==="rotPosY"),y!==-1&&(this.keyAssignments[y][1]=""),y=this.keyAssignments.findIndex(v=>v[0]==="rotNegY"),y!==-1&&(this.keyAssignments[y][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??gm.defaultData.gravity)*PB,this.usePhysics=this.gloabalPhysics.usePhysics??gm.defaultData.usePhysics,this.jumpPower=i.jumpPower*Vye,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??yw.defaultDataThirdPerson.orientWith,this.slopeThresh=Oye*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*CC/this.pixelsPerMeter,this.stepThresh=i.collider.height*TC/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*CC/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*TC/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*CC/this.pixelsPerMeter,this.stepThresh=i.collider.height*TC/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let c=new L().fromArray(i.collider.position),f=new Wt().setFromEuler(new dn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(c).multiply(this.scale),this.collider.rotation.copy(f),this.collider.matrix.compose(c,f,TB),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let m=i.navmesh.destinationHelperRadius*2;if(m>0){let y=new At;y.push({fi:0,data:{...Dn.defaultData("light","phong"),alpha:0},id:"layer1"}),y.push({fi:0,data:{...Dn.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let v=new GM({layers:y},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new ar(yV.create({parameters:{width:m,height:m/10,hollow:.7}}),v),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new dn().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof ws?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},vw.list.forEach(i=>{this.actions[i]=tn({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Nn(this.actions.idle),Nn(this.actions.move),Nn(this.actions.run),Nn(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ks.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,u,h,c,f,m,g,y;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let v=$s.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*PB),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,v,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(b){this.onObject=!0,this.groundNormal.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=b.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let S=b.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let _ of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(_.rigidBody===S&&_.userData.isFollowingObj!==this.object.uuid){(_.hasNonUniformScale?_.matrixWorldRigid:_.matrixWorld).decompose(ks,mu,$s),this.groundVelocity.subVectors(ks,_.prevT),this.object.getWorldPosition($s).add(this.collider.position).sub(ks),this.groundYRotation=ml.setFromQuaternion(mu).y-_.prevR.y,Bh.copy($s).applyAxisAngle(To,this.groundYRotation),this.groundVelocity.add(Bh.sub($s)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let v=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let b=ks.subVectors(this.path[1],this.position),S=$s.subVectors(this.path[1],this.path[0]);b.dot(S)<0?this.path.shift():(this.directionXZ.x=S.x,this.directionXZ.z=S.z),v.opacity=v.userData.opacity0}else v.opacity-=.05*v.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=kye.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let v=$s.copy(a);v.y=0,a.set(0,a.y,v.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let v=ks;this.camera.getWorldDirection(v);let b=Bh.copy(To).multiplyScalar(v.dot(To));v.sub(b);let S=$s.copy(this.directionXZ);S.x*=-1,this.rot.y=v.angleTo(S)*(v.cross(S).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(ml.setFromVector3(this.rot),this.moveMode==="walk"&&(ml.x=0),a.applyEuler(ml),s&&(mu.setFromUnitVectors(To,this.groundNormal),a.applyQuaternion(mu)),i){let v=ml.set(0,this.vrEulerYOffset*MB,0);i.applyEuler(v),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let v=$s;this.pushedVelocity.set(0,0,0);for(let b of this.sharedGameControlGlobals.entitiesWithTransformAnim){let S=Bh.setFromMatrixPosition(b.matrixWorld).sub(b.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),_=b.rigidBody.collider(0).castCollider(S,this.object.rigidBody.collider(0),ks.copy(a).divideScalar(this.pixelsPerMeter),r,!1);S.multiplyScalar(this.pixelsPerMeter);let T=Si.is(b)?b:b.object;if(_!==null&&this.lastHitObj!==T){let M;b instanceof rs&&(M=b);let C=this.sharedGameControlGlobals.entityToCollisionEvents[T.uuid];if(C)for(let P of C)P.data.target==="character"&&(P.dispatch(M),T.dispatchEvent(aP));this.lastHitObj=T}if(_!==null){this.pushedVelocity.copy(S),v.copy(_.normal1).applyQuaternion(b.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let b=v.dot(a);b<0&&a.addScaledVector(v,-b),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(To,this.euler.y-this.euler0.y);let v=$s.copy(this.objectToCamXZ).normalize(),b=Bh.copy(a).multiplyScalar(r);b.y=0;let S=b.sub(ks.copy(v).multiplyScalar(b.dot(v))).cross(v).y;this.euler.y-=Math.atan2(S,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=ht.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(ml.copy(t),ml.y=0):(ml.copy(this.euler),ml.y=0),this.nonColliderRotOffset.makeRotationFromEuler(ml)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*MB),Co.setFromAxisAngle(zye,this.rot.x),mu.setFromAxisAngle(To,this.rot.y),mu.multiply(Co),Co.setFromAxisAngle(Nye,this.rot.z),mu.multiply(Co),this.quaternion.copy(mu),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let v=$s.copy(a).multiplyScalar(r/this.pixelsPerMeter),b=null;this.didHit=!1;let S=new L;for(let _=0;_<5;_++){let T=v.length(),M=Bh.copy(v).normalize();if(b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(S),this.colliderWorldQuat,M,(u=this.object.rigidBody)==null?void 0:u.collider(0).shape,T,!1,24,void 0,void 0,this.object.rigidBody),b!==null){this.didHit=!0;let C=this.sharedGameControlGlobals.colliderToEntity.get(b.collider.handle);if(C!==this.lastHitObj&&_===0){this.lastHitObj=C;let I=this.sharedGameControlGlobals.entityToCollisionEvents[C==null?void 0:C.uuid];if(I){for(let O of I)if(O.data.target==="character"){let N=((h=this.sharedGameControlGlobals.rapierWorld)==null?void 0:h.getCollider(b.collider.handle))._parent,k;if(C.cloner){for(let U of C.cloner.children)if(U.rigidBody===N){k=U;break}}O.dispatch(k),C.dispatchEvent(aP)}}}let P=EB.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat),E=AB.copy(M).multiplyScalar(b.toi).dot(P),D=b.toi;if(D===0&&(this.position.y+=this.offset*this.pixelsPerMeter),E>this.offset&&(D=b.toi*(E-this.offset)/E,S.addScaledVector(M,D)),v.copy(M).multiplyScalar(T-D),Math.acos(-P.y)>this.slopeThresh){let I=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(S),O=Bh.copy(b.witness2).applyQuaternion(this.colliderWorldQuat);O.y=0;let N=I.add(O);N.y+=this.stepThresh;let k=this.sharedGameControlGlobals.rapierWorld.castShape(N,this.colliderWorldQuat,v,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);k!==null&&k.toi===0&&(P.y=0,P.normalize())}v.addScaledVector(P,-v.dot(P))}else{_===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),S.add(v);break}}this.position.addScaledVector(S,this.pixelsPerMeter),(f=this.object.rigidBody)==null||f.setTranslation(ks.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(m=this.object.rigidBody)==null||m.setRotation(Co.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let v=this.onObject?1:5,b=a.multiplyScalar(r/v);for(let S=0;S<v;S++)this.position.add(b),this.collisionAdjustment(r/v)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let v=this.objectToTarget.add(this.position),b=this.targetToCamera.add(v);PC.lookAt(b,v,To).setPosition(b),PC.decompose(this.targetPos,this.targetQuat,ks),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=ht.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=ht.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(Hye),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((y=(g=this.navMeshPathDest)==null?void 0:g.material)==null?void 0:y.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(jye),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Co.setFromAxisAngle(To,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?ht.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ks.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=mu.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){To.angleTo(e)*180/Math.PI<15||To.angleTo(e)*180/Math.PI>85?Co.identity():Co.setFromUnitVectors(To,e),this.groundTilt.slerp(Co,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=AB.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=PC.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ks,Co,$s).compose(ks,Co,TB);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;ja.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=CB.copy(a).invert(),l=Lye.copy(CB).multiply(i);Pn.copy(this.collider.segment),Pn.start.applyMatrix4(l),Pn.end.applyMatrix4(l);let u=EB.copy(this.position).applyMatrix4(o);ja.expandByPoint(Pn.start),ja.expandByPoint(Pn.end),ja.min.addScalar(-this.collider.radius),ja.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(h){return h.distanceToPoint(Pn.end)},intersectsBounds:h=>h.intersectsBox(ja),intersectsTriangle:h=>{let c=ks,f=$s,m=h.closestPointToSegment(Pn,c,f);if(m<this.collider.radius){let g=this.collider.radius-m,y=f.sub(c).normalize(),v=Bh.copy(u);v.addScaledVector(y,g);let b=v.applyMatrix4(a).sub(this.position);t.add(b),Pn.start.addScaledVector(y,g),Pn.end.addScaledVector(y,g)}}})}),ja.makeEmpty(),Pn.copy(this.collider.segment),Pn.start.applyMatrix4(i),Pn.end.applyMatrix4(i),ja.expandByPoint(Pn.start),ja.expandByPoint(Pn.end),ja.min.addScalar(-this.collider.radius),ja.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Pn.end)},intersectsBounds:s=>s.intersectsBox(ja),intersectsTriangle:s=>{let a=ks,o=$s,l=s.closestPointToSegment(Pn,a,o);if(l<this.collider.radius){let u=this.collider.radius-l,h=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(h),t.addScaledVector(h,u),Pn.start.addScaledVector(h,u),Pn.end.addScaledVector(h,u)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},W6=nP;W6.isLocked=!1;var Gye=Oc(QF());function q6(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function Tu(e,t){let i=new St;if(t&&q6(t))return i.setAttribute("position",new ot([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new ot([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=O_(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new ot(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var Wye=new je,qye=new je,gl=[[0,0,0],[0,0,0],[0,0,0]];function X6(e){let t=e.elements;gl[0][0]=t[0],gl[0][1]=t[4],gl[0][2]=t[8],gl[1][0]=t[1],gl[1][1]=t[5],gl[1][2]=t[9],gl[2][0]=t[2],gl[2][1]=t[6],gl[2][2]=t[10];let{u:i,v:r}=(0,Gye.SVD)(gl),n=Wye.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=qye.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var Xye=class extends j5{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new Lc({color:65280,linewidth:10}),t=new L(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new L(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new L().addVectors(t,i.multiplyScalar(r)),s=new St;return s.setFromPoints([t,n]),new Vb(s,e)}},Y6=e=>e instanceof em||e instanceof tm;function Yye(e,t){return e.distance-t.distance}function Q6(e,t,i){if(!(!Cu(t)||!t.visible)){Io(t)&&t.raycast(e,i);for(let r of t.children)Q6(e,r,i)}}function Sb(e,t,i,r=!1){if(!r&&!i.some(s=>Bw(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>Q6(e,s,n)),n.sort(Yye),n}function sP(e){let t=[];if(e.length){let i=e[0].object;Cu(i)&&t.push(i);let r=i.parent;for(;r;)Y6(r)&&t.push(r),r=r.parent}return t}function Pu(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function Bw(e,t){if(Io(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(Y6(t))return K6(e,t)}function K6(e,t){if(!(!Cu(t)||!t.visible)){if(Io(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=K6(e,i);if(r)return r}}}function Qye(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function Kye(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var Zye=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new Xye,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=Qye(t,i,this._domRect),this.pointerScreen=Kye(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},As=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},wD=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Z6=e=>{var t;return(t=wD.find(([i,r])=>r===e))==null?void 0:t[0]},t0=e=>{var t;return(t=wD.find(([i])=>i===e))==null?void 0:t[1]},Jye=(e,t)=>{let i=Z6(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},$ye=class extends As{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[Z6(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of wD)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=Jye(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},e0e=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=tn(t,t.actions,r,n,s,i)}disconnect(){Nn(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},t0e=class extends As{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=Sb(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{Vt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Vt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Vt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Vt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,u,h;if(!r||!n)return;let a=t0(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(c=>{c.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(h=(u=this.eventsPerObjects[a])==null?void 0:u[n.uuid])==null||h.forEach(c=>{c.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,u;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(h,c)=>{var m,g;if(!((m=h.data)!=null&&m.events.length))return;let f=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let y of f){let v=this.eventsPerObjects[y];if(h.data.events.filter(({data:b})=>b.type===y&&b.disabled!==!0).forEach(({id:b,data:S})=>{try{let _=new e0e(b,S,h,e,t,this.eventManager);_.actions.Video.length&&(this.hasVideoAction=!0),(S.type==="MouseDown"||S.type==="MouseUp"||S.type==="MousePress")&&(S.mode==="Canvas"||S.mode==="Window")?this.canvasMouseEvents.push(_):(v[h.uuid]?v[h.uuid].some(T=>T.id===_.id)||v[h.uuid].push(_):v[h.uuid]=[_],h instanceof qd&&h.traverseChildren(T=>{var M;if(!T.visible)return!0;T instanceof Jr&&((M=T.data.geometry.shapeBlendNode)==null?void 0:M.operation)!==2&&(v[T.uuid]?v[T.uuid].push(_):v[T.uuid]=[_])}))}catch{}}),((g=v[h.uuid])==null?void 0:g.length)&&(this.objectsPerTypes[y].push(h instanceof Bn&&(y==="MouseDown"||y==="MouseUp"||y==="MousePress")?c:h),h instanceof qd)){let b=this.objectsPerTypes[y];h.traverseChildren(S=>{if(!S.visible)return!0;S instanceof Jr&&b.indexOf(S)===-1&&b.push(S)})}}};e.traverseEntity(h=>{var c;(h instanceof xs||h instanceof Rn)&&((c=h.frame)==null||c.traverse(f=>{r(f,h)})),r(h)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(u=this.objectsPerTypes.KeyPress)!=null&&u.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([h,c])=>{c.forEach(f=>{f.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,u,h;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(c=>!(c instanceof Bn));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Pu(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),c=>{this.handleObjectMouseEventDispatch(c,e)}))){if(t||this.useForRaycastProperty){let c;if(this.sceneInterects===null?c=Sb(i,r,a,this.useForRaycastProperty):(c=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&c.length&&(this.eventContext.sharedAssets.raycastProperty={x:c[0].point.x,y:c[0].point.y,z:c[0].point.z,objX:c[0].object.matrixWorld.elements[12],objY:c[0].object.matrixWorld.elements[13],objZ:c[0].object.matrixWorld.elements[14]}),t){let f=[((l=(o=c[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((h=(u=c[0])==null?void 0:u.uv)==null?void 0:h.y)??0];sP(c).forEach(m=>{m instanceof xs&&Pu(m,f,Object.keys(this.eventsPerObjects[e]),g=>{this.handleObjectMouseEventDispatch(g,e)}),this.eventsPerObjects[e][m.uuid]&&this.handleObjectMouseEventDispatch(m,e)})}}t||a.forEach(c=>{var m,g;let f=Bw(i,c);f&&(this.handleObjectMouseEventDispatch(c,e),c instanceof xs&&Pu(c,[((m=f==null?void 0:f.uv)==null?void 0:m.x)??0,((g=f==null?void 0:f.uv)==null?void 0:g.y)??0],Object.keys(this.eventsPerObjects[e]),y=>{this.handleObjectMouseEventDispatch(y,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof Bn)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,u=!1;if(o.uiCanvas&&(u=Pu(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),h=>{n.push(h)})),s&&!u){let h=Sb(a,o,r);n=sP(h),h.forEach(c=>{var f,m;c.object instanceof xs&&Pu(c.object,[((f=c==null?void 0:c.uv)==null?void 0:f.x)??0,((m=c==null?void 0:c.uv)==null?void 0:m.y)??0],Object.keys(this.eventsPerObjects[t]),g=>{n.push(g)})})}else r.forEach(h=>{var f,m;let c=Bw(a,h);c&&(n.push(h),h instanceof xs&&Pu(h,[((f=c==null?void 0:c.uv)==null?void 0:f.x)??0,((m=c==null?void 0:c.uv)==null?void 0:m.y)??0],Object.keys(this.eventsPerObjects[t]),g=>{n.push(g)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},i0e=new L,r0e=new L,J6=class{constructor(e,t,i,r,n){this.actionsIn=tn(e,e.inActions,i,r,n,t),this.actionsOut=tn(e,e.outActions,i,r,n,t)}disconnect(){Nn(this.actionsIn),Nn(this.actionsOut)}},n0e=class extends J6{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let f of this.objects)if(!f.visible)return;let u=i0e.setFromMatrixPosition(this.objects[0].matrixWorld),h=r0e.setFromMatrixPosition(this.objects[1].matrixWorld),c=u.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==c){this.stage=c;let f=c==="in"?this.actionsIn:this.actionsOut;f.Audio.forEach(m=>m.dispatchConditional()),f.Particles.forEach(m=>m.dispatchConditional()),f.Video.forEach(m=>m.dispatchConditional()),f.Link.forEach(m=>m.dispatch()),f.Create.forEach(m=>m.dispatch()),f.Destroy.forEach(m=>m.dispatch()),f.Reset.forEach(m=>m.dispatch()),f.Transition.forEach(m=>{m.object.currentTransitionEvent!==this&&(m.object.currentTransitionEvent=this),m.init()}),f.Transition.forEach(m=>m.play()),f.Animation.forEach(m=>m.play()),f.SwitchCamera.forEach(m=>m.play()),f.SceneTransition.forEach(m=>m.dispatch()),f.SetVariable.forEach(m=>m.checkConditions()),f.SetVariable.forEach(m=>m.dispatch()),f.DynamicVariablePlay.forEach(m=>m.dispatch()),f.ClearLocalStorage.forEach(m=>m.dispatch()),f.UserAPI.forEach(m=>m.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let u of[o,l]){if(!u)throw new Error("Missing property");let h=r.find(u);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},s0e=class extends J6{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:u,state:h})=>{this.toState!==h&&(this.actionsOut.Audio.forEach(c=>c.dispatchConditional()),this.actionsOut.Particles.forEach(c=>c.dispatchConditional()),this.actionsOut.Video.forEach(c=>c.dispatchConditional()),this.actionsOut.Link.forEach(c=>c.dispatch()),this.actionsOut.Create.forEach(c=>c.dispatch()),this.actionsOut.Destroy.forEach(c=>c.dispatch()),this.actionsOut.Reset.forEach(c=>c.dispatch()),this.actionsIn.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(c=>c.play()),this.actionsOut.Animation.forEach(c=>c.play()),this.actionsIn.SwitchCamera.forEach(c=>c.pause()),this.actionsOut.SwitchCamera.forEach(c=>c.play()),this.actionsOut.SceneTransition.forEach(c=>c.dispatch()),this.actionsOut.SetVariable.forEach(c=>c.checkConditions()),this.actionsOut.SetVariable.forEach(c=>c.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(c=>c.dispatch()),this.actionsOut.ClearLocalStorage.forEach(c=>c.dispatch()),this.actionsOut.UserAPI.forEach(c=>c.dispatch()))},this.onComplete=({target:u,state:h})=>{this.toState===h&&(this.actionsIn.Audio.forEach(c=>c.dispatchConditional()),this.actionsIn.Particles.forEach(c=>c.dispatchConditional()),this.actionsIn.Video.forEach(c=>c.dispatchConditional()),this.actionsIn.Link.forEach(c=>c.dispatch()),this.actionsIn.Create.forEach(c=>c.dispatch()),this.actionsIn.Destroy.forEach(c=>c.dispatch()),this.actionsIn.Reset.forEach(c=>c.dispatch()),this.actionsOut.Transition.forEach(c=>c.pause()),this.actionsOut.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(c=>c.play()),this.actionsIn.Animation.forEach(c=>c.play()),this.actionsOut.SwitchCamera.forEach(c=>c.pause()),this.actionsIn.SwitchCamera.forEach(c=>c.play()),this.actionsIn.SceneTransition.forEach(c=>c.dispatch()),this.actionsIn.SetVariable.forEach(c=>c.checkConditions()),this.actionsIn.SetVariable.forEach(c=>c.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(c=>c.dispatch()),this.actionsOut.ClearLocalStorage.forEach(c=>c.dispatch()),this.actionsOut.UserAPI.forEach(c=>c.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){_d(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),_d(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),_d(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),_d(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},a0e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new n0e(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new s0e(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},ov=new L,Fh=new L,ad=new L,DB=new ia,o0e=.01,Hi=new L,hn=new L,IB=new L,Md=new Wt,MC=new dn,l0e=new je,DC=new Zr,gp=new L,vl=new L,IC=.2;function RC(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var u0e=function(){let e=new je;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&RC(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?RC(n.position,t.limits):t.reference==="local"&&(Md.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Md),RC(n.position,t.limits),Md.invert(),n.position.applyQuaternion(Md),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(Hi,n.quaternion,hn),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof js&&zu(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),h0e=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=tn(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=tn(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let u=r.find(l);!u||u.data.visible!==!1&&(o.push(u),a[u.uuid]&&a[u.uuid].forEach(h=>{let c=r.find(h);!c||c.data.visible!==!1&&o.push(c)}))}),this.data.dropDestinations.forEach(l=>{let u=r.find(l);!u||u.data.visible!==!1&&(this.dropDestIds.push(u.uuid),a[u.uuid]&&a[u.uuid].forEach(h=>{let c=r.find(h);!c||c.data.visible!==!1&&this.dropDestIds.push(c.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new L().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new L().setFromMatrixPosition(l.matrixWorld),pointStart:new L,pointEnd:new L,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new L().copy(l.position),quat0:new Wt().copy(l.quaternion),snapped:!1,orientationMatrix:new je,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Nn(this.actionsDrag),Nn(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},c0e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(Vt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:u,pointEnd:h,pointStart:c}of o.dragItems){if(u===s[0].object||u===s[0].object.object||Si.is(u)&&u.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let f=o.activeDragItem.obj;u.hasNonUniformScale&&u.updateMatrixWorldSVD(),(f.hasNonUniformScale?f.matrixWorldRigid:f.matrixWorld).decompose(Hi,Md,hn),MC.setFromQuaternion(Md),f.prevR===void 0?(f.prevR=MC.clone(),f.prevT=Hi.clone()):(f.prevR.copy(MC),f.prevT.copy(Hi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(u,c,o.data.plane,o.data.referenceFrame),h.copy(c),(this.eventManager.controlsManager.usePhysics&&((a=u.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,u;if(Vt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(Vt.length===0){let h=!1;for(let c of this.events){for(let{obj:f}of c.dragItems)if(f===((a=s[0])==null?void 0:a.object)||f===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Si.is(f)&&f.isAncestorOf((u=s[0])==null?void 0:u.object.uuid)){switch(h=!0,c.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(h)break}h||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let h=this.activeEvent.activeDragItem;h.snapped=!1;let c;if(this.activeEvent.data.drop&&(c=s.filter(f=>h.obj!==f.object&&!h.obj.isAncestorOf(f.object.uuid)&&!(f.object instanceof em)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(m=>m===f.object.uuid||n.scene.find(m).isAncestorOf(f.object.uuid))))[0]),c){let f=IB.copy(c.face.normal).applyMatrix3(DC.getNormalMatrix(c.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")h.fromPosition.setFromMatrixPosition(c.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(h.fromPosition.copy(c.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Hi.copy(f).applyMatrix3(DC.setFromMatrix4(h.obj.matrixWorld).transpose());let m=h.obj;Hi.x>IC?hn.x=-m.recursiveBBox.min.x:Hi.x<-.2&&(hn.x=-m.recursiveBBox.max.x),Hi.y>IC?hn.y=-m.recursiveBBox.min.y:Hi.y<-.2&&(hn.y=-m.recursiveBBox.max.y),Hi.z>IC?hn.z=-m.recursiveBBox.min.z:Hi.z<-.2&&(hn.z=-m.recursiveBBox.max.z),hn.applyMatrix3(DC.invert())}else hn.copy(f).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);h.fromPosition.add(hn)}this.activeEvent.data.autoOrient&&(Hi.set(0,1,0).cross(f),Hi.length()<1e-4&&Hi.set(-1,0,0).cross(f),hn.crossVectors(IB,Hi),h.orientationMatrix.makeBasis(Hi,hn,f)),h.pointStart.copy(h.fromPosition),h.pointEnd.copy(h.pointStart),h.currentDampingFactor=this.activeEvent.snapDampingFactor,h.snapped=!0,this.lastDropDestination!==c.object&&(this.lastDropDestination=c.object,this.activeEvent.actionsDrop.Transition.forEach(m=>{m.play()}),this.activeEvent.actionsDrop.Animation.forEach(m=>{m.play()}),this.activeEvent.actionsDrop.Audio.forEach(m=>{m.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(m=>{m.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(m=>{m.dispatchThrottled()}))}else h.orientationMatrix.makeRotationFromQuaternion(h.quat0),this.lastDropDestination=null,h.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(h.obj,h.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.stop()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(f=>{f.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(f=>f.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(f=>f.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(f=>f.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(f=>f.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(f=>f.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(f=>{f.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(f=>{f.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.stop()}))},500),this.updateDragItem(h),h.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new h0e(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(Fh),Fh.negate();let a=Md.identity();switch(r==="parent"?l0e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Hi,a,hn):r==="local"&&e.matrixWorld.decompose(Hi,a,hn),i){case"x":Hi.set(1,0,0).applyQuaternion(a),gp.copy(Fh).cross(Hi),vl.copy(Hi).cross(gp);break;case"y":Hi.set(0,1,0).applyQuaternion(a),gp.copy(Fh).cross(Hi),vl.copy(Hi).cross(gp);break;case"z":Hi.set(0,0,1).applyQuaternion(a),gp.copy(Fh).cross(Hi),vl.copy(Hi).cross(gp);break;case"xy":vl.set(0,0,1).applyQuaternion(a);break;case"yz":vl.set(1,0,0).applyQuaternion(a);break;case"xz":vl.set(0,1,0).applyQuaternion(a);break;case"adaptive":Fh.angleTo(hn.set(0,1,0))>Math.PI/6?(Hi.crossVectors(hn.set(0,1,0),Fh),vl.crossVectors(Hi,hn)):vl.set(0,1,0);break;default:vl.copy(Fh);break}ad.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:ad;if(DB.setFromNormalAndCoplanarPoint(vl,o),!!s.ray.intersectPlane(DB,t)&&(i==="x"||i==="y"||i==="z")){let l=hn.subVectors(t,o).dot(Hi);t.copy(o).addScaledVector(Hi,l)}}updateDragItem(e,t=!1){var i,r;ad.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?ov.subVectors(e.fromPosition,ad).divideScalar(e.currentDampingFactor):e.reset==="original"?(ov.subVectors(e.obj.userData.worldPosition0,ad).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):ov.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(ad).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?ov.length()<o0e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&u0e(e,ov.add(ad),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},vp=new L,OC=new L,gu=new L,vu=new L,RB=new ia,d0e=.01,f0e={type:"requestRender"},p0e=function(){let e=new L,t=new L;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),OB=function(){let e=new je;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof js&&zu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),m0e=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new L,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...LT.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=tn(e,e.actions,r,n,s,i)}},g0e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Vt.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new m0e(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Pa&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Pa&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Nn(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(gu),e.isReset)vu.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(vu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(OC),OC.negate(),vp.copy(OC)):i==="xy"?vp.set(0,0,1):i==="xz"?vp.set(0,1,0):i==="yz"&&vp.set(1,0,0),RB.setFromNormalAndCoplanarPoint(vp,gu),!l.ray.intersectPlane(RB,vu))return}if(!e.isReset){if(vu.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)vu.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(vu.x=gu.x),e.data.enabledTranslation[1]===!1&&(vu.y=gu.y),e.data.enabledTranslation[2]===!1&&(vu.z=gu.z);let s=p0e(gu,vu,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=vp.subVectors(s,gu).divideScalar(e.currentDampingFactor);gu.add(o),t&&OB(e.object,gu),e.paused=o.length()<d0e}else OB(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(f0e)}},lv=new L,Vx=new L,uv=new je,yp=new Wt,Uh=new Wt,hv=new L,cv=new L,od=new L,yu=new L,kC=new ia,v0e=1e-6,y0e={type:"requestRender"},x0e={type:"changeRotation"},kB=function(){let e=new je;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(X6(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof js&&zu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),b0e=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Wt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...zT.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},w0e=class extends As{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Vt.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=t0(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new b0e(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Pa&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Pa&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var f;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:u}=this.eventContext,{object:h,target:c}=e;if(h.getWorldPosition(hv),!e.isReset)if(e.target)e.target.getWorldPosition(cv);else{if(n==="custom"?(l().getWorldDirection(Vx),Vx.negate(),kC.setFromNormalAndCoplanarPoint(Vx,hv)):(n==="xy"?lv.set(0,0,1):n==="xz"?lv.set(0,1,0):n==="yz"&&lv.set(1,0,0),kC.setFromNormalAndCoplanarPoint(lv,hv)),!u.ray.intersectPlane(kC,cv))return;r>0&&(n==="custom"||n===void 0)&&cv.addScaledVector(Vx,r)}if(e.isReset||(c?t==="target"?od.copy(c.up).applyMatrix4(uv.extractRotation(c.matrixWorld)).normalize():a.some(m=>m===!1)?(i==="x"?(yu.set(0,0,1),a[2]===!1&&yu.set(0,1,0)):i==="y"?(yu.set(1,0,0),a[0]===!1&&yu.set(0,0,1)):(yu.set(0,1,0),a[1]===!1&&yu.set(1,0,0)),od.copy(yu).applyQuaternion(e.worldQuaternion0).normalize()):od.set(0,1,0):n==="custom"?od.set(0,1,0):od.copy(lv)),e.isReset)Uh.copy(e.worldQuaternion0);else if(hv.distanceTo(cv)>s&&o&&c)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Uh.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;_0e(uv,cv,hv,od,i,yu),Uh.setFromRotationMatrix(uv),yp.setFromUnitVectors(yu.applyQuaternion(Uh),od),a.some(m=>m===!1)&&t!=="target"&&Uh.premultiply(yp).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),yp.setFromRotationMatrix(X6(h.matrixWorld)),yp.slerp(Uh,1/e.currentDampingFactor),kB(h,uv.makeRotationFromQuaternion(yp)),e.paused=8*(1-yp.dot(Uh))<v0e):(kB(h,uv.makeRotationFromQuaternion(Uh)),e.paused=!0),(f=e.object)==null||f.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(y0e),h.dispatchEvent(x0e)}},Ha=new L,un=new L,Br=new L;function _0e(e,t,i,r,n,s){let a=e.elements;Br.subVectors(t,i),Br.lengthSq()===0&&(Br.z=1),Br.normalize(),un.crossVectors(r,Br),un.lengthSq()===0&&(Math.abs(r.z)===1?Br.x+=1e-4:Br.z+=1e-4,Br.normalize(),un.crossVectors(r,Br)),un.normalize(),Ha.crossVectors(Br,un),n==="x"?s.z===1?[un,Ha,Br]=[Br,un,Ha]:(un.negate(),[un,Br]=[Br,un]):n==="y"?s.x===1?[un,Ha,Br]=[Ha,Br,un]:(un.negate(),[Ha,Br]=[Br,Ha]):s.x===1&&(un.negate(),[un,Ha]=[Ha,un]),a[0]=un.x,a[4]=Ha.x,a[8]=Br.x,a[1]=un.y,a[5]=Ha.y,a[9]=Br.y,a[2]=un.z,a[6]=Ha.z,a[10]=Br.z}var S0e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=tn(t,t.actions,r,n,s,i)}disconnect(){Nn(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},E0e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Vt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Vt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Vt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=t0(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:u}of n.data.events)if(!u.disabled&&u.type==="MouseHover")try{let h=new S0e(l,u,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(h):this.eventsPerObjects[n.uuid]=[h]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof Bn?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof xs||n instanceof Rn)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),Pa&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Pa&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=Pu(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=Sb(r,n,this.objects);t=sP(o),o.forEach(l=>{var u,h;l.object instanceof xs&&Pu(l.object,[((u=l==null?void 0:l.uv)==null?void 0:u.x)??0,((h=l==null?void 0:l.uv)==null?void 0:h.y)??0],Object.keys(this.eventsPerObjects),c=>{t.push(c)})})}else this.objects.forEach(o=>{var u,h;let l=Bw(r,o);l&&(t.push(o),o instanceof xs&&Pu(o,[((u=l==null?void 0:l.uv)==null?void 0:u.x)??0,((h=l==null?void 0:l.uv)==null?void 0:h.y)??0],Object.keys(this.eventsPerObjects),c=>{t.push(c)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},A0e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=tn(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Nn(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},C0e=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=tn(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let u=t.getBoundingClientRect(),h=window.getComputedStyle(e),c=parseFloat(h.marginTop)+parseFloat(h.marginBottom),f=parseFloat(h.top),m=parseFloat(h.bottom),g=u.height-c;if(!isNaN(f))i.top===f?(r.top+=u.top-f,r.bottom+=u.top-f):i.top<0&&(r.top-=g-i.height,r.bottom-=g-i.height);else if(!isNaN(m)){let y=document.body.clientHeight??window.innerHeight,v=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===y-m?(r.top+=u.top-i.height+m+v,r.bottom+=u.top-i.height+m+v):i.bottom<y-m&&(r.top-=g-i.height,r.bottom-=g-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let u=window.innerHeight,h=r.height,c=this.data.enterAnchor,f=c==="top"?u:c==="bottom"?u-h:u-h*.5;this.scrollStart=l-f}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Nn(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},T0e=class extends As{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=t0(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:u,data:h}of s.data.events)if(!h.disabled&&h.type==="Scroll")if(h.trigger==="load"||!r){let c=new A0e(u,h,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(c):this.wheelEventsPerObject.set(s,[c])}else{let c=new C0e(u,h,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(c):this.scrollEventsPerObject.set(s,[c])}}};e.traverseEntity(s=>{var a;(s instanceof xs||s instanceof Rn)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},P0e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=tn(t,t.actions,r,n,s,i)}disconnect(){Nn(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Pd?t.interaction.audioPlayer.play():t.interaction instanceof $2&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof im?t.interaction.play(i==="autoplay"):t.interaction instanceof rP&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Pd?t.interaction.audioPlayer.play():t.interaction instanceof $2&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof im?t.interaction.play():t.interaction instanceof rP&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},M0e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof Pd&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof im&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=t0(i);s&&s==="Start"&&(r instanceof Bn||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:u,data:h}of r.data.events){if(h.disabled||h.type!=="Start")continue;let c=new P0e(u,h,r,t,e,this.eventManager);(c.actions.Transition.length||c.actions.Animation.length||c.actions.SwitchCamera.length||c.actions.Create.length||c.actions.Destroy.length||c.actions.SceneTransition.length||c.actions.Reset.length||c.actions.SetVariable.length||c.actions.DynamicVariablePlay.length||c.actions.ClearLocalStorage.length||c.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(c):this.eventsPerObject.set(r,[c])),c.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(c):this.eventsAfterPerObject.set(r,[c])),c.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(c):this.eventsAfterPerObject.set(r,[c])),c.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(c):this.eventsAfterPerObject.set(r,[c]))}};if(t.traverseEntity(r=>{var n;(r instanceof xs||r instanceof Rn)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},D0e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=tn(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){Nn(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},I0e=class extends As{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],u=[];for(let f=0;f<this.propertiesToWatch.length;f++){let{objectId:m,property:g,prevValue:y}=this.propertiesToWatch[f],v=this.eventContext.scene.find(m),b=BT.propertyPaths[g];if(b[0]==="width"||b[0]==="height"||b[0]==="depth")v=v.geometry.userData.parameters[b[0]];else for(let S=0;S<b.length;S++)v=v[b[S]];y===null?this.propertiesToWatch[f].prevValue=v instanceof L?v.clone():v:(v instanceof L?!v.equals(y):y!==v)&&(u.push({objId:m,property:g}),v instanceof L?this.propertiesToWatch[f].prevValue.copy(v):this.propertiesToWatch[f].prevValue=v)}for(let f=0;f<this.variablesToWatch.length;f++){let{id:m,prevValue:g}=this.variablesToWatch[f],y=a.getVariable(m);y!==g&&(l.push(m),this.variablesToWatch[f].prevValue=y)}for(let f=0;f<this.dynamicVars.length;f++){let{id:m,expectedTime:g,last:y,data:v,timerSeconds:b,startValue:S}=this.dynamicVars[f],_=1e3;if((v.dynamicVariableType==="timer"||v.dynamicVariableType==="stopwatch")&&v.format==="number3decimal"?_=1:v.dynamicVariableType==="counter"?_=v.updateInterval:v.dynamicVariableType==="random"&&(_=v.isStatic?1/0:v.updateInterval),g===-1){this.dynamicVars[f].last=s,this.dynamicVars[f].expectedTime=s+_;continue}if(!((a.getDynamicVariablePlayState(m)==="Stopped"||a.getDynamicVariablePlayState(m)==="Restarted")&&(this.dynamicVars[f].last=s,this.dynamicVars[f].expectedTime=s+_,v.dynamicVariableType==="counter"&&a.getVariable(m)!==S&&(a.updateVariable(m,S),this.eventManager.requestRender()),(v.dynamicVariableType==="timer"||v.dynamicVariableType==="stopwatch")&&this.dynamicVars[f].timerSeconds!==S&&(this.dynamicVars[f].timerSeconds=S,a.updateVariable(m,Xa.getFormattedTimerTime(S,v)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(m)==="Restarted"&&a.setDynamicVariablePlayState(m,"Playing"),a.getDynamicVariablePlayState(m)==="Stopped"))){if(a.getDynamicVariablePlayState(m)==="Paused"){this.dynamicVars[f].deltaToExpectedTime===void 0&&(this.dynamicVars[f].deltaToExpectedTime=Math.max(this.dynamicVars[f].expectedTime-s,0)),this.dynamicVars[f].last=s-(_-this.dynamicVars[f].deltaToExpectedTime),this.dynamicVars[f].expectedTime=s+this.dynamicVars[f].deltaToExpectedTime;continue}else this.dynamicVars[f].deltaToExpectedTime=void 0;if(s>=g)if(this.dynamicVars[f].last=s,this.dynamicVars[f].expectedTime+=_,v.dynamicVariableType==="random"){let T=v.min+Math.random()*(v.max-v.min),M=v.decimals;T=Math.round(T*Math.pow(10,M))/Math.pow(10,M),a.updateVariable(m,T),l.push(m),this.eventManager.requestRender()}else if(v.dynamicVariableType==="counter"){let T=a.getVariable(m),M=a.getDynamicVariableToggleIsForward(m)??!0,C=a.getVariable(m)+v.increment*(M?1:-1);v.hasEnd&&(C=v.increment>0?ht.clamp(C,S,v.endValue):ht.clamp(C,v.endValue,S),C===S&&a.setDynamicVariableToggleIsForward(m,void 0),v.repeat?C===v.endValue&&(C=S):(C===S||C===v.endValue)&&a.setDynamicVariablePlayState(m,"Paused")),C!==T&&(l.push(m),a.updateVariable(m,C),this.eventManager.requestRender())}else if(v.dynamicVariableType==="time"){let T=a.getVariable(m),M=Wz(o,v);if(typeof T=="object"&&"textValue"in T&&typeof M=="object"&&"textValue"in M){if(Array.isArray(T.textValue)&&Array.isArray(M.textValue)){if(T.textValue.every((C,P)=>C===M.textValue[P]))continue}else if(T.textValue===M.textValue)continue}else if(T===M)continue;a.updateVariable(m,M),l.push(m),this.eventManager.requestRender()}else{let T=is.isTextValue(v.endValue)?LB(v.endValue.textValue):v.endValue,M=a.getDynamicVariableToggleIsForward(m)??!0,C=b+(s-y)/1e3*(v.dynamicVariableType==="timer"?-1:1)*(M?1:-1);C=Math.max(C,0),v.hasEnd&&(C=v.dynamicVariableType==="stopwatch"?ht.clamp(C,S,T):ht.clamp(C,T,S),C===S&&a.setDynamicVariableToggleIsForward(m,void 0),v.repeat?Math.abs(C-T)<(v.format==="number3decimal"?1e-4:.1)&&(C=S):(Math.abs(C-S)<(v.format==="number3decimal"?1e-4:.1)||Math.abs(C-T)<(v.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(m,"Paused")),C!==b&&(l.push(m),this.dynamicVars[f].timerSeconds=C,a.updateVariable(m,Xa.getFormattedTimerTime(C,v)),this.eventManager.requestRender())}}}let h=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,h=!0);let c=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,c=!0),this.events.forEach(f=>{(l.includes(f.data.variableId)||u.find(m=>m.objId===f.data.objectId&&m.property===f.data.property)||f.data.variableId==="mouseProperty"&&h||f.data.variableId==="raycastProperty"&&c)&&(f.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new R0e(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(is.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,Wz(new Date,i)),i.dynamicVariableType==="counter"&&(r=is.isTextValue(i.value)?LB(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},R0e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=tn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){Nn(this.actions)}};function LB(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var O0e="https://unpkg.com/@splinetool/runtime@1.9.59/build/",k0e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.59/build/",L0e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${O0e}' + 'navmesh.js'),
		fetch('${k0e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,z0e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,N0e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,B0e=.001,F0e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},$6,bi,Xn;Aae.then(e=>{$6=e,bi=new e.Vec3,Xn=new e.Vec3});var U0e=new L,V0e=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(Vt.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=U0e.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var f,m,g,y,v,b,S;let s;if(n instanceof Ja)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof rs)s=n.object;else if(s=n,((f=s.dataPatched.cloner)==null?void 0:f.disabled)===!1&&((m=s.dataPatched.cloner)==null?void 0:m.hideBase)&&((g=s.dataPatched.physics)==null?void 0:g.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((y=a.physics)==null?void 0:y.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=Fw(a),l=s.userData.hasDestroy,u=s.userData.hasDrag,h=!1,c=!1;for(let _ of a.events)_.data.disabled!==!0&&(_.data.type==="GameControl"?h=!0:_.data.type==="Follow"&&(c=!0));if(h||o||c||l||u)return!0;if(this.usePhysics&&((v=a.physics)==null?void 0:v.rigidBody)==="dynamic"){if(this.usePhysics&&((b=a.physics)!=null&&b.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(Tu(n.geometry,n.matrixWorld)),this.usePhysics&&((S=a.physics)==null?void 0:S.fusedBody))return n.traverseObject((_,T)=>{var P,E;if(T===0)return;let M;if(_ instanceof Ja)if(_.objectForSample){if(_.objectForSample.dataPatched.physics.fusedBody)return;M=_.object}else return _.object.dataPatched.physics.fusedBody===!0&&_.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(_ instanceof rs)M=_.object;else if(M=_,(P=_.dataPatched.cloner)==null?void 0:P.hideBase)return!0;let C=M.dataPatched;if(!C.visible&&((E=C.physics)==null?void 0:E.enabled)!==!0)return!0;"geometry"in _&&_.geometry&&i.push(Tu(_.geometry,_.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof Ja)return;n instanceof rs?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,u=s.userData.hasDrag===!0;if(Fw(a)||l||u||s.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return!0;o&&i.push(Tu(o,n.matrixWorld))},this.navmeshWasm=$6,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?L0e:z0e)+N0e])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new L().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var h;let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=!0}),(h=u.cloner)==null||h.traverseObject(c=>{c.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var h;let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=void 0}),(h=u.cloner)==null||h.traverseObject(c=>{c.userData.navmesh=void 0})}),r.length===0)return!1;let s=Td(r),{positions:a,triIndices:o}=O_(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...F0e,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new St;return a.setIndex(new Bt(n,1)),a.setAttribute("position",new Bt(s,3)),a}getClosestPoint(e){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.getClosestPoint(bi)}getClosestPointToRef(e,t){bi.x=e.x,bi.y=e.y,bi.z=e.z;let i=this.navMesh.getClosestPoint(bi);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.getRandomPointAround(bi,t)}getRandomPointAroundToRef(e,t,i){bi.x=e.x,bi.y=e.y,bi.z=e.z;let r=this.navMesh.getRandomPointAround(bi,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Xn.x=t.x,Xn.y=t.y,Xn.z=t.z,this.navMesh.moveAlong(bi,Xn)}moveAlongToRef(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Xn.x=t.x,Xn.y=t.y,Xn.z=t.z,this.navMesh.moveAlong(bi,Xn)}computePath(e,t){let i=this.getClosestPoint(t);if(Xn.x=i.x,Xn.y=i.y,Xn.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(bi,Xn),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new L(o.x,o.y,o.z))}return s}createCrowd(e,t){return new j0e(this,e,t)}setDefaultQueryExtent(e){bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.setDefaultQueryExtent(bi)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,this.navMesh.addCylinderObstacle(bi,t,i)}addBoxObstacle(e,t,i){return bi.x=e.x,bi.y=e.y,bi.z=e.z,Xn.x=t.x,Xn.y=t.y,Xn.z=t.z,this.navMesh.addBoxObstacle(bi,Xn,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},j0e=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new L(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=B0e)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],u=this._agentDestination[r].y-this.reachRadii[r],h=this._agentDestination[r].y+this.reachRadii[r],c=a*a+o*o;s.y>u&&s.y<h&&c<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new L(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function H0e(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&gy.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var G0e={type:"change"},zB={type:"changeZoom"},W0e={type:"changePan"},ld={type:"start"},ud={type:"end",changed:!0},q0e={type:"end",changed:!1},LC=new Wt,NB=new oe,X0e=2*Math.PI,Y0e=1e-8,Q0e=.01,zC=new L,jx=new oe,NC=new L,Hx=new Wt,BB=new je,K0e={type:"requestRender"},eH=class extends as{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Ba.DOLLY_ROTATE,Ba.PAN],this.offset=new L,this.eye=new L,this.lastPosition=new L,this.lastQuaternion=new Wt,this.current=new oe,this.overShoot=new oe,this.overRatio=new oe,this.spherical=new lk,this.sphericalDelta=new lk,this.panOffset=new L,this.panLeftV=new L,this.panUpV=new L,this.panV=new L,this.rotateStart=new oe,this.rotateEnd=new oe,this.rotateDelta=new oe,this.panStart=new oe,this.panEnd=new oe,this.panDelta=new oe,this.dollyStart=new oe,this.dollyEnd=new oe,this.dollyDelta=new oe,this.rotationRangeFactor=new oe,this.panRangeFactor=new oe,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(NC,Hx,zC),this.offset.copy(NC).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(LC.copy(Hx).invert()),this.panOffset.applyQuaternion(LC),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Hx),this.panOffset.applyQuaternion(Hx)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),NC.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(BB.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(BB));let r=this.spherical.phi%X0e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(qi.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>Q0e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>Y0e?(this.dispatchEvent(G0e),this.object.dispatchEvent(K0e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&Pa?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(ld),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Pa||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,zC.subVectors(this.position0,this.target0),this.spherical.setFromVector3(zC),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?jx.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):jx.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(jx).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(NB,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(jx).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&Pa?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Vt.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Vt.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(ud):this.dispatchEvent(q0e),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Pa||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!ex(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(ex(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(ex(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Vt.length>1&&r.preventDefault(),this.touches[Vt.length-1]){case Ba.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Ba.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Ba.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Ba.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Vt.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=cy(()=>this.dispatchEvent(ud),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(ld),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!Xy)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(ld),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(ud)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(ld))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Vt[0]),r.key===" "&&this.dispatchEvent(ud))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(LC.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=yl(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=yl(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=yl(yl(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=yl(yl(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Ba.ROTATE),e.panTouches===1&&(this.touches[0]=Ba.PAN),e.orbitTouches===2&&(this.touches[1]=Ba.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Ba.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Ba.ROTATE),e.panTouches===3&&(this.touches[2]=Ba.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,u,h;e instanceof L?(l=e.x,u=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,u=e.phi,this.current.set(yl(this.spherical.theta),yl(this.spherical.phi)),h=!1),i===0&&(this.current.x+=l,this.current.y+=u),(t===3||t===2)&&(!h&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),h||(this.overShoot.x=yl(this.overShoot.x),this.overShoot.y=yl(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=FB(Math.abs(this.overRatio.x)),this.overRatio.y=FB(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),u*this.overShoot.y<0&&!this.phiIsFree&&(u*=1-this.overRatio.y)):i===2&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(u=this.overShoot.y*.05),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,u+=this.overShoot.y),e instanceof L?(e.x=l,e.y=u):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=u))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(W0e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(zB)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(zB)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(ld),this.dollyOut(e),this.dispatchEvent(ud)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(ld),this.dollyIn(e),this.dispatchEvent(ud)}setZoom(e){if(this.dispatchEvent(ld),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(ud)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(NB,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(xae===!1&&ex(e)===!1&&wae(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Vt.length===2){let e=.5*(Vt[0].pageX+Vt[1].pageX),t=.5*(Vt[0].pageY+Vt[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Vt[0].pageX,Vt[0].pageY)}handleTouchStartPan(){if(Vt.length===2){let e=.5*(Vt[0].pageX+Vt[1].pageX),t=.5*(Vt[0].pageY+Vt[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Vt[0].pageX,Vt[0].pageY)}handleTouchStartDolly(){let e=Vt[0].pageX-Vt[1].pageX,t=Vt[0].pageY-Vt[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Vt.length===2){let i=AA(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==Vt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Vt.length===2){let t=AA(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==Vt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=AA(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function yl(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function FB(e){return 1-Math.pow(1-e,4)}var UB=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=tn(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){Nn(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Ii;Tae.then(e=>Ii=e);var Xr=new L,Po=new Wt,Vh=new L,BC=new dn(0,0,0,"YXZ"),VB=new dn(0,0,0,"XYZ"),Mo=new L,FC=new L,UC=new L(1,1,1),xp=new Wt,Gx=new je,jB=new je,Z0e={type:"updateMatrix"},HB=new Wt,VC=new ua,aP={type:"beginEvent",eventName:"Collision"},J0e={type:"beginEvent",eventName:"Trigger"};function $0e(e){if(gy.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var Fw=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),e1e=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Ii.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(Xr.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),Po.copy(t.rotation()),i.matrixWorld.compose(Xr,Po,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(Z0e),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,u;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let h=this.sharedGameControlGlobals.createdObjects.length-1;h>=0;h--){let c=this.sharedGameControlGlobals.createdObjects[h];if(c.userData.hasCollisionDestroy&&(((a=c.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=c.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(h,1),c.removeFromParent(),requestAnimationFrame(()=>{var f;return(f=this.sharedGameControlGlobals.rapierWorld)==null?void 0:f.removeRigidBody(c.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let h=this.sharedGameControlGlobals.colliderToEntity.get(i),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c===void 0)return;for(let f of c)f.data.target==="character"&&this.dispatchCollisionEvent(f,h,i)}else if(((u=this.gameControl)==null?void 0:u.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let h=this.sharedGameControlGlobals.colliderToEntity.get(t),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c===void 0)return;for(let f of c)f.data.target==="character"&&this.dispatchCollisionEvent(f,h,t)}else{let h=this.sharedGameControlGlobals.colliderToEntity.get(t),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c!==void 0)for(let g of c)g.data.target==="scene"&&this.dispatchCollisionEvent(g,h,t);let f=this.sharedGameControlGlobals.colliderToEntity.get(i),m=this.sharedGameControlGlobals.entityToCollisionEvents[f==null?void 0:f.uuid];if(m!==void 0)for(let g of m)g.data.target==="scene"&&this.dispatchCollisionEvent(g,f,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=G6,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var u,h;let i,r=t instanceof Hv,n=t instanceof Gv;if(t instanceof Ja||r||n)return;t instanceof rs?i=t.object:i=t;let s=i.dataPatched;if(((u=s.physics)==null?void 0:u.enabled)==="visibility"?!s.visible:!((h=s.physics)!=null&&h.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(Fw(s)||o||l||i.dataPatched.events.some(c=>c.data.disabled!==!0&&(c.data.type==="GameControl"||c.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Tu(a,t.matrixWorld))}),e.length>0){let t=Td(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new Vv(t)}}addRigidBody(e,t,i){if(q6(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(Tu(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Ii.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Ii.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=Ii.RigidBodyDesc.fixed();let l=Td(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Xr,Po,Vh),e.position0=Xr.clone().divideScalar(this.pixelsPerMeter),e.rotation0=Po.clone(),Xr.divideScalar(this.pixelsPerMeter),a.setTranslation(Xr.x,Xr.y,Xr.z).setRotation(Po),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(Vh.x/this.pixelsPerMeter,Vh.y/this.pixelsPerMeter,Vh.z/this.pixelsPerMeter);let u=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(u.handle,[e,Vh.clone(),s.physics.fusedBody]);let h=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(u,s.physics,l,t,h)}catch{try{this.addCollider(u,s.physics,l,t,!1)}catch(c){console.error(c)}}e.rigidBody=u}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Tu(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=Td(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new Vv(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Ii.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(u=>u.target==="scene")&&a.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof Ja)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof rs)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Tu(a,i.matrixWorld))}}activate(e){var f,m;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,u=null;if(l)for(let g of l.data.events){if(g.data.disabled||g.data.type!=="GameControl")continue;let y=l;for(;this.usePhysics&&((f=y=y.parent)==null?void 0:f.parent)!==null;)(m=y.data.physics)==null||m.fusedBody;g.data.collisionEnabled&&(this.needsCollisionDetection=!0),u===null&&(u=g.data)}if(this.page.traverseEntity(g=>{for(let y of g.dataPatched.events)if(y.data.disabled===!1&&y.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&u&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||u.camera===t.uuid||l.uuid===t.uuid;let g=new W6(l,this.renderer.domElement,u,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&u.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=g,r=u.joystickPosLoc,n=u.joystickRotLoc,s=u.jumpTouchButtonLoc,a=u.rotByTouch,Pa&&u.touchControl&&(this.joystickToGameControls[r]="pos",u.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let g=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new V0e(this.usePhysics,this.isExport);let y;g.collider.type==="sphere"?y=g.collider.radius*2:y=g.collider.height,y=Math.floor(y/g.navmesh.ch-1),this.navigationMeshWrapper.init({...g.navmesh,walkableHeight:y},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:g,enablePan:y,enableZoom:v,autoRotate:b,hoverRotatePanMode:S}=this.eventManager.publish.orbitControls;(g||y||v||b||S!==0)&&(this.orbitControls=new eH(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),c=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((g,y)=>{let v=document.body.appendChild(document.createElement("div")),[b,S,_]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[y],T=(h-5*b)/4+b,M={},C=g==="jmp",P=C?0:b;y<10?(y<5?M.top=P/2:M.bottom=P/2,M.left=P/2+y%5*T):y===10?(M.left=P/2,M.top=c/2):(M.right=P/2,M.top=c/2),M.top?M.top-=S[1]:M.bottom+=S[1],M.left?M.left+=S[0]:M.right-=S[0];for(let I in M)M[I]+="px";if(C){let I=v.appendChild(document.createElement("div"));Object.assign(I.style,M,{position:"absolute",width:b+"px",height:b+"px",backgroundColor:`rgba(255,255,255,${_==="show"?.4:0})`,zIndex:"9999",borderRadius:b+"px",border:_==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let O=b/16*16*.4;_==="show"&&(I.innerHTML=`
						<svg width="${O}" height="${b*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),I.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),I.addEventListener("touchend",N=>N.preventDefault()),this.joysticks[y]=[void 0,v];return}let E={zone:v,mode:"static",position:M,size:b};_==="hide"&&(E.restOpacity=0);let D=hve.create(E);D.on("move",(I,O)=>{let N=this.gameControl;g==="pos"?O.force<.2?N.moveForce=0:(N.movementState.movePosZ=Math.sin(-O.angle.radian),N.movementState.movePosX=Math.cos(-O.angle.radian),O.force>1.2?N.movementState.run=1:N.movementState.run=0,O.force<.3?N.moveForce=(O.force-.2)/.1:N.moveForce=1):g==="rot"&&(O.force<.2?N.rotForce=0:(N.movementState.rotPosX=O.vector.y,N.movementState.rotPosY=-O.vector.x,O.force<.3?N.rotForce=(O.force-.2)/.1:N.rotForce=1)),this.requestRender()}),D.on("end",(I,O)=>{let N=this.gameControl;g==="pos"?(N.movementState.movePosZ=0,N.movementState.movePosX=0,N.moveForce=1):g==="rot"&&(N.movementState.rotPosX=0,N.movementState.rotPosY=0,N.rotForce=1)}),this.joysticks[y]=[D,v]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(g=>g.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new Ii.World(new Ii.Vector3(0,this.gravity,0)),this.events=new Ii.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var b,S,_,T;let l;if(o instanceof Ja)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof rs)l=o.object;else{if(o instanceof Gv||o instanceof Hv)return;if(l=o,((b=l.dataPatched.cloner)==null?void 0:b.disabled)===!1&&((S=l.dataPatched.cloner)==null?void 0:S.hideBase)&&((_=l.dataPatched.physics)==null?void 0:_.fusedBody)!==!0)return!0}let u=l.dataPatched,h;for(let M of u.events)M.data.disabled!==!0&&M.data.type==="GameControl"&&(h=M.data);if(!u.physics||(u.physics.enabled==="visibility"?!u.visible:!u.physics.enabled))return!0;o.updateMatrixWorldSVD();let c=Fw(u),f=!1,m=l.userData.hasDestroy,g=l.userData.hasDrag,y=!1;for(let M of u.events)if(M.data.disabled!==!0){if(M.data.type==="Collision"){f=!0;let C=new D0e(M.id,M.data,l,this.page,this.sharedAssets,this.eventManager);C.initialDisabled=!0,this.collisionEvents.push(C),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(P=>P.id!==M.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(C):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[C]}else if(M.data.type==="Follow"){y=!0;let C=M.data.target;o.traverseVisible(P=>{P.userData.isFollowingObj=C})}}u.physics.rigidBody==="dynamic"&&u.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let v=o.geometry;if(h!==void 0){let M=Ii.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Xr,Po,Vh),o.position0=Xr.clone().divideScalar(this.pixelsPerMeter),o.rotation0=Po.clone(),Xr.divideScalar(this.pixelsPerMeter),M.setTranslation(Xr.x,Xr.y,Xr.z).setRotation(Po);let C=this.sharedGameControlGlobals.rapierWorld.createRigidBody(M);o.rigidBody=C;let P;h.collider.type==="sphere"?P=Ii.ColliderDesc.ball(h.collider.radius/this.pixelsPerMeter):h.collider.type==="capsule"?P=Ii.ColliderDesc.capsule((h.collider.height/2-h.collider.radius)/this.pixelsPerMeter,h.collider.radius/this.pixelsPerMeter):P=Ii.ColliderDesc.cuboid(h.collider.width/this.pixelsPerMeter/2,h.collider.height/this.pixelsPerMeter/2,h.collider.depth/this.pixelsPerMeter/2),P.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(u.physics.density).setFriction(u.physics.friction).setRestitution(u.physics.restitution);let E=this.sharedGameControlGlobals.rapierWorld.createCollider(P,C);this.sharedGameControlGlobals.colliderToEntity.set(E.handle,l),Xr.fromArray(h.collider.position).multiply(Vh.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),E.setTranslationWrtParent(Xr);let D=new Wt().setFromEuler(new dn().setFromVector3(new L().fromArray(h.collider.rotation)));E.setRotationWrtParent(D),E.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else u.physics.rigidBody==="dynamic"||c||y||m||g||f?(this.addRigidBody(o,l,{hasFollow:y,hasTransformAnim:c,hasDrag:g}),this.generateSensorColliderDescs(l,u.physics.fusedBody)):(v&&e.push(Tu(v,o.matrixWorld)),u.physics.fusedBody&&o.traverseObject((M,C)=>{var I;if(C===0)return;let P;if(M instanceof Ja)if(M.objectForSample){if(M.objectForSample.dataPatched.physics.fusedBody)return;P=M.object}else return M.object.dataPatched.physics.fusedBody===!0&&M.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(M instanceof Gv||M instanceof Hv)return;if(M instanceof rs)P=M.object;else if(P=M,(I=P.dataPatched.cloner)==null?void 0:I.hideBase)return!0}let E=P.dataPatched;if(E.physics.enabled==="visibility"?!E.visible:!E.physics.enabled)return!0;let D=M.geometry;(D==null?void 0:D.getAttribute("position"))!==void 0&&e.push(Tu(D,M.matrixWorld))}),this.generateSensorColliderDescs(l,u.physics.fusedBody,t));if(((T=u.physics)==null?void 0:T.fusedBody)===!0||h)return!0}),e.length===0)return;let i=Td(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Ii.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Ii.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Ii.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let u=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[u.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new UB(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new je().compose(Mo.fromArray(t.data.position),xp.setFromEuler(VB.fromArray(t.data.rotation)),UC);if(t.data.triggerZone==="box"){let n=new jr;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Xr,Po,Vh),BC.setFromQuaternion(Po);let i=t;i.prevR===void 0?(i.prevR=BC.clone(),i.prevT=Xr.clone()):(i.prevR.copy(BC),i.prevT.copy(Xr)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(Xr.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(Po))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(aP)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=jB.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new UB(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Ii.ColliderDesc.cuboid(...a.data.size.map(u=>u/(2*this.pixelsPerMeter))):l=Ii.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),Mo.fromArray(a.data.position),xp.setFromEuler(VB.fromArray(a.data.rotation)),Gx.compose(Mo,xp,UC).premultiply(n.matrixWorld),i?(Gx.decompose(Mo,xp,FC),l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED)):(Gx.premultiply(r).decompose(Mo,xp,FC),e.rigidBody.bodyType()===Ii.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Ii.RigidBodyType.Fixed?l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Ii.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Mo.divideScalar(this.pixelsPerMeter),l.setTranslation(Mo.x,Mo.y,Mo.z),l.setRotation(xp),i)i.push([l,o]);else{let u=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[u.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Si.is(o)?o:o.object)===!1)continue;let l=jB.copy(n.matrixWorld).decompose(Mo,HB,FC).compose(Mo,HB,UC).multiply(r),u=Gx.copy(o.matrixWorld).invert().multiply(l);i instanceof jr?e=o.bvhGeometry.boundsTree.intersectsBox(i,u):(VC.radius=i,VC.center.setFromMatrixPosition(u),e=o.bvhGeometry.boundsTree.intersectsSphere(VC)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(J0e)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(h=>h!==o)}}}};function t1e(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===FP;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===r5){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var GB=!1,i1e=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=vT.parse(JSON.parse(s[2]));n.animations[a]=l;let u=this.mixer.clipAction(l,n);GB===!1&&(Object.getPrototypeOf(u)._updateTime=t1e,GB=!0),u.clampWhenFinished=!0,this.clipIdToAction[o]=u})},this.mixer=new UZ(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=n5}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=FP)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return z6(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},jC=new WeakMap,r1e=class extends Hy{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new yT(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(jC.has(e)){let o=jC.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,u)=>{r._callbacks[n]={resolve:l,reject:u},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),jC.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new St;e.index&&t.setIndex(new Bt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new Bt(s,a))}return t}_loadLibrary(e,t){let i=new yT(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=n1e.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function n1e(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(c){h({draco:c})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,u=o.taskConfig;t.then(h=>{let c=h.draco,f=new c.Decoder,m=new c.DecoderBuffer;m.Init(new Int8Array(l),l.byteLength);try{let g=i(c,f,m,u),y=g.attributes.map(v=>v.array.buffer);g.index&&y.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},y)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{c.destroy(m),c.destroy(f)}});break}};function i(a,o,l,u){let h=u.attributeIDs,c=u.attributeTypes,f,m,g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)f=new a.Mesh,m=o.DecodeBufferToMesh(l,f);else if(g===a.POINT_CLOUD)f=new a.PointCloud,m=o.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());let y={index:null,attributes:[]};for(let v in h){let b=self[c[v]],S,_;if(u.useUniqueIDs)_=h[v],S=o.GetAttributeByUniqueId(f,_);else{if(_=o.GetAttributeId(f,a[h[v]]),_===-1)continue;S=o.GetAttribute(f,_)}y.attributes.push(n(a,o,f,v,b,S))}return g===a.TRIANGULAR_MESH&&(y.index=r(a,o,f)),a.destroy(f),y}function r(a,o,l){let u=l.num_faces()*3,h=u*4,c=a._malloc(h);o.GetTrianglesUInt32Array(l,h,c);let f=new Uint32Array(a.HEAPF32.buffer,c,u).slice();return a._free(c),{array:f,itemSize:1}}function n(a,o,l,u,h,c){let f=c.num_components(),m=l.num_points()*f,g=m*h.BYTES_PER_ELEMENT,y=s(a,h),v=a._malloc(g);o.GetAttributeDataArrayForAllPoints(l,c,y,g,v);let b=new h(a.HEAPF32.buffer,v,m).slice();return a._free(v),{name:u,array:b,itemSize:f}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var hc;function s1e(){return hc||(hc=new r1e,hc.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),hc.decoderPending}async function a1e(e){if(hc){let t={attributeIDs:hc.defaultAttributeIDs,attributeTypes:hc.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await hc.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function o1e(e,t){let[i,r]=VU(OT.deserialize(new Uint8Array(e)));return dV(i),r.result().data}function l1e(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function u1e(e){for(let t of e){let i=await a1e(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var h1e=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},c1e=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=tn(r,i.actions,s,a,o,n)}disconnect(){Nn(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},d1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=NT.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:u})=>{try{let h=new c1e(o,u,l,a,n,e,t,this.eventManager);this.breakpoints.push(h)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof xs||n instanceof Rn)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},f1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new p1e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},p1e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=tn(t,t.successActions,r,n,s,i),this.errorActions=tn(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},m1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new g1e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},g1e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=tn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function v1e(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var y1e=new L(0,0,1),WB=new L,qB=new L,XB=new Zr,x1e=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new Vj,this.doubleClickHandler=new h1e,this.isDragging=!1,this.plane=new ia,this.caretInterval=0,this.planeIntersection=new L,this.projected=new oe,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,u=Cme(l,this.sharedAssets);this.helper.setCaretColor(u)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=v1e(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof nD)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new L);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(XB.getNormalMatrix(this.virtualInput.matrixWorld),WB.copy(y1e).applyMatrix3(XB).normalize(),this.virtualInput.localToWorld(qB.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(WB,qB))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=b1e(e.geometry.horizontalAlign))}};function b1e(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var tH=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return tH(i.value,t)}return is.getDisplayedValue(e)};function YB(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=tH(n.value,t.variables))}else r=i.textValue.toString();return r}var w1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new la,this.helper=new Vj,this._onMouseDownFocusIn=i=>{if(Vt.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let u=l;this.eventContext.sharedAssets.updateVariable(u,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new x1e(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof nD&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=YB(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=YB(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},_1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new S1e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},S1e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=tn(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},E1e=class extends As{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new A1e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},A1e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=tn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},C1e=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var u;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((u=s.touches)==null?void 0:u.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){var r,n;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new $ye(this.eventContext),VariableChange:new I0e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new f1e(this.eventContext,this),WEBHOOK:new m1e(this.eventContext,this),AIAssistantListener:new _1e(this.eventContext,this),AIAssistantTrigger:new E1e(this.eventContext,this),Conditional:new a0e(this.eventContext,this),Start:new M0e(this.eventContext,this),Basic:new t0e(this.eventContext,this,this.needsRaycast),MouseHover:new E0e(this.eventContext,this),Scroll:new T0e(this.eventContext,this),Follow:new g0e(this.eventContext,this),DragDrop:new c0e(this.eventContext,this),LookAt:new w0e(this.eventContext),Resize:new d1e(this.eventContext,this),Textfields:new w1e(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(s=>{s.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(s=>s.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect(),(n=this.eventContext.sharedAssets.openAIRealtime)==null||n.start())}deactivate(e=!1){var r;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;if(i.style.cursor="",Object.values(this.handlers).forEach(n=>n.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(n=>{n.removeEventListener("requestRender",this.requestRender),n.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),!e){let n=this.eventContext.sharedAssets.openAIRealtime;n==null||n.disconnect(),n==null||n.stop().then(()=>{n==null||n.disconnect()})}}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},T1e=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new oe().copy(i),this._editorSize=new oe().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=P1e(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function P1e(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var M1e=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new XM(e.shared,t,!0,i),this.scene=new oD(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof Rn&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Jr&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},D1e=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function I1e(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function Qv(e){return e instanceof Sy?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function R1e(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof js)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof js&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!Ln.isMergable(a))return}else{let u=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(u&&"material"in u&&typeof u.material!="string"){if(!Ln.isMergable(u.material))return;s=Ln.getHash(u.material)}}i[s]||(i[s]={});let o=i[s][Qv(r)];if(o){if(o.push(r),r.cloner)for(let u of r.cloner.children)o.push(u)}else if(i[s][Qv(r)]=[r],r.cloner)for(let u of r.cloner.children)i[s][Qv(r)].push(u)}),i}function O1e(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function k1e(e,t){let i=R1e(t,e),r=O1e(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),u=0,h=new Array(r),c=0;for(let[f,m]of Object.entries(i))for(let g of Object.values(m)){if(o=0,u=0,g.forEach(v=>{v instanceof js&&(a[o++]=v.geometry.clone(),l[u++]=v)}),u<2)continue;for(let v=0;v<u;v++)l[v].updateWorldMatrix(!0,!1),a[v].applyMatrix4(l[v].matrixWorld),l[v].matrixWorld.determinant()<0&&I1e(a[v]);let y=Td(a.slice(0,o),!1);if(y){let v;switch(f){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),v=new ar(y,l[0].material);break}default:{v=new ar(y,l[0].material);break}}v.castShadow=l[0].castShadow,v.receiveShadow=l[0].receiveShadow,t.add(v);let b=S=>{c=0;for(let _ of S)_.children&&b(_.children),_ instanceof js&&(Array.isArray(_.material)||i[_.material.uuid]&&i[_.material.uuid][Qv(_)]&&i[_.material.uuid][Qv(_)].length>1||(h[c++]=_));for(let _=0;_<c;_++)t.attach(h[_])};for(let S=0;S<u;S++){let _=l[S];b(_.children),n[s++]=_}}}for(let f=0;f<s;f++)n[f].removeFromParent()}var L1e=Oc(E8(),1),z1e=new oe;function N1e(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var B1e=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,u,h,c,f,m,g,y,v;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(u=this._eventManager.handlers)!=null&&u.Conditional.hasVideoAction)&&(this._skipRender=!1),(h=this._animationControls)==null||h.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(c=this._scene)==null||c.traverseVisibleEntity(b=>{b.type==="ParticleSystem"&&(b.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(f=this._eventManager)!=null&&f.isEnabled&&(((m=this._eventManager.handlers)==null?void 0:m.Follow).onAnimationFrameDamping(),((g=this._eventManager.handlers)==null?void 0:g.LookAt).onAnimationFrameDamping(),((y=this._eventManager.handlers)==null?void 0:y.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let b=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=b,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(v=this._perfs)==null||v.end()},this._resize=r=>{var n,s,a,o,l,u,h,c,f,m;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=z1e.set(this._viewportWidth,this._viewportHeight)),r){let g=this._viewportWidth,y=this._viewportHeight;this._renderer.setSize(g-1,y-1,!1),this._renderer.setSize(g,y,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(h=this._scene)==null||h.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((u=this._frameView)==null?void 0:u.enableResponsive)??!1),this._camera){let g=Object.values(((c=this._data)==null?void 0:c.frames)??{})[0].preset??"fullscreen";(f=this._frameView)==null||f.setCamera(this._camera),(m=this._frameView)==null||m.updateCamera(g!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=cy(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new D1e({x:10,y:10})),Sae(e)}async load(e,t,i){N1e(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,u,h,c;if(this.disposed)return;let r=await o1e(e);this._data=r;let n=l1e(r);r.version&&(0,L1e.default)(r.version,"1.9.59")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&s1e(),yN(r)&&The(),Vde(r)&&She(),gy.physicsEnabled(r.scene.objects)&&Pae(),fN(r)&&lde(),YN(r)&&Jge(),ade(r)&&sde(),FN(r)&&Bme(),H0e(r)&&Cae()].filter(Boolean)),n.length&&await u1e(n),(l=this._eventManager)==null||l.deactivate(),(u=this._controls)==null||u.deactivate(),(h=this._scene)==null||h.dispose();let s=new M1e(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let f=performance.now();k1e(r,s.scene);let m=performance.now();console.log("Merged geometries in ",m-f," ms")}yN(r)&&this._scene.traverse(f=>{zu(f)&&f.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var f;this._requestRenderAutoMode(),(f=this._scene)==null||f.traverse(m=>{m instanceof Ja&&m.pendingMediaLoad&&m.update()})}),(c=this._scene)==null||c.traverse(f=>{f.type==="ParticleSystem"&&(f.wakeUp(),f.data.autoPlay?f.start():f.stop())});let a=Object.keys(r.shared.fonts).map(f=>this._sharedAssetsManager.getFont(f).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),fN(r)&&$0e(r)&&await Promise.all(a),FN(r)){let f=[];this._scene.traverseEntity(m=>{(m instanceof xs||m instanceof Rn)&&m.uiCanvas&&f.push(m.uiCanvas)}),await Promise.all(f.map(m=>m.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),bD(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new Eme({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let f=this._sharedAssetsManager.getImage("SplineWatermark");await f.loadPromise;let m=f.getTexture(1001);this._renderer.pipeline.setWatermark(m)}YN(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new T1e(this._renderer,this._camera,new oe(this._viewportWidth,this._viewportHeight),new oe(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let f=new Zye(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new e1e(f),this._animationControls=new i1e(this._scene,this._requestRenderAutoMode),this._eventManager=new C1e(r.scene.publish,this._controls,this._animationControls,f,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var f;(f=this._renderer)==null||f.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&is.isTextValue(e)?is.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==jm&&!this._scene.isInvisibleObjects(i)&&!(i instanceof Rn)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof eH&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new ns(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{yk.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,Eae(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof Rn&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof Rn||e instanceof oD||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=yk(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){xj.skiaWasmUrl=e}},HC,QB;function F1e(){if(QB)return HC;QB=1;var e="Expected a function",t=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof b1=="object"&&b1&&b1.Object===Object&&b1,u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")(),c=Object.prototype,f=c.toString,m=Math.max,g=Math.min,y=function(){return h.Date.now()};function v(M,C,P){var E,D,I,O,N,k,U=0,Q=!1,se=!1,K=!0;if(typeof M!="function")throw new TypeError(e);C=T(C)||0,b(P)&&(Q=!!P.leading,se="maxWait"in P,I=se?m(T(P.maxWait)||0,C):I,K="trailing"in P?!!P.trailing:K);function H(me){var de=E,fe=D;return E=D=void 0,U=me,O=M.apply(fe,de),O}function ie(me){return U=me,N=setTimeout(X,C),Q?H(me):O}function $(me){var de=me-k,fe=me-U,ye=C-de;return se?g(ye,I-fe):ye}function V(me){var de=me-k,fe=me-U;return k===void 0||de>=C||de<0||se&&fe>=I}function X(){var me=y();if(V(me))return ue(me);N=setTimeout(X,$(me))}function ue(me){return N=void 0,K&&E?H(me):(E=D=void 0,O)}function ne(){N!==void 0&&clearTimeout(N),U=0,E=k=D=N=void 0}function he(){return N===void 0?O:ue(y())}function te(){var me=y(),de=V(me);if(E=arguments,D=this,k=me,de){if(N===void 0)return ie(k);if(se)return N=setTimeout(X,C),H(k)}return N===void 0&&(N=setTimeout(X,C)),O}return te.cancel=ne,te.flush=he,te}function b(M){var C=typeof M;return!!M&&(C=="object"||C=="function")}function S(M){return!!M&&typeof M=="object"}function _(M){return typeof M=="symbol"||S(M)&&f.call(M)==i}function T(M){if(typeof M=="number")return M;if(_(M))return t;if(b(M)){var C=typeof M.valueOf=="function"?M.valueOf():M;M=b(C)?C+"":C}if(typeof M!="string")return M===0?M:+M;M=M.replace(r,"");var P=s.test(M);return P||a.test(M)?o(M.slice(2),P?2:8):n.test(M)?t:+M}return HC=v,HC}var U1e=F1e();const V1e=YF(U1e);function j1e(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const H1e=[],G1e={width:"100%",height:"100%"},W1e=Ae.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=H1e,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const u=Ae.useRef(null),h=Ae.useRef(0),[c,f]=Ae.useState({width:0,height:0,top:0,left:0}),m=Ae.useMemo(()=>{const g=Array.isArray(r)?r:[r];return V1e(y=>{f(v=>Object.keys(v).filter(b=>v[b]!==y[b]).every(b=>g.includes(b))?v:y)},i,{leading:s})},[i,s,r]);return Ae.useEffect(()=>{const g=a||window.ResizeObserver,y=new g(v=>{v.forEach(b=>{const{left:S,top:_,width:T,height:M}=(b==null?void 0:b.contentRect)??{};h.current=window.requestAnimationFrame(()=>{m({width:T,height:M,top:_,left:S})})})});return u.current&&y.observe(u.current),()=>{window.cancelAnimationFrame(h.current),y.disconnect(),m.cancel()}},[m,a]),Jt.jsx("div",{style:{...G1e,...n},ref:j1e([l,u]),className:e,...o,children:t({...c,ref:u.current,resize:m})})}),q1e=Ae.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:u,onSplineScroll:h,onLoad:c,renderOnDemand:f=!0,children:m,...g},y)=>{const v=Ae.useRef(null),[b,S]=Ae.useState(!0),[_,T]=Ae.useState();if(_)throw _;return Ae.useEffect(()=>{S(!0);let M;const C=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:u},{name:"scroll",cb:h}];if(v.current){M=new B1e(v.current,{renderOnDemand:f});async function P(){await M.load(e);for(let E of C)E.cb&&M.addEventListener(E.name,E.cb);S(!1),c==null||c(M)}P().catch(E=>{T(E)})}return()=>{for(let P of C)P.cb&&M.removeEventListener(P.name,P.cb);M.dispose()}},[e]),Jt.jsx(W1e,{ref:y,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...g,children:()=>Jt.jsxs(Jt.Fragment,{children:[b&&m,Jt.jsx("canvas",{ref:v,style:{display:b?"none":"block"}})]})})}),X1e=()=>Jt.jsx("div",{className:"fixed top-0 left-0 w-full h-full -z-10",children:Jt.jsx(q1e,{scene:"https://prod.spline.design/6WORjSjYIrk9wHXh/scene.splinecode"})}),Y1e=()=>{};var KB={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iH=function(e){const t=[];let i=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t[i++]=n:n<2048?(t[i++]=n>>6|192,t[i++]=n&63|128):(n&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(n=65536+((n&1023)<<10)+(e.charCodeAt(++r)&1023),t[i++]=n>>18|240,t[i++]=n>>12&63|128,t[i++]=n>>6&63|128,t[i++]=n&63|128):(t[i++]=n>>12|224,t[i++]=n>>6&63|128,t[i++]=n&63|128)}return t},Q1e=function(e){const t=[];let i=0,r=0;for(;i<e.length;){const n=e[i++];if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){const s=e[i++];t[r++]=String.fromCharCode((n&31)<<6|s&63)}else if(n>239&&n<365){const s=e[i++],a=e[i++],o=e[i++],l=((n&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;t[r++]=String.fromCharCode(55296+(l>>10)),t[r++]=String.fromCharCode(56320+(l&1023))}else{const s=e[i++],a=e[i++];t[r++]=String.fromCharCode((n&15)<<12|(s&63)<<6|a&63)}}return t.join("")},rH={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let n=0;n<e.length;n+=3){const s=e[n],a=n+1<e.length,o=a?e[n+1]:0,l=n+2<e.length,u=l?e[n+2]:0,h=s>>2,c=(s&3)<<4|o>>4;let f=(o&15)<<2|u>>6,m=u&63;l||(m=64,a||(f=64)),r.push(i[h],i[c],i[f],i[m])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(iH(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Q1e(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let n=0;n<e.length;){const s=i[e.charAt(n++)],o=n<e.length?i[e.charAt(n)]:0;++n;const u=n<e.length?i[e.charAt(n)]:64;++n;const c=n<e.length?i[e.charAt(n)]:64;if(++n,s==null||o==null||u==null||c==null)throw new K1e;const f=s<<2|o>>4;if(r.push(f),u!==64){const m=o<<4&240|u>>2;if(r.push(m),c!==64){const g=u<<6&192|c;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class K1e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Z1e=function(e){const t=iH(e);return rH.encodeByteArray(t,!0)},Uw=function(e){return Z1e(e).replace(/\./g,"")},nH=function(e){try{return rH.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1e=()=>J1e().__FIREBASE_DEFAULTS__,exe=()=>{if(typeof process>"u"||typeof KB>"u")return;const e=KB.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},txe=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&nH(e[1]);return t&&JSON.parse(t)},U_=()=>{try{return Y1e()||$1e()||exe()||txe()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},sH=e=>{var t,i;return(i=(t=U_())===null||t===void 0?void 0:t.emulatorHosts)===null||i===void 0?void 0:i[e]},ixe=e=>{const t=sH(e);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(i+1),10);return t[0]==="["?[t.substring(1,i-1),r]:[t.substring(0,i),r]},aH=()=>{var e;return(e=U_())===null||e===void 0?void 0:e.config},oH=e=>{var t;return(t=U_())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rxe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}wrapCallback(t){return(i,r)=>{i?this.reject(i):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(i):t(i,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nxe(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},r=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Uw(JSON.stringify(i)),Uw(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sxe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ss())}function axe(){var e;const t=(e=U_())===null||e===void 0?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function oxe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function lxe(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function uxe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hxe(){const e=Ss();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function cxe(){return!axe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function dxe(){try{return typeof indexedDB=="object"}catch{return!1}}function fxe(){return new Promise((e,t)=>{try{let i=!0;const r="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(r);n.onsuccess=()=>{n.result.close(),i||self.indexedDB.deleteDatabase(r),e(!0)},n.onupgradeneeded=()=>{i=!1},n.onerror=()=>{var s;t(((s=n.error)===null||s===void 0?void 0:s.message)||"")}}catch(i){t(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pxe="FirebaseError";class ih extends Error{constructor(t,i,r){super(i),this.code=t,this.customData=r,this.name=pxe,Object.setPrototypeOf(this,ih.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i0.prototype.create)}}class i0{constructor(t,i,r){this.service=t,this.serviceName=i,this.errors=r}create(t,...i){const r=i[0]||{},n=`${this.service}/${t}`,s=this.errors[t],a=s?mxe(s,r):"Error",o=`${this.serviceName}: ${a} (${n}).`;return new ih(n,o,r)}}function mxe(e,t){return e.replace(gxe,(i,r)=>{const n=t[r];return n!=null?String(n):`<${r}?>`})}const gxe=/\{\$([^}]+)}/g;function vxe(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Xd(e,t){if(e===t)return!0;const i=Object.keys(e),r=Object.keys(t);for(const n of i){if(!r.includes(n))return!1;const s=e[n],a=t[n];if(ZB(s)&&ZB(a)){if(!Xd(s,a))return!1}else if(s!==a)return!1}for(const n of r)if(!i.includes(n))return!1;return!0}function ZB(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(e){const t=[];for(const[i,r]of Object.entries(e))Array.isArray(r)?r.forEach(n=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Pv(e){const t={};return e.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[n,s]=r.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function Mv(e){const t=e.indexOf("?");if(!t)return"";const i=e.indexOf("#",t);return e.substring(t,i>0?i:void 0)}function yxe(e,t){const i=new xxe(e,t);return i.subscribe.bind(i)}class xxe{constructor(t,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(i=>{i.next(t)})}error(t){this.forEachObserver(i=>{i.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,i,r){let n;if(t===void 0&&i===void 0&&r===void 0)throw new Error("Missing Observer.");bxe(t,["next","error","complete"])?n=t:n={next:t,error:i,complete:r},n.next===void 0&&(n.next=GC),n.error===void 0&&(n.error=GC),n.complete===void 0&&(n.complete=GC);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),s}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(t,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{i(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function bxe(e,t){if(typeof e!="object"||e===null)return!1;for(const i of t)if(i in e&&typeof e[i]=="function")return!0;return!1}function GC(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(e){return e&&e._delegate?e._delegate:e}class Yd{constructor(t,i,r){this.name=t,this.instanceFactory=i,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wxe{constructor(t,i){this.name=t,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const i=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(i)){const r=new rxe;if(this.instancesDeferred.set(i,r),this.isInitialized(i)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:i});n&&r.resolve(n)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(t){var i;const r=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),n=(i=t==null?void 0:t.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Sxe(t))try{this.getOrInitializeService({instanceIdentifier:pd})}catch{}for(const[i,r]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(i);try{const s=this.getOrInitializeService({instanceIdentifier:n});r.resolve(s)}catch{}}}}clearInstance(t=pd){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=pd){return this.instances.has(t)}getOptions(t=pd){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:i={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:i});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);r===o&&a.resolve(n)}return n}onInit(t,i){var r;const n=this.normalizeInstanceIdentifier(i),s=(r=this.onInitCallbacks.get(n))!==null&&r!==void 0?r:new Set;s.add(t),this.onInitCallbacks.set(n,s);const a=this.instances.get(n);return a&&t(a,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,i){const r=this.onInitCallbacks.get(i);if(r)for(const n of r)try{n(t,i)}catch{}}getOrInitializeService({instanceIdentifier:t,options:i={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_xe(t),options:i}),this.instances.set(t,r),this.instancesOptions.set(t,i),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=pd){return this.component?this.component.multipleInstances?t:pd:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _xe(e){return e===pd?void 0:e}function Sxe(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Exe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const i=this.getProvider(t.name);if(i.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);i.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const i=new wxe(t,this);return this.providers.set(t,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ci;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Ci||(Ci={}));const Axe={debug:Ci.DEBUG,verbose:Ci.VERBOSE,info:Ci.INFO,warn:Ci.WARN,error:Ci.ERROR,silent:Ci.SILENT},Cxe=Ci.INFO,Txe={[Ci.DEBUG]:"log",[Ci.VERBOSE]:"log",[Ci.INFO]:"info",[Ci.WARN]:"warn",[Ci.ERROR]:"error"},Pxe=(e,t,...i)=>{if(t<e.logLevel)return;const r=new Date().toISOString(),n=Txe[t];if(n)console[n](`[${r}]  ${e.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};let _D=class{constructor(t){this.name=t,this._logLevel=Cxe,this._logHandler=Pxe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Ci))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Axe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Ci.DEBUG,...t),this._logHandler(this,Ci.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Ci.VERBOSE,...t),this._logHandler(this,Ci.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Ci.INFO,...t),this._logHandler(this,Ci.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Ci.WARN,...t),this._logHandler(this,Ci.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Ci.ERROR,...t),this._logHandler(this,Ci.ERROR,...t)}};const Mxe=(e,t)=>t.some(i=>e instanceof i);let JB,$B;function Dxe(){return JB||(JB=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ixe(){return $B||($B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lH=new WeakMap,oP=new WeakMap,uH=new WeakMap,WC=new WeakMap,SD=new WeakMap;function Rxe(e){const t=new Promise((i,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{i(vc(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",a)});return t.then(i=>{i instanceof IDBCursor&&lH.set(i,e)}).catch(()=>{}),SD.set(t,e),t}function Oxe(e){if(oP.has(e))return;const t=new Promise((i,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{i(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});oP.set(e,t)}let lP={get(e,t,i){if(e instanceof IDBTransaction){if(t==="done")return oP.get(e);if(t==="objectStoreNames")return e.objectStoreNames||uH.get(e);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return vc(e[t])},set(e,t,i){return e[t]=i,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function kxe(e){lP=e(lP)}function Lxe(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const r=e.call(qC(this),t,...i);return uH.set(r,t.sort?t.sort():[t]),vc(r)}:Ixe().includes(e)?function(...t){return e.apply(qC(this),t),vc(lH.get(this))}:function(...t){return vc(e.apply(qC(this),t))}}function zxe(e){return typeof e=="function"?Lxe(e):(e instanceof IDBTransaction&&Oxe(e),Mxe(e,Dxe())?new Proxy(e,lP):e)}function vc(e){if(e instanceof IDBRequest)return Rxe(e);if(WC.has(e))return WC.get(e);const t=zxe(e);return t!==e&&(WC.set(e,t),SD.set(t,e)),t}const qC=e=>SD.get(e);function Nxe(e,t,{blocked:i,upgrade:r,blocking:n,terminated:s}={}){const a=indexedDB.open(e,t),o=vc(a);return r&&a.addEventListener("upgradeneeded",l=>{r(vc(a.result),l.oldVersion,l.newVersion,vc(a.transaction),l)}),i&&a.addEventListener("blocked",l=>i(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),n&&l.addEventListener("versionchange",u=>n(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const Bxe=["get","getKey","getAll","getAllKeys","count"],Fxe=["put","add","delete","clear"],XC=new Map;function e4(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(XC.get(t))return XC.get(t);const i=t.replace(/FromIndex$/,""),r=t!==i,n=Fxe.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Bxe.includes(i)))return;const s=async function(a,...o){const l=this.transaction(a,n?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(o.shift())),(await Promise.all([u[i](...o),n&&l.done]))[0]};return XC.set(t,s),s}kxe(e=>({...e,get:(t,i,r)=>e4(t,i)||e.get(t,i,r),has:(t,i)=>!!e4(t,i)||e.has(t,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uxe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(Vxe(i)){const r=i.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(i=>i).join(" ")}}function Vxe(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const uP="@firebase/app",t4="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ku=new _D("@firebase/app"),jxe="@firebase/app-compat",Hxe="@firebase/analytics-compat",Gxe="@firebase/analytics",Wxe="@firebase/app-check-compat",qxe="@firebase/app-check",Xxe="@firebase/auth",Yxe="@firebase/auth-compat",Qxe="@firebase/database",Kxe="@firebase/data-connect",Zxe="@firebase/database-compat",Jxe="@firebase/functions",$xe="@firebase/functions-compat",ebe="@firebase/installations",tbe="@firebase/installations-compat",ibe="@firebase/messaging",rbe="@firebase/messaging-compat",nbe="@firebase/performance",sbe="@firebase/performance-compat",abe="@firebase/remote-config",obe="@firebase/remote-config-compat",lbe="@firebase/storage",ube="@firebase/storage-compat",hbe="@firebase/firestore",cbe="@firebase/vertexai",dbe="@firebase/firestore-compat",fbe="firebase",pbe="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP="[DEFAULT]",mbe={[uP]:"fire-core",[jxe]:"fire-core-compat",[Gxe]:"fire-analytics",[Hxe]:"fire-analytics-compat",[qxe]:"fire-app-check",[Wxe]:"fire-app-check-compat",[Xxe]:"fire-auth",[Yxe]:"fire-auth-compat",[Qxe]:"fire-rtdb",[Kxe]:"fire-data-connect",[Zxe]:"fire-rtdb-compat",[Jxe]:"fire-fn",[$xe]:"fire-fn-compat",[ebe]:"fire-iid",[tbe]:"fire-iid-compat",[ibe]:"fire-fcm",[rbe]:"fire-fcm-compat",[nbe]:"fire-perf",[sbe]:"fire-perf-compat",[abe]:"fire-rc",[obe]:"fire-rc-compat",[lbe]:"fire-gcs",[ube]:"fire-gcs-compat",[hbe]:"fire-fst",[dbe]:"fire-fst-compat",[cbe]:"fire-vertex","fire-js":"fire-js",[fbe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw=new Map,gbe=new Map,cP=new Map;function i4(e,t){try{e.container.addComponent(t)}catch(i){Ku.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,i)}}function _m(e){const t=e.name;if(cP.has(t))return Ku.debug(`There were multiple attempts to register component ${t}.`),!1;cP.set(t,e);for(const i of Vw.values())i4(i,e);for(const i of gbe.values())i4(i,e);return!0}function ED(e,t){const i=e.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),e.container.getProvider(t)}function Ka(e){return e==null?!1:e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vbe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yc=new i0("app","Firebase",vbe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ybe{constructor(t,i,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Yd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw yc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm=pbe;function hH(e,t={}){let i=e;typeof t!="object"&&(t={name:t});const r=Object.assign({name:hP,automaticDataCollectionEnabled:!1},t),n=r.name;if(typeof n!="string"||!n)throw yc.create("bad-app-name",{appName:String(n)});if(i||(i=aH()),!i)throw yc.create("no-options");const s=Vw.get(n);if(s){if(Xd(i,s.options)&&Xd(r,s.config))return s;throw yc.create("duplicate-app",{appName:n})}const a=new Exe(n);for(const l of cP.values())a.addComponent(l);const o=new ybe(i,r,a);return Vw.set(n,o),o}function cH(e=hP){const t=Vw.get(e);if(!t&&e===hP&&aH())return hH();if(!t)throw yc.create("no-app",{appName:e});return t}function xc(e,t,i){var r;let n=(r=mbe[e])!==null&&r!==void 0?r:e;i&&(n+=`-${i}`);const s=n.match(/\s|\//),a=t.match(/\s|\//);if(s||a){const o=[`Unable to register library "${n}" with version "${t}":`];s&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&a&&o.push("and"),a&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ku.warn(o.join(" "));return}_m(new Yd(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xbe="firebase-heartbeat-database",bbe=1,Ay="firebase-heartbeat-store";let YC=null;function dH(){return YC||(YC=Nxe(xbe,bbe,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Ay)}catch(i){console.warn(i)}}}}).catch(e=>{throw yc.create("idb-open",{originalErrorMessage:e.message})})),YC}async function wbe(e){try{const i=(await dH()).transaction(Ay),r=await i.objectStore(Ay).get(fH(e));return await i.done,r}catch(t){if(t instanceof ih)Ku.warn(t.message);else{const i=yc.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Ku.warn(i.message)}}}async function r4(e,t){try{const r=(await dH()).transaction(Ay,"readwrite");await r.objectStore(Ay).put(t,fH(e)),await r.done}catch(i){if(i instanceof ih)Ku.warn(i.message);else{const r=yc.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Ku.warn(r.message)}}}function fH(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _be=1024,Sbe=30;class Ebe{constructor(t){this.container=t,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new Cbe(i),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var t,i;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=n4();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats.length>Sbe){const a=Tbe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ku.warn(r)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=n4(),{heartbeatsToSend:r,unsentEntries:n}=Abe(this._heartbeatsCache.heartbeats),s=Uw(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=i,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(i){return Ku.warn(i),""}}}function n4(){return new Date().toISOString().substring(0,10)}function Abe(e,t=_be){const i=[];let r=e.slice();for(const n of e){const s=i.find(a=>a.agent===n.agent);if(s){if(s.dates.push(n.date),s4(i)>t){s.dates.pop();break}}else if(i.push({agent:n.agent,dates:[n.date]}),s4(i)>t){i.pop();break}r=r.slice(1)}return{heartbeatsToSend:i,unsentEntries:r}}class Cbe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return dxe()?fxe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await wbe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var i;if(await this._canUseIndexedDBPromise){const n=await this.read();return r4(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var i;if(await this._canUseIndexedDBPromise){const n=await this.read();return r4(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function s4(e){return Uw(JSON.stringify({version:2,heartbeats:e})).length}function Tbe(e){if(e.length===0)return-1;let t=0,i=e[0].date;for(let r=1;r<e.length;r++)e[r].date<i&&(i=e[r].date,t=r);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pbe(e){_m(new Yd("platform-logger",t=>new Uxe(t),"PRIVATE")),_m(new Yd("heartbeat",t=>new Ebe(t),"PRIVATE")),xc(uP,t4,e),xc(uP,t4,"esm2017"),xc("fire-js","")}Pbe("");function AD(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i}function pH(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Mbe=pH,mH=new i0("auth","Firebase",pH());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw=new _D("@firebase/auth");function Dbe(e,...t){jw.logLevel<=Ci.WARN&&jw.warn(`Auth (${Xm}): ${e}`,...t)}function Eb(e,...t){jw.logLevel<=Ci.ERROR&&jw.error(`Auth (${Xm}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(e,...t){throw CD(e,...t)}function Nl(e,...t){return CD(e,...t)}function gH(e,t,i){const r=Object.assign(Object.assign({},Mbe()),{[t]:i});return new i0("auth","Firebase",r).create(t,{appName:e.name})}function Vu(e){return gH(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function CD(e,...t){if(typeof e!="string"){const i=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(i,...r)}return mH.create(e,...t)}function ei(e,t,...i){if(!e)throw CD(t,...i)}function Nu(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Eb(t),new Error(t)}function Zu(e,t){e||Nu(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dP(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function Ibe(){return a4()==="http:"||a4()==="https:"}function a4(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rbe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ibe()||lxe()||"connection"in navigator)?navigator.onLine:!0}function Obe(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(t,i){this.shortDelay=t,this.longDelay=i,Zu(i>t,"Short delay should be less than long delay!"),this.isMobile=sxe()||uxe()}get(){return Rbe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TD(e,t){Zu(e.emulator,"Emulator should always be set here");const{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vH{static initialize(t,i,r){this.fetchImpl=t,i&&(this.headersImpl=i),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Nu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Nu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Nu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kbe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lbe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],zbe=new n0(3e4,6e4);function rh(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Yo(e,t,i,r,n={}){return yH(e,n,async()=>{let s={},a={};r&&(t==="GET"?a=r:s={body:JSON.stringify(r)});const o=r0(Object.assign({key:e.config.apiKey},a)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const u=Object.assign({method:t,headers:l},s);return oxe()||(u.referrerPolicy="no-referrer"),vH.fetch()(await xH(e,e.config.apiHost,i,o),u)})}async function yH(e,t,i){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},kbe),t);try{const n=new Bbe(e),s=await Promise.race([i(),n.promise]);n.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Wx(e,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Wx(e,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Wx(e,"email-already-in-use",a);if(l==="USER_DISABLED")throw Wx(e,"user-disabled",a);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw gH(e,h,u);Go(e,h)}}catch(n){if(n instanceof ih)throw n;Go(e,"network-request-failed",{message:String(n)})}}async function s0(e,t,i,r,n={}){const s=await Yo(e,t,i,r,n);return"mfaPendingCredential"in s&&Go(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function xH(e,t,i,r){const n=`${t}${i}?${r}`,s=e,a=s.config.emulator?TD(e.config,n):`${e.config.apiScheme}://${n}`;return Lbe.includes(i)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function Nbe(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Bbe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((i,r)=>{this.timer=setTimeout(()=>r(Nl(this.auth,"network-request-failed")),zbe.get())})}}function Wx(e,t,i){const r={appName:e.name};i.email&&(r.email=i.email),i.phoneNumber&&(r.phoneNumber=i.phoneNumber);const n=Nl(e,t,r);return n.customData._tokenResponse=i,n}function o4(e){return e!==void 0&&e.enterprise!==void 0}class Fbe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===t)return Nbe(i.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Ube(e,t){return Yo(e,"GET","/v2/recaptchaConfig",rh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vbe(e,t){return Yo(e,"POST","/v1/accounts:delete",t)}async function Hw(e,t){return Yo(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kv(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function jbe(e,t=!1){const i=Hs(e),r=await i.getIdToken(t),n=PD(r);ei(n&&n.exp&&n.auth_time&&n.iat,i.auth,"internal-error");const s=typeof n.firebase=="object"?n.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:n,token:r,authTime:Kv(QC(n.auth_time)),issuedAtTime:Kv(QC(n.iat)),expirationTime:Kv(QC(n.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function QC(e){return Number(e)*1e3}function PD(e){const[t,i,r]=e.split(".");if(t===void 0||i===void 0||r===void 0)return Eb("JWT malformed, contained fewer than 3 sections"),null;try{const n=nH(i);return n?JSON.parse(n):(Eb("Failed to decode base64 JWT payload"),null)}catch(n){return Eb("Caught error parsing JWT payload as JSON",n==null?void 0:n.toString()),null}}function l4(e){const t=PD(e);return ei(t,"internal-error"),ei(typeof t.exp<"u","internal-error"),ei(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qd(e,t,i=!1){if(i)return t;try{return await t}catch(r){throw r instanceof ih&&Hbe(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}function Hbe({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gbe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var i;if(t){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const n=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,n)}}schedule(t=!1){if(!this.isRunning)return;const i=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(t,i){this.createdAt=t,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Kv(this.lastLoginAt),this.creationTime=Kv(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gw(e){var t;const i=e.auth,r=await e.getIdToken(),n=await Qd(e,Hw(i,{idToken:r}));ei(n==null?void 0:n.users.length,i,"internal-error");const s=n.users[0];e._notifyReloadListener(s);const a=!((t=s.providerUserInfo)===null||t===void 0)&&t.length?bH(s.providerUserInfo):[],o=qbe(e.providerData,a),l=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(o!=null&&o.length),h=l?u:!1,c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new fP(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,c)}async function Wbe(e){const t=Hs(e);await Gw(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function qbe(e,t){return[...e.filter(r=>!t.some(n=>n.providerId===r.providerId)),...t]}function bH(e){return e.map(t=>{var{providerId:i}=t,r=AD(t,["providerId"]);return{providerId:i,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xbe(e,t){const i=await yH(e,{},async()=>{const r=r0({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,a=await xH(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",vH.fetch()(a,{method:"POST",headers:o,body:r})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function Ybe(e,t){return Yo(e,"POST","/v2/accounts:revokeToken",rh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){ei(t.idToken,"internal-error"),ei(typeof t.idToken<"u","internal-error"),ei(typeof t.refreshToken<"u","internal-error");const i="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):l4(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,i)}updateFromIdToken(t){ei(t.length!==0,"internal-error");const i=l4(t);this.updateTokensAndExpiration(t,null,i)}async getToken(t,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(ei(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,i){const{accessToken:r,refreshToken:n,expiresIn:s}=await Xbe(t,i);this.updateTokensAndExpiration(r,n,Number(s))}updateTokensAndExpiration(t,i,r){this.refreshToken=i||null,this.accessToken=t||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(t,i){const{refreshToken:r,accessToken:n,expirationTime:s}=i,a=new rm;return r&&(ei(typeof r=="string","internal-error",{appName:t}),a.refreshToken=r),n&&(ei(typeof n=="string","internal-error",{appName:t}),a.accessToken=n),s&&(ei(typeof s=="number","internal-error",{appName:t}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new rm,this.toJSON())}_performRefresh(){return Nu("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(e,t){ei(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class zo{constructor(t){var{uid:i,auth:r,stsTokenManager:n}=t,s=AD(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Gbe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new fP(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const i=await Qd(this,this.stsTokenManager.getToken(this.auth,t));return ei(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(t){return jbe(this,t)}reload(){return Wbe(this)}_assign(t){this!==t&&(ei(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(i=>Object.assign({},i)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const i=new zo(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(t){ei(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,i=!1){let r=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),i&&await Gw(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ka(this.auth.app))return Promise.reject(Vu(this.auth));const t=await this.getIdToken();return await Qd(this,Vbe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,i){var r,n,s,a,o,l,u,h;const c=(r=i.displayName)!==null&&r!==void 0?r:void 0,f=(n=i.email)!==null&&n!==void 0?n:void 0,m=(s=i.phoneNumber)!==null&&s!==void 0?s:void 0,g=(a=i.photoURL)!==null&&a!==void 0?a:void 0,y=(o=i.tenantId)!==null&&o!==void 0?o:void 0,v=(l=i._redirectEventId)!==null&&l!==void 0?l:void 0,b=(u=i.createdAt)!==null&&u!==void 0?u:void 0,S=(h=i.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:_,emailVerified:T,isAnonymous:M,providerData:C,stsTokenManager:P}=i;ei(_&&P,t,"internal-error");const E=rm.fromJSON(this.name,P);ei(typeof _=="string",t,"internal-error"),jh(c,t.name),jh(f,t.name),ei(typeof T=="boolean",t,"internal-error"),ei(typeof M=="boolean",t,"internal-error"),jh(m,t.name),jh(g,t.name),jh(y,t.name),jh(v,t.name),jh(b,t.name),jh(S,t.name);const D=new zo({uid:_,auth:t,email:f,emailVerified:T,displayName:c,isAnonymous:M,photoURL:g,phoneNumber:m,tenantId:y,stsTokenManager:E,createdAt:b,lastLoginAt:S});return C&&Array.isArray(C)&&(D.providerData=C.map(I=>Object.assign({},I))),v&&(D._redirectEventId=v),D}static async _fromIdTokenResponse(t,i,r=!1){const n=new rm;n.updateFromServerResponse(i);const s=new zo({uid:i.localId,auth:t,stsTokenManager:n,isAnonymous:r});return await Gw(s),s}static async _fromGetAccountInfoResponse(t,i,r){const n=i.users[0];ei(n.localId!==void 0,"internal-error");const s=n.providerUserInfo!==void 0?bH(n.providerUserInfo):[],a=!(n.email&&n.passwordHash)&&!(s!=null&&s.length),o=new rm;o.updateFromIdToken(r);const l=new zo({uid:n.localId,auth:t,stsTokenManager:o,isAnonymous:a}),u={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new fP(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u4=new Map;function Bu(e){Zu(e instanceof Function,"Expected a class definition");let t=u4.get(e);return t?(Zu(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,u4.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wH{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,i){this.storage[t]=i}async _get(t){const i=this.storage[t];return i===void 0?null:i}async _remove(t){delete this.storage[t]}_addListener(t,i){}_removeListener(t,i){}}wH.type="NONE";const h4=wH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ab(e,t,i){return`firebase:${e}:${t}:${i}`}class nm{constructor(t,i,r){this.persistence=t,this.auth=i,this.userKey=r;const{config:n,name:s}=this.auth;this.fullUserKey=Ab(this.userKey,n.apiKey,s),this.fullPersistenceKey=Ab("persistence",n.apiKey,s),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const i=await Hw(this.auth,{idToken:t}).catch(()=>{});return i?zo._fromGetAccountInfoResponse(this.auth,i,t):null}return zo._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,i,r="authUser"){if(!i.length)return new nm(Bu(h4),t,r);const n=(await Promise.all(i.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=n[0]||Bu(h4);const a=Ab(r,t.config.apiKey,t.name);let o=null;for(const u of i)try{const h=await u._get(a);if(h){let c;if(typeof h=="string"){const f=await Hw(t,{idToken:h}).catch(()=>{});if(!f)break;c=await zo._fromGetAccountInfoResponse(t,f,h)}else c=zo._fromJSON(t,h);u!==s&&(o=c),s=u;break}}catch{}const l=n.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new nm(s,t,r):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(i.map(async u=>{if(u!==s)try{await u._remove(a)}catch{}})),new nm(s,t,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c4(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(AH(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(_H(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(TH(t))return"Blackberry";if(PH(t))return"Webos";if(SH(t))return"Safari";if((t.includes("chrome/")||EH(t))&&!t.includes("edge/"))return"Chrome";if(CH(t))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(i);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function _H(e=Ss()){return/firefox\//i.test(e)}function SH(e=Ss()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function EH(e=Ss()){return/crios\//i.test(e)}function AH(e=Ss()){return/iemobile/i.test(e)}function CH(e=Ss()){return/android/i.test(e)}function TH(e=Ss()){return/blackberry/i.test(e)}function PH(e=Ss()){return/webos/i.test(e)}function MD(e=Ss()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Qbe(e=Ss()){var t;return MD(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Kbe(){return hxe()&&document.documentMode===10}function MH(e=Ss()){return MD(e)||CH(e)||PH(e)||TH(e)||/windows phone/i.test(e)||AH(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DH(e,t=[]){let i;switch(e){case"Browser":i=c4(Ss());break;case"Worker":i=`${c4(Ss())}-${e}`;break;default:i=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${Xm}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zbe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,i){const r=s=>new Promise((a,o)=>{try{const l=t(s);a(l)}catch(l){o(l)}});r.onAbort=i,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const i=[];try{for(const r of this.queue)await r(t),r.onAbort&&i.push(r.onAbort)}catch(r){i.reverse();for(const n of i)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jbe(e,t={}){return Yo(e,"GET","/v2/passwordPolicy",rh(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $be=6;class ewe{constructor(t){var i,r,n,s;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=a.minPasswordLength)!==null&&i!==void 0?i:$be,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(n=(r=t.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&n!==void 0?n:"",this.forceUpgradeOnSignin=(s=t.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var i,r,n,s,a,o;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(i=l.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(n=l.containsLowercaseLetter)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(o=l.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),l}validatePasswordLengthOptions(t,i){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(i.meetsMinPasswordLength=t.length>=r),n&&(i.meetsMaxPasswordLength=t.length<=n)}validatePasswordCharacterOptions(t,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let r;for(let n=0;n<t.length;n++)r=t.charAt(n),this.updatePasswordCharacterOptionsStatuses(i,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(t,i,r,n,s){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class twe{constructor(t,i,r,n){this.app=t,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new d4(this),this.idTokenSubscription=new d4(this),this.beforeStateQueue=new Zbe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mH,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(t,i){return i&&(this._popupRedirectResolver=Bu(i)),this._initializationPromise=this.queue(async()=>{var r,n,s;if(!this._deleted&&(this.persistenceManager=await nm.create(this,t),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const i=await Hw(this,{idToken:t}),r=await zo._fromGetAccountInfoResponse(this,i,t);await this.directlySetCurrentUser(r)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var i;if(Ka(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let n=r,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,o=n==null?void 0:n._redirectEventId,l=await this.tryRedirectSignIn(t);(!a||a===o)&&(l!=null&&l.user)&&(n=l.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(a){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return ei(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(t){try{await Gw(t)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Obe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ka(this.app))return Promise.reject(Vu(this));const i=t?Hs(t):null;return i&&ei(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(t,i=!1){if(!this._deleted)return t&&ei(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ka(this.app)?Promise.reject(Vu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ka(this.app)?Promise.reject(Vu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bu(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Jbe(this),i=new ewe(t);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new i0("auth","Firebase",t())}onAuthStateChanged(t,i,r){return this.registerStateListener(this.authStateSubscription,t,i,r)}beforeAuthStateChanged(t,i){return this.beforeStateQueue.pushCallback(t,i)}onIdTokenChanged(t,i,r){return this.registerStateListener(this.idTokenSubscription,t,i,r)}authStateReady(){return new Promise((t,i)=>{if(this.currentUser)t();else{const r=this.onAuthStateChanged(()=>{r(),t()},i)}})}async revokeAccessToken(t){if(this.currentUser){const i=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:i};this.tenantId!=null&&(r.tenantId=this.tenantId),await Ybe(this,r)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,i){const r=await this.getOrInitRedirectPersistenceManager(i);return t===null?r.removeCurrentUser():r.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const i=t&&Bu(t)||this._popupRedirectResolver;ei(i,this,"argument-error"),this.redirectPersistenceManager=await nm.create(this,[Bu(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var i,r;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===t?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(i=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,i,r,n){if(this._deleted)return()=>{};const s=typeof i=="function"?i:i.next.bind(i);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(ei(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof i=="function"){const l=t.addObserver(i,r,n);return()=>{a=!0,l()}}else{const l=t.addObserver(i);return()=>{a=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return ei(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=DH(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const r=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());r&&(i["X-Firebase-Client"]=r);const n=await this._getAppCheckToken();return n&&(i["X-Firebase-AppCheck"]=n),i}async _getAppCheckToken(){var t;if(Ka(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return i!=null&&i.error&&Dbe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Nc(e){return Hs(e)}class d4{constructor(t){this.auth=t,this.observer=null,this.addObserver=yxe(i=>this.observer=i)}get next(){return ei(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let V_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function iwe(e){V_=e}function IH(e){return V_.loadJS(e)}function rwe(){return V_.recaptchaEnterpriseScript}function nwe(){return V_.gapiScript}function swe(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class awe{constructor(){this.enterprise=new owe}ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}class owe{ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}const lwe="recaptcha-enterprise",RH="NO_RECAPTCHA";class uwe{constructor(t){this.type=lwe,this.auth=Nc(t)}async verify(t="verify",i=!1){async function r(s){if(!i){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{Ube(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new Fbe(l);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function n(s,a,o){const l=window.grecaptcha;o4(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:t}).then(u=>{a(u)}).catch(()=>{a(RH)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new awe().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(o=>{if(!i&&o4(window.grecaptcha))n(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=rwe();l.length!==0&&(l+=o),IH(l).then(()=>{n(o,s,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function f4(e,t,i,r=!1,n=!1){const s=new uwe(e);let a;if(n)a=RH;else try{a=await s.verify(i)}catch{a=await s.verify(i,!0)}const o=Object.assign({},t);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ww(e,t,i,r,n){var s;if(!((s=e._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await f4(e,t,i,i==="getOobCode");return r(e,a)}else return r(e,t).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await f4(e,t,i,i==="getOobCode");return r(e,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hwe(e,t){const i=ED(e,"auth");if(i.isInitialized()){const n=i.getImmediate(),s=i.getOptions();if(Xd(s,t??{}))return n;Go(n,"already-initialized")}return i.initialize({options:t})}function cwe(e,t){const i=(t==null?void 0:t.persistence)||[],r=(Array.isArray(i)?i:[i]).map(Bu);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t==null?void 0:t.popupRedirectResolver)}function dwe(e,t,i){const r=Nc(e);ei(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const n=!1,s=OH(t),{host:a,port:o}=fwe(t),l=o===null?"":`:${o}`,u={url:`${s}//${a}${l}/`},h=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:n})});if(!r._canInitEmulator){ei(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ei(Xd(u,r.config.emulator)&&Xd(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,pwe()}function OH(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function fwe(e){const t=OH(e),i=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!i)return{host:"",port:null};const r=i[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(r);if(n){const s=n[1];return{host:s,port:p4(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:p4(a)}}}function p4(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function pwe(){function e(){const t=document.createElement("p"),i=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(t,i){this.providerId=t,this.signInMethod=i}toJSON(){return Nu("not implemented")}_getIdTokenResponse(t){return Nu("not implemented")}_linkToIdToken(t,i){return Nu("not implemented")}_getReauthenticationResolver(t){return Nu("not implemented")}}async function mwe(e,t){return Yo(e,"POST","/v1/accounts:update",t)}async function gwe(e,t){return Yo(e,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vwe(e,t){return s0(e,"POST","/v1/accounts:signInWithPassword",rh(e,t))}async function ywe(e,t){return Yo(e,"POST","/v1/accounts:sendOobCode",rh(e,t))}async function xwe(e,t){return ywe(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bwe(e,t){return s0(e,"POST","/v1/accounts:signInWithEmailLink",rh(e,t))}async function wwe(e,t){return s0(e,"POST","/v1/accounts:signInWithEmailLink",rh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy extends DD{constructor(t,i,r,n=null){super("password",r),this._email=t,this._password=i,this._tenantId=n}static _fromEmailAndPassword(t,i){return new Cy(t,i,"password")}static _fromEmailAndCode(t,i,r=null){return new Cy(t,i,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ww(t,i,"signInWithPassword",vwe);case"emailLink":return bwe(t,{email:this._email,oobCode:this._password});default:Go(t,"internal-error")}}async _linkToIdToken(t,i){switch(this.signInMethod){case"password":const r={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ww(t,r,"signUpPassword",gwe);case"emailLink":return wwe(t,{idToken:i,email:this._email,oobCode:this._password});default:Go(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sm(e,t){return s0(e,"POST","/v1/accounts:signInWithIdp",rh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _we="http://localhost";class Kd extends DD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const i=new Kd(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(i.idToken=t.idToken),t.accessToken&&(i.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(i.nonce=t.nonce),t.pendingToken&&(i.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(i.accessToken=t.oauthToken,i.secret=t.oauthTokenSecret):Go("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t,{providerId:r,signInMethod:n}=i,s=AD(i,["providerId","signInMethod"]);if(!r||!n)return null;const a=new Kd(r,n);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(t){const i=this.buildRequest();return sm(t,i)}_linkToIdToken(t,i){const r=this.buildRequest();return r.idToken=i,sm(t,r)}_getReauthenticationResolver(t){const i=this.buildRequest();return i.autoCreate=!1,sm(t,i)}buildRequest(){const t={requestUri:_we,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),t.postBody=r0(i)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Swe(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Ewe(e){const t=Pv(Mv(e)).link,i=t?Pv(Mv(t)).deep_link_id:null,r=Pv(Mv(e)).deep_link_id;return(r?Pv(Mv(r)).link:null)||r||i||t||e}class ID{constructor(t){var i,r,n,s,a,o;const l=Pv(Mv(t)),u=(i=l.apiKey)!==null&&i!==void 0?i:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,c=Swe((n=l.mode)!==null&&n!==void 0?n:null);ei(u&&h&&c,"argument-error"),this.apiKey=u,this.operation=c,this.code=h,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(o=l.tenantId)!==null&&o!==void 0?o:null}static parseLink(t){const i=Ewe(t);try{return new ID(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(){this.providerId=Ym.PROVIDER_ID}static credential(t,i){return Cy._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const r=ID.parseLink(i);return ei(r,"argument-error"),Cy._fromEmailAndCode(t,r.code,r.tenantId)}}Ym.PROVIDER_ID="password";Ym.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ym.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kH{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0 extends kH{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh extends a0{constructor(){super("facebook.com")}static credential(t){return Kd._fromParams({providerId:Jh.PROVIDER_ID,signInMethod:Jh.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Jh.credentialFromTaggedObject(t)}static credentialFromError(t){return Jh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Jh.credential(t.oauthAccessToken)}catch{return null}}}Jh.FACEBOOK_SIGN_IN_METHOD="facebook.com";Jh.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h extends a0{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return Kd._fromParams({providerId:$h.PROVIDER_ID,signInMethod:$h.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return $h.credentialFromTaggedObject(t)}static credentialFromError(t){return $h.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:r}=t;if(!i&&!r)return null;try{return $h.credential(i,r)}catch{return null}}}$h.GOOGLE_SIGN_IN_METHOD="google.com";$h.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec extends a0{constructor(){super("github.com")}static credential(t){return Kd._fromParams({providerId:ec.PROVIDER_ID,signInMethod:ec.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ec.credentialFromTaggedObject(t)}static credentialFromError(t){return ec.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ec.credential(t.oauthAccessToken)}catch{return null}}}ec.GITHUB_SIGN_IN_METHOD="github.com";ec.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc extends a0{constructor(){super("twitter.com")}static credential(t,i){return Kd._fromParams({providerId:tc.PROVIDER_ID,signInMethod:tc.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:i})}static credentialFromResult(t){return tc.credentialFromTaggedObject(t)}static credentialFromError(t){return tc.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:i,oauthTokenSecret:r}=t;if(!i||!r)return null;try{return tc.credential(i,r)}catch{return null}}}tc.TWITTER_SIGN_IN_METHOD="twitter.com";tc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Awe(e,t){return s0(e,"POST","/v1/accounts:signUp",rh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,i,r,n=!1){const s=await zo._fromIdTokenResponse(t,r,n),a=m4(r);return new Zd({user:s,providerId:a,_tokenResponse:r,operationType:i})}static async _forOperation(t,i,r){await t._updateTokensIfNecessary(r,!0);const n=m4(r);return new Zd({user:t,providerId:n,_tokenResponse:r,operationType:i})}}function m4(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw extends ih{constructor(t,i,r,n){var s;super(i.code,i.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,qw.prototype),this.customData={appName:t.name,tenantId:(s=t.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:i.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,i,r,n){return new qw(t,i,r,n)}}function LH(e,t,i,r){return(t==="reauthenticate"?i._getReauthenticationResolver(e):i._getIdTokenResponse(e)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?qw._fromErrorAndOperation(e,s,t,r):s})}async function Cwe(e,t,i=!1){const r=await Qd(e,t._linkToIdToken(e.auth,await e.getIdToken()),i);return Zd._forOperation(e,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zH(e,t,i=!1){const{auth:r}=e;if(Ka(r.app))return Promise.reject(Vu(r));const n="reauthenticate";try{const s=await Qd(e,LH(r,n,t,e),i);ei(s.idToken,r,"internal-error");const a=PD(s.idToken);ei(a,r,"internal-error");const{sub:o}=a;return ei(e.uid===o,r,"user-mismatch"),Zd._forOperation(e,n,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Go(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NH(e,t,i=!1){if(Ka(e.app))return Promise.reject(Vu(e));const r="signIn",n=await LH(e,r,t),s=await Zd._fromIdTokenResponse(e,r,n);return i||await e._updateCurrentUser(s.user),s}async function Twe(e,t){return NH(Nc(e),t)}async function PPe(e,t){return zH(Hs(e),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BH(e){const t=Nc(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function MPe(e,t,i){const r=Nc(e);await Ww(r,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",xwe)}async function DPe(e,t,i){if(Ka(e.app))return Promise.reject(Vu(e));const r=Nc(e),a=await Ww(r,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Awe).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&BH(e),l}),o=await Zd._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function IPe(e,t,i){return Ka(e.app)?Promise.reject(Vu(e)):Twe(Hs(e),Ym.credential(t,i)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&BH(e),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pwe(e,t){return Yo(e,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RPe(e,{displayName:t,photoURL:i}){if(t===void 0&&i===void 0)return;const r=Hs(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:i,returnSecureToken:!0},a=await Qd(r,Pwe(r.auth,s));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const o=r.providerData.find(({providerId:l})=>l==="password");o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function OPe(e,t){return Mwe(Hs(e),null,t)}async function Mwe(e,t,i){const{auth:r}=e,s={idToken:await e.getIdToken(),returnSecureToken:!0};i&&(s.password=i);const a=await Qd(e,mwe(r,s));await e._updateTokensIfNecessary(a,!0)}function Dwe(e,t,i,r){return Hs(e).onIdTokenChanged(t,i,r)}function Iwe(e,t,i){return Hs(e).beforeAuthStateChanged(t,i)}function Rwe(e,t,i,r){return Hs(e).onAuthStateChanged(t,i,r)}const Xw="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FH{constructor(t,i){this.storageRetriever=t,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Xw,"1"),this.storage.removeItem(Xw),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,i){return this.storage.setItem(t,JSON.stringify(i)),Promise.resolve()}_get(t){const i=this.storage.getItem(t);return Promise.resolve(i?JSON.parse(i):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Owe=1e3,kwe=10;class UH extends FH{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=MH(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const r=this.storage.getItem(i),n=this.localCache[i];r!==n&&t(i,n,r)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=t.key;i?this.detachListener():this.stopPolling();const n=()=>{const a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);Kbe()&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,kwe):n()}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const n of Array.from(r))n(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},Owe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,i){await super._set(t,i),this.localCache[t]=JSON.stringify(i)}async _get(t){const i=await super._get(t);return this.localCache[t]=JSON.stringify(i),i}async _remove(t){await super._remove(t),delete this.localCache[t]}}UH.type="LOCAL";const Lwe=UH;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VH extends FH{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}VH.type="SESSION";const jH=VH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zwe(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(n=>n.isListeningto(t));if(i)return i;const r=new j_(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const i=t,{eventId:r,eventType:n,data:s}=i.data,a=this.handlersMap[n];if(!(a!=null&&a.size))return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:n});const o=Array.from(a).map(async u=>u(i.origin,s)),l=await zwe(o);i.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:l})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}j_.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(e="",t=10){let i="";for(let r=0;r<t;r++)i+=Math.floor(Math.random()*10);return e+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nwe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,i,r=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const u=RD("",20);n.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:n,onMessage(c){const f=c;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(f.data.response);break;default:clearTimeout(h),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),n.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:t,eventId:u,data:i},[n.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bl(){return window}function Bwe(e){Bl().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(){return typeof Bl().WorkerGlobalScope<"u"&&typeof Bl().importScripts=="function"}async function Fwe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Uwe(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Vwe(){return HH()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GH="firebaseLocalStorageDb",jwe=1,Yw="firebaseLocalStorage",WH="fbase_key";class o0{constructor(t){this.request=t}toPromise(){return new Promise((t,i)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function H_(e,t){return e.transaction([Yw],t?"readwrite":"readonly").objectStore(Yw)}function Hwe(){const e=indexedDB.deleteDatabase(GH);return new o0(e).toPromise()}function pP(){const e=indexedDB.open(GH,jwe);return new Promise((t,i)=>{e.addEventListener("error",()=>{i(e.error)}),e.addEventListener("upgradeneeded",()=>{const r=e.result;try{r.createObjectStore(Yw,{keyPath:WH})}catch(n){i(n)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(Yw)?t(r):(r.close(),await Hwe(),t(await pP()))})})}async function g4(e,t,i){const r=H_(e,!0).put({[WH]:t,value:i});return new o0(r).toPromise()}async function Gwe(e,t){const i=H_(e,!1).get(t),r=await new o0(i).toPromise();return r===void 0?null:r.value}function v4(e,t){const i=H_(e,!0).delete(t);return new o0(i).toPromise()}const Wwe=800,qwe=3;class qH{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await pP(),this.db)}async _withRetries(t){let i=0;for(;;)try{const r=await this._openDb();return await t(r)}catch(r){if(i++>qwe)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return HH()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=j_._getInstance(Vwe()),this.receiver._subscribe("keyChanged",async(t,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(t,i)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await Fwe(),!this.activeServiceWorker)return;this.sender=new Nwe(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Uwe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await pP();return await g4(t,Xw,"1"),await v4(t,Xw),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,i){return this._withPendingWrite(async()=>(await this._withRetries(r=>g4(r,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)))}async _get(t){const i=await this._withRetries(r=>Gwe(r,t));return this.localCache[t]=i,i}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(i=>v4(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(n=>{const s=H_(n,!1).getAll();return new o0(s).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const i=[],r=new Set;if(t.length!==0)for(const{fbase_key:n,value:s}of t)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),i.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!r.has(n)&&(this.notifyListeners(n,null),i.push(n));return i}notifyListeners(t,i){this.localCache[t]=i;const r=this.listeners[t];if(r)for(const n of Array.from(r))n(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Wwe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}qH.type="LOCAL";const Xwe=qH;new n0(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ywe(e,t){return t?Bu(t):(ei(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD extends DD{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return sm(t,this._buildIdpRequest())}_linkToIdToken(t,i){return sm(t,this._buildIdpRequest(i))}_getReauthenticationResolver(t){return sm(t,this._buildIdpRequest())}_buildIdpRequest(t){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(i.idToken=t),i}}function Qwe(e){return NH(e.auth,new OD(e),e.bypassAuthState)}function Kwe(e){const{auth:t,user:i}=e;return ei(i,t,"internal-error"),zH(i,new OD(e),e.bypassAuthState)}async function Zwe(e){const{auth:t,user:i}=e;return ei(i,t,"internal-error"),Cwe(i,new OD(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XH{constructor(t,i,r,n,s=!1){this.auth=t,this.resolver=r,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(t,i)=>{this.pendingPromise={resolve:t,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(t){const{urlResponse:i,sessionId:r,postBody:n,tenantId:s,error:a,type:o}=t;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:i,sessionId:r,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Qwe;case"linkViaPopup":case"linkViaRedirect":return Zwe;case"reauthViaPopup":case"reauthViaRedirect":return Kwe;default:Go(this.auth,"internal-error")}}resolve(t){Zu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Zu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jwe=new n0(2e3,1e4);class jp extends XH{constructor(t,i,r,n,s){super(t,i,n,s),this.provider=r,this.authWindow=null,this.pollId=null,jp.currentPopupAction&&jp.currentPopupAction.cancel(),jp.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return ei(t,this.auth,"internal-error"),t}async onExecution(){Zu(this.filter.length===1,"Popup operations only handle one event");const t=RD();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Nl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Nl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jp.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,r;if(!((r=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Nl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Jwe.get())};t()}}jp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $we="pendingRedirect",Cb=new Map;class e_e extends XH{constructor(t,i,r=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,r),this.eventId=null}async execute(){let t=Cb.get(this.auth._key());if(!t){try{const r=await t_e(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(r)}catch(i){t=()=>Promise.reject(i)}Cb.set(this.auth._key(),t)}return this.bypassAuthState||Cb.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const i=await this.auth._redirectUserForId(t.eventId);if(i)return this.user=i,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function t_e(e,t){const i=n_e(t),r=r_e(e);if(!await r._isAvailable())return!1;const n=await r._get(i)==="true";return await r._remove(i),n}function i_e(e,t){Cb.set(e._key(),t)}function r_e(e){return Bu(e._redirectPersistence)}function n_e(e){return Ab($we,e.config.apiKey,e.name)}async function s_e(e,t,i=!1){if(Ka(e.app))return Promise.reject(Vu(e));const r=Nc(e),n=Ywe(r,t),a=await new e_e(r,n,i).execute();return a&&!i&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_e=10*60*1e3;class o_e{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let i=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(t,r)&&(i=!0,this.sendToConsumer(t,r),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!l_e(t)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=t,i=!0)),i}sendToConsumer(t,i){var r;if(t.error&&!YH(t)){const n=((r=t.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";i.onError(Nl(this.auth,n))}else i.onAuthEvent(t)}isEventForConsumer(t,i){const r=i.eventId===null||!!t.eventId&&t.eventId===i.eventId;return i.filter.includes(t.type)&&r}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=a_e&&this.cachedEventUids.clear(),this.cachedEventUids.has(y4(t))}saveEventToCache(t){this.cachedEventUids.add(y4(t)),this.lastProcessedEventTime=Date.now()}}function y4(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function YH({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function l_e(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return YH(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u_e(e,t={}){return Yo(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h_e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,c_e=/^https?/;async function d_e(e){if(e.config.emulator)return;const{authorizedDomains:t}=await u_e(e);for(const i of t)try{if(f_e(i))return}catch{}Go(e,"unauthorized-domain")}function f_e(e){const t=dP(),{protocol:i,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const a=new URL(e);return a.hostname===""&&r===""?i==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):i==="chrome-extension:"&&a.hostname===r}if(!c_e.test(i))return!1;if(h_e.test(e))return r===e;const n=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p_e=new n0(3e4,6e4);function x4(){const e=Bl().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let i=0;i<e.CP.length;i++)e.CP[i]=null}}function m_e(e){return new Promise((t,i)=>{var r,n,s;function a(){x4(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{x4(),i(Nl(e,"network-request-failed"))},timeout:p_e.get()})}if(!((n=(r=Bl().gapi)===null||r===void 0?void 0:r.iframes)===null||n===void 0)&&n.Iframe)t(gapi.iframes.getContext());else if(!((s=Bl().gapi)===null||s===void 0)&&s.load)a();else{const o=swe("iframefcb");return Bl()[o]=()=>{gapi.load?a():i(Nl(e,"network-request-failed"))},IH(`${nwe()}?onload=${o}`).catch(l=>i(l))}}).catch(t=>{throw Tb=null,t})}let Tb=null;function g_e(e){return Tb=Tb||m_e(e),Tb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_e=new n0(5e3,15e3),y_e="__/auth/iframe",x_e="emulator/auth/iframe",b_e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},w_e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function __e(e){const t=e.config;ei(t.authDomain,e,"auth-domain-config-required");const i=t.emulator?TD(t,x_e):`https://${e.config.authDomain}/${y_e}`,r={apiKey:t.apiKey,appName:e.name,v:Xm},n=w_e.get(e.config.apiHost);n&&(r.eid=n);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${i}?${r0(r).slice(1)}`}async function S_e(e){const t=await g_e(e),i=Bl().gapi;return ei(i,e,"internal-error"),t.open({where:document.body,url:__e(e),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:b_e,dontclear:!0},r=>new Promise(async(n,s)=>{await r.restyle({setHideOnLeave:!1});const a=Nl(e,"network-request-failed"),o=Bl().setTimeout(()=>{s(a)},v_e.get());function l(){Bl().clearTimeout(o),n(r)}r.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E_e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},A_e=500,C_e=600,T_e="_blank",P_e="http://localhost";class b4{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function M_e(e,t,i,r=A_e,n=C_e){const s=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},E_e),{width:r.toString(),height:n.toString(),top:s,left:a}),u=Ss().toLowerCase();i&&(o=EH(u)?T_e:i),_H(u)&&(t=t||P_e,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[m,g])=>`${f}${m}=${g},`,"");if(Qbe(u)&&o!=="_self")return D_e(t||"",o),new b4(null);const c=window.open(t||"",o,h);ei(c,e,"popup-blocked");try{c.focus()}catch{}return new b4(c)}function D_e(e,t){const i=document.createElement("a");i.href=e,i.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I_e="__/auth/handler",R_e="emulator/auth/handler",O_e=encodeURIComponent("fac");async function w4(e,t,i,r,n,s){ei(e.config.authDomain,e,"auth-domain-config-required"),ei(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:i,redirectUrl:r,v:Xm,eventId:n};if(t instanceof kH){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",vxe(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[h,c]of Object.entries({}))a[h]=c}if(t instanceof a0){const h=t.getScopes().filter(c=>c!=="");h.length>0&&(a.scopes=h.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const h of Object.keys(o))o[h]===void 0&&delete o[h];const l=await e._getAppCheckToken(),u=l?`#${O_e}=${encodeURIComponent(l)}`:"";return`${k_e(e)}?${r0(o).slice(1)}${u}`}function k_e({config:e}){return e.emulator?TD(e,R_e):`https://${e.authDomain}/${I_e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC="webStorageSupport";class L_e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jH,this._completeRedirectFn=s_e,this._overrideRedirectResult=i_e}async _openPopup(t,i,r,n){var s;Zu((s=this.eventManagers[t._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const a=await w4(t,i,r,dP(),n);return M_e(t,a,RD())}async _openRedirect(t,i,r,n){await this._originValidation(t);const s=await w4(t,i,r,dP(),n);return Bwe(s),new Promise(()=>{})}_initialize(t){const i=t._key();if(this.eventManagers[i]){const{manager:n,promise:s}=this.eventManagers[i];return n?Promise.resolve(n):(Zu(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(t);return this.eventManagers[i]={promise:r},r.catch(()=>{delete this.eventManagers[i]}),r}async initAndGetManager(t){const i=await S_e(t),r=new o_e(t);return i.register("authEvent",n=>(ei(n==null?void 0:n.authEvent,t,"invalid-auth-event"),{status:r.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=i,r}_isIframeWebStorageSupported(t,i){this.iframes[t._key()].send(KC,{type:KC},n=>{var s;const a=(s=n==null?void 0:n[0])===null||s===void 0?void 0:s[KC];a!==void 0&&i(!!a),Go(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const i=t._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=d_e(t)),this.originValidationPromises[i]}get _shouldInitProactively(){return MH()||SH()||MD()}}const z_e=L_e;var _4="@firebase/auth",S4="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_e{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const i=this.auth.onIdTokenChanged(r=>{t((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,i),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const i=this.internalListeners.get(t);i&&(this.internalListeners.delete(t),i(),this.updateProactiveRefresh())}assertAuthConfigured(){ei(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B_e(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function F_e(e){_m(new Yd("auth",(t,{options:i})=>{const r=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;ei(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:DH(e)},u=new twe(r,n,s,l);return cwe(u,i),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,i,r)=>{t.getProvider("auth-internal").initialize()})),_m(new Yd("auth-internal",t=>{const i=Nc(t.getProvider("auth").getImmediate());return(r=>new N_e(r))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),xc(_4,S4,B_e(e)),xc(_4,S4,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_e=5*60,V_e=oH("authIdTokenMaxAge")||U_e;let E4=null;const j_e=e=>async t=>{const i=t&&await t.getIdTokenResult(),r=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(r&&r>V_e)return;const n=i==null?void 0:i.token;E4!==n&&(E4=n,await fetch(e,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function H_e(e=cH()){const t=ED(e,"auth");if(t.isInitialized())return t.getImmediate();const i=hwe(e,{popupRedirectResolver:z_e,persistence:[Xwe,Lwe,jH]}),r=oH("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const a=j_e(s.toString());Iwe(i,a,()=>a(i.currentUser)),Dwe(i,o=>a(o))}}const n=sH("auth");return n&&dwe(i,`http://${n}`),i}function G_e(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}iwe({loadJS(e){return new Promise((t,i)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=n=>{const s=Nl("internal-error");s.customData=n,i(s)},r.type="text/javascript",r.charset="UTF-8",G_e().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});F_e("Browser");var W_e="firebase",q_e="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xc(W_e,q_e,"app");var A4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bc,QH;(function(){var e;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(P,E){function D(){}D.prototype=E.prototype,P.D=E.prototype,P.prototype=new D,P.prototype.constructor=P,P.C=function(I,O,N){for(var k=Array(arguments.length-2),U=2;U<arguments.length;U++)k[U-2]=arguments[U];return E.prototype[O].apply(I,k)}}function i(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,i),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function n(P,E,D){D||(D=0);var I=Array(16);if(typeof E=="string")for(var O=0;16>O;++O)I[O]=E.charCodeAt(D++)|E.charCodeAt(D++)<<8|E.charCodeAt(D++)<<16|E.charCodeAt(D++)<<24;else for(O=0;16>O;++O)I[O]=E[D++]|E[D++]<<8|E[D++]<<16|E[D++]<<24;E=P.g[0],D=P.g[1],O=P.g[2];var N=P.g[3],k=E+(N^D&(O^N))+I[0]+3614090360&4294967295;E=D+(k<<7&4294967295|k>>>25),k=N+(O^E&(D^O))+I[1]+3905402710&4294967295,N=E+(k<<12&4294967295|k>>>20),k=O+(D^N&(E^D))+I[2]+606105819&4294967295,O=N+(k<<17&4294967295|k>>>15),k=D+(E^O&(N^E))+I[3]+3250441966&4294967295,D=O+(k<<22&4294967295|k>>>10),k=E+(N^D&(O^N))+I[4]+4118548399&4294967295,E=D+(k<<7&4294967295|k>>>25),k=N+(O^E&(D^O))+I[5]+1200080426&4294967295,N=E+(k<<12&4294967295|k>>>20),k=O+(D^N&(E^D))+I[6]+2821735955&4294967295,O=N+(k<<17&4294967295|k>>>15),k=D+(E^O&(N^E))+I[7]+4249261313&4294967295,D=O+(k<<22&4294967295|k>>>10),k=E+(N^D&(O^N))+I[8]+1770035416&4294967295,E=D+(k<<7&4294967295|k>>>25),k=N+(O^E&(D^O))+I[9]+2336552879&4294967295,N=E+(k<<12&4294967295|k>>>20),k=O+(D^N&(E^D))+I[10]+4294925233&4294967295,O=N+(k<<17&4294967295|k>>>15),k=D+(E^O&(N^E))+I[11]+2304563134&4294967295,D=O+(k<<22&4294967295|k>>>10),k=E+(N^D&(O^N))+I[12]+1804603682&4294967295,E=D+(k<<7&4294967295|k>>>25),k=N+(O^E&(D^O))+I[13]+4254626195&4294967295,N=E+(k<<12&4294967295|k>>>20),k=O+(D^N&(E^D))+I[14]+2792965006&4294967295,O=N+(k<<17&4294967295|k>>>15),k=D+(E^O&(N^E))+I[15]+1236535329&4294967295,D=O+(k<<22&4294967295|k>>>10),k=E+(O^N&(D^O))+I[1]+4129170786&4294967295,E=D+(k<<5&4294967295|k>>>27),k=N+(D^O&(E^D))+I[6]+3225465664&4294967295,N=E+(k<<9&4294967295|k>>>23),k=O+(E^D&(N^E))+I[11]+643717713&4294967295,O=N+(k<<14&4294967295|k>>>18),k=D+(N^E&(O^N))+I[0]+3921069994&4294967295,D=O+(k<<20&4294967295|k>>>12),k=E+(O^N&(D^O))+I[5]+3593408605&4294967295,E=D+(k<<5&4294967295|k>>>27),k=N+(D^O&(E^D))+I[10]+38016083&4294967295,N=E+(k<<9&4294967295|k>>>23),k=O+(E^D&(N^E))+I[15]+3634488961&4294967295,O=N+(k<<14&4294967295|k>>>18),k=D+(N^E&(O^N))+I[4]+3889429448&4294967295,D=O+(k<<20&4294967295|k>>>12),k=E+(O^N&(D^O))+I[9]+568446438&4294967295,E=D+(k<<5&4294967295|k>>>27),k=N+(D^O&(E^D))+I[14]+3275163606&4294967295,N=E+(k<<9&4294967295|k>>>23),k=O+(E^D&(N^E))+I[3]+4107603335&4294967295,O=N+(k<<14&4294967295|k>>>18),k=D+(N^E&(O^N))+I[8]+1163531501&4294967295,D=O+(k<<20&4294967295|k>>>12),k=E+(O^N&(D^O))+I[13]+2850285829&4294967295,E=D+(k<<5&4294967295|k>>>27),k=N+(D^O&(E^D))+I[2]+4243563512&4294967295,N=E+(k<<9&4294967295|k>>>23),k=O+(E^D&(N^E))+I[7]+1735328473&4294967295,O=N+(k<<14&4294967295|k>>>18),k=D+(N^E&(O^N))+I[12]+2368359562&4294967295,D=O+(k<<20&4294967295|k>>>12),k=E+(D^O^N)+I[5]+4294588738&4294967295,E=D+(k<<4&4294967295|k>>>28),k=N+(E^D^O)+I[8]+2272392833&4294967295,N=E+(k<<11&4294967295|k>>>21),k=O+(N^E^D)+I[11]+1839030562&4294967295,O=N+(k<<16&4294967295|k>>>16),k=D+(O^N^E)+I[14]+4259657740&4294967295,D=O+(k<<23&4294967295|k>>>9),k=E+(D^O^N)+I[1]+2763975236&4294967295,E=D+(k<<4&4294967295|k>>>28),k=N+(E^D^O)+I[4]+1272893353&4294967295,N=E+(k<<11&4294967295|k>>>21),k=O+(N^E^D)+I[7]+4139469664&4294967295,O=N+(k<<16&4294967295|k>>>16),k=D+(O^N^E)+I[10]+3200236656&4294967295,D=O+(k<<23&4294967295|k>>>9),k=E+(D^O^N)+I[13]+681279174&4294967295,E=D+(k<<4&4294967295|k>>>28),k=N+(E^D^O)+I[0]+3936430074&4294967295,N=E+(k<<11&4294967295|k>>>21),k=O+(N^E^D)+I[3]+3572445317&4294967295,O=N+(k<<16&4294967295|k>>>16),k=D+(O^N^E)+I[6]+76029189&4294967295,D=O+(k<<23&4294967295|k>>>9),k=E+(D^O^N)+I[9]+3654602809&4294967295,E=D+(k<<4&4294967295|k>>>28),k=N+(E^D^O)+I[12]+3873151461&4294967295,N=E+(k<<11&4294967295|k>>>21),k=O+(N^E^D)+I[15]+530742520&4294967295,O=N+(k<<16&4294967295|k>>>16),k=D+(O^N^E)+I[2]+3299628645&4294967295,D=O+(k<<23&4294967295|k>>>9),k=E+(O^(D|~N))+I[0]+4096336452&4294967295,E=D+(k<<6&4294967295|k>>>26),k=N+(D^(E|~O))+I[7]+1126891415&4294967295,N=E+(k<<10&4294967295|k>>>22),k=O+(E^(N|~D))+I[14]+2878612391&4294967295,O=N+(k<<15&4294967295|k>>>17),k=D+(N^(O|~E))+I[5]+4237533241&4294967295,D=O+(k<<21&4294967295|k>>>11),k=E+(O^(D|~N))+I[12]+1700485571&4294967295,E=D+(k<<6&4294967295|k>>>26),k=N+(D^(E|~O))+I[3]+2399980690&4294967295,N=E+(k<<10&4294967295|k>>>22),k=O+(E^(N|~D))+I[10]+4293915773&4294967295,O=N+(k<<15&4294967295|k>>>17),k=D+(N^(O|~E))+I[1]+2240044497&4294967295,D=O+(k<<21&4294967295|k>>>11),k=E+(O^(D|~N))+I[8]+1873313359&4294967295,E=D+(k<<6&4294967295|k>>>26),k=N+(D^(E|~O))+I[15]+4264355552&4294967295,N=E+(k<<10&4294967295|k>>>22),k=O+(E^(N|~D))+I[6]+2734768916&4294967295,O=N+(k<<15&4294967295|k>>>17),k=D+(N^(O|~E))+I[13]+1309151649&4294967295,D=O+(k<<21&4294967295|k>>>11),k=E+(O^(D|~N))+I[4]+4149444226&4294967295,E=D+(k<<6&4294967295|k>>>26),k=N+(D^(E|~O))+I[11]+3174756917&4294967295,N=E+(k<<10&4294967295|k>>>22),k=O+(E^(N|~D))+I[2]+718787259&4294967295,O=N+(k<<15&4294967295|k>>>17),k=D+(N^(O|~E))+I[9]+3951481745&4294967295,P.g[0]=P.g[0]+E&4294967295,P.g[1]=P.g[1]+(O+(k<<21&4294967295|k>>>11))&4294967295,P.g[2]=P.g[2]+O&4294967295,P.g[3]=P.g[3]+N&4294967295}r.prototype.u=function(P,E){E===void 0&&(E=P.length);for(var D=E-this.blockSize,I=this.B,O=this.h,N=0;N<E;){if(O==0)for(;N<=D;)n(this,P,N),N+=this.blockSize;if(typeof P=="string"){for(;N<E;)if(I[O++]=P.charCodeAt(N++),O==this.blockSize){n(this,I),O=0;break}}else for(;N<E;)if(I[O++]=P[N++],O==this.blockSize){n(this,I),O=0;break}}this.h=O,this.o+=E},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var E=1;E<P.length-8;++E)P[E]=0;var D=8*this.o;for(E=P.length-8;E<P.length;++E)P[E]=D&255,D/=256;for(this.u(P),P=Array(16),E=D=0;4>E;++E)for(var I=0;32>I;I+=8)P[D++]=this.g[E]>>>I&255;return P};function s(P,E){var D=o;return Object.prototype.hasOwnProperty.call(D,P)?D[P]:D[P]=E(P)}function a(P,E){this.h=E;for(var D=[],I=!0,O=P.length-1;0<=O;O--){var N=P[O]|0;I&&N==E||(D[O]=N,I=!1)}this.g=D}var o={};function l(P){return-128<=P&&128>P?s(P,function(E){return new a([E|0],0>E?-1:0)}):new a([P|0],0>P?-1:0)}function u(P){if(isNaN(P)||!isFinite(P))return c;if(0>P)return v(u(-P));for(var E=[],D=1,I=0;P>=D;I++)E[I]=P/D|0,D*=4294967296;return new a(E,0)}function h(P,E){if(P.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(P.charAt(0)=="-")return v(h(P.substring(1),E));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=u(Math.pow(E,8)),I=c,O=0;O<P.length;O+=8){var N=Math.min(8,P.length-O),k=parseInt(P.substring(O,O+N),E);8>N?(N=u(Math.pow(E,N)),I=I.j(N).add(u(k))):(I=I.j(D),I=I.add(u(k)))}return I}var c=l(0),f=l(1),m=l(16777216);e=a.prototype,e.m=function(){if(y(this))return-v(this).m();for(var P=0,E=1,D=0;D<this.g.length;D++){var I=this.i(D);P+=(0<=I?I:4294967296+I)*E,E*=4294967296}return P},e.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(g(this))return"0";if(y(this))return"-"+v(this).toString(P);for(var E=u(Math.pow(P,6)),D=this,I="";;){var O=T(D,E).g;D=b(D,O.j(E));var N=((0<D.g.length?D.g[0]:D.h)>>>0).toString(P);if(D=O,g(D))return N+I;for(;6>N.length;)N="0"+N;I=N+I}},e.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function g(P){if(P.h!=0)return!1;for(var E=0;E<P.g.length;E++)if(P.g[E]!=0)return!1;return!0}function y(P){return P.h==-1}e.l=function(P){return P=b(this,P),y(P)?-1:g(P)?0:1};function v(P){for(var E=P.g.length,D=[],I=0;I<E;I++)D[I]=~P.g[I];return new a(D,~P.h).add(f)}e.abs=function(){return y(this)?v(this):this},e.add=function(P){for(var E=Math.max(this.g.length,P.g.length),D=[],I=0,O=0;O<=E;O++){var N=I+(this.i(O)&65535)+(P.i(O)&65535),k=(N>>>16)+(this.i(O)>>>16)+(P.i(O)>>>16);I=k>>>16,N&=65535,k&=65535,D[O]=k<<16|N}return new a(D,D[D.length-1]&-2147483648?-1:0)};function b(P,E){return P.add(v(E))}e.j=function(P){if(g(this)||g(P))return c;if(y(this))return y(P)?v(this).j(v(P)):v(v(this).j(P));if(y(P))return v(this.j(v(P)));if(0>this.l(m)&&0>P.l(m))return u(this.m()*P.m());for(var E=this.g.length+P.g.length,D=[],I=0;I<2*E;I++)D[I]=0;for(I=0;I<this.g.length;I++)for(var O=0;O<P.g.length;O++){var N=this.i(I)>>>16,k=this.i(I)&65535,U=P.i(O)>>>16,Q=P.i(O)&65535;D[2*I+2*O]+=k*Q,S(D,2*I+2*O),D[2*I+2*O+1]+=N*Q,S(D,2*I+2*O+1),D[2*I+2*O+1]+=k*U,S(D,2*I+2*O+1),D[2*I+2*O+2]+=N*U,S(D,2*I+2*O+2)}for(I=0;I<E;I++)D[I]=D[2*I+1]<<16|D[2*I];for(I=E;I<2*E;I++)D[I]=0;return new a(D,0)};function S(P,E){for(;(P[E]&65535)!=P[E];)P[E+1]+=P[E]>>>16,P[E]&=65535,E++}function _(P,E){this.g=P,this.h=E}function T(P,E){if(g(E))throw Error("division by zero");if(g(P))return new _(c,c);if(y(P))return E=T(v(P),E),new _(v(E.g),v(E.h));if(y(E))return E=T(P,v(E)),new _(v(E.g),E.h);if(30<P.g.length){if(y(P)||y(E))throw Error("slowDivide_ only works with positive integers.");for(var D=f,I=E;0>=I.l(P);)D=M(D),I=M(I);var O=C(D,1),N=C(I,1);for(I=C(I,2),D=C(D,2);!g(I);){var k=N.add(I);0>=k.l(P)&&(O=O.add(D),N=k),I=C(I,1),D=C(D,1)}return E=b(P,O.j(E)),new _(O,E)}for(O=c;0<=P.l(E);){for(D=Math.max(1,Math.floor(P.m()/E.m())),I=Math.ceil(Math.log(D)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),N=u(D),k=N.j(E);y(k)||0<k.l(P);)D-=I,N=u(D),k=N.j(E);g(N)&&(N=f),O=O.add(N),P=b(P,k)}return new _(O,P)}e.A=function(P){return T(this,P).h},e.and=function(P){for(var E=Math.max(this.g.length,P.g.length),D=[],I=0;I<E;I++)D[I]=this.i(I)&P.i(I);return new a(D,this.h&P.h)},e.or=function(P){for(var E=Math.max(this.g.length,P.g.length),D=[],I=0;I<E;I++)D[I]=this.i(I)|P.i(I);return new a(D,this.h|P.h)},e.xor=function(P){for(var E=Math.max(this.g.length,P.g.length),D=[],I=0;I<E;I++)D[I]=this.i(I)^P.i(I);return new a(D,this.h^P.h)};function M(P){for(var E=P.g.length+1,D=[],I=0;I<E;I++)D[I]=P.i(I)<<1|P.i(I-1)>>>31;return new a(D,P.h)}function C(P,E){var D=E>>5;E%=32;for(var I=P.g.length-D,O=[],N=0;N<I;N++)O[N]=0<E?P.i(N+D)>>>E|P.i(N+D+1)<<32-E:P.i(N+D);return new a(O,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,QH=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=h,bc=a}).apply(typeof A4<"u"?A4:typeof self<"u"?self:typeof window<"u"?window:{});var qx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var KH,Dv,ZH,Pb,mP,JH,$H,eG;(function(){var e,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(w,z,F){return w==Array.prototype||w==Object.prototype||(w[z]=F.value),w};function i(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof qx=="object"&&qx];for(var z=0;z<w.length;++z){var F=w[z];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=i(this);function n(w,z){if(z)e:{var F=r;w=w.split(".");for(var Z=0;Z<w.length-1;Z++){var be=w[Z];if(!(be in F))break e;F=F[be]}w=w[w.length-1],Z=F[w],z=z(Z),z!=Z&&z!=null&&t(F,w,{configurable:!0,writable:!0,value:z})}}function s(w,z){w instanceof String&&(w+="");var F=0,Z=!1,be={next:function(){if(!Z&&F<w.length){var Re=F++;return{value:z(Re,w[Re]),done:!1}}return Z=!0,{done:!0,value:void 0}}};return be[Symbol.iterator]=function(){return be},be}n("Array.prototype.values",function(w){return w||function(){return s(this,function(z,F){return F})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(w){var z=typeof w;return z=z!="object"?z:w?Array.isArray(w)?"array":z:"null",z=="array"||z=="object"&&typeof w.length=="number"}function u(w){var z=typeof w;return z=="object"&&w!=null||z=="function"}function h(w,z,F){return w.call.apply(w.bind,arguments)}function c(w,z,F){if(!w)throw Error();if(2<arguments.length){var Z=Array.prototype.slice.call(arguments,2);return function(){var be=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(be,Z),w.apply(z,be)}}return function(){return w.apply(z,arguments)}}function f(w,z,F){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:c,f.apply(null,arguments)}function m(w,z){var F=Array.prototype.slice.call(arguments,1);return function(){var Z=F.slice();return Z.push.apply(Z,arguments),w.apply(this,Z)}}function g(w,z){function F(){}F.prototype=z.prototype,w.aa=z.prototype,w.prototype=new F,w.prototype.constructor=w,w.Qb=function(Z,be,Re){for(var nt=Array(arguments.length-2),Yi=2;Yi<arguments.length;Yi++)nt[Yi-2]=arguments[Yi];return z.prototype[be].apply(Z,nt)}}function y(w){const z=w.length;if(0<z){const F=Array(z);for(let Z=0;Z<z;Z++)F[Z]=w[Z];return F}return[]}function v(w,z){for(let F=1;F<arguments.length;F++){const Z=arguments[F];if(l(Z)){const be=w.length||0,Re=Z.length||0;w.length=be+Re;for(let nt=0;nt<Re;nt++)w[be+nt]=Z[nt]}else w.push(Z)}}class b{constructor(z,F){this.i=z,this.j=F,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function S(w){return/^[\s\xa0]*$/.test(w)}function _(){var w=o.navigator;return w&&(w=w.userAgent)?w:""}function T(w){return T[" "](w),w}T[" "]=function(){};var M=_().indexOf("Gecko")!=-1&&!(_().toLowerCase().indexOf("webkit")!=-1&&_().indexOf("Edge")==-1)&&!(_().indexOf("Trident")!=-1||_().indexOf("MSIE")!=-1)&&_().indexOf("Edge")==-1;function C(w,z,F){for(const Z in w)z.call(F,w[Z],Z,w)}function P(w,z){for(const F in w)z.call(void 0,w[F],F,w)}function E(w){const z={};for(const F in w)z[F]=w[F];return z}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(w,z){let F,Z;for(let be=1;be<arguments.length;be++){Z=arguments[be];for(F in Z)w[F]=Z[F];for(let Re=0;Re<D.length;Re++)F=D[Re],Object.prototype.hasOwnProperty.call(Z,F)&&(w[F]=Z[F])}}function O(w){var z=1;w=w.split(":");const F=[];for(;0<z&&w.length;)F.push(w.shift()),z--;return w.length&&F.push(w.join(":")),F}function N(w){o.setTimeout(()=>{throw w},0)}function k(){var w=ie;let z=null;return w.g&&(z=w.g,w.g=w.g.next,w.g||(w.h=null),z.next=null),z}class U{constructor(){this.h=this.g=null}add(z,F){const Z=Q.get();Z.set(z,F),this.h?this.h.next=Z:this.g=Z,this.h=Z}}var Q=new b(()=>new se,w=>w.reset());class se{constructor(){this.next=this.g=this.h=null}set(z,F){this.h=z,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let K,H=!1,ie=new U,$=()=>{const w=o.Promise.resolve(void 0);K=()=>{w.then(V)}};var V=()=>{for(var w;w=k();){try{w.h.call(w.g)}catch(F){N(F)}var z=Q;z.j(w),100>z.h&&(z.h++,w.next=z.g,z.g=w)}H=!1};function X(){this.s=this.s,this.C=this.C}X.prototype.s=!1,X.prototype.ma=function(){this.s||(this.s=!0,this.N())},X.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(w,z){this.type=w,this.g=this.target=z,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var ne=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var w=!1,z=Object.defineProperty({},"passive",{get:function(){w=!0}});try{const F=()=>{};o.addEventListener("test",F,z),o.removeEventListener("test",F,z)}catch{}return w}();function he(w,z){if(ue.call(this,w?w.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,w){var F=this.type=w.type,Z=w.changedTouches&&w.changedTouches.length?w.changedTouches[0]:null;if(this.target=w.target||w.srcElement,this.g=z,z=w.relatedTarget){if(M){e:{try{T(z.nodeName);var be=!0;break e}catch{}be=!1}be||(z=null)}}else F=="mouseover"?z=w.fromElement:F=="mouseout"&&(z=w.toElement);this.relatedTarget=z,Z?(this.clientX=Z.clientX!==void 0?Z.clientX:Z.pageX,this.clientY=Z.clientY!==void 0?Z.clientY:Z.pageY,this.screenX=Z.screenX||0,this.screenY=Z.screenY||0):(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0),this.button=w.button,this.key=w.key||"",this.ctrlKey=w.ctrlKey,this.altKey=w.altKey,this.shiftKey=w.shiftKey,this.metaKey=w.metaKey,this.pointerId=w.pointerId||0,this.pointerType=typeof w.pointerType=="string"?w.pointerType:te[w.pointerType]||"",this.state=w.state,this.i=w,w.defaultPrevented&&he.aa.h.call(this)}}g(he,ue);var te={2:"touch",3:"pen",4:"mouse"};he.prototype.h=function(){he.aa.h.call(this);var w=this.i;w.preventDefault?w.preventDefault():w.returnValue=!1};var me="closure_listenable_"+(1e6*Math.random()|0),de=0;function fe(w,z,F,Z,be){this.listener=w,this.proxy=null,this.src=z,this.type=F,this.capture=!!Z,this.ha=be,this.key=++de,this.da=this.fa=!1}function ye(w){w.da=!0,w.listener=null,w.proxy=null,w.src=null,w.ha=null}function Te(w){this.src=w,this.g={},this.h=0}Te.prototype.add=function(w,z,F,Z,be){var Re=w.toString();w=this.g[Re],w||(w=this.g[Re]=[],this.h++);var nt=Ne(w,z,Z,be);return-1<nt?(z=w[nt],F||(z.fa=!1)):(z=new fe(z,this.src,Re,!!Z,be),z.fa=F,w.push(z)),z};function Ie(w,z){var F=z.type;if(F in w.g){var Z=w.g[F],be=Array.prototype.indexOf.call(Z,z,void 0),Re;(Re=0<=be)&&Array.prototype.splice.call(Z,be,1),Re&&(ye(z),w.g[F].length==0&&(delete w.g[F],w.h--))}}function Ne(w,z,F,Z){for(var be=0;be<w.length;++be){var Re=w[be];if(!Re.da&&Re.listener==z&&Re.capture==!!F&&Re.ha==Z)return be}return-1}var st="closure_lm_"+(1e6*Math.random()|0),We={};function ct(w,z,F,Z,be){if(Array.isArray(z)){for(var Re=0;Re<z.length;Re++)ct(w,z[Re],F,Z,be);return null}return F=Ve(F),w&&w[me]?w.K(z,F,u(Z)?!!Z.capture:!1,be):ut(w,z,F,!1,Z,be)}function ut(w,z,F,Z,be,Re){if(!z)throw Error("Invalid event type");var nt=u(be)?!!be.capture:!!be,Yi=Y(w);if(Yi||(w[st]=Yi=new Te(w)),F=Yi.add(z,F,Z,nt,Re),F.proxy)return F;if(Z=Ke(),F.proxy=Z,Z.src=w,Z.listener=F,w.addEventListener)ne||(be=nt),be===void 0&&(be=!1),w.addEventListener(z.toString(),Z,be);else if(w.attachEvent)w.attachEvent(pt(z.toString()),Z);else if(w.addListener&&w.removeListener)w.addListener(Z);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Ke(){function w(F){return z.call(w.src,w.listener,F)}const z=re;return w}function Ye(w,z,F,Z,be){if(Array.isArray(z))for(var Re=0;Re<z.length;Re++)Ye(w,z[Re],F,Z,be);else Z=u(Z)?!!Z.capture:!!Z,F=Ve(F),w&&w[me]?(w=w.i,z=String(z).toString(),z in w.g&&(Re=w.g[z],F=Ne(Re,F,Z,be),-1<F&&(ye(Re[F]),Array.prototype.splice.call(Re,F,1),Re.length==0&&(delete w.g[z],w.h--)))):w&&(w=Y(w))&&(z=w.g[z.toString()],w=-1,z&&(w=Ne(z,F,Z,be)),(F=-1<w?z[w]:null)&&yt(F))}function yt(w){if(typeof w!="number"&&w&&!w.da){var z=w.src;if(z&&z[me])Ie(z.i,w);else{var F=w.type,Z=w.proxy;z.removeEventListener?z.removeEventListener(F,Z,w.capture):z.detachEvent?z.detachEvent(pt(F),Z):z.addListener&&z.removeListener&&z.removeListener(Z),(F=Y(z))?(Ie(F,w),F.h==0&&(F.src=null,z[st]=null)):ye(w)}}}function pt(w){return w in We?We[w]:We[w]="on"+w}function re(w,z){if(w.da)w=!0;else{z=new he(z,this);var F=w.listener,Z=w.ha||w.src;w.fa&&yt(w),w=F.call(Z,z)}return w}function Y(w){return w=w[st],w instanceof Te?w:null}var Ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ve(w){return typeof w=="function"?w:(w[Ee]||(w[Ee]=function(z){return w.handleEvent(z)}),w[Ee])}function W(){X.call(this),this.i=new Te(this),this.M=this,this.F=null}g(W,X),W.prototype[me]=!0,W.prototype.removeEventListener=function(w,z,F,Z){Ye(this,w,z,F,Z)};function Ge(w,z){var F,Z=w.F;if(Z)for(F=[];Z;Z=Z.F)F.push(Z);if(w=w.M,Z=z.type||z,typeof z=="string")z=new ue(z,w);else if(z instanceof ue)z.target=z.target||w;else{var be=z;z=new ue(Z,w),I(z,be)}if(be=!0,F)for(var Re=F.length-1;0<=Re;Re--){var nt=z.g=F[Re];be=lt(nt,Z,!0,z)&&be}if(nt=z.g=w,be=lt(nt,Z,!0,z)&&be,be=lt(nt,Z,!1,z)&&be,F)for(Re=0;Re<F.length;Re++)nt=z.g=F[Re],be=lt(nt,Z,!1,z)&&be}W.prototype.N=function(){if(W.aa.N.call(this),this.i){var w=this.i,z;for(z in w.g){for(var F=w.g[z],Z=0;Z<F.length;Z++)ye(F[Z]);delete w.g[z],w.h--}}this.F=null},W.prototype.K=function(w,z,F,Z){return this.i.add(String(w),z,!1,F,Z)},W.prototype.L=function(w,z,F,Z){return this.i.add(String(w),z,!0,F,Z)};function lt(w,z,F,Z){if(z=w.i.g[String(z)],!z)return!0;z=z.concat();for(var be=!0,Re=0;Re<z.length;++Re){var nt=z[Re];if(nt&&!nt.da&&nt.capture==F){var Yi=nt.listener,nn=nt.ha||nt.src;nt.fa&&Ie(w.i,nt),be=Yi.call(nn,Z)!==!1&&be}}return be&&!Z.defaultPrevented}function it(w,z,F){if(typeof w=="function")F&&(w=f(w,F));else if(w&&typeof w.handleEvent=="function")w=f(w.handleEvent,w);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:o.setTimeout(w,z||0)}function De(w){w.g=it(()=>{w.g=null,w.i&&(w.i=!1,De(w))},w.l);const z=w.h;w.h=null,w.m.apply(null,z)}class dt extends X{constructor(z,F){super(),this.m=z,this.l=F,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:De(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function at(w){X.call(this),this.h=w,this.g={}}g(at,X);var bt=[];function Dt(w){C(w.g,function(z,F){this.g.hasOwnProperty(F)&&yt(z)},w),w.g={}}at.prototype.N=function(){at.aa.N.call(this),Dt(this)},at.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ct=o.JSON.stringify,Pt=o.JSON.parse,Oi=class{stringify(w){return o.JSON.stringify(w,void 0)}parse(w){return o.JSON.parse(w,void 0)}};function ji(){}ji.prototype.h=null;function pe(w){return w.h||(w.h=w.i())}function Oe(){}var Be={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function et(){ue.call(this,"d")}g(et,ue);function Ot(){ue.call(this,"c")}g(Ot,ue);var ti={},rr=null;function or(){return rr=rr||new W}ti.La="serverreachability";function os(w){ue.call(this,ti.La,w)}g(os,ue);function Ei(w){const z=or();Ge(z,new os(z))}ti.STAT_EVENT="statevent";function Un(w,z){ue.call(this,ti.STAT_EVENT,w),this.stat=z}g(Un,ue);function Ai(w){const z=or();Ge(z,new Un(z,w))}ti.Ma="timingevent";function ca(w,z){ue.call(this,ti.Ma,w),this.size=z}g(ca,ue);function Ts(w,z){if(typeof w!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){w()},z)}function so(){this.g=!0}so.prototype.xa=function(){this.g=!1};function da(w,z,F,Z,be,Re){w.info(function(){if(w.g)if(Re)for(var nt="",Yi=Re.split("&"),nn=0;nn<Yi.length;nn++){var ki=Yi[nn].split("=");if(1<ki.length){var Sn=ki[0];ki=ki[1];var Gr=Sn.split("_");nt=2<=Gr.length&&Gr[1]=="type"?nt+(Sn+"="+ki+"&"):nt+(Sn+"=redacted&")}}else nt=null;else nt=Re;return"XMLHTTP REQ ("+Z+") [attempt "+be+"]: "+z+`
`+F+`
`+nt})}function ee(w,z,F,Z,be,Re,nt){w.info(function(){return"XMLHTTP RESP ("+Z+") [ attempt "+be+"]: "+z+`
`+F+`
`+Re+" "+nt})}function we(w,z,F,Z){w.info(function(){return"XMLHTTP TEXT ("+z+"): "+xe(w,F)+(Z?" "+Z:"")})}function ke(w,z){w.info(function(){return"TIMEOUT: "+z})}so.prototype.info=function(){};function xe(w,z){if(!w.g)return z;if(!z)return null;try{var F=JSON.parse(z);if(F){for(w=0;w<F.length;w++)if(Array.isArray(F[w])){var Z=F[w];if(!(2>Z.length)){var be=Z[1];if(Array.isArray(be)&&!(1>be.length)){var Re=be[0];if(Re!="noop"&&Re!="stop"&&Re!="close")for(var nt=1;nt<be.length;nt++)be[nt]=""}}}}return Ct(F)}catch{return z}}var ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},vt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},It;function Lt(){}g(Lt,ji),Lt.prototype.g=function(){return new XMLHttpRequest},Lt.prototype.i=function(){return{}},It=new Lt;function wt(w,z,F,Z){this.j=w,this.i=z,this.l=F,this.R=Z||1,this.U=new at(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new wi}function wi(){this.i=null,this.g="",this.h=!1}var ni={},ii={};function Xt(w,z,F){w.L=1,w.v=lh(ya(z)),w.m=F,w.P=!0,dr(w,null)}function dr(w,z){w.F=Date.now(),Zt(w),w.A=ya(w.v);var F=w.A,Z=w.R;Array.isArray(Z)||(Z=[String(Z)]),hh(F.i,"t",Z),w.C=0,F=w.j.J,w.h=new wi,w.g=A0(w.j,F?z:null,!w.m),0<w.O&&(w.M=new dt(f(w.Y,w,w.g),w.O)),z=w.U,F=w.g,Z=w.ca;var be="readystatechange";Array.isArray(be)||(be&&(bt[0]=be.toString()),be=bt);for(var Re=0;Re<be.length;Re++){var nt=ct(F,be[Re],Z||z.handleEvent,!1,z.h||z);if(!nt)break;z.g[nt.key]=nt}z=w.H?E(w.H):{},w.m?(w.u||(w.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",w.g.ea(w.A,w.u,w.m,z)):(w.u="GET",w.g.ea(w.A,w.u,null,z)),Ei(),da(w.i,w.u,w.A,w.l,w.R,w.m)}wt.prototype.ca=function(w){w=w.target;const z=this.M;z&&qs(w)==3?z.j():this.Y(w)},wt.prototype.Y=function(w){try{if(w==this.g)e:{const Gr=qs(this.g);var z=this.g.Ba();const Ia=this.g.Z();if(!(3>Gr)&&(Gr!=3||this.g&&(this.h.h||this.g.oa()||ug(this.g)))){this.J||Gr!=4||z==7||(z==8||0>=Ia?Ei(3):Ei(2)),rn(this);var F=this.g.Z();this.X=F;t:if(Vn(this)){var Z=ug(this.g);w="";var be=Z.length,Re=qs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Tr(this),$t(this);var nt="";break t}this.h.i=new o.TextDecoder}for(z=0;z<be;z++)this.h.h=!0,w+=this.h.i.decode(Z[z],{stream:!(Re&&z==be-1)});Z.length=0,this.h.g+=w,this.C=0,nt=this.h.g}else nt=this.g.oa();if(this.o=F==200,ee(this.i,this.u,this.A,this.l,this.R,Gr,F),this.o){if(this.T&&!this.K){t:{if(this.g){var Yi,nn=this.g;if((Yi=nn.g?nn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(Yi)){var ki=Yi;break t}}ki=null}if(F=ki)we(this.i,this.l,F,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,pa(this,F);else{this.o=!1,this.s=3,Ai(12),Tr(this),$t(this);break e}}if(this.P){F=!0;let ba;for(;!this.J&&this.C<nt.length;)if(ba=fa(this,nt),ba==ii){Gr==4&&(this.s=4,Ai(14),F=!1),we(this.i,this.l,null,"[Incomplete Response]");break}else if(ba==ni){this.s=4,Ai(15),we(this.i,this.l,nt,"[Invalid Chunk]"),F=!1;break}else we(this.i,this.l,ba,null),pa(this,ba);if(Vn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Gr!=4||nt.length!=0||this.h.h||(this.s=1,Ai(16),F=!1),this.o=this.o&&F,!F)we(this.i,this.l,nt,"[Invalid Chunked Response]"),Tr(this),$t(this);else if(0<nt.length&&!this.W){this.W=!0;var Sn=this.j;Sn.g==this&&Sn.ba&&!Sn.M&&(Sn.j.info("Great, no buffering proxy detected. Bytes received: "+nt.length),cg(Sn),Sn.M=!0,Ai(11))}}else we(this.i,this.l,nt,null),pa(this,nt);Gr==4&&Tr(this),this.o&&!this.J&&(Gr==4?xf(this.j,this):(this.o=!1,Zt(this)))}else pf(this.g),F==400&&0<nt.indexOf("Unknown SID")?(this.s=3,Ai(12)):(this.s=0,Ai(13)),Tr(this),$t(this)}}}catch{}finally{}};function Vn(w){return w.g?w.u=="GET"&&w.L!=2&&w.j.Ca:!1}function fa(w,z){var F=w.C,Z=z.indexOf(`
`,F);return Z==-1?ii:(F=Number(z.substring(F,Z)),isNaN(F)?ni:(Z+=1,Z+F>z.length?ii:(z=z.slice(Z,Z+F),w.C=Z+F,z)))}wt.prototype.cancel=function(){this.J=!0,Tr(this)};function Zt(w){w.S=Date.now()+w.I,mi(w,w.I)}function mi(w,z){if(w.B!=null)throw Error("WatchDog timer not null");w.B=Ts(f(w.ba,w),z)}function rn(w){w.B&&(o.clearTimeout(w.B),w.B=null)}wt.prototype.ba=function(){this.B=null;const w=Date.now();0<=w-this.S?(ke(this.i,this.A),this.L!=2&&(Ei(),Ai(17)),Tr(this),this.s=2,$t(this)):mi(this,this.S-w)};function $t(w){w.j.G==0||w.J||xf(w.j,w)}function Tr(w){rn(w);var z=w.M;z&&typeof z.ma=="function"&&z.ma(),w.M=null,Dt(w.U),w.g&&(z=w.g,w.g=null,z.abort(),z.ma())}function pa(w,z){try{var F=w.j;if(F.G!=0&&(F.g==w||le(F.h,w))){if(!w.K&&le(F.h,w)&&F.G==3){try{var Z=F.Da.g.parse(z)}catch{Z=null}if(Array.isArray(Z)&&Z.length==3){var be=Z;if(be[0]==0){e:if(!F.u){if(F.g)if(F.g.F+3e3<w.F)yf(F),co(F);else break e;vf(F),Ai(18)}}else F.za=be[1],0<F.za-F.T&&37500>be[2]&&F.F&&F.v==0&&!F.C&&(F.C=Ts(f(F.Za,F),6e3));if(1>=q(F.h)&&F.ca){try{F.ca()}catch{}F.ca=void 0}}else $l(F,11)}else if((w.K||F.g==w)&&yf(F),!S(z))for(be=F.Da.g.parse(z),z=0;z<be.length;z++){let ki=be[z];if(F.T=ki[0],ki=ki[1],F.G==2)if(ki[0]=="c"){F.K=ki[1],F.ia=ki[2];const Sn=ki[3];Sn!=null&&(F.la=Sn,F.j.info("VER="+F.la));const Gr=ki[4];Gr!=null&&(F.Aa=Gr,F.j.info("SVER="+F.Aa));const Ia=ki[5];Ia!=null&&typeof Ia=="number"&&0<Ia&&(Z=1.5*Ia,F.L=Z,F.j.info("backChannelRequestTimeoutMs_="+Z)),Z=F;const ba=w.g;if(ba){const jc=ba.g?ba.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(jc){var Re=Z.h;Re.g||jc.indexOf("spdy")==-1&&jc.indexOf("quic")==-1&&jc.indexOf("h2")==-1||(Re.j=Re.l,Re.g=new Set,Re.h&&(J(Re,Re.h),Re.h=null))}if(Z.D){const wf=ba.g?ba.g.getResponseHeader("X-HTTP-Session-Id"):null;wf&&(Z.ya=wf,nr(Z.I,Z.D,wf))}}F.G=3,F.l&&F.l.ua(),F.ba&&(F.R=Date.now()-w.F,F.j.info("Handshake RTT: "+F.R+"ms")),Z=F;var nt=w;if(Z.qa=E0(Z,Z.J?Z.ia:null,Z.W),nt.K){ve(Z.h,nt);var Yi=nt,nn=Z.L;nn&&(Yi.I=nn),Yi.B&&(rn(Yi),Zt(Yi)),Z.g=nt}else Vc(Z);0<F.i.length&&tl(F)}else ki[0]!="stop"&&ki[0]!="close"||$l(F,7);else F.G==3&&(ki[0]=="stop"||ki[0]=="close"?ki[0]=="stop"?$l(F,7):Hn(F):ki[0]!="noop"&&F.l&&F.l.ta(ki),F.v=0)}}Ei(4)}catch{}}var ma=class{constructor(w,z){this.g=w,this.map=z}};function _n(w){this.l=w||10,o.PerformanceNavigationTiming?(w=o.performance.getEntriesByType("navigation"),w=0<w.length&&(w[0].nextHopProtocol=="hq"||w[0].nextHopProtocol=="h2")):w=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=w?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function j(w){return w.h?!0:w.g?w.g.size>=w.j:!1}function q(w){return w.h?1:w.g?w.g.size:0}function le(w,z){return w.h?w.h==z:w.g?w.g.has(z):!1}function J(w,z){w.g?w.g.add(z):w.h=z}function ve(w,z){w.h&&w.h==z?w.h=null:w.g&&w.g.has(z)&&w.g.delete(z)}_n.prototype.cancel=function(){if(this.i=qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const w of this.g.values())w.cancel();this.g.clear()}};function qe(w){if(w.h!=null)return w.i.concat(w.h.D);if(w.g!=null&&w.g.size!==0){let z=w.i;for(const F of w.g.values())z=z.concat(F.D);return z}return y(w.i)}function ls(w){if(w.V&&typeof w.V=="function")return w.V();if(typeof Map<"u"&&w instanceof Map||typeof Set<"u"&&w instanceof Set)return Array.from(w.values());if(typeof w=="string")return w.split("");if(l(w)){for(var z=[],F=w.length,Z=0;Z<F;Z++)z.push(w[Z]);return z}z=[],F=0;for(Z in w)z[F++]=w[Z];return z}function Zo(w){if(w.na&&typeof w.na=="function")return w.na();if(!w.V||typeof w.V!="function"){if(typeof Map<"u"&&w instanceof Map)return Array.from(w.keys());if(!(typeof Set<"u"&&w instanceof Set)){if(l(w)||typeof w=="string"){var z=[];w=w.length;for(var F=0;F<w;F++)z.push(F);return z}z=[],F=0;for(const Z in w)z[F++]=Z;return z}}}function ga(w,z){if(w.forEach&&typeof w.forEach=="function")w.forEach(z,void 0);else if(l(w)||typeof w=="string")Array.prototype.forEach.call(w,z,void 0);else for(var F=Zo(w),Z=ls(w),be=Z.length,Re=0;Re<be;Re++)z.call(void 0,Z[Re],F&&F[Re],w)}var ao=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sh(w,z){if(w){w=w.split("&");for(var F=0;F<w.length;F++){var Z=w[F].indexOf("="),be=null;if(0<=Z){var Re=w[F].substring(0,Z);be=w[F].substring(Z+1)}else Re=w[F];z(Re,be?decodeURIComponent(be.replace(/\+/g," ")):"")}}}function va(w){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,w instanceof va){this.h=w.h,Bc(this,w.j),this.o=w.o,this.g=w.g,ah(this,w.s),this.l=w.l;var z=w.i,F=new Jo;F.i=z.i,z.g&&(F.g=new Map(z.g),F.h=z.h),oh(this,F),this.m=w.m}else w&&(z=String(w).match(ao))?(this.h=!1,Bc(this,z[1]||"",!0),this.o=Di(z[2]||""),this.g=Di(z[3]||"",!0),ah(this,z[4]),this.l=Di(z[5]||"",!0),oh(this,z[6]||"",!0),this.m=Di(z[7]||"")):(this.h=!1,this.i=new Jo(null,this.h))}va.prototype.toString=function(){var w=[],z=this.j;z&&w.push(uh(z,cf,!0),":");var F=this.g;return(F||z=="file")&&(w.push("//"),(z=this.o)&&w.push(uh(z,cf,!0),"@"),w.push(encodeURIComponent(String(F)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.s,F!=null&&w.push(":",String(F))),(F=this.l)&&(this.g&&F.charAt(0)!="/"&&w.push("/"),w.push(uh(F,F.charAt(0)=="/"?g0:m0,!0))),(F=this.i.toString())&&w.push("?",F),(F=this.m)&&w.push("#",uh(F,ag)),w.join("")};function ya(w){return new va(w)}function Bc(w,z,F){w.j=F?Di(z,!0):z,w.j&&(w.j=w.j.replace(/:$/,""))}function ah(w,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);w.s=z}else w.s=null}function oh(w,z,F){z instanceof Jo?(w.i=z,$o(w.i,w.h)):(F||(z=uh(z,v0)),w.i=new Jo(z,w.h))}function nr(w,z,F){w.i.set(z,F)}function lh(w){return nr(w,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),w}function Di(w,z){return w?z?decodeURI(w.replace(/%25/g,"%2525")):decodeURIComponent(w):""}function uh(w,z,F){return typeof w=="string"?(w=encodeURI(w).replace(z,p0),F&&(w=w.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w):null}function p0(w){return w=w.charCodeAt(0),"%"+(w>>4&15).toString(16)+(w&15).toString(16)}var cf=/[#\/\?@]/g,m0=/[#\?:]/g,g0=/[#\?]/g,v0=/[#\?@]/g,ag=/#/g;function Jo(w,z){this.h=this.g=null,this.i=w||null,this.j=!!z}function jn(w){w.g||(w.g=new Map,w.h=0,w.i&&sh(w.i,function(z,F){w.add(decodeURIComponent(z.replace(/\+/g," ")),F)}))}e=Jo.prototype,e.add=function(w,z){jn(this),this.i=null,w=Da(this,w);var F=this.g.get(w);return F||this.g.set(w,F=[]),F.push(z),this.h+=1,this};function oo(w,z){jn(w),z=Da(w,z),w.g.has(z)&&(w.i=null,w.h-=w.g.get(z).length,w.g.delete(z))}function lo(w,z){return jn(w),z=Da(w,z),w.g.has(z)}e.forEach=function(w,z){jn(this),this.g.forEach(function(F,Z){F.forEach(function(be){w.call(z,be,Z,this)},this)},this)},e.na=function(){jn(this);const w=Array.from(this.g.values()),z=Array.from(this.g.keys()),F=[];for(let Z=0;Z<z.length;Z++){const be=w[Z];for(let Re=0;Re<be.length;Re++)F.push(z[Z])}return F},e.V=function(w){jn(this);let z=[];if(typeof w=="string")lo(this,w)&&(z=z.concat(this.g.get(Da(this,w))));else{w=Array.from(this.g.values());for(let F=0;F<w.length;F++)z=z.concat(w[F])}return z},e.set=function(w,z){return jn(this),this.i=null,w=Da(this,w),lo(this,w)&&(this.h-=this.g.get(w).length),this.g.set(w,[z]),this.h+=1,this},e.get=function(w,z){return w?(w=this.V(w),0<w.length?String(w[0]):z):z};function hh(w,z,F){oo(w,z),0<F.length&&(w.i=null,w.g.set(Da(w,z),y(F)),w.h+=F.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const w=[],z=Array.from(this.g.keys());for(var F=0;F<z.length;F++){var Z=z[F];const Re=encodeURIComponent(String(Z)),nt=this.V(Z);for(Z=0;Z<nt.length;Z++){var be=Re;nt[Z]!==""&&(be+="="+encodeURIComponent(String(nt[Z]))),w.push(be)}}return this.i=w.join("&")};function Da(w,z){return z=String(z),w.j&&(z=z.toLowerCase()),z}function $o(w,z){z&&!w.j&&(jn(w),w.i=null,w.g.forEach(function(F,Z){var be=Z.toLowerCase();Z!=be&&(oo(this,Z),hh(this,be,F))},w)),w.j=z}function uS(w,z){const F=new so;if(o.Image){const Z=new Image;Z.onload=m(Ws,F,"TestLoadImage: loaded",!0,z,Z),Z.onerror=m(Ws,F,"TestLoadImage: error",!1,z,Z),Z.onabort=m(Ws,F,"TestLoadImage: abort",!1,z,Z),Z.ontimeout=m(Ws,F,"TestLoadImage: timeout",!1,z,Z),o.setTimeout(function(){Z.ontimeout&&Z.ontimeout()},1e4),Z.src=w}else z(!1)}function y0(w,z){const F=new so,Z=new AbortController,be=setTimeout(()=>{Z.abort(),Ws(F,"TestPingServer: timeout",!1,z)},1e4);fetch(w,{signal:Z.signal}).then(Re=>{clearTimeout(be),Re.ok?Ws(F,"TestPingServer: ok",!0,z):Ws(F,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(be),Ws(F,"TestPingServer: error",!1,z)})}function Ws(w,z,F,Z,be){try{be&&(be.onload=null,be.onerror=null,be.onabort=null,be.ontimeout=null),Z(F)}catch{}}function hS(){this.g=new Oi}function x0(w,z,F){const Z=F||"";try{ga(w,function(be,Re){let nt=be;u(be)&&(nt=Ct(be)),z.push(Z+Re+"="+encodeURIComponent(nt))})}catch(be){throw z.push(Z+"type="+encodeURIComponent("_badmap")),be}}function Kl(w){this.l=w.Ub||null,this.j=w.eb||!1}g(Kl,ji),Kl.prototype.g=function(){return new Fc(this.l,this.j)},Kl.prototype.i=function(w){return function(){return w}}({});function Fc(w,z){W.call(this),this.D=w,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}g(Fc,W),e=Fc.prototype,e.open=function(w,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=w,this.A=z,this.readyState=1,ho(this)},e.send=function(w){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};w&&(z.body=w),(this.D||o).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,uo(this)),this.readyState=0},e.Sa=function(w){if(this.g&&(this.l=w,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=w.headers,this.readyState=2,ho(this)),this.g&&(this.readyState=3,ho(this),this.g)))if(this.responseType==="arraybuffer")w.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in w){if(this.j=w.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;b0(this)}else w.text().then(this.Ra.bind(this),this.ga.bind(this))};function b0(w){w.j.read().then(w.Pa.bind(w)).catch(w.ga.bind(w))}e.Pa=function(w){if(this.g){if(this.o&&w.value)this.response.push(w.value);else if(!this.o){var z=w.value?w.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!w.done}))&&(this.response=this.responseText+=z)}w.done?uo(this):ho(this),this.readyState==3&&b0(this)}},e.Ra=function(w){this.g&&(this.response=this.responseText=w,uo(this))},e.Qa=function(w){this.g&&(this.response=w,uo(this))},e.ga=function(){this.g&&uo(this)};function uo(w){w.readyState=4,w.l=null,w.j=null,w.v=null,ho(w)}e.setRequestHeader=function(w,z){this.u.append(w,z)},e.getResponseHeader=function(w){return this.h&&this.h.get(w.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const w=[],z=this.h.entries();for(var F=z.next();!F.done;)F=F.value,w.push(F[0]+": "+F[1]),F=z.next();return w.join(`\r
`)};function ho(w){w.onreadystatechange&&w.onreadystatechange.call(w)}Object.defineProperty(Fc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(w){this.m=w?"include":"same-origin"}});function Zl(w){let z="";return C(w,function(F,Z){z+=Z,z+=":",z+=F,z+=`\r
`}),z}function ch(w,z,F){e:{for(Z in F){var Z=!1;break e}Z=!0}Z||(F=Zl(F),typeof w=="string"?F!=null&&encodeURIComponent(String(F)):nr(w,z,F))}function vr(w){W.call(this),this.headers=new Map,this.o=w||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}g(vr,W);var cS=/^https?$/i,og=["POST","PUT"];e=vr.prototype,e.Ha=function(w){this.J=w},e.ea=function(w,z,F,Z){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+w);z=z?z.toUpperCase():"GET",this.D=w,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():It.g(),this.v=this.o?pe(this.o):pe(It),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(z,String(w),!0),this.B=!1}catch(Re){Uc(this,Re);return}if(w=F||"",F=new Map(this.headers),Z)if(Object.getPrototypeOf(Z)===Object.prototype)for(var be in Z)F.set(be,Z[be]);else if(typeof Z.keys=="function"&&typeof Z.get=="function")for(const Re of Z.keys())F.set(Re,Z.get(Re));else throw Error("Unknown input type for opt_headers: "+String(Z));Z=Array.from(F.keys()).find(Re=>Re.toLowerCase()=="content-type"),be=o.FormData&&w instanceof o.FormData,!(0<=Array.prototype.indexOf.call(og,z,void 0))||Z||be||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Re,nt]of F)this.g.setRequestHeader(Re,nt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ff(this),this.u=!0,this.g.send(w),this.u=!1}catch(Re){Uc(this,Re)}};function Uc(w,z){w.h=!1,w.g&&(w.j=!0,w.g.abort(),w.j=!1),w.l=z,w.m=5,df(w),xa(w)}function df(w){w.A||(w.A=!0,Ge(w,"complete"),Ge(w,"error"))}e.abort=function(w){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=w||7,Ge(this,"complete"),Ge(this,"abort"),xa(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xa(this,!0)),vr.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?lg(this):this.bb())},e.bb=function(){lg(this)};function lg(w){if(w.h&&typeof a<"u"&&(!w.v[1]||qs(w)!=4||w.Z()!=2)){if(w.u&&qs(w)==4)it(w.Ea,0,w);else if(Ge(w,"readystatechange"),qs(w)==4){w.h=!1;try{const nt=w.Z();e:switch(nt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var F;if(!(F=z)){var Z;if(Z=nt===0){var be=String(w.D).match(ao)[1]||null;!be&&o.self&&o.self.location&&(be=o.self.location.protocol.slice(0,-1)),Z=!cS.test(be?be.toLowerCase():"")}F=Z}if(F)Ge(w,"complete"),Ge(w,"success");else{w.m=6;try{var Re=2<qs(w)?w.g.statusText:""}catch{Re=""}w.l=Re+" ["+w.Z()+"]",df(w)}}finally{xa(w)}}}}function xa(w,z){if(w.g){ff(w);const F=w.g,Z=w.v[0]?()=>{}:null;w.g=null,w.v=null,z||Ge(w,"ready");try{F.onreadystatechange=Z}catch{}}}function ff(w){w.I&&(o.clearTimeout(w.I),w.I=null)}e.isActive=function(){return!!this.g};function qs(w){return w.g?w.g.readyState:0}e.Z=function(){try{return 2<qs(this)?this.g.status:-1}catch{return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},e.Oa=function(w){if(this.g){var z=this.g.responseText;return w&&z.indexOf(w)==0&&(z=z.substring(w.length)),Pt(z)}};function ug(w){try{if(!w.g)return null;if("response"in w.g)return w.g.response;switch(w.H){case"":case"text":return w.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in w.g)return w.g.mozResponseArrayBuffer}return null}catch{return null}}function pf(w){const z={};w=(w.g&&2<=qs(w)&&w.g.getAllResponseHeaders()||"").split(`\r
`);for(let Z=0;Z<w.length;Z++){if(S(w[Z]))continue;var F=O(w[Z]);const be=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const Re=z[be]||[];z[be]=Re,Re.push(F)}P(z,function(Z){return Z.join(", ")})}e.Ba=function(){return this.m},e.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function el(w,z,F){return F&&F.internalChannelParams&&F.internalChannelParams[w]||z}function hg(w){this.Aa=0,this.i=[],this.j=new so,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=el("failFast",!1,w),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=el("baseRetryDelayMs",5e3,w),this.cb=el("retryDelaySeedMs",1e4,w),this.Wa=el("forwardChannelMaxRetries",2,w),this.wa=el("forwardChannelRequestTimeoutMs",2e4,w),this.pa=w&&w.xmlHttpFactory||void 0,this.Xa=w&&w.Tb||void 0,this.Ca=w&&w.useFetchStreams||!1,this.L=void 0,this.J=w&&w.supportsCrossDomainXhr||!1,this.K="",this.h=new _n(w&&w.concurrentRequestLimit),this.Da=new hS,this.P=w&&w.fastHandshake||!1,this.O=w&&w.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=w&&w.Rb||!1,w&&w.xa&&this.j.xa(),w&&w.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&w&&w.detectBufferingProxy||!1,this.ja=void 0,w&&w.longPollingTimeout&&0<w.longPollingTimeout&&(this.ja=w.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}e=hg.prototype,e.la=8,e.G=1,e.connect=function(w,z,F,Z){Ai(0),this.W=w,this.H=z||{},F&&Z!==void 0&&(this.H.OSID=F,this.H.OAID=Z),this.F=this.X,this.I=E0(this,null,this.W),tl(this)};function Hn(w){if(mf(w),w.G==3){var z=w.U++,F=ya(w.I);if(nr(F,"SID",w.K),nr(F,"RID",z),nr(F,"TYPE","terminate"),Jl(w,F),z=new wt(w,w.j,z),z.L=2,z.v=lh(ya(F)),F=!1,o.navigator&&o.navigator.sendBeacon)try{F=o.navigator.sendBeacon(z.v.toString(),"")}catch{}!F&&o.Image&&(new Image().src=z.v,F=!0),F||(z.g=A0(z.j,null),z.g.ea(z.v)),z.F=Date.now(),Zt(z)}S0(w)}function co(w){w.g&&(cg(w),w.g.cancel(),w.g=null)}function mf(w){co(w),w.u&&(o.clearTimeout(w.u),w.u=null),yf(w),w.h.cancel(),w.s&&(typeof w.s=="number"&&o.clearTimeout(w.s),w.s=null)}function tl(w){if(!j(w.h)&&!w.s){w.s=!0;var z=w.Ga;K||$(),H||(K(),H=!0),ie.add(z,w),w.B=0}}function dS(w,z){return q(w.h)>=w.h.j-(w.s?1:0)?!1:w.s?(w.i=z.D.concat(w.i),!0):w.G==1||w.G==2||w.B>=(w.Va?0:w.Wa)?!1:(w.s=Ts(f(w.Ga,w,z),_0(w,w.B)),w.B++,!0)}e.Ga=function(w){if(this.s)if(this.s=null,this.G==1){if(!w){this.U=Math.floor(1e5*Math.random()),w=this.U++;const be=new wt(this,this.j,w);let Re=this.o;if(this.S&&(Re?(Re=E(Re),I(Re,this.S)):Re=this.S),this.m!==null||this.O||(be.H=Re,Re=null),this.P)e:{for(var z=0,F=0;F<this.i.length;F++){t:{var Z=this.i[F];if("__data__"in Z.map&&(Z=Z.map.__data__,typeof Z=="string")){Z=Z.length;break t}Z=void 0}if(Z===void 0)break;if(z+=Z,4096<z){z=F;break e}if(z===4096||F===this.i.length-1){z=F+1;break e}}z=1e3}else z=1e3;z=dh(this,be,z),F=ya(this.I),nr(F,"RID",w),nr(F,"CVER",22),this.D&&nr(F,"X-HTTP-Session-Id",this.D),Jl(this,F),Re&&(this.O?z="headers="+encodeURIComponent(String(Zl(Re)))+"&"+z:this.m&&ch(F,this.m,Re)),J(this.h,be),this.Ua&&nr(F,"TYPE","init"),this.P?(nr(F,"$req",z),nr(F,"SID","null"),be.T=!0,Xt(be,F,null)):Xt(be,F,z),this.G=2}}else this.G==3&&(w?gf(this,w):this.i.length==0||j(this.h)||gf(this))};function gf(w,z){var F;z?F=z.l:F=w.U++;const Z=ya(w.I);nr(Z,"SID",w.K),nr(Z,"RID",F),nr(Z,"AID",w.T),Jl(w,Z),w.m&&w.o&&ch(Z,w.m,w.o),F=new wt(w,w.j,F,w.B+1),w.m===null&&(F.H=w.o),z&&(w.i=z.D.concat(w.i)),z=dh(w,F,1e3),F.I=Math.round(.5*w.wa)+Math.round(.5*w.wa*Math.random()),J(w.h,F),Xt(F,Z,z)}function Jl(w,z){w.H&&C(w.H,function(F,Z){nr(z,Z,F)}),w.l&&ga({},function(F,Z){nr(z,Z,F)})}function dh(w,z,F){F=Math.min(w.i.length,F);var Z=w.l?f(w.l.Na,w.l,w):null;e:{var be=w.i;let Re=-1;for(;;){const nt=["count="+F];Re==-1?0<F?(Re=be[0].g,nt.push("ofs="+Re)):Re=0:nt.push("ofs="+Re);let Yi=!0;for(let nn=0;nn<F;nn++){let ki=be[nn].g;const Sn=be[nn].map;if(ki-=Re,0>ki)Re=Math.max(0,be[nn].g-100),Yi=!1;else try{x0(Sn,nt,"req"+ki+"_")}catch{Z&&Z(Sn)}}if(Yi){Z=nt.join("&");break e}}}return w=w.i.splice(0,F),z.D=w,Z}function Vc(w){if(!w.g&&!w.u){w.Y=1;var z=w.Fa;K||$(),H||(K(),H=!0),ie.add(z,w),w.v=0}}function vf(w){return w.g||w.u||3<=w.v?!1:(w.Y++,w.u=Ts(f(w.Fa,w),_0(w,w.v)),w.v++,!0)}e.Fa=function(){if(this.u=null,w0(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var w=2*this.R;this.j.info("BP detection timer enabled: "+w),this.A=Ts(f(this.ab,this),w)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ai(10),co(this),w0(this))};function cg(w){w.A!=null&&(o.clearTimeout(w.A),w.A=null)}function w0(w){w.g=new wt(w,w.j,"rpc",w.Y),w.m===null&&(w.g.H=w.o),w.g.O=0;var z=ya(w.qa);nr(z,"RID","rpc"),nr(z,"SID",w.K),nr(z,"AID",w.T),nr(z,"CI",w.F?"0":"1"),!w.F&&w.ja&&nr(z,"TO",w.ja),nr(z,"TYPE","xmlhttp"),Jl(w,z),w.m&&w.o&&ch(z,w.m,w.o),w.L&&(w.g.I=w.L);var F=w.g;w=w.ia,F.L=1,F.v=lh(ya(z)),F.m=null,F.P=!0,dr(F,w)}e.Za=function(){this.C!=null&&(this.C=null,co(this),vf(this),Ai(19))};function yf(w){w.C!=null&&(o.clearTimeout(w.C),w.C=null)}function xf(w,z){var F=null;if(w.g==z){yf(w),cg(w),w.g=null;var Z=2}else if(le(w.h,z))F=z.D,ve(w.h,z),Z=1;else return;if(w.G!=0){if(z.o)if(Z==1){F=z.m?z.m.length:0,z=Date.now()-z.F;var be=w.B;Z=or(),Ge(Z,new ca(Z,F)),tl(w)}else Vc(w);else if(be=z.s,be==3||be==0&&0<z.X||!(Z==1&&dS(w,z)||Z==2&&vf(w)))switch(F&&0<F.length&&(z=w.h,z.i=z.i.concat(F)),be){case 1:$l(w,5);break;case 4:$l(w,10);break;case 3:$l(w,6);break;default:$l(w,2)}}}function _0(w,z){let F=w.Ta+Math.floor(Math.random()*w.cb);return w.isActive()||(F*=2),F*z}function $l(w,z){if(w.j.info("Error code "+z),z==2){var F=f(w.fb,w),Z=w.Xa;const be=!Z;Z=new va(Z||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Bc(Z,"https"),lh(Z),be?uS(Z.toString(),F):y0(Z.toString(),F)}else Ai(2);w.G=0,w.l&&w.l.sa(z),S0(w),mf(w)}e.fb=function(w){w?(this.j.info("Successfully pinged google.com"),Ai(2)):(this.j.info("Failed to ping google.com"),Ai(1))};function S0(w){if(w.G=0,w.ka=[],w.l){const z=qe(w.h);(z.length!=0||w.i.length!=0)&&(v(w.ka,z),v(w.ka,w.i),w.h.i.length=0,y(w.i),w.i.length=0),w.l.ra()}}function E0(w,z,F){var Z=F instanceof va?ya(F):new va(F);if(Z.g!="")z&&(Z.g=z+"."+Z.g),ah(Z,Z.s);else{var be=o.location;Z=be.protocol,z=z?z+"."+be.hostname:be.hostname,be=+be.port;var Re=new va(null);Z&&Bc(Re,Z),z&&(Re.g=z),be&&ah(Re,be),F&&(Re.l=F),Z=Re}return F=w.D,z=w.ya,F&&z&&nr(Z,F,z),nr(Z,"VER",w.la),Jl(w,Z),Z}function A0(w,z,F){if(z&&!w.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=w.Ca&&!w.pa?new vr(new Kl({eb:F})):new vr(w.pa),z.Ha(w.J),z}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function dg(){}e=dg.prototype,e.ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){};function bf(){}bf.prototype.g=function(w,z){return new Ps(w,z)};function Ps(w,z){W.call(this),this.g=new hg(z),this.l=w,this.h=z&&z.messageUrlParams||null,w=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(w?w["X-Client-Protocol"]="webchannel":w={"X-Client-Protocol":"webchannel"}),this.g.o=w,w=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(w?w["X-WebChannel-Content-Type"]=z.messageContentType:w={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(w?w["X-WebChannel-Client-Profile"]=z.va:w={"X-WebChannel-Client-Profile":z.va}),this.g.S=w,(w=z&&z.Sb)&&!S(w)&&(this.g.m=w),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!S(z)&&(this.g.D=z,w=this.h,w!==null&&z in w&&(w=this.h,z in w&&delete w[z])),this.j=new il(this)}g(Ps,W),Ps.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ps.prototype.close=function(){Hn(this.g)},Ps.prototype.o=function(w){var z=this.g;if(typeof w=="string"){var F={};F.__data__=w,w=F}else this.u&&(F={},F.__data__=Ct(w),w=F);z.i.push(new ma(z.Ya++,w)),z.G==3&&tl(z)},Ps.prototype.N=function(){this.g.l=null,delete this.j,Hn(this.g),delete this.g,Ps.aa.N.call(this)};function C0(w){et.call(this),w.__headers__&&(this.headers=w.__headers__,this.statusCode=w.__status__,delete w.__headers__,delete w.__status__);var z=w.__sm__;if(z){e:{for(const F in z){w=F;break e}w=void 0}(this.i=w)&&(w=this.i,z=z!==null&&w in z?z[w]:void 0),this.data=z}else this.data=w}g(C0,et);function T0(){Ot.call(this),this.status=1}g(T0,Ot);function il(w){this.g=w}g(il,dg),il.prototype.ua=function(){Ge(this.g,"a")},il.prototype.ta=function(w){Ge(this.g,new C0(w))},il.prototype.sa=function(w){Ge(this.g,new T0)},il.prototype.ra=function(){Ge(this.g,"b")},bf.prototype.createWebChannel=bf.prototype.g,Ps.prototype.send=Ps.prototype.o,Ps.prototype.open=Ps.prototype.m,Ps.prototype.close=Ps.prototype.close,eG=function(){return new bf},$H=function(){return or()},JH=ti,mP={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ze.NO_ERROR=0,ze.TIMEOUT=8,ze.HTTP_ERROR=6,Pb=ze,vt.COMPLETE="complete",ZH=vt,Oe.EventType=Be,Be.OPEN="a",Be.CLOSE="b",Be.ERROR="c",Be.MESSAGE="d",W.prototype.listen=W.prototype.K,Dv=Oe,vr.prototype.listenOnce=vr.prototype.L,vr.prototype.getLastError=vr.prototype.Ka,vr.prototype.getLastErrorCode=vr.prototype.Ba,vr.prototype.getStatus=vr.prototype.Z,vr.prototype.getResponseJson=vr.prototype.Oa,vr.prototype.getResponseText=vr.prototype.oa,vr.prototype.send=vr.prototype.ea,vr.prototype.setWithCredentials=vr.prototype.Ha,KH=vr}).apply(typeof qx<"u"?qx:typeof self<"u"?self:typeof window<"u"?window:{});const C4="@firebase/firestore",T4="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}gs.UNAUTHENTICATED=new gs(null),gs.GOOGLE_CREDENTIALS=new gs("google-credentials-uid"),gs.FIRST_PARTY=new gs("first-party-uid"),gs.MOCK_USER=new gs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qm="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd=new _D("@firebase/firestore");function Ip(){return Jd.logLevel}function xt(e,...t){if(Jd.logLevel<=Ci.DEBUG){const i=t.map(kD);Jd.debug(`Firestore (${Qm}): ${e}`,...i)}}function Ju(e,...t){if(Jd.logLevel<=Ci.ERROR){const i=t.map(kD);Jd.error(`Firestore (${Qm}): ${e}`,...i)}}function Sm(e,...t){if(Jd.logLevel<=Ci.WARN){const i=t.map(kD);Jd.warn(`Firestore (${Qm}): ${e}`,...i)}}function kD(e){if(typeof e=="string")return e;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(e)}catch{return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(e="Unexpected state"){const t=`FIRESTORE (${Qm}) INTERNAL ASSERTION FAILED: `+e;throw Ju(t),new Error(t)}function Xi(e,t){e||ai()}function pi(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qt extends ih{constructor(t,i){super(t,i),this.code=t,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tG{constructor(t,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class X_e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,i){t.enqueueRetryable(()=>i(gs.UNAUTHENTICATED))}shutdown(){}}class Y_e{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,i){this.changeListener=i,t.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class Q_e{constructor(t){this.t=t,this.currentUser=gs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,i){Xi(this.o===void 0);let r=this.i;const n=l=>this.i!==r?(r=this.i,i(l)):Promise.resolve();let s=new wc;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new wc,t.enqueueRetryable(()=>n(this.currentUser))};const a=()=>{const l=s;t.enqueueRetryable(async()=>{await l.promise,await n(this.currentUser)})},o=l=>{xt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(xt("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new wc)}},0),a()}getToken(){const t=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(r=>this.i!==t?(xt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Xi(typeof r.accessToken=="string"),new tG(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Xi(t===null||typeof t=="string"),new gs(t)}}class K_e{constructor(t,i,r){this.l=t,this.h=i,this.P=r,this.type="FirstParty",this.user=gs.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Z_e{constructor(t,i,r){this.l=t,this.h=i,this.P=r}getToken(){return Promise.resolve(new K_e(this.l,this.h,this.P))}start(t,i){t.enqueueRetryable(()=>i(gs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class P4{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class J_e{constructor(t,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ka(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,i){Xi(this.o===void 0);const r=s=>{s.error!=null&&xt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,xt("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?i(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};const n=s=>{xt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>n(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?n(s):xt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new P4(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(i=>i?(Xi(typeof i.token=="string"),this.R=i.token,new P4(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $_e(e){const t=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(i);else for(let r=0;r<e;r++)i[r]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iG(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rG{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const n=$_e(40);for(let s=0;s<n.length;++s)r.length<20&&n[s]<i&&(r+=t.charAt(n[s]%62))}return r}}function yi(e,t){return e<t?-1:e>t?1:0}function gP(e,t){let i=0;for(;i<e.length&&i<t.length;){const r=e.codePointAt(i),n=t.codePointAt(i);if(r!==n){if(r<128&&n<128)return yi(r,n);{const s=iG(),a=eSe(s.encode(M4(e,i)),s.encode(M4(t,i)));return a!==0?a:yi(r,n)}}i+=r>65535?2:1}return yi(e.length,t.length)}function M4(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function eSe(e,t){for(let i=0;i<e.length&&i<t.length;++i)if(e[i]!==t[i])return yi(e[i],t[i]);return yi(e.length,t.length)}function Em(e,t,i){return e.length===t.length&&e.every((r,n)=>i(r,t[n]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4=-62135596800,I4=1e6;class gn{static now(){return gn.fromMillis(Date.now())}static fromDate(t){return gn.fromMillis(t.getTime())}static fromMillis(t){const i=Math.floor(t/1e3),r=Math.floor((t-1e3*i)*I4);return new gn(i,r)}constructor(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new Qt(Je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Qt(Je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<D4)throw new Qt(Je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qt(Je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/I4}_compareTo(t){return this.seconds===t.seconds?yi(this.nanoseconds,t.nanoseconds):yi(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-D4;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{static fromTimestamp(t){return new ci(t)}static min(){return new ci(new gn(0,0))}static max(){return new ci(new gn(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R4="__name__";class Sl{constructor(t,i,r){i===void 0?i=0:i>t.length&&ai(),r===void 0?r=t.length-i:r>t.length-i&&ai(),this.segments=t,this.offset=i,this.len=r}get length(){return this.len}isEqual(t){return Sl.comparator(this,t)===0}child(t){const i=this.segments.slice(this.offset,this.limit());return t instanceof Sl?t.forEach(r=>{i.push(r)}):i.push(t),this.construct(i)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}forEach(t){for(let i=this.offset,r=this.limit();i<r;i++)t(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,i){const r=Math.min(t.length,i.length);for(let n=0;n<r;n++){const s=Sl.compareSegments(t.get(n),i.get(n));if(s!==0)return s}return yi(t.length,i.length)}static compareSegments(t,i){const r=Sl.isNumericId(t),n=Sl.isNumericId(i);return r&&!n?-1:!r&&n?1:r&&n?Sl.extractNumericId(t).compare(Sl.extractNumericId(i)):gP(t,i)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return bc.fromString(t.substring(4,t.length-2))}}class Rr extends Sl{construct(t,i,r){return new Rr(t,i,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const i=[];for(const r of t){if(r.indexOf("//")>=0)throw new Qt(Je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);i.push(...r.split("/").filter(n=>n.length>0))}return new Rr(i)}static emptyPath(){return new Rr([])}}const tSe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class es extends Sl{construct(t,i,r){return new es(t,i,r)}static isValidIdentifier(t){return tSe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),es.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===R4}static keyField(){return new es([R4])}static fromServerFormat(t){const i=[];let r="",n=0;const s=()=>{if(r.length===0)throw new Qt(Je.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(r),r=""};let a=!1;for(;n<t.length;){const o=t[n];if(o==="\\"){if(n+1===t.length)throw new Qt(Je.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[n+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Qt(Je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=l,n+=2}else o==="`"?(a=!a,n++):o!=="."||a?(r+=o,n++):(s(),n++)}if(s(),a)throw new Qt(Je.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new es(i)}static emptyPath(){return new es([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(t){this.path=t}static fromPath(t){return new Kt(Rr.fromString(t))}static fromName(t){return new Kt(Rr.fromString(t).popFirst(5))}static empty(){return new Kt(Rr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Rr.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,i){return Rr.comparator(t.path,i.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Kt(new Rr(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty=-1;function iSe(e,t){const i=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,n=ci.fromTimestamp(r===1e9?new gn(i+1,0):new gn(i,r));return new Cc(n,Kt.empty(),t)}function rSe(e){return new Cc(e.readTime,e.key,Ty)}class Cc{constructor(t,i,r){this.readTime=t,this.documentKey=i,this.largestBatchId=r}static min(){return new Cc(ci.min(),Kt.empty(),Ty)}static max(){return new Cc(ci.max(),Kt.empty(),Ty)}}function nSe(e,t){let i=e.readTime.compareTo(t.readTime);return i!==0?i:(i=Kt.comparator(e.documentKey,t.documentKey),i!==0?i:yi(e.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sSe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class aSe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Km(e){if(e.code!==Je.FAILED_PRECONDITION||e.message!==sSe)throw e;xt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(t){return this.next(void 0,t)}next(t,i){return this.callbackAttached&&ai(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new He((r,n)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,n)},this.catchCallback=s=>{this.wrapFailure(i,s).next(r,n)}})}toPromise(){return new Promise((t,i)=>{this.next(t,i)})}wrapUserFunction(t){try{const i=t();return i instanceof He?i:He.resolve(i)}catch(i){return He.reject(i)}}wrapSuccess(t,i){return t?this.wrapUserFunction(()=>t(i)):He.resolve(i)}wrapFailure(t,i){return t?this.wrapUserFunction(()=>t(i)):He.reject(i)}static resolve(t){return new He((i,r)=>{i(t)})}static reject(t){return new He((i,r)=>{r(t)})}static waitFor(t){return new He((i,r)=>{let n=0,s=0,a=!1;t.forEach(o=>{++n,o.next(()=>{++s,a&&s===n&&i()},l=>r(l))}),a=!0,s===n&&i()})}static or(t){let i=He.resolve(!1);for(const r of t)i=i.next(n=>n?He.resolve(n):r());return i}static forEach(t,i){const r=[];return t.forEach((n,s)=>{r.push(i.call(this,n,s))}),this.waitFor(r)}static mapArray(t,i){return new He((r,n)=>{const s=t.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const u=l;i(t[u]).next(h=>{a[u]=h,++o,o===s&&r(a)},h=>n(h))}})}static doWhile(t,i){return new He((r,n)=>{const s=()=>{t()===!0?i().next(()=>{s()},n):r()};s()})}}function oSe(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function Zm(e){return e.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.oe(r),this._e=r=>i.writeSequenceNumber(r))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}G_.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LD=-1;function W_(e){return e==null}function Qw(e){return e===0&&1/e==-1/0}function lSe(e){return typeof e=="number"&&Number.isInteger(e)&&!Qw(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nG="";function uSe(e){let t="";for(let i=0;i<e.length;i++)t.length>0&&(t=O4(t)),t=hSe(e.get(i),t);return O4(t)}function hSe(e,t){let i=t;const r=e.length;for(let n=0;n<r;n++){const s=e.charAt(n);switch(s){case"\0":i+="";break;case nG:i+="";break;default:i+=s}}return i}function O4(e){return e+nG+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k4(e){let t=0;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t}function of(e,t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t(i,e[i])}function sG(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(t,i){this.comparator=t,this.root=i||Zn.EMPTY}insert(t,i){return new Cr(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,Zn.BLACK,null,null))}remove(t){return new Cr(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Zn.BLACK,null,null))}get(t){let i=this.root;for(;!i.isEmpty();){const r=this.comparator(t,i.key);if(r===0)return i.value;r<0?i=i.left:r>0&&(i=i.right)}return null}indexOf(t){let i=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(t,r.key);if(n===0)return i+r.left.size;n<0?r=r.left:(i+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((i,r)=>(t(i,r),!1))}toString(){const t=[];return this.inorderTraversal((i,r)=>(t.push(`${i}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Xx(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Xx(this.root,t,this.comparator,!1)}getReverseIterator(){return new Xx(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Xx(this.root,t,this.comparator,!0)}}class Xx{constructor(t,i,r,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=i?r(t.key,i):1,i&&n&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Zn{constructor(t,i,r,n,s){this.key=t,this.value=i,this.color=r??Zn.RED,this.left=n??Zn.EMPTY,this.right=s??Zn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,r,n,s){return new Zn(t??this.key,i??this.value,r??this.color,n??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let n=this;const s=r(t,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(t,i,r),null):s===0?n.copy(null,i,null,null,null):n.copy(null,null,null,null,n.right.insert(t,i,r)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Zn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let r,n=this;if(i(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,i),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),i(t,n.key)===0){if(n.right.isEmpty())return Zn.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,i))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Zn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Zn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ai();const t=this.left.check();if(t!==this.right.check())throw ai();return t+(this.isRed()?0:1)}}Zn.EMPTY=null,Zn.RED=!0,Zn.BLACK=!1;Zn.EMPTY=new class{constructor(){this.size=0}get key(){throw ai()}get value(){throw ai()}get color(){throw ai()}get left(){throw ai()}get right(){throw ai()}copy(t,i,r,n,s){return this}insert(t,i,r){return new Zn(t,i)}remove(t,i){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(t){this.comparator=t,this.data=new Cr(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((i,r)=>(t(i),!1))}forEachInRange(t,i){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,t[1])>=0)return;i(n.key)}}forEachWhile(t,i){let r;for(r=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null}getIterator(){return new L4(this.data.getIterator())}getIteratorFrom(t){return new L4(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let i=this;return i.size<t.size&&(i=t,t=this),t.forEach(r=>{i=i.add(r)}),i}isEqual(t){if(!(t instanceof vn)||this.size!==t.size)return!1;const i=this.data.getIterator(),r=t.data.getIterator();for(;i.hasNext();){const n=i.getNext().key,s=r.getNext().key;if(this.comparator(n,s)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(i=>{t.push(i)}),t}toString(){const t=[];return this.forEach(i=>t.push(i)),"SortedSet("+t.toString()+")"}copy(t){const i=new vn(this.comparator);return i.data=t,i}}class L4{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(t){this.fields=t,t.sort(es.comparator)}static empty(){return new No([])}unionWith(t){let i=new vn(es.comparator);for(const r of this.fields)i=i.add(r);for(const r of t)i=i.add(r);return new No(i.toArray())}covers(t){for(const i of this.fields)if(i.isPrefixOf(t))return!0;return!1}isEqual(t){return Em(this.fields,t.fields,(i,r)=>i.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(t){this.binaryString=t}static fromBase64String(t){const i=function(n){try{return atob(n)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new aG("Invalid base64 string: "+s):s}}(t);return new ss(i)}static fromUint8Array(t){const i=function(n){let s="";for(let a=0;a<n.length;++a)s+=String.fromCharCode(n[a]);return s}(t);return new ss(i)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return yi(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ss.EMPTY_BYTE_STRING=new ss("");const cSe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tc(e){if(Xi(!!e),typeof e=="string"){let t=0;const i=cSe.exec(e);if(Xi(!!i),i[1]){let n=i[1];n=(n+"000000000").substr(0,9),t=Number(n)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Fr(e.seconds),nanos:Fr(e.nanos)}}function Fr(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Pc(e){return typeof e=="string"?ss.fromBase64String(e):ss.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oG="server_timestamp",lG="__type__",uG="__previous_value__",hG="__local_write_time__";function zD(e){var t,i;return((i=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{})[lG])===null||i===void 0?void 0:i.stringValue)===oG}function q_(e){const t=e.mapValue.fields[uG];return zD(t)?q_(t):t}function Py(e){const t=Tc(e.mapValue.fields[hG].timestampValue);return new gn(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dSe{constructor(t,i,r,n,s,a,o,l,u){this.databaseId=t,this.appId=i,this.persistenceKey=r,this.host=n,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u}}const Kw="(default)";class My{constructor(t,i){this.projectId=t,this.database=i||Kw}static empty(){return new My("","")}get isDefaultDatabase(){return this.database===Kw}isEqual(t){return t instanceof My&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cG="__type__",dG="__max__",Yx={mapValue:{fields:{__type__:{stringValue:dG}}}},fG="__vector__",Zw="value";function Mc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?zD(e)?4:pSe(e)?9007199254740991:fSe(e)?10:11:ai()}function Wl(e,t){if(e===t)return!0;const i=Mc(e);if(i!==Mc(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Py(e).isEqual(Py(t));case 3:return function(n,s){if(typeof n.timestampValue=="string"&&typeof s.timestampValue=="string"&&n.timestampValue.length===s.timestampValue.length)return n.timestampValue===s.timestampValue;const a=Tc(n.timestampValue),o=Tc(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(n,s){return Pc(n.bytesValue).isEqual(Pc(s.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(n,s){return Fr(n.geoPointValue.latitude)===Fr(s.geoPointValue.latitude)&&Fr(n.geoPointValue.longitude)===Fr(s.geoPointValue.longitude)}(e,t);case 2:return function(n,s){if("integerValue"in n&&"integerValue"in s)return Fr(n.integerValue)===Fr(s.integerValue);if("doubleValue"in n&&"doubleValue"in s){const a=Fr(n.doubleValue),o=Fr(s.doubleValue);return a===o?Qw(a)===Qw(o):isNaN(a)&&isNaN(o)}return!1}(e,t);case 9:return Em(e.arrayValue.values||[],t.arrayValue.values||[],Wl);case 10:case 11:return function(n,s){const a=n.mapValue.fields||{},o=s.mapValue.fields||{};if(k4(a)!==k4(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Wl(a[l],o[l])))return!1;return!0}(e,t);default:return ai()}}function Dy(e,t){return(e.values||[]).find(i=>Wl(i,t))!==void 0}function Am(e,t){if(e===t)return 0;const i=Mc(e),r=Mc(t);if(i!==r)return yi(i,r);switch(i){case 0:case 9007199254740991:return 0;case 1:return yi(e.booleanValue,t.booleanValue);case 2:return function(s,a){const o=Fr(s.integerValue||s.doubleValue),l=Fr(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(e,t);case 3:return z4(e.timestampValue,t.timestampValue);case 4:return z4(Py(e),Py(t));case 5:return gP(e.stringValue,t.stringValue);case 6:return function(s,a){const o=Pc(s),l=Pc(a);return o.compareTo(l)}(e.bytesValue,t.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const h=yi(o[u],l[u]);if(h!==0)return h}return yi(o.length,l.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,a){const o=yi(Fr(s.latitude),Fr(a.latitude));return o!==0?o:yi(Fr(s.longitude),Fr(a.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return N4(e.arrayValue,t.arrayValue);case 10:return function(s,a){var o,l,u,h;const c=s.fields||{},f=a.fields||{},m=(o=c[Zw])===null||o===void 0?void 0:o.arrayValue,g=(l=f[Zw])===null||l===void 0?void 0:l.arrayValue,y=yi(((u=m==null?void 0:m.values)===null||u===void 0?void 0:u.length)||0,((h=g==null?void 0:g.values)===null||h===void 0?void 0:h.length)||0);return y!==0?y:N4(m,g)}(e.mapValue,t.mapValue);case 11:return function(s,a){if(s===Yx.mapValue&&a===Yx.mapValue)return 0;if(s===Yx.mapValue)return 1;if(a===Yx.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),u=a.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let c=0;c<l.length&&c<h.length;++c){const f=gP(l[c],h[c]);if(f!==0)return f;const m=Am(o[l[c]],u[h[c]]);if(m!==0)return m}return yi(l.length,h.length)}(e.mapValue,t.mapValue);default:throw ai()}}function z4(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return yi(e,t);const i=Tc(e),r=Tc(t),n=yi(i.seconds,r.seconds);return n!==0?n:yi(i.nanos,r.nanos)}function N4(e,t){const i=e.values||[],r=t.values||[];for(let n=0;n<i.length&&n<r.length;++n){const s=Am(i[n],r[n]);if(s)return s}return yi(i.length,r.length)}function Cm(e){return vP(e)}function vP(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(i){const r=Tc(i);return`time(${r.seconds},${r.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(i){return Pc(i).toBase64()}(e.bytesValue):"referenceValue"in e?function(i){return Kt.fromName(i).toString()}(e.referenceValue):"geoPointValue"in e?function(i){return`geo(${i.latitude},${i.longitude})`}(e.geoPointValue):"arrayValue"in e?function(i){let r="[",n=!0;for(const s of i.values||[])n?n=!1:r+=",",r+=vP(s);return r+"]"}(e.arrayValue):"mapValue"in e?function(i){const r=Object.keys(i.fields||{}).sort();let n="{",s=!0;for(const a of r)s?s=!1:n+=",",n+=`${a}:${vP(i.fields[a])}`;return n+"}"}(e.mapValue):ai()}function Mb(e){switch(Mc(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=q_(e);return t?16+Mb(t):16;case 5:return 2*e.stringValue.length;case 6:return Pc(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((n,s)=>n+Mb(s),0)}(e.arrayValue);case 10:case 11:return function(r){let n=0;return of(r.fields,(s,a)=>{n+=s.length+Mb(a)}),n}(e.mapValue);default:throw ai()}}function yP(e){return!!e&&"integerValue"in e}function ND(e){return!!e&&"arrayValue"in e}function B4(e){return!!e&&"nullValue"in e}function F4(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Db(e){return!!e&&"mapValue"in e}function fSe(e){var t,i;return((i=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{})[cG])===null||i===void 0?void 0:i.stringValue)===fG}function Zv(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return of(e.mapValue.fields,(i,r)=>t.mapValue.fields[i]=Zv(r)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let i=0;i<(e.arrayValue.values||[]).length;++i)t.arrayValue.values[i]=Zv(e.arrayValue.values[i]);return t}return Object.assign({},e)}function pSe(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===dG}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(t){this.value=t}static empty(){return new Za({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let i=this.value;for(let r=0;r<t.length-1;++r)if(i=(i.mapValue.fields||{})[t.get(r)],!Db(i))return null;return i=(i.mapValue.fields||{})[t.lastSegment()],i||null}}set(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=Zv(i)}setAll(t){let i=es.emptyPath(),r={},n=[];t.forEach((a,o)=>{if(!i.isImmediateParentOf(o)){const l=this.getFieldsMap(i);this.applyChanges(l,r,n),r={},n=[],i=o.popLast()}a?r[o.lastSegment()]=Zv(a):n.push(o.lastSegment())});const s=this.getFieldsMap(i);this.applyChanges(s,r,n)}delete(t){const i=this.field(t.popLast());Db(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]}isEqual(t){return Wl(this.value,t.value)}getFieldsMap(t){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let r=0;r<t.length;++r){let n=i.mapValue.fields[t.get(r)];Db(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},i.mapValue.fields[t.get(r)]=n),i=n}return i.mapValue.fields}applyChanges(t,i,r){of(i,(n,s)=>t[n]=s);for(const n of r)delete t[n]}clone(){return new Za(Zv(this.value))}}function pG(e){const t=[];return of(e.fields,(i,r)=>{const n=new es([i]);if(Db(r)){const s=pG(r.mapValue).fields;if(s.length===0)t.push(n);else for(const a of s)t.push(n.child(a))}else t.push(n)}),new No(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(t,i,r,n,s,a,o){this.key=t,this.documentType=i,this.version=r,this.readTime=n,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(t){return new ys(t,0,ci.min(),ci.min(),ci.min(),Za.empty(),0)}static newFoundDocument(t,i,r,n){return new ys(t,1,i,ci.min(),r,n,0)}static newNoDocument(t,i){return new ys(t,2,i,ci.min(),ci.min(),Za.empty(),0)}static newUnknownDocument(t,i){return new ys(t,3,i,ci.min(),ci.min(),Za.empty(),2)}convertToFoundDocument(t,i){return!this.createTime.isEqual(ci.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Za.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Za.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ci.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ys&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ys(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(t,i){this.position=t,this.inclusive=i}}function U4(e,t,i){let r=0;for(let n=0;n<e.position.length;n++){const s=t[n],a=e.position[n];if(s.field.isKeyField()?r=Kt.comparator(Kt.fromName(a.referenceValue),i.key):r=Am(a,i.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function V4(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let i=0;i<e.position.length;i++)if(!Wl(e.position[i],t.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(t,i="asc"){this.field=t,this.dir=i}}function mSe(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mG{}class mn extends mG{constructor(t,i,r){super(),this.field=t,this.op=i,this.value=r}static create(t,i,r){return t.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(t,i,r):new vSe(t,i,r):i==="array-contains"?new bSe(t,r):i==="in"?new wSe(t,r):i==="not-in"?new _Se(t,r):i==="array-contains-any"?new SSe(t,r):new mn(t,i,r)}static createKeyFieldInFilter(t,i,r){return i==="in"?new ySe(t,r):new xSe(t,r)}matches(t){const i=t.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(Am(i,this.value)):i!==null&&Mc(this.value)===Mc(i)&&this.matchesComparison(Am(i,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return ai()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ql extends mG{constructor(t,i){super(),this.filters=t,this.op=i,this.ce=null}static create(t,i){return new ql(t,i)}matches(t){return gG(this)?this.filters.find(i=>!i.matches(t))===void 0:this.filters.find(i=>i.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,i)=>t.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function gG(e){return e.op==="and"}function vG(e){return gSe(e)&&gG(e)}function gSe(e){for(const t of e.filters)if(t instanceof ql)return!1;return!0}function xP(e){if(e instanceof mn)return e.field.canonicalString()+e.op.toString()+Cm(e.value);if(vG(e))return e.filters.map(t=>xP(t)).join(",");{const t=e.filters.map(i=>xP(i)).join(",");return`${e.op}(${t})`}}function yG(e,t){return e instanceof mn?function(r,n){return n instanceof mn&&r.op===n.op&&r.field.isEqual(n.field)&&Wl(r.value,n.value)}(e,t):e instanceof ql?function(r,n){return n instanceof ql&&r.op===n.op&&r.filters.length===n.filters.length?r.filters.reduce((s,a,o)=>s&&yG(a,n.filters[o]),!0):!1}(e,t):void ai()}function xG(e){return e instanceof mn?function(i){return`${i.field.canonicalString()} ${i.op} ${Cm(i.value)}`}(e):e instanceof ql?function(i){return i.op.toString()+" {"+i.getFilters().map(xG).join(" ,")+"}"}(e):"Filter"}class vSe extends mn{constructor(t,i,r){super(t,i,r),this.key=Kt.fromName(r.referenceValue)}matches(t){const i=Kt.comparator(t.key,this.key);return this.matchesComparison(i)}}class ySe extends mn{constructor(t,i){super(t,"in",i),this.keys=bG("in",i)}matches(t){return this.keys.some(i=>i.isEqual(t.key))}}class xSe extends mn{constructor(t,i){super(t,"not-in",i),this.keys=bG("not-in",i)}matches(t){return!this.keys.some(i=>i.isEqual(t.key))}}function bG(e,t){var i;return(((i=t.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(r=>Kt.fromName(r.referenceValue))}class bSe extends mn{constructor(t,i){super(t,"array-contains",i)}matches(t){const i=t.data.field(this.field);return ND(i)&&Dy(i.arrayValue,this.value)}}class wSe extends mn{constructor(t,i){super(t,"in",i)}matches(t){const i=t.data.field(this.field);return i!==null&&Dy(this.value.arrayValue,i)}}class _Se extends mn{constructor(t,i){super(t,"not-in",i)}matches(t){if(Dy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=t.data.field(this.field);return i!==null&&!Dy(this.value.arrayValue,i)}}class SSe extends mn{constructor(t,i){super(t,"array-contains-any",i)}matches(t){const i=t.data.field(this.field);return!(!ND(i)||!i.arrayValue.values)&&i.arrayValue.values.some(r=>Dy(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ESe{constructor(t,i=null,r=[],n=[],s=null,a=null,o=null){this.path=t,this.collectionGroup=i,this.orderBy=r,this.filters=n,this.limit=s,this.startAt=a,this.endAt=o,this.le=null}}function j4(e,t=null,i=[],r=[],n=null,s=null,a=null){return new ESe(e,t,i,r,n,s,a)}function BD(e){const t=pi(e);if(t.le===null){let i=t.path.canonicalString();t.collectionGroup!==null&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(r=>xP(r)).join(","),i+="|ob:",i+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),W_(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Cm(r)).join(",")),t.endAt&&(i+="|ub:",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Cm(r)).join(",")),t.le=i}return t.le}function FD(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!mSe(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(!yG(e.filters[i],t.filters[i]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!V4(e.startAt,t.startAt)&&V4(e.endAt,t.endAt)}function bP(e){return Kt.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(t,i=null,r=[],n=[],s=null,a="F",o=null,l=null){this.path=t,this.collectionGroup=i,this.explicitOrderBy=r,this.filters=n,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function ASe(e,t,i,r,n,s,a,o){return new X_(e,t,i,r,n,s,a,o)}function UD(e){return new X_(e)}function H4(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function CSe(e){return e.collectionGroup!==null}function Jv(e){const t=pi(e);if(t.he===null){t.he=[];const i=new Set;for(const s of t.explicitOrderBy)t.he.push(s),i.add(s.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new vn(es.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(t).forEach(s=>{i.has(s.canonicalString())||s.isKeyField()||t.he.push(new $w(s,r))}),i.has(es.keyField().canonicalString())||t.he.push(new $w(es.keyField(),r))}return t.he}function Fl(e){const t=pi(e);return t.Pe||(t.Pe=TSe(t,Jv(e))),t.Pe}function TSe(e,t){if(e.limitType==="F")return j4(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(n=>{const s=n.dir==="desc"?"asc":"desc";return new $w(n.field,s)});const i=e.endAt?new Jw(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Jw(e.startAt.position,e.startAt.inclusive):null;return j4(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}}function wP(e,t,i){return new X_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,i,e.startAt,e.endAt)}function Y_(e,t){return FD(Fl(e),Fl(t))&&e.limitType===t.limitType}function wG(e){return`${BD(Fl(e))}|lt:${e.limitType}`}function Rp(e){return`Query(target=${function(i){let r=i.path.canonicalString();return i.collectionGroup!==null&&(r+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(r+=`, filters: [${i.filters.map(n=>xG(n)).join(", ")}]`),W_(i.limit)||(r+=", limit: "+i.limit),i.orderBy.length>0&&(r+=`, orderBy: [${i.orderBy.map(n=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(n)).join(", ")}]`),i.startAt&&(r+=", startAt: ",r+=i.startAt.inclusive?"b:":"a:",r+=i.startAt.position.map(n=>Cm(n)).join(",")),i.endAt&&(r+=", endAt: ",r+=i.endAt.inclusive?"a:":"b:",r+=i.endAt.position.map(n=>Cm(n)).join(",")),`Target(${r})`}(Fl(e))}; limitType=${e.limitType})`}function Q_(e,t){return t.isFoundDocument()&&function(r,n){const s=n.key.path;return r.collectionGroup!==null?n.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Kt.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(e,t)&&function(r,n){for(const s of Jv(r))if(!s.field.isKeyField()&&n.data.field(s.field)===null)return!1;return!0}(e,t)&&function(r,n){for(const s of r.filters)if(!s.matches(n))return!1;return!0}(e,t)&&function(r,n){return!(r.startAt&&!function(a,o,l){const u=U4(a,o,l);return a.inclusive?u<=0:u<0}(r.startAt,Jv(r),n)||r.endAt&&!function(a,o,l){const u=U4(a,o,l);return a.inclusive?u>=0:u>0}(r.endAt,Jv(r),n))}(e,t)}function PSe(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function _G(e){return(t,i)=>{let r=!1;for(const n of Jv(e)){const s=MSe(n,t,i);if(s!==0)return s;r=r||n.field.isKeyField()}return 0}}function MSe(e,t,i){const r=e.field.isKeyField()?Kt.comparator(t.key,i.key):function(s,a,o){const l=a.data.field(s),u=o.data.field(s);return l!==null&&u!==null?Am(l,u):ai()}(e.field,t,i);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ai()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={},this.innerSize=0}get(t){const i=this.mapKeyFn(t),r=this.inner[i];if(r!==void 0){for(const[n,s]of r)if(this.equalsFn(n,t))return s}}has(t){return this.get(t)!==void 0}set(t,i){const r=this.mapKeyFn(t),n=this.inner[r];if(n===void 0)return this.inner[r]=[[t,i]],void this.innerSize++;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return void(n[s]=[t,i]);n.push([t,i]),this.innerSize++}delete(t){const i=this.mapKeyFn(t),r=this.inner[i];if(r===void 0)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return r.length===1?delete this.inner[i]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(t){of(this.inner,(i,r)=>{for(const[n,s]of r)t(n,s)})}isEmpty(){return sG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DSe=new Cr(Kt.comparator);function $u(){return DSe}const SG=new Cr(Kt.comparator);function Iv(...e){let t=SG;for(const i of e)t=t.insert(i.key,i);return t}function EG(e){let t=SG;return e.forEach((i,r)=>t=t.insert(i,r.overlayedDocument)),t}function Dd(){return $v()}function AG(){return $v()}function $v(){return new lf(e=>e.toString(),(e,t)=>e.isEqual(t))}const ISe=new Cr(Kt.comparator),RSe=new vn(Kt.comparator);function Ti(...e){let t=RSe;for(const i of e)t=t.add(i);return t}const OSe=new vn(yi);function kSe(){return OSe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VD(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qw(t)?"-0":t}}function CG(e){return{integerValue:""+e}}function LSe(e,t){return lSe(t)?CG(t):VD(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(){this._=void 0}}function zSe(e,t,i){return e instanceof e_?function(n,s){const a={fields:{[lG]:{stringValue:oG},[hG]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return s&&zD(s)&&(s=q_(s)),s&&(a.fields[uG]=s),{mapValue:a}}(i,t):e instanceof Iy?PG(e,t):e instanceof Ry?MG(e,t):function(n,s){const a=TG(n,s),o=G4(a)+G4(n.Ie);return yP(a)&&yP(n.Ie)?CG(o):VD(n.serializer,o)}(e,t)}function NSe(e,t,i){return e instanceof Iy?PG(e,t):e instanceof Ry?MG(e,t):i}function TG(e,t){return e instanceof t_?function(r){return yP(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}class e_ extends K_{}class Iy extends K_{constructor(t){super(),this.elements=t}}function PG(e,t){const i=DG(t);for(const r of e.elements)i.some(n=>Wl(n,r))||i.push(r);return{arrayValue:{values:i}}}class Ry extends K_{constructor(t){super(),this.elements=t}}function MG(e,t){let i=DG(t);for(const r of e.elements)i=i.filter(n=>!Wl(n,r));return{arrayValue:{values:i}}}class t_ extends K_{constructor(t,i){super(),this.serializer=t,this.Ie=i}}function G4(e){return Fr(e.integerValue||e.doubleValue)}function DG(e){return ND(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}function BSe(e,t){return e.field.isEqual(t.field)&&function(r,n){return r instanceof Iy&&n instanceof Iy||r instanceof Ry&&n instanceof Ry?Em(r.elements,n.elements,Wl):r instanceof t_&&n instanceof t_?Wl(r.Ie,n.Ie):r instanceof e_&&n instanceof e_}(e.transform,t.transform)}class FSe{constructor(t,i){this.version=t,this.transformResults=i}}class ju{constructor(t,i){this.updateTime=t,this.exists=i}static none(){return new ju}static exists(t){return new ju(void 0,t)}static updateTime(t){return new ju(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ib(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}class Z_{}function IG(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new OG(e.key,ju.none()):new l0(e.key,e.data,ju.none());{const i=e.data,r=Za.empty();let n=new vn(es.comparator);for(let s of t.fields)if(!n.has(s)){let a=i.field(s);a===null&&s.length>1&&(s=s.popLast(),a=i.field(s)),a===null?r.delete(s):r.set(s,a),n=n.add(s)}return new uf(e.key,r,new No(n.toArray()),ju.none())}}function USe(e,t,i){e instanceof l0?function(n,s,a){const o=n.value.clone(),l=q4(n.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(e,t,i):e instanceof uf?function(n,s,a){if(!Ib(n.precondition,s))return void s.convertToUnknownDocument(a.version);const o=q4(n.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(RG(n)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(e,t,i):function(n,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,i)}function ey(e,t,i,r){return e instanceof l0?function(s,a,o,l){if(!Ib(s.precondition,a))return o;const u=s.value.clone(),h=X4(s.fieldTransforms,l,a);return u.setAll(h),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(e,t,i,r):e instanceof uf?function(s,a,o,l){if(!Ib(s.precondition,a))return o;const u=X4(s.fieldTransforms,l,a),h=a.data;return h.setAll(RG(s)),h.setAll(u),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(c=>c.field))}(e,t,i,r):function(s,a,o){return Ib(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(e,t,i)}function VSe(e,t){let i=null;for(const r of e.fieldTransforms){const n=t.data.field(r.field),s=TG(r.transform,n||null);s!=null&&(i===null&&(i=Za.empty()),i.set(r.field,s))}return i||null}function W4(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(r,n){return r===void 0&&n===void 0||!(!r||!n)&&Em(r,n,(s,a)=>BSe(s,a))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class l0 extends Z_{constructor(t,i,r,n=[]){super(),this.key=t,this.value=i,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class uf extends Z_{constructor(t,i,r,n,s=[]){super(),this.key=t,this.data=i,this.fieldMask=r,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function RG(e){const t=new Map;return e.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const r=e.data.field(i);t.set(i,r)}}),t}function q4(e,t,i){const r=new Map;Xi(e.length===i.length);for(let n=0;n<i.length;n++){const s=e[n],a=s.transform,o=t.data.field(s.field);r.set(s.field,NSe(a,o,i[n]))}return r}function X4(e,t,i){const r=new Map;for(const n of e){const s=n.transform,a=i.data.field(n.field);r.set(n.field,zSe(s,a,t))}return r}class OG extends Z_{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jSe extends Z_{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HSe{constructor(t,i,r,n){this.batchId=t,this.localWriteTime=i,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(t,i){const r=i.mutationResults;for(let n=0;n<this.mutations.length;n++){const s=this.mutations[n];s.key.isEqual(t.key)&&USe(s,t,r[n])}}applyToLocalView(t,i){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(i=ey(r,t,i,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(i=ey(r,t,i,this.localWriteTime));return i}applyToLocalDocumentSet(t,i){const r=AG();return this.mutations.forEach(n=>{const s=t.get(n.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=i.has(n.key)?null:o;const l=IG(a,o);l!==null&&r.set(n.key,l),a.isValidDocument()||a.convertToNoDocument(ci.min())}),r}keys(){return this.mutations.reduce((t,i)=>t.add(i.key),Ti())}isEqual(t){return this.batchId===t.batchId&&Em(this.mutations,t.mutations,(i,r)=>W4(i,r))&&Em(this.baseMutations,t.baseMutations,(i,r)=>W4(i,r))}}class jD{constructor(t,i,r,n){this.batch=t,this.commitVersion=i,this.mutationResults=r,this.docVersions=n}static from(t,i,r){Xi(t.mutations.length===r.length);let n=function(){return ISe}();const s=t.mutations;for(let a=0;a<s.length;a++)n=n.insert(s[a].key,r[a].version);return new jD(t,i,r,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GSe{constructor(t,i){this.largestBatchId=t,this.mutation=i}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WSe{constructor(t,i){this.count=t,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yr,Li;function qSe(e){switch(e){case Je.OK:return ai();case Je.CANCELLED:case Je.UNKNOWN:case Je.DEADLINE_EXCEEDED:case Je.RESOURCE_EXHAUSTED:case Je.INTERNAL:case Je.UNAVAILABLE:case Je.UNAUTHENTICATED:return!1;case Je.INVALID_ARGUMENT:case Je.NOT_FOUND:case Je.ALREADY_EXISTS:case Je.PERMISSION_DENIED:case Je.FAILED_PRECONDITION:case Je.ABORTED:case Je.OUT_OF_RANGE:case Je.UNIMPLEMENTED:case Je.DATA_LOSS:return!0;default:return ai()}}function kG(e){if(e===void 0)return Ju("GRPC error has no .code"),Je.UNKNOWN;switch(e){case Yr.OK:return Je.OK;case Yr.CANCELLED:return Je.CANCELLED;case Yr.UNKNOWN:return Je.UNKNOWN;case Yr.DEADLINE_EXCEEDED:return Je.DEADLINE_EXCEEDED;case Yr.RESOURCE_EXHAUSTED:return Je.RESOURCE_EXHAUSTED;case Yr.INTERNAL:return Je.INTERNAL;case Yr.UNAVAILABLE:return Je.UNAVAILABLE;case Yr.UNAUTHENTICATED:return Je.UNAUTHENTICATED;case Yr.INVALID_ARGUMENT:return Je.INVALID_ARGUMENT;case Yr.NOT_FOUND:return Je.NOT_FOUND;case Yr.ALREADY_EXISTS:return Je.ALREADY_EXISTS;case Yr.PERMISSION_DENIED:return Je.PERMISSION_DENIED;case Yr.FAILED_PRECONDITION:return Je.FAILED_PRECONDITION;case Yr.ABORTED:return Je.ABORTED;case Yr.OUT_OF_RANGE:return Je.OUT_OF_RANGE;case Yr.UNIMPLEMENTED:return Je.UNIMPLEMENTED;case Yr.DATA_LOSS:return Je.DATA_LOSS;default:return ai()}}(Li=Yr||(Yr={}))[Li.OK=0]="OK",Li[Li.CANCELLED=1]="CANCELLED",Li[Li.UNKNOWN=2]="UNKNOWN",Li[Li.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Li[Li.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Li[Li.NOT_FOUND=5]="NOT_FOUND",Li[Li.ALREADY_EXISTS=6]="ALREADY_EXISTS",Li[Li.PERMISSION_DENIED=7]="PERMISSION_DENIED",Li[Li.UNAUTHENTICATED=16]="UNAUTHENTICATED",Li[Li.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Li[Li.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Li[Li.ABORTED=10]="ABORTED",Li[Li.OUT_OF_RANGE=11]="OUT_OF_RANGE",Li[Li.UNIMPLEMENTED=12]="UNIMPLEMENTED",Li[Li.INTERNAL=13]="INTERNAL",Li[Li.UNAVAILABLE=14]="UNAVAILABLE",Li[Li.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XSe=new bc([4294967295,4294967295],0);function Y4(e){const t=iG().encode(e),i=new QH;return i.update(t),new Uint8Array(i.digest())}function Q4(e){const t=new DataView(e.buffer),i=t.getUint32(0,!0),r=t.getUint32(4,!0),n=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new bc([i,r],0),new bc([n,s],0)]}class HD{constructor(t,i,r){if(this.bitmap=t,this.padding=i,this.hashCount=r,i<0||i>=8)throw new Rv(`Invalid padding: ${i}`);if(r<0)throw new Rv(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Rv(`Invalid hash count: ${r}`);if(t.length===0&&i!==0)throw new Rv(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*t.length-i,this.de=bc.fromNumber(this.Ee)}Ae(t,i,r){let n=t.add(i.multiply(bc.fromNumber(r)));return n.compare(XSe)===1&&(n=new bc([n.getBits(0),n.getBits(1)],0)),n.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const i=Y4(t),[r,n]=Q4(i);for(let s=0;s<this.hashCount;s++){const a=this.Ae(r,n,s);if(!this.Re(a))return!1}return!0}static create(t,i,r){const n=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new HD(s,n,i);return r.forEach(o=>a.insert(o)),a}insert(t){if(this.Ee===0)return;const i=Y4(t),[r,n]=Q4(i);for(let s=0;s<this.hashCount;s++){const a=this.Ae(r,n,s);this.Ve(a)}}Ve(t){const i=Math.floor(t/8),r=t%8;this.bitmap[i]|=1<<r}}class Rv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(t,i,r,n,s){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,i,r){const n=new Map;return n.set(t,u0.createSynthesizedTargetChangeForCurrentChange(t,i,r)),new J_(ci.min(),n,new Cr(yi),$u(),Ti())}}class u0{constructor(t,i,r,n,s){this.resumeToken=t,this.current=i,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,i,r){return new u0(r,i,Ti(),Ti(),Ti())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(t,i,r,n){this.me=t,this.removedTargetIds=i,this.key=r,this.fe=n}}class LG{constructor(t,i){this.targetId=t,this.ge=i}}class zG{constructor(t,i,r=ss.EMPTY_BYTE_STRING,n=null){this.state=t,this.targetIds=i,this.resumeToken=r,this.cause=n}}class K4{constructor(){this.pe=0,this.ye=Z4(),this.we=ss.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Ti(),i=Ti(),r=Ti();return this.ye.forEach((n,s)=>{switch(s){case 0:t=t.add(n);break;case 2:i=i.add(n);break;case 1:r=r.add(n);break;default:ai()}}),new u0(this.we,this.Se,t,i,r)}Me(){this.be=!1,this.ye=Z4()}xe(t,i){this.be=!0,this.ye=this.ye.insert(t,i)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,Xi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class YSe{constructor(t){this.ke=t,this.qe=new Map,this.Qe=$u(),this.$e=Qx(),this.Ue=Qx(),this.Ke=new Cr(yi)}We(t){for(const i of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(i,t.fe):this.ze(i,t.key,t.fe);for(const i of t.removedTargetIds)this.ze(i,t.key,t.fe)}je(t){this.forEachTarget(t,i=>{const r=this.He(i);switch(t.state){case 0:this.Je(i)&&r.Ce(t.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(t.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(i);break;case 3:this.Je(i)&&(r.Le(),r.Ce(t.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),r.Ce(t.resumeToken));break;default:ai()}})}forEachTarget(t,i){t.targetIds.length>0?t.targetIds.forEach(i):this.qe.forEach((r,n)=>{this.Je(n)&&i(n)})}Ze(t){const i=t.targetId,r=t.ge.count,n=this.Xe(i);if(n){const s=n.target;if(bP(s))if(r===0){const a=new Kt(s.path);this.ze(i,a,ys.newNoDocument(a,ci.min()))}else Xi(r===1);else{const a=this.et(i);if(a!==r){const o=this.tt(t),l=o?this.nt(o,t,a):1;if(l!==0){this.Ye(i);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,u)}}}}}tt(t){const i=t.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:r="",padding:n=0},hashCount:s=0}=i;let a,o;try{a=Pc(r).toUint8Array()}catch(l){if(l instanceof aG)return Sm("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new HD(a,n,s)}catch(l){return Sm(l instanceof Rv?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.Ee===0?null:o}nt(t,i,r){return i.ge.count===r-this.st(t,i.targetId)?0:2}st(t,i){const r=this.ke.getRemoteKeysForTarget(i);let n=0;return r.forEach(s=>{const a=this.ke.it(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(o)||(this.ze(i,s,null),n++)}),n}ot(t){const i=new Map;this.qe.forEach((s,a)=>{const o=this.Xe(a);if(o){if(s.current&&bP(o.target)){const l=new Kt(o.target.path);this._t(l).has(a)||this.ut(a,l)||this.ze(a,l,ys.newNoDocument(l,t))}s.ve&&(i.set(a,s.Fe()),s.Me())}});let r=Ti();this.Ue.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.Xe(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(r=r.add(s))}),this.Qe.forEach((s,a)=>a.setReadTime(t));const n=new J_(t,i,this.Ke,this.Qe,r);return this.Qe=$u(),this.$e=Qx(),this.Ue=Qx(),this.Ke=new Cr(yi),n}Ge(t,i){if(!this.Je(t))return;const r=this.ut(t,i.key)?2:0;this.He(t).xe(i.key,r),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(t)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(t))}ze(t,i,r){if(!this.Je(t))return;const n=this.He(t);this.ut(t,i)?n.xe(i,1):n.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(t)),this.Ue=this.Ue.insert(i,this.ct(i).add(t)),r&&(this.Qe=this.Qe.insert(i,r))}removeTarget(t){this.qe.delete(t)}et(t){const i=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let i=this.qe.get(t);return i||(i=new K4,this.qe.set(t,i)),i}ct(t){let i=this.Ue.get(t);return i||(i=new vn(yi),this.Ue=this.Ue.insert(t,i)),i}_t(t){let i=this.$e.get(t);return i||(i=new vn(yi),this.$e=this.$e.insert(t,i)),i}Je(t){const i=this.Xe(t)!==null;return i||xt("WatchChangeAggregator","Detected inactive target",t),i}Xe(t){const i=this.qe.get(t);return i&&i.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new K4),this.ke.getRemoteKeysForTarget(t).forEach(i=>{this.ze(t,i,null)})}ut(t,i){return this.ke.getRemoteKeysForTarget(t).has(i)}}function Qx(){return new Cr(Kt.comparator)}function Z4(){return new Cr(Kt.comparator)}const QSe={asc:"ASCENDING",desc:"DESCENDING"},KSe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZSe={and:"AND",or:"OR"};class JSe{constructor(t,i){this.databaseId=t,this.useProto3Json=i}}function _P(e,t){return e.useProto3Json||W_(t)?t:{value:t}}function i_(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function NG(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function $Se(e,t){return i_(e,t.toTimestamp())}function Ul(e){return Xi(!!e),ci.fromTimestamp(function(i){const r=Tc(i);return new gn(r.seconds,r.nanos)}(e))}function GD(e,t){return SP(e,t).canonicalString()}function SP(e,t){const i=function(n){return new Rr(["projects",n.projectId,"databases",n.database])}(e).child("documents");return t===void 0?i:i.child(t)}function BG(e){const t=Rr.fromString(e);return Xi(HG(t)),t}function EP(e,t){return GD(e.databaseId,t.path)}function ZC(e,t){const i=BG(t);if(i.get(1)!==e.databaseId.projectId)throw new Qt(Je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+e.databaseId.projectId);if(i.get(3)!==e.databaseId.database)throw new Qt(Je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+e.databaseId.database);return new Kt(UG(i))}function FG(e,t){return GD(e.databaseId,t)}function eEe(e){const t=BG(e);return t.length===4?Rr.emptyPath():UG(t)}function AP(e){return new Rr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function UG(e){return Xi(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function J4(e,t,i){return{name:EP(e,t),fields:i.value.mapValue.fields}}function tEe(e,t){let i;if("targetChange"in t){t.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ai()}(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],s=function(u,h){return u.useProto3Json?(Xi(h===void 0||typeof h=="string"),ss.fromBase64String(h||"")):(Xi(h===void 0||h instanceof Buffer||h instanceof Uint8Array),ss.fromUint8Array(h||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(u){const h=u.code===void 0?Je.UNKNOWN:kG(u.code);return new Qt(h,u.message||"")}(a);i=new zG(r,n,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const n=ZC(e,r.document.name),s=Ul(r.document.updateTime),a=r.document.createTime?Ul(r.document.createTime):ci.min(),o=new Za({mapValue:{fields:r.document.fields}}),l=ys.newFoundDocument(n,s,a,o),u=r.targetIds||[],h=r.removedTargetIds||[];i=new Rb(u,h,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const n=ZC(e,r.document),s=r.readTime?Ul(r.readTime):ci.min(),a=ys.newNoDocument(n,s),o=r.removedTargetIds||[];i=new Rb([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const n=ZC(e,r.document),s=r.removedTargetIds||[];i=new Rb([],s,n,null)}else{if(!("filter"in t))return ai();{t.filter;const r=t.filter;r.targetId;const{count:n=0,unchangedNames:s}=r,a=new WSe(n,s),o=r.targetId;i=new LG(o,a)}}return i}function iEe(e,t){let i;if(t instanceof l0)i={update:J4(e,t.key,t.value)};else if(t instanceof OG)i={delete:EP(e,t.key)};else if(t instanceof uf)i={update:J4(e,t.key,t.data),updateMask:cEe(t.fieldMask)};else{if(!(t instanceof jSe))return ai();i={verify:EP(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(r=>function(s,a){const o=a.transform;if(o instanceof e_)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Iy)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Ry)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof t_)return{fieldPath:a.field.canonicalString(),increment:o.Ie};throw ai()}(0,r))),t.precondition.isNone||(i.currentDocument=function(n,s){return s.updateTime!==void 0?{updateTime:$Se(n,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:ai()}(e,t.precondition)),i}function rEe(e,t){return e&&e.length>0?(Xi(t!==void 0),e.map(i=>function(n,s){let a=n.updateTime?Ul(n.updateTime):Ul(s);return a.isEqual(ci.min())&&(a=Ul(s)),new FSe(a,n.transformResults||[])}(i,t))):[]}function nEe(e,t){return{documents:[FG(e,t.path)]}}function sEe(e,t){const i={structuredQuery:{}},r=t.path;let n;t.collectionGroup!==null?(n=r,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=r.popLast(),i.structuredQuery.from=[{collectionId:r.lastSegment()}]),i.parent=FG(e,n);const s=function(u){if(u.length!==0)return jG(ql.create(u,"and"))}(t.filters);s&&(i.structuredQuery.where=s);const a=function(u){if(u.length!==0)return u.map(h=>function(f){return{field:Op(f.field),direction:lEe(f.dir)}}(h))}(t.orderBy);a&&(i.structuredQuery.orderBy=a);const o=_P(e,t.limit);return o!==null&&(i.structuredQuery.limit=o),t.startAt&&(i.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(t.startAt)),t.endAt&&(i.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(t.endAt)),{ht:i,parent:n}}function aEe(e){let t=eEe(e.parent);const i=e.structuredQuery,r=i.from?i.from.length:0;let n=null;if(r>0){Xi(r===1);const h=i.from[0];h.allDescendants?n=h.collectionId:t=t.child(h.collectionId)}let s=[];i.where&&(s=function(c){const f=VG(c);return f instanceof ql&&vG(f)?f.getFilters():[f]}(i.where));let a=[];i.orderBy&&(a=function(c){return c.map(f=>function(g){return new $w(kp(g.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(f))}(i.orderBy));let o=null;i.limit&&(o=function(c){let f;return f=typeof c=="object"?c.value:c,W_(f)?null:f}(i.limit));let l=null;i.startAt&&(l=function(c){const f=!!c.before,m=c.values||[];return new Jw(m,f)}(i.startAt));let u=null;return i.endAt&&(u=function(c){const f=!c.before,m=c.values||[];return new Jw(m,f)}(i.endAt)),ASe(t,n,a,s,o,"F",l,u)}function oEe(e,t){const i=function(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ai()}}(t.purpose);return i==null?null:{"goog-listen-tags":i}}function VG(e){return e.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const r=kp(i.unaryFilter.field);return mn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const n=kp(i.unaryFilter.field);return mn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=kp(i.unaryFilter.field);return mn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=kp(i.unaryFilter.field);return mn.create(a,"!=",{nullValue:"NULL_VALUE"});default:return ai()}}(e):e.fieldFilter!==void 0?function(i){return mn.create(kp(i.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ai()}}(i.fieldFilter.op),i.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(i){return ql.create(i.compositeFilter.filters.map(r=>VG(r)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return ai()}}(i.compositeFilter.op))}(e):ai()}function lEe(e){return QSe[e]}function uEe(e){return KSe[e]}function hEe(e){return ZSe[e]}function Op(e){return{fieldPath:e.canonicalString()}}function kp(e){return es.fromServerFormat(e.fieldPath)}function jG(e){return e instanceof mn?function(i){if(i.op==="=="){if(F4(i.value))return{unaryFilter:{field:Op(i.field),op:"IS_NAN"}};if(B4(i.value))return{unaryFilter:{field:Op(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(F4(i.value))return{unaryFilter:{field:Op(i.field),op:"IS_NOT_NAN"}};if(B4(i.value))return{unaryFilter:{field:Op(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Op(i.field),op:uEe(i.op),value:i.value}}}(e):e instanceof ql?function(i){const r=i.getFilters().map(n=>jG(n));return r.length===1?r[0]:{compositeFilter:{op:hEe(i.op),filters:r}}}(e):ai()}function cEe(e){const t=[];return e.fields.forEach(i=>t.push(i.canonicalString())),{fieldPaths:t}}function HG(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(t,i,r,n,s=ci.min(),a=ci.min(),o=ss.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=i,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(t){return new cc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,i){return new cc(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new cc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new cc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dEe{constructor(t){this.Tt=t}}function fEe(e){const t=aEe({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?wP(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pEe{constructor(){this.Tn=new mEe}addToCollectionParentIndex(t,i){return this.Tn.add(i),He.resolve()}getCollectionParents(t,i){return He.resolve(this.Tn.getEntries(i))}addFieldIndex(t,i){return He.resolve()}deleteFieldIndex(t,i){return He.resolve()}deleteAllFieldIndexes(t){return He.resolve()}createTargetIndexes(t,i){return He.resolve()}getDocumentsMatchingTarget(t,i){return He.resolve(null)}getIndexType(t,i){return He.resolve(0)}getFieldIndexes(t,i){return He.resolve([])}getNextCollectionGroupToUpdate(t){return He.resolve(null)}getMinOffset(t,i){return He.resolve(Cc.min())}getMinOffsetFromCollectionGroup(t,i){return He.resolve(Cc.min())}updateCollectionGroup(t,i,r){return He.resolve()}updateIndexEntries(t,i){return He.resolve()}}class mEe{constructor(){this.index={}}add(t){const i=t.lastSegment(),r=t.popLast(),n=this.index[i]||new vn(Rr.comparator),s=!n.has(r);return this.index[i]=n.add(r),s}has(t){const i=t.lastSegment(),r=t.popLast(),n=this.index[i];return n&&n.has(r)}getEntries(t){return(this.index[t]||new vn(Rr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $4={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},GG=41943040;class ta{static withCacheSize(t){return new ta(t,ta.DEFAULT_COLLECTION_PERCENTILE,ta.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,i,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ta.DEFAULT_COLLECTION_PERCENTILE=10,ta.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ta.DEFAULT=new ta(GG,ta.DEFAULT_COLLECTION_PERCENTILE,ta.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ta.DISABLED=new ta(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new Tm(0)}static Kn(){return new Tm(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eF="LruGarbageCollector",gEe=1048576;function tF([e,t],[i,r]){const n=yi(e,i);return n===0?yi(t,r):n}class vEe{constructor(t){this.Hn=t,this.buffer=new vn(tF),this.Jn=0}Yn(){return++this.Jn}Zn(t){const i=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const r=this.buffer.last();tF(i,r)<0&&(this.buffer=this.buffer.delete(r).add(i))}}get maxValue(){return this.buffer.last()[0]}}class yEe{constructor(t,i,r){this.garbageCollector=t,this.asyncQueue=i,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){xt(eF,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){Zm(i)?xt(eF,"Ignoring IndexedDB error during garbage collection: ",i):await Km(i)}await this.er(3e5)})}}class xEe{constructor(t,i){this.tr=t,this.params=i}calculateTargetCount(t,i){return this.tr.nr(t).next(r=>Math.floor(i/100*r))}nthSequenceNumber(t,i){if(i===0)return He.resolve(G_.ae);const r=new vEe(i);return this.tr.forEachTarget(t,n=>r.Zn(n.sequenceNumber)).next(()=>this.tr.rr(t,n=>r.Zn(n))).next(()=>r.maxValue)}removeTargets(t,i,r){return this.tr.removeTargets(t,i,r)}removeOrphanedDocuments(t,i){return this.tr.removeOrphanedDocuments(t,i)}collect(t,i){return this.params.cacheSizeCollectionThreshold===-1?(xt("LruGarbageCollector","Garbage collection skipped; disabled"),He.resolve($4)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(xt("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$4):this.ir(t,i))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,i){let r,n,s,a,o,l,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(c=>(c>this.params.maximumSequenceNumbersToCollect?(xt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${c}`),n=this.params.maximumSequenceNumbersToCollect):n=c,a=Date.now(),this.nthSequenceNumber(t,n))).next(c=>(r=c,o=Date.now(),this.removeTargets(t,r,i))).next(c=>(s=c,l=Date.now(),this.removeOrphanedDocuments(t,r))).next(c=>(u=Date.now(),Ip()<=Ci.DEBUG&&xt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${n} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${c} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),He.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:c})))}}function bEe(e,t){return new xEe(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wEe{constructor(){this.changes=new lf(t=>t.toString(),(t,i)=>t.isEqual(i)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,i){this.assertNotApplied(),this.changes.set(t,ys.newInvalidDocument(t).setReadTime(i))}getEntry(t,i){this.assertNotApplied();const r=this.changes.get(i);return r!==void 0?He.resolve(r):this.getFromCache(t,i)}getEntries(t,i){return this.getAllFromCache(t,i)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Ee{constructor(t,i){this.overlayedDocument=t,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SEe{constructor(t,i,r,n){this.remoteDocumentCache=t,this.mutationQueue=i,this.documentOverlayCache=r,this.indexManager=n}getDocument(t,i){let r=null;return this.documentOverlayCache.getOverlay(t,i).next(n=>(r=n,this.remoteDocumentCache.getEntry(t,i))).next(n=>(r!==null&&ey(r.mutation,n,No.empty(),gn.now()),n))}getDocuments(t,i){return this.remoteDocumentCache.getEntries(t,i).next(r=>this.getLocalViewOfDocuments(t,r,Ti()).next(()=>r))}getLocalViewOfDocuments(t,i,r=Ti()){const n=Dd();return this.populateOverlays(t,n,i).next(()=>this.computeViews(t,i,n,r).next(s=>{let a=Iv();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,i){const r=Dd();return this.populateOverlays(t,r,i).next(()=>this.computeViews(t,i,r,Ti()))}populateOverlays(t,i,r){const n=[];return r.forEach(s=>{i.has(s)||n.push(s)}),this.documentOverlayCache.getOverlays(t,n).next(s=>{s.forEach((a,o)=>{i.set(a,o)})})}computeViews(t,i,r,n){let s=$u();const a=$v(),o=function(){return $v()}();return i.forEach((l,u)=>{const h=r.get(u.key);n.has(u.key)&&(h===void 0||h.mutation instanceof uf)?s=s.insert(u.key,u):h!==void 0?(a.set(u.key,h.mutation.getFieldMask()),ey(h.mutation,u,h.mutation.getFieldMask(),gn.now())):a.set(u.key,No.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((u,h)=>a.set(u,h)),i.forEach((u,h)=>{var c;return o.set(u,new _Ee(h,(c=a.get(u))!==null&&c!==void 0?c:null))}),o))}recalculateAndSaveOverlays(t,i){const r=$v();let n=new Cr((a,o)=>a-o),s=Ti();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,i).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=i.get(l);if(u===null)return;let h=r.get(l)||No.empty();h=o.applyToLocalView(u,h),r.set(l,h);const c=(n.get(o.batchId)||Ti()).add(l);n=n.insert(o.batchId,c)})}).next(()=>{const a=[],o=n.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,h=l.value,c=AG();h.forEach(f=>{if(!s.has(f)){const m=IG(i.get(f),r.get(f));m!==null&&c.set(f,m),s=s.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(t,u,c))}return He.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,i){return this.remoteDocumentCache.getEntries(t,i).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,i,r,n){return function(a){return Kt.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(t,i.path):CSe(i)?this.getDocumentsMatchingCollectionGroupQuery(t,i,r,n):this.getDocumentsMatchingCollectionQuery(t,i,r,n)}getNextDocuments(t,i,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(t,i,r,n).next(s=>{const a=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,i,r.largestBatchId,n-s.size):He.resolve(Dd());let o=Ty,l=s;return a.next(u=>He.forEach(u,(h,c)=>(o<c.largestBatchId&&(o=c.largestBatchId),s.get(h)?He.resolve():this.remoteDocumentCache.getEntry(t,h).next(f=>{l=l.insert(h,f)}))).next(()=>this.populateOverlays(t,u,s)).next(()=>this.computeViews(t,l,u,Ti())).next(h=>({batchId:o,changes:EG(h)})))})}getDocumentsMatchingDocumentQuery(t,i){return this.getDocument(t,new Kt(i)).next(r=>{let n=Iv();return r.isFoundDocument()&&(n=n.insert(r.key,r)),n})}getDocumentsMatchingCollectionGroupQuery(t,i,r,n){const s=i.collectionGroup;let a=Iv();return this.indexManager.getCollectionParents(t,s).next(o=>He.forEach(o,l=>{const u=function(c,f){return new X_(f,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(i,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,u,r,n).next(h=>{h.forEach((c,f)=>{a=a.insert(c,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,i,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,r,s,n))).next(a=>{s.forEach((l,u)=>{const h=u.getKey();a.get(h)===null&&(a=a.insert(h,ys.newInvalidDocument(h)))});let o=Iv();return a.forEach((l,u)=>{const h=s.get(l);h!==void 0&&ey(h.mutation,u,No.empty(),gn.now()),Q_(i,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EEe{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,i){return He.resolve(this.dr.get(i))}saveBundleMetadata(t,i){return this.dr.set(i.id,function(n){return{id:n.id,version:n.version,createTime:Ul(n.createTime)}}(i)),He.resolve()}getNamedQuery(t,i){return He.resolve(this.Ar.get(i))}saveNamedQuery(t,i){return this.Ar.set(i.name,function(n){return{name:n.name,query:fEe(n.bundledQuery),readTime:Ul(n.readTime)}}(i)),He.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AEe{constructor(){this.overlays=new Cr(Kt.comparator),this.Rr=new Map}getOverlay(t,i){return He.resolve(this.overlays.get(i))}getOverlays(t,i){const r=Dd();return He.forEach(i,n=>this.getOverlay(t,n).next(s=>{s!==null&&r.set(n,s)})).next(()=>r)}saveOverlays(t,i,r){return r.forEach((n,s)=>{this.Et(t,i,s)}),He.resolve()}removeOverlaysForBatchId(t,i,r){const n=this.Rr.get(r);return n!==void 0&&(n.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(r)),He.resolve()}getOverlaysForCollection(t,i,r){const n=Dd(),s=i.length+1,a=new Kt(i.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!i.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&n.set(l.getKey(),l)}return He.resolve(n)}getOverlaysForCollectionGroup(t,i,r,n){let s=new Cr((u,h)=>u-h);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===i&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=Dd(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const o=Dd(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>o.set(u,h)),!(o.size()>=n)););return He.resolve(o)}Et(t,i,r){const n=this.overlays.get(r.key);if(n!==null){const a=this.Rr.get(n.largestBatchId).delete(r.key);this.Rr.set(n.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new GSe(i,r));let s=this.Rr.get(i);s===void 0&&(s=Ti(),this.Rr.set(i,s)),this.Rr.set(i,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CEe{constructor(){this.sessionToken=ss.EMPTY_BYTE_STRING}getSessionToken(t){return He.resolve(this.sessionToken)}setSessionToken(t,i){return this.sessionToken=i,He.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(){this.Vr=new vn(In.mr),this.gr=new vn(In.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,i){const r=new In(t,i);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(t,i){t.forEach(r=>this.addReference(r,i))}removeReference(t,i){this.wr(new In(t,i))}Sr(t,i){t.forEach(r=>this.removeReference(r,i))}br(t){const i=new Kt(new Rr([])),r=new In(i,t),n=new In(i,t+1),s=[];return this.gr.forEachInRange([r,n],a=>{this.wr(a),s.push(a.key)}),s}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const i=new Kt(new Rr([])),r=new In(i,t),n=new In(i,t+1);let s=Ti();return this.gr.forEachInRange([r,n],a=>{s=s.add(a.key)}),s}containsKey(t){const i=new In(t,0),r=this.Vr.firstAfterOrEqual(i);return r!==null&&t.isEqual(r.key)}}class In{constructor(t,i){this.key=t,this.Cr=i}static mr(t,i){return Kt.comparator(t.key,i.key)||yi(t.Cr,i.Cr)}static pr(t,i){return yi(t.Cr,i.Cr)||Kt.comparator(t.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TEe{constructor(t,i){this.indexManager=t,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new vn(In.mr)}checkEmpty(t){return He.resolve(this.mutationQueue.length===0)}addMutationBatch(t,i,r,n){const s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new HSe(s,i,r,n);this.mutationQueue.push(a);for(const o of n)this.Mr=this.Mr.add(new In(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return He.resolve(a)}lookupMutationBatch(t,i){return He.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(t,i){const r=i+1,n=this.Nr(r),s=n<0?0:n;return He.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return He.resolve(this.mutationQueue.length===0?LD:this.Fr-1)}getAllMutationBatches(t){return He.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,i){const r=new In(i,0),n=new In(i,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([r,n],a=>{const o=this.Or(a.Cr);s.push(o)}),He.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,i){let r=new vn(yi);return i.forEach(n=>{const s=new In(n,0),a=new In(n,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,a],o=>{r=r.add(o.Cr)})}),He.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(t,i){const r=i.path,n=r.length+1;let s=r;Kt.isDocumentKey(s)||(s=s.child(""));const a=new In(new Kt(s),0);let o=new vn(yi);return this.Mr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===n&&(o=o.add(l.Cr)),!0)},a),He.resolve(this.Br(o))}Br(t){const i=[];return t.forEach(r=>{const n=this.Or(r);n!==null&&i.push(n)}),i}removeMutationBatch(t,i){Xi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return He.forEach(i.mutations,n=>{const s=new In(n.key,i.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,n.key)}).next(()=>{this.Mr=r})}qn(t){}containsKey(t,i){const r=new In(i,0),n=this.Mr.firstAfterOrEqual(r);return He.resolve(i.isEqual(n&&n.key))}performConsistencyCheck(t){return this.mutationQueue.length,He.resolve()}Lr(t,i){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const i=this.Nr(t);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PEe{constructor(t){this.kr=t,this.docs=function(){return new Cr(Kt.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,i){const r=i.key,n=this.docs.get(r),s=n?n.size:0,a=this.kr(i);return this.docs=this.docs.insert(r,{document:i.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)}getEntry(t,i){const r=this.docs.get(i);return He.resolve(r?r.document.mutableCopy():ys.newInvalidDocument(i))}getEntries(t,i){let r=$u();return i.forEach(n=>{const s=this.docs.get(n);r=r.insert(n,s?s.document.mutableCopy():ys.newInvalidDocument(n))}),He.resolve(r)}getDocumentsMatchingQuery(t,i,r,n){let s=$u();const a=i.path,o=new Kt(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||nSe(rSe(h),r)<=0||(n.has(h.key)||Q_(i,h))&&(s=s.insert(h.key,h.mutableCopy()))}return He.resolve(s)}getAllFromCollectionGroup(t,i,r,n){ai()}qr(t,i){return He.forEach(this.docs,r=>i(r))}newChangeBuffer(t){return new MEe(this)}getSize(t){return He.resolve(this.size)}}class MEe extends wEe{constructor(t){super(),this.Ir=t}applyChanges(t){const i=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?i.push(this.Ir.addEntry(t,n)):this.Ir.removeEntry(r)}),He.waitFor(i)}getFromCache(t,i){return this.Ir.getEntry(t,i)}getAllFromCache(t,i){return this.Ir.getEntries(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DEe{constructor(t){this.persistence=t,this.Qr=new lf(i=>BD(i),FD),this.lastRemoteSnapshotVersion=ci.min(),this.highestTargetId=0,this.$r=0,this.Ur=new WD,this.targetCount=0,this.Kr=Tm.Un()}forEachTarget(t,i){return this.Qr.forEach((r,n)=>i(n)),He.resolve()}getLastRemoteSnapshotVersion(t){return He.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return He.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),He.resolve(this.highestTargetId)}setTargetsMetadata(t,i,r){return r&&(this.lastRemoteSnapshotVersion=r),i>this.$r&&(this.$r=i),He.resolve()}zn(t){this.Qr.set(t.target,t);const i=t.targetId;i>this.highestTargetId&&(this.Kr=new Tm(i),this.highestTargetId=i),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,i){return this.zn(i),this.targetCount+=1,He.resolve()}updateTargetData(t,i){return this.zn(i),He.resolve()}removeTargetData(t,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,He.resolve()}removeTargets(t,i,r){let n=0;const s=[];return this.Qr.forEach((a,o)=>{o.sequenceNumber<=i&&r.get(o.targetId)===null&&(this.Qr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),n++)}),He.waitFor(s).next(()=>n)}getTargetCount(t){return He.resolve(this.targetCount)}getTargetData(t,i){const r=this.Qr.get(i)||null;return He.resolve(r)}addMatchingKeys(t,i,r){return this.Ur.yr(i,r),He.resolve()}removeMatchingKeys(t,i,r){this.Ur.Sr(i,r);const n=this.persistence.referenceDelegate,s=[];return n&&i.forEach(a=>{s.push(n.markPotentiallyOrphaned(t,a))}),He.waitFor(s)}removeMatchingKeysForTargetId(t,i){return this.Ur.br(i),He.resolve()}getMatchingKeysForTargetId(t,i){const r=this.Ur.vr(i);return He.resolve(r)}containsKey(t,i){return He.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WG{constructor(t,i){this.Wr={},this.overlays={},this.Gr=new G_(0),this.zr=!1,this.zr=!0,this.jr=new CEe,this.referenceDelegate=t(this),this.Hr=new DEe(this),this.indexManager=new pEe,this.remoteDocumentCache=function(n){return new PEe(n)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new dEe(i),this.Yr=new EEe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let i=this.overlays[t.toKey()];return i||(i=new AEe,this.overlays[t.toKey()]=i),i}getMutationQueue(t,i){let r=this.Wr[t.toKey()];return r||(r=new TEe(i,this.referenceDelegate),this.Wr[t.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,i,r){xt("MemoryPersistence","Starting transaction:",t);const n=new IEe(this.Gr.next());return this.referenceDelegate.Zr(),r(n).next(s=>this.referenceDelegate.Xr(n).next(()=>s)).toPromise().then(s=>(n.raiseOnCommittedEvent(),s))}ei(t,i){return He.or(Object.values(this.Wr).map(r=>()=>r.containsKey(t,i)))}}class IEe extends aSe{constructor(t){super(),this.currentSequenceNumber=t}}class qD{constructor(t){this.persistence=t,this.ti=new WD,this.ni=null}static ri(t){return new qD(t)}get ii(){if(this.ni)return this.ni;throw ai()}addReference(t,i,r){return this.ti.addReference(r,i),this.ii.delete(r.toString()),He.resolve()}removeReference(t,i,r){return this.ti.removeReference(r,i),this.ii.add(r.toString()),He.resolve()}markPotentiallyOrphaned(t,i){return this.ii.add(i.toString()),He.resolve()}removeTarget(t,i){this.ti.br(i.targetId).forEach(n=>this.ii.add(n.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,i.targetId).next(n=>{n.forEach(s=>this.ii.add(s.toString()))}).next(()=>r.removeTargetData(t,i))}Zr(){this.ni=new Set}Xr(t){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return He.forEach(this.ii,r=>{const n=Kt.fromPath(r);return this.si(t,n).next(s=>{s||i.removeEntry(n,ci.min())})}).next(()=>(this.ni=null,i.apply(t)))}updateLimboDocument(t,i){return this.si(t,i).next(r=>{r?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(t){return 0}si(t,i){return He.or([()=>He.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(t,i),()=>this.persistence.ei(t,i)])}}class r_{constructor(t,i){this.persistence=t,this.oi=new lf(r=>uSe(r.path),(r,n)=>r.isEqual(n)),this.garbageCollector=bEe(this,i)}static ri(t,i){return new r_(t,i)}Zr(){}Xr(t){return He.resolve()}forEachTarget(t,i){return this.persistence.getTargetCache().forEachTarget(t,i)}nr(t){const i=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>i.next(n=>r+n))}sr(t){let i=0;return this.rr(t,r=>{i++}).next(()=>i)}rr(t,i){return He.forEach(this.oi,(r,n)=>this.ar(t,r,n).next(s=>s?He.resolve():i(n)))}removeTargets(t,i,r){return this.persistence.getTargetCache().removeTargets(t,i,r)}removeOrphanedDocuments(t,i){let r=0;const n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.qr(t,a=>this.ar(t,a,i).next(o=>{o||(r++,s.removeEntry(a,ci.min()))})).next(()=>s.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,i){return this.oi.set(i,t.currentSequenceNumber),He.resolve()}removeTarget(t,i){const r=i.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,i,r){return this.oi.set(r,t.currentSequenceNumber),He.resolve()}removeReference(t,i,r){return this.oi.set(r,t.currentSequenceNumber),He.resolve()}updateLimboDocument(t,i){return this.oi.set(i,t.currentSequenceNumber),He.resolve()}Jr(t){let i=t.key.toString().length;return t.isFoundDocument()&&(i+=Mb(t.data.value)),i}ar(t,i,r){return He.or([()=>this.persistence.ei(t,i),()=>this.persistence.getTargetCache().containsKey(t,i),()=>{const n=this.oi.get(i);return He.resolve(n!==void 0&&n>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(t,i,r,n){this.targetId=t,this.fromCache=i,this.Hi=r,this.Ji=n}static Yi(t,i){let r=Ti(),n=Ti();for(const s of i.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:n=n.add(s.doc.key)}return new XD(t,i.fromCache,r,n)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class REe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OEe{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return cxe()?8:oSe(Ss())>0?6:4}()}initialize(t,i){this.ns=t,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(t,i,r,n){const s={result:null};return this.rs(t,i).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ss(t,i,n,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new REe;return this._s(t,i,a).next(o=>{if(s.result=o,this.Xi)return this.us(t,i,a,o.size)})}).next(()=>s.result)}us(t,i,r,n){return r.documentReadCount<this.es?(Ip()<=Ci.DEBUG&&xt("QueryEngine","SDK will not create cache indexes for query:",Rp(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),He.resolve()):(Ip()<=Ci.DEBUG&&xt("QueryEngine","Query:",Rp(i),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ts*n?(Ip()<=Ci.DEBUG&&xt("QueryEngine","The SDK decides to create cache indexes for query:",Rp(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Fl(i))):He.resolve())}rs(t,i){if(H4(i))return He.resolve(null);let r=Fl(i);return this.indexManager.getIndexType(t,r).next(n=>n===0?null:(i.limit!==null&&n===1&&(i=wP(i,null,"F"),r=Fl(i)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{const a=Ti(...s);return this.ns.getDocuments(t,a).next(o=>this.indexManager.getMinOffset(t,r).next(l=>{const u=this.cs(i,o);return this.ls(i,u,a,l.readTime)?this.rs(t,wP(i,null,"F")):this.hs(t,u,i,l)}))})))}ss(t,i,r,n){return H4(i)||n.isEqual(ci.min())?He.resolve(null):this.ns.getDocuments(t,r).next(s=>{const a=this.cs(i,s);return this.ls(i,a,r,n)?He.resolve(null):(Ip()<=Ci.DEBUG&&xt("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Rp(i)),this.hs(t,a,i,iSe(n,Ty)).next(o=>o))})}cs(t,i){let r=new vn(_G(t));return i.forEach((n,s)=>{Q_(t,s)&&(r=r.add(s))}),r}ls(t,i,r,n){if(t.limit===null)return!1;if(r.size!==i.size)return!0;const s=t.limitType==="F"?i.last():i.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}_s(t,i,r){return Ip()<=Ci.DEBUG&&xt("QueryEngine","Using full collection scan to execute query:",Rp(i)),this.ns.getDocumentsMatchingQuery(t,i,Cc.min(),r)}hs(t,i,r,n){return this.ns.getDocumentsMatchingQuery(t,r,n).next(s=>(i.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YD="LocalStore",kEe=3e8;class LEe{constructor(t,i,r,n){this.persistence=t,this.Ps=i,this.serializer=n,this.Ts=new Cr(yi),this.Is=new lf(s=>BD(s),FD),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(r)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new SEe(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>t.collect(i,this.Ts))}}function zEe(e,t,i,r){return new LEe(e,t,i,r)}async function qG(e,t){const i=pi(e);return await i.persistence.runTransaction("Handle user change","readonly",r=>{let n;return i.mutationQueue.getAllMutationBatches(r).next(s=>(n=s,i.As(t),i.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],o=[];let l=Ti();for(const u of n){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return i.localDocuments.getDocuments(r,l).next(u=>({Rs:u,removedBatchIds:a,addedBatchIds:o}))})})}function NEe(e,t){const i=pi(e);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const n=t.batch.keys(),s=i.ds.newChangeBuffer({trackRemovals:!0});return function(o,l,u,h){const c=u.batch,f=c.keys();let m=He.resolve();return f.forEach(g=>{m=m.next(()=>h.getEntry(l,g)).next(y=>{const v=u.docVersions.get(g);Xi(v!==null),y.version.compareTo(v)<0&&(c.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),h.addEntry(y)))})}),m.next(()=>o.mutationQueue.removeMutationBatch(l,c))}(i,r,t,s).next(()=>s.apply(r)).next(()=>i.mutationQueue.performConsistencyCheck(r)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(r,n,t.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let l=Ti();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(t))).next(()=>i.localDocuments.getDocuments(r,n))})}function XG(e){const t=pi(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",i=>t.Hr.getLastRemoteSnapshotVersion(i))}function BEe(e,t){const i=pi(e),r=t.snapshotVersion;let n=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=i.ds.newChangeBuffer({trackRemovals:!0});n=i.Ts;const o=[];t.targetChanges.forEach((h,c)=>{const f=n.get(c);if(!f)return;o.push(i.Hr.removeMatchingKeys(s,h.removedDocuments,c).next(()=>i.Hr.addMatchingKeys(s,h.addedDocuments,c)));let m=f.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(c)!==null?m=m.withResumeToken(ss.EMPTY_BYTE_STRING,ci.min()).withLastLimboFreeSnapshotVersion(ci.min()):h.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(h.resumeToken,r)),n=n.insert(c,m),function(y,v,b){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=kEe?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(f,m,h)&&o.push(i.Hr.updateTargetData(s,m))});let l=$u(),u=Ti();if(t.documentUpdates.forEach(h=>{t.resolvedLimboDocuments.has(h)&&o.push(i.persistence.referenceDelegate.updateLimboDocument(s,h))}),o.push(FEe(s,a,t.documentUpdates).next(h=>{l=h.Vs,u=h.fs})),!r.isEqual(ci.min())){const h=i.Hr.getLastRemoteSnapshotVersion(s).next(c=>i.Hr.setTargetsMetadata(s,s.currentSequenceNumber,r));o.push(h)}return He.waitFor(o).next(()=>a.apply(s)).next(()=>i.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(i.Ts=n,s))}function FEe(e,t,i){let r=Ti(),n=Ti();return i.forEach(s=>r=r.add(s)),t.getEntries(e,r).next(s=>{let a=$u();return i.forEach((o,l)=>{const u=s.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(n=n.add(o)),l.isNoDocument()&&l.version.isEqual(ci.min())?(t.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(t.addEntry(l),a=a.insert(o,l)):xt(YD,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Vs:a,fs:n}})}function UEe(e,t){const i=pi(e);return i.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=LD),i.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function VEe(e,t){const i=pi(e);return i.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return i.Hr.getTargetData(r,t).next(s=>s?(n=s,He.resolve(n)):i.Hr.allocateTargetId(r).next(a=>(n=new cc(t,a,"TargetPurposeListen",r.currentSequenceNumber),i.Hr.addTargetData(r,n).next(()=>n))))}).then(r=>{const n=i.Ts.get(r.targetId);return(n===null||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(r.targetId,r),i.Is.set(t,r.targetId)),r})}async function CP(e,t,i){const r=pi(e),n=r.Ts.get(t),s=i?"readwrite":"readwrite-primary";try{i||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,n))}catch(a){if(!Zm(a))throw a;xt(YD,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ts=r.Ts.remove(t),r.Is.delete(n.target)}function iF(e,t,i){const r=pi(e);let n=ci.min(),s=Ti();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,h){const c=pi(l),f=c.Is.get(h);return f!==void 0?He.resolve(c.Ts.get(f)):c.Hr.getTargetData(u,h)}(r,a,Fl(t)).next(o=>{if(o)return n=o.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>r.Ps.getDocumentsMatchingQuery(a,t,i?n:ci.min(),i?s:Ti())).next(o=>(jEe(r,PSe(t),o),{documents:o,gs:s})))}function jEe(e,t,i){let r=e.Es.get(t)||ci.min();i.forEach((n,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),e.Es.set(t,r)}class rF{constructor(){this.activeTargetIds=kSe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class HEe{constructor(){this.ho=new rF,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,i,r){}addLocalQueryTarget(t,i=!0){return i&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,i,r){this.Po[t]=i}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new rF,Promise.resolve()}handleUserChange(t,i,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GEe{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nF="ConnectivityMonitor";class sF{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){xt(nF,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){xt(nF,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kx=null;function TP(){return Kx===null?Kx=function(){return 268435456+Math.round(2147483648*Math.random())}():Kx++,"0x"+Kx.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JC="RestConnection",WEe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class qEe{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.po=i+"://"+t.host,this.yo=`projects/${r}/databases/${n}`,this.wo=this.databaseId.database===Kw?`project_id=${r}`:`project_id=${r}&database_id=${n}`}So(t,i,r,n,s){const a=TP(),o=this.bo(t,i.toUriEncodedString());xt(JC,`Sending RPC '${t}' ${a}:`,o,r);const l={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(l,n,s),this.vo(t,o,l,r).then(u=>(xt(JC,`Received RPC '${t}' ${a}: `,u),u),u=>{throw Sm(JC,`RPC '${t}' ${a} failed with error: `,u,"url: ",o,"request:",r),u})}Co(t,i,r,n,s,a){return this.So(t,i,r,n,s)}Do(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Qm}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((n,s)=>t[s]=n),r&&r.headers.forEach((n,s)=>t[s]=n)}bo(t,i){const r=WEe[t];return`${this.po}/v1/${i}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XEe{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms="WebChannelConnection";class YEe extends qEe{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,i,r,n){const s=TP();return new Promise((a,o)=>{const l=new KH;l.setWithCredentials(!0),l.listenOnce(ZH.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Pb.NO_ERROR:const h=l.getResponseJson();xt(ms,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(h)),a(h);break;case Pb.TIMEOUT:xt(ms,`RPC '${t}' ${s} timed out`),o(new Qt(Je.DEADLINE_EXCEEDED,"Request time out"));break;case Pb.HTTP_ERROR:const c=l.getStatus();if(xt(ms,`RPC '${t}' ${s} failed with status:`,c,"response text:",l.getResponseText()),c>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const g=function(v){const b=v.toLowerCase().replace(/_/g,"-");return Object.values(Je).indexOf(b)>=0?b:Je.UNKNOWN}(m.status);o(new Qt(g,m.message))}else o(new Qt(Je.UNKNOWN,"Server responded with status "+l.getStatus()))}else o(new Qt(Je.UNAVAILABLE,"Connection failed."));break;default:ai()}}finally{xt(ms,`RPC '${t}' ${s} completed.`)}});const u=JSON.stringify(n);xt(ms,`RPC '${t}' ${s} sending request:`,n),l.send(i,"POST",u,r,15)})}Wo(t,i,r){const n=TP(),s=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=eG(),o=$H(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,i,r),l.encodeInitMessageHeaders=!0;const h=s.join("");xt(ms,`Creating RPC '${t}' stream ${n}: ${h}`,l);const c=a.createWebChannel(h,l);let f=!1,m=!1;const g=new XEe({Fo:v=>{m?xt(ms,`Not sending because RPC '${t}' stream ${n} is closed:`,v):(f||(xt(ms,`Opening RPC '${t}' stream ${n} transport.`),c.open(),f=!0),xt(ms,`RPC '${t}' stream ${n} sending:`,v),c.send(v))},Mo:()=>c.close()}),y=(v,b,S)=>{v.listen(b,_=>{try{S(_)}catch(T){setTimeout(()=>{throw T},0)}})};return y(c,Dv.EventType.OPEN,()=>{m||(xt(ms,`RPC '${t}' stream ${n} transport opened.`),g.Qo())}),y(c,Dv.EventType.CLOSE,()=>{m||(m=!0,xt(ms,`RPC '${t}' stream ${n} transport closed`),g.Uo())}),y(c,Dv.EventType.ERROR,v=>{m||(m=!0,Sm(ms,`RPC '${t}' stream ${n} transport errored:`,v),g.Uo(new Qt(Je.UNAVAILABLE,"The operation could not be completed")))}),y(c,Dv.EventType.MESSAGE,v=>{var b;if(!m){const S=v.data[0];Xi(!!S);const _=S,T=(_==null?void 0:_.error)||((b=_[0])===null||b===void 0?void 0:b.error);if(T){xt(ms,`RPC '${t}' stream ${n} received error:`,T);const M=T.status;let C=function(D){const I=Yr[D];if(I!==void 0)return kG(I)}(M),P=T.message;C===void 0&&(C=Je.INTERNAL,P="Unknown error status: "+M+" with message "+T.message),m=!0,g.Uo(new Qt(C,P)),c.close()}else xt(ms,`RPC '${t}' stream ${n} received:`,S),g.Ko(S)}}),y(o,JH.STAT_EVENT,v=>{v.stat===mP.PROXY?xt(ms,`RPC '${t}' stream ${n} detected buffering proxy`):v.stat===mP.NOPROXY&&xt(ms,`RPC '${t}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{g.$o()},0),g}}function $C(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $_(e){return new JSe(e,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YG{constructor(t,i,r=1e3,n=1.5,s=6e4){this.Ti=t,this.timerId=i,this.Go=r,this.zo=n,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const i=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),n=Math.max(0,i-r);n>0&&xt("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,n,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aF="PersistentStream";class QG{constructor(t,i,r,n,s,a,o,l){this.Ti=t,this.n_=r,this.r_=n,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new YG(t,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():i&&i.code===Je.RESOURCE_EXHAUSTED?(Ju(i.toString()),Ju("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===Je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,n])=>{this.i_===i&&this.V_(r,n)},r=>{t(()=>{const n=new Qt(Je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(n)})})}V_(t,i){const r=this.R_(this.i_);this.stream=this.f_(t,i),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(n=>{r(()=>this.m_(n))}),this.stream.onMessage(n=>{r(()=>++this.__==1?this.g_(n):this.onNext(n))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return xt(aF,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return i=>{this.Ti.enqueueAndForget(()=>this.i_===t?i():(xt(aF,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QEe extends QG{constructor(t,i,r,n,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,r,n,a),this.serializer=s}f_(t,i){return this.connection.Wo("Listen",t,i)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const i=tEe(this.serializer,t),r=function(s){if(!("targetChange"in s))return ci.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ci.min():a.readTime?Ul(a.readTime):ci.min()}(t);return this.listener.p_(i,r)}y_(t){const i={};i.database=AP(this.serializer),i.addTarget=function(s,a){let o;const l=a.target;if(o=bP(l)?{documents:nEe(s,l)}:{query:sEe(s,l).ht},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=NG(s,a.resumeToken);const u=_P(s,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(ci.min())>0){o.readTime=i_(s,a.snapshotVersion.toTimestamp());const u=_P(s,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,t);const r=oEe(this.serializer,t);r&&(i.labels=r),this.I_(i)}w_(t){const i={};i.database=AP(this.serializer),i.removeTarget=t,this.I_(i)}}class KEe extends QG{constructor(t,i,r,n,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,r,n,a),this.serializer=s}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,i){return this.connection.Wo("Write",t,i)}g_(t){return Xi(!!t.streamToken),this.lastStreamToken=t.streamToken,Xi(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){Xi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const i=rEe(t.writeResults,t.commitTime),r=Ul(t.commitTime);return this.listener.v_(r,i)}C_(){const t={};t.database=AP(this.serializer),this.I_(t)}b_(t){const i={streamToken:this.lastStreamToken,writes:t.map(r=>iEe(this.serializer,r))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZEe{}class JEe extends ZEe{constructor(t,i,r,n){super(),this.authCredentials=t,this.appCheckCredentials=i,this.connection=r,this.serializer=n,this.F_=!1}M_(){if(this.F_)throw new Qt(Je.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,i,r,n){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.So(t,SP(i,r),n,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===Je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Qt(Je.UNKNOWN,s.toString())})}Co(t,i,r,n,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Co(t,SP(i,r),n,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===Je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Qt(Je.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class $Ee{constructor(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const i=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Ju(i),this.N_=!1):xt("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d="RemoteStore";class eAe{constructor(t,i,r,n,s){this.localStore=t,this.datastore=i,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(a=>{r.enqueueAndForget(async()=>{hf(this)&&(xt($d,"Restarting streams for network reachability change."),await async function(l){const u=pi(l);u.W_.add(4),await h0(u),u.j_.set("Unknown"),u.W_.delete(4),await eS(u)}(this))})}),this.j_=new $Ee(r,n)}}async function eS(e){if(hf(e))for(const t of e.G_)await t(!0)}async function h0(e){for(const t of e.G_)await t(!1)}function KG(e,t){const i=pi(e);i.K_.has(t.targetId)||(i.K_.set(t.targetId,t),JD(i)?ZD(i):Jm(i).c_()&&KD(i,t))}function QD(e,t){const i=pi(e),r=Jm(i);i.K_.delete(t),r.c_()&&ZG(i,t),i.K_.size===0&&(r.c_()?r.P_():hf(i)&&i.j_.set("Unknown"))}function KD(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ci.min())>0){const i=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(i)}Jm(e).y_(t)}function ZG(e,t){e.H_.Ne(t),Jm(e).w_(t)}function ZD(e){e.H_=new YSe({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.K_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),Jm(e).start(),e.j_.B_()}function JD(e){return hf(e)&&!Jm(e).u_()&&e.K_.size>0}function hf(e){return pi(e).W_.size===0}function JG(e){e.H_=void 0}async function tAe(e){e.j_.set("Online")}async function iAe(e){e.K_.forEach((t,i)=>{KD(e,t)})}async function rAe(e,t){JG(e),JD(e)?(e.j_.q_(t),ZD(e)):e.j_.set("Unknown")}async function nAe(e,t,i){if(e.j_.set("Online"),t instanceof zG&&t.state===2&&t.cause)try{await async function(n,s){const a=s.cause;for(const o of s.targetIds)n.K_.has(o)&&(await n.remoteSyncer.rejectListen(o,a),n.K_.delete(o),n.H_.removeTarget(o))}(e,t)}catch(r){xt($d,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await n_(e,r)}else if(t instanceof Rb?e.H_.We(t):t instanceof LG?e.H_.Ze(t):e.H_.je(t),!i.isEqual(ci.min()))try{const r=await XG(e.localStore);i.compareTo(r)>=0&&await function(s,a){const o=s.H_.ot(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=s.K_.get(u);h&&s.K_.set(u,h.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const h=s.K_.get(l);if(!h)return;s.K_.set(l,h.withResumeToken(ss.EMPTY_BYTE_STRING,h.snapshotVersion)),ZG(s,l);const c=new cc(h.target,l,u,h.sequenceNumber);KD(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(e,i)}catch(r){xt($d,"Failed to raise snapshot:",r),await n_(e,r)}}async function n_(e,t,i){if(!Zm(t))throw t;e.W_.add(1),await h0(e),e.j_.set("Offline"),i||(i=()=>XG(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{xt($d,"Retrying IndexedDB access"),await i(),e.W_.delete(1),await eS(e)})}function $G(e,t){return t().catch(i=>n_(e,i,t))}async function tS(e){const t=pi(e),i=Dc(t);let r=t.U_.length>0?t.U_[t.U_.length-1].batchId:LD;for(;sAe(t);)try{const n=await UEe(t.localStore,r);if(n===null){t.U_.length===0&&i.P_();break}r=n.batchId,aAe(t,n)}catch(n){await n_(t,n)}e9(t)&&t9(t)}function sAe(e){return hf(e)&&e.U_.length<10}function aAe(e,t){e.U_.push(t);const i=Dc(e);i.c_()&&i.S_&&i.b_(t.mutations)}function e9(e){return hf(e)&&!Dc(e).u_()&&e.U_.length>0}function t9(e){Dc(e).start()}async function oAe(e){Dc(e).C_()}async function lAe(e){const t=Dc(e);for(const i of e.U_)t.b_(i.mutations)}async function uAe(e,t,i){const r=e.U_.shift(),n=jD.from(r,t,i);await $G(e,()=>e.remoteSyncer.applySuccessfulWrite(n)),await tS(e)}async function hAe(e,t){t&&Dc(e).S_&&await async function(r,n){if(function(a){return qSe(a)&&a!==Je.ABORTED}(n.code)){const s=r.U_.shift();Dc(r).h_(),await $G(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,n)),await tS(r)}}(e,t),e9(e)&&t9(e)}async function oF(e,t){const i=pi(e);i.asyncQueue.verifyOperationInProgress(),xt($d,"RemoteStore received new credentials");const r=hf(i);i.W_.add(3),await h0(i),r&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(t),i.W_.delete(3),await eS(i)}async function cAe(e,t){const i=pi(e);t?(i.W_.delete(2),await eS(i)):t||(i.W_.add(2),await h0(i),i.j_.set("Unknown"))}function Jm(e){return e.J_||(e.J_=function(i,r,n){const s=pi(i);return s.M_(),new QEe(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{xo:tAe.bind(null,e),No:iAe.bind(null,e),Lo:rAe.bind(null,e),p_:nAe.bind(null,e)}),e.G_.push(async t=>{t?(e.J_.h_(),JD(e)?ZD(e):e.j_.set("Unknown")):(await e.J_.stop(),JG(e))})),e.J_}function Dc(e){return e.Y_||(e.Y_=function(i,r,n){const s=pi(i);return s.M_(),new KEe(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{xo:()=>Promise.resolve(),No:oAe.bind(null,e),Lo:hAe.bind(null,e),D_:lAe.bind(null,e),v_:uAe.bind(null,e)}),e.G_.push(async t=>{t?(e.Y_.h_(),await tS(e)):(await e.Y_.stop(),e.U_.length>0&&(xt($d,`Stopping write stream with ${e.U_.length} pending writes`),e.U_=[]))})),e.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(t,i,r,n,s){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=r,this.op=n,this.removalCallback=s,this.deferred=new wc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,i,r,n,s){const a=Date.now()+r,o=new $D(t,i,a,n,s);return o.start(r),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Qt(Je.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function eI(e,t){if(Ju("AsyncQueue",`${t}: ${e}`),Zm(e))return new Qt(Je.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{static emptySet(t){return new am(t.comparator)}constructor(t){this.comparator=t?(i,r)=>t(i,r)||Kt.comparator(i.key,r.key):(i,r)=>Kt.comparator(i.key,r.key),this.keyedMap=Iv(),this.sortedSet=new Cr(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((i,r)=>(t(i),!1))}add(t){const i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))}delete(t){const i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this}isEqual(t){if(!(t instanceof am)||this.size!==t.size)return!1;const i=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;i.hasNext();){const n=i.getNext().key,s=r.getNext().key;if(!n.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(i=>{t.push(i.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,i){const r=new am;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=i,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(){this.Z_=new Cr(Kt.comparator)}track(t){const i=t.doc.key,r=this.Z_.get(i);r?t.type!==0&&r.type===3?this.Z_=this.Z_.insert(i,t):t.type===3&&r.type!==1?this.Z_=this.Z_.insert(i,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Z_=this.Z_.remove(i):t.type===1&&r.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):ai():this.Z_=this.Z_.insert(i,t)}X_(){const t=[];return this.Z_.inorderTraversal((i,r)=>{t.push(r)}),t}}class Pm{constructor(t,i,r,n,s,a,o,l,u){this.query=t,this.docs=i,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(t,i,r,n,s){const a=[];return i.forEach(o=>{a.push({type:0,doc:o})}),new Pm(t,i,am.emptySet(i),a,r,n,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Y_(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const i=this.docChanges,r=t.docChanges;if(i.length!==r.length)return!1;for(let n=0;n<i.length;n++)if(i[n].type!==r[n].type||!i[n].doc.isEqual(r[n].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dAe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class fAe{constructor(){this.queries=uF(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,r){const n=pi(i),s=n.queries;n.queries=uF(),s.forEach((a,o)=>{for(const l of o.ta)l.onError(r)})})(this,new Qt(Je.ABORTED,"Firestore shutting down"))}}function uF(){return new lf(e=>wG(e),Y_)}async function pAe(e,t){const i=pi(e);let r=3;const n=t.query;let s=i.queries.get(n);s?!s.na()&&t.ra()&&(r=2):(s=new dAe,r=t.ra()?0:1);try{switch(r){case 0:s.ea=await i.onListen(n,!0);break;case 1:s.ea=await i.onListen(n,!1);break;case 2:await i.onFirstRemoteStoreListen(n)}}catch(a){const o=eI(a,`Initialization of query '${Rp(t.query)}' failed`);return void t.onError(o)}i.queries.set(n,s),s.ta.push(t),t.sa(i.onlineState),s.ea&&t.oa(s.ea)&&tI(i)}async function mAe(e,t){const i=pi(e),r=t.query;let n=3;const s=i.queries.get(r);if(s){const a=s.ta.indexOf(t);a>=0&&(s.ta.splice(a,1),s.ta.length===0?n=t.ra()?0:1:!s.na()&&t.ra()&&(n=2))}switch(n){case 0:return i.queries.delete(r),i.onUnlisten(r,!0);case 1:return i.queries.delete(r),i.onUnlisten(r,!1);case 2:return i.onLastRemoteStoreUnlisten(r);default:return}}function gAe(e,t){const i=pi(e);let r=!1;for(const n of t){const s=n.query,a=i.queries.get(s);if(a){for(const o of a.ta)o.oa(n)&&(r=!0);a.ea=n}}r&&tI(i)}function vAe(e,t,i){const r=pi(e),n=r.queries.get(t);if(n)for(const s of n.ta)s.onError(i);r.queries.delete(t)}function tI(e){e.ia.forEach(t=>{t.next()})}var PP,hF;(hF=PP||(PP={}))._a="default",hF.Cache="cache";class yAe{constructor(t,i,r){this.query=t,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(t){if(!this.options.includeMetadataChanges){const r=[];for(const n of t.docChanges)n.type!==3&&r.push(n);t=new Pm(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let i=!1;return this.ua?this.la(t)&&(this.aa.next(t),i=!0):this.ha(t,this.onlineState)&&(this.Pa(t),i=!0),this.ca=t,i}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),i=!0),i}ha(t,i){if(!t.fromCache||!this.ra())return!0;const r=i!=="Offline";return(!this.options.Ta||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||i==="Offline")}la(t){if(t.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(t){t=Pm.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==PP.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i9{constructor(t){this.key=t}}class r9{constructor(t){this.key=t}}class xAe{constructor(t,i){this.query=t,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Ti(),this.mutatedKeys=Ti(),this.ya=_G(t),this.wa=new am(this.ya)}get Sa(){return this.fa}ba(t,i){const r=i?i.Da:new lF,n=i?i.wa:this.wa;let s=i?i.mutatedKeys:this.mutatedKeys,a=n,o=!1;const l=this.query.limitType==="F"&&n.size===this.query.limit?n.last():null,u=this.query.limitType==="L"&&n.size===this.query.limit?n.first():null;if(t.inorderTraversal((h,c)=>{const f=n.get(h),m=Q_(this.query,c)?c:null,g=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let v=!1;f&&m?f.data.isEqual(m.data)?g!==y&&(r.track({type:3,doc:m}),v=!0):this.va(f,m)||(r.track({type:2,doc:m}),v=!0,(l&&this.ya(m,l)>0||u&&this.ya(m,u)<0)&&(o=!0)):!f&&m?(r.track({type:0,doc:m}),v=!0):f&&!m&&(r.track({type:1,doc:f}),v=!0,(l||u)&&(o=!0)),v&&(m?(a=a.add(m),s=y?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{wa:a,Da:r,ls:o,mutatedKeys:s}}va(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(t,i,r,n){const s=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const a=t.Da.X_();a.sort((h,c)=>function(m,g){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ai()}};return y(m)-y(g)}(h.type,c.type)||this.ya(h.doc,c.doc)),this.Ca(r),n=n!=null&&n;const o=i&&!n?this.Fa():[],l=this.pa.size===0&&this.current&&!n?1:0,u=l!==this.ga;return this.ga=l,a.length!==0||u?{snapshot:new Pm(this.query,t.wa,s,a,t.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:o}:{Ma:o}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new lF,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),t.modifiedDocuments.forEach(i=>{}),t.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Ti(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const i=[];return t.forEach(r=>{this.pa.has(r)||i.push(new r9(r))}),this.pa.forEach(r=>{t.has(r)||i.push(new i9(r))}),i}Oa(t){this.fa=t.gs,this.pa=Ti();const i=this.ba(t.documents);return this.applyChanges(i,!0)}Na(){return Pm.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const iI="SyncEngine";class bAe{constructor(t,i,r){this.query=t,this.targetId=i,this.view=r}}class wAe{constructor(t){this.key=t,this.Ba=!1}}class _Ae{constructor(t,i,r,n,s,a){this.localStore=t,this.remoteStore=i,this.eventManager=r,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new lf(o=>wG(o),Y_),this.qa=new Map,this.Qa=new Set,this.$a=new Cr(Kt.comparator),this.Ua=new Map,this.Ka=new WD,this.Wa={},this.Ga=new Map,this.za=Tm.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function SAe(e,t,i=!0){const r=u9(e);let n;const s=r.ka.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.Na()):n=await n9(r,t,i,!0),n}async function EAe(e,t){const i=u9(e);await n9(i,t,!0,!1)}async function n9(e,t,i,r){const n=await VEe(e.localStore,Fl(t)),s=n.targetId,a=e.sharedClientState.addLocalQueryTarget(s,i);let o;return r&&(o=await AAe(e,t,s,a==="current",n.resumeToken)),e.isPrimaryClient&&i&&KG(e.remoteStore,n),o}async function AAe(e,t,i,r,n){e.Ha=(c,f,m)=>async function(y,v,b,S){let _=v.view.ba(b);_.ls&&(_=await iF(y.localStore,v.query,!1).then(({documents:P})=>v.view.ba(P,_)));const T=S&&S.targetChanges.get(v.targetId),M=S&&S.targetMismatches.get(v.targetId)!=null,C=v.view.applyChanges(_,y.isPrimaryClient,T,M);return dF(y,v.targetId,C.Ma),C.snapshot}(e,c,f,m);const s=await iF(e.localStore,t,!0),a=new xAe(t,s.gs),o=a.ba(s.documents),l=u0.createSynthesizedTargetChangeForCurrentChange(i,r&&e.onlineState!=="Offline",n),u=a.applyChanges(o,e.isPrimaryClient,l);dF(e,i,u.Ma);const h=new bAe(t,i,a);return e.ka.set(t,h),e.qa.has(i)?e.qa.get(i).push(t):e.qa.set(i,[t]),u.snapshot}async function CAe(e,t,i){const r=pi(e),n=r.ka.get(t),s=r.qa.get(n.targetId);if(s.length>1)return r.qa.set(n.targetId,s.filter(a=>!Y_(a,t))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(n.targetId),r.sharedClientState.isActiveQueryTarget(n.targetId)||await CP(r.localStore,n.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(n.targetId),i&&QD(r.remoteStore,n.targetId),MP(r,n.targetId)}).catch(Km)):(MP(r,n.targetId),await CP(r.localStore,n.targetId,!0))}async function TAe(e,t){const i=pi(e),r=i.ka.get(t),n=i.qa.get(r.targetId);i.isPrimaryClient&&n.length===1&&(i.sharedClientState.removeLocalQueryTarget(r.targetId),QD(i.remoteStore,r.targetId))}async function PAe(e,t,i){const r=LAe(e);try{const n=await function(a,o){const l=pi(a),u=gn.now(),h=o.reduce((m,g)=>m.add(g.key),Ti());let c,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let g=$u(),y=Ti();return l.ds.getEntries(m,h).next(v=>{g=v,g.forEach((b,S)=>{S.isValidDocument()||(y=y.add(b))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,g)).next(v=>{c=v;const b=[];for(const S of o){const _=VSe(S,c.get(S.key).overlayedDocument);_!=null&&b.push(new uf(S.key,_,pG(_.value.mapValue),ju.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,b,o)}).next(v=>{f=v;const b=v.applyToLocalDocumentSet(c,y);return l.documentOverlayCache.saveOverlays(m,v.batchId,b)})}).then(()=>({batchId:f.batchId,changes:EG(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(n.batchId),function(a,o,l){let u=a.Wa[a.currentUser.toKey()];u||(u=new Cr(yi)),u=u.insert(o,l),a.Wa[a.currentUser.toKey()]=u}(r,n.batchId,i),await c0(r,n.changes),await tS(r.remoteStore)}catch(n){const s=eI(n,"Failed to persist write");i.reject(s)}}async function s9(e,t){const i=pi(e);try{const r=await BEe(i.localStore,t);t.targetChanges.forEach((n,s)=>{const a=i.Ua.get(s);a&&(Xi(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1),n.addedDocuments.size>0?a.Ba=!0:n.modifiedDocuments.size>0?Xi(a.Ba):n.removedDocuments.size>0&&(Xi(a.Ba),a.Ba=!1))}),await c0(i,r,t)}catch(r){await Km(r)}}function cF(e,t,i){const r=pi(e);if(r.isPrimaryClient&&i===0||!r.isPrimaryClient&&i===1){const n=[];r.ka.forEach((s,a)=>{const o=a.view.sa(t);o.snapshot&&n.push(o.snapshot)}),function(a,o){const l=pi(a);l.onlineState=o;let u=!1;l.queries.forEach((h,c)=>{for(const f of c.ta)f.sa(o)&&(u=!0)}),u&&tI(l)}(r.eventManager,t),n.length&&r.La.p_(n),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function MAe(e,t,i){const r=pi(e);r.sharedClientState.updateQueryState(t,"rejected",i);const n=r.Ua.get(t),s=n&&n.key;if(s){let a=new Cr(Kt.comparator);a=a.insert(s,ys.newNoDocument(s,ci.min()));const o=Ti().add(s),l=new J_(ci.min(),new Map,new Cr(yi),a,o);await s9(r,l),r.$a=r.$a.remove(s),r.Ua.delete(t),rI(r)}else await CP(r.localStore,t,!1).then(()=>MP(r,t,i)).catch(Km)}async function DAe(e,t){const i=pi(e),r=t.batch.batchId;try{const n=await NEe(i.localStore,t);o9(i,r,null),a9(i,r),i.sharedClientState.updateMutationState(r,"acknowledged"),await c0(i,n)}catch(n){await Km(n)}}async function IAe(e,t,i){const r=pi(e);try{const n=await function(a,o){const l=pi(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,o).next(c=>(Xi(c!==null),h=c.keys(),l.mutationQueue.removeMutationBatch(u,c))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,t);o9(r,t,i),a9(r,t),r.sharedClientState.updateMutationState(t,"rejected",i),await c0(r,n)}catch(n){await Km(n)}}function a9(e,t){(e.Ga.get(t)||[]).forEach(i=>{i.resolve()}),e.Ga.delete(t)}function o9(e,t,i){const r=pi(e);let n=r.Wa[r.currentUser.toKey()];if(n){const s=n.get(t);s&&(i?s.reject(i):s.resolve(),n=n.remove(t)),r.Wa[r.currentUser.toKey()]=n}}function MP(e,t,i=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.qa.get(t))e.ka.delete(r),i&&e.La.Ja(r,i);e.qa.delete(t),e.isPrimaryClient&&e.Ka.br(t).forEach(r=>{e.Ka.containsKey(r)||l9(e,r)})}function l9(e,t){e.Qa.delete(t.path.canonicalString());const i=e.$a.get(t);i!==null&&(QD(e.remoteStore,i),e.$a=e.$a.remove(t),e.Ua.delete(i),rI(e))}function dF(e,t,i){for(const r of i)r instanceof i9?(e.Ka.addReference(r.key,t),RAe(e,r)):r instanceof r9?(xt(iI,"Document no longer in limbo: "+r.key),e.Ka.removeReference(r.key,t),e.Ka.containsKey(r.key)||l9(e,r.key)):ai()}function RAe(e,t){const i=t.key,r=i.path.canonicalString();e.$a.get(i)||e.Qa.has(r)||(xt(iI,"New document in limbo: "+i),e.Qa.add(r),rI(e))}function rI(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){const t=e.Qa.values().next().value;e.Qa.delete(t);const i=new Kt(Rr.fromString(t)),r=e.za.next();e.Ua.set(r,new wAe(i)),e.$a=e.$a.insert(i,r),KG(e.remoteStore,new cc(Fl(UD(i.path)),r,"TargetPurposeLimboResolution",G_.ae))}}async function c0(e,t,i){const r=pi(e),n=[],s=[],a=[];r.ka.isEmpty()||(r.ka.forEach((o,l)=>{a.push(r.Ha(l,t,i).then(u=>{var h;if((u||i)&&r.isPrimaryClient){const c=u?!u.fromCache:(h=i==null?void 0:i.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,c?"current":"not-current")}if(u){n.push(u);const c=XD.Yi(l.targetId,u);s.push(c)}}))}),await Promise.all(a),r.La.p_(n),await async function(l,u){const h=pi(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>He.forEach(u,f=>He.forEach(f.Hi,m=>h.persistence.referenceDelegate.addReference(c,f.targetId,m)).next(()=>He.forEach(f.Ji,m=>h.persistence.referenceDelegate.removeReference(c,f.targetId,m)))))}catch(c){if(!Zm(c))throw c;xt(YD,"Failed to update sequence numbers: "+c)}for(const c of u){const f=c.targetId;if(!c.fromCache){const m=h.Ts.get(f),g=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(g);h.Ts=h.Ts.insert(f,y)}}}(r.localStore,s))}async function OAe(e,t){const i=pi(e);if(!i.currentUser.isEqual(t)){xt(iI,"User change. New user:",t.toKey());const r=await qG(i.localStore,t);i.currentUser=t,function(s,a){s.Ga.forEach(o=>{o.forEach(l=>{l.reject(new Qt(Je.CANCELLED,a))})}),s.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await c0(i,r.Rs)}}function kAe(e,t){const i=pi(e),r=i.Ua.get(t);if(r&&r.Ba)return Ti().add(r.key);{let n=Ti();const s=i.qa.get(t);if(!s)return n;for(const a of s){const o=i.ka.get(a);n=n.unionWith(o.view.Sa)}return n}}function u9(e){const t=pi(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=s9.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=kAe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=MAe.bind(null,t),t.La.p_=gAe.bind(null,t.eventManager),t.La.Ja=vAe.bind(null,t.eventManager),t}function LAe(e){const t=pi(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=DAe.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=IAe.bind(null,t),t}class s_{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=$_(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,i){return null}nu(t,i){return null}eu(t){return zEe(this.persistence,new OEe,t.initialUser,this.serializer)}Xa(t){return new WG(qD.ri,this.serializer)}Za(t){return new HEe}async terminate(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}s_.provider={build:()=>new s_};class zAe extends s_{constructor(t){super(),this.cacheSizeBytes=t}tu(t,i){Xi(this.persistence.referenceDelegate instanceof r_);const r=this.persistence.referenceDelegate.garbageCollector;return new yEe(r,t.asyncQueue,i)}Xa(t){const i=this.cacheSizeBytes!==void 0?ta.withCacheSize(this.cacheSizeBytes):ta.DEFAULT;return new WG(r=>r_.ri(r,i),this.serializer)}}class DP{async initialize(t,i){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>cF(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=OAe.bind(null,this.syncEngine),await cAe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new fAe}()}createDatastore(t){const i=$_(t.databaseInfo.databaseId),r=function(s){return new YEe(s)}(t.databaseInfo);return function(s,a,o,l){return new JEe(s,a,o,l)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,n,s,a,o){return new eAe(r,n,s,a,o)}(this.localStore,this.datastore,t.asyncQueue,i=>cF(this.syncEngine,i,0),function(){return sF.D()?new sF:new GEe}())}createSyncEngine(t,i){return function(n,s,a,o,l,u,h){const c=new _Ae(n,s,a,o,l,u);return h&&(c.ja=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}async terminate(){var t,i;await async function(n){const s=pi(n);xt($d,"RemoteStore shutting down."),s.W_.add(5),await h0(s),s.z_.shutdown(),s.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}DP.provider={build:()=>new DP};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NAe{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Ju("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,i){setTimeout(()=>{this.muted||t(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic="FirestoreClient";class BAe{constructor(t,i,r,n,s){this.authCredentials=t,this.appCheckCredentials=i,this.asyncQueue=r,this.databaseInfo=n,this.user=gs.UNAUTHENTICATED,this.clientId=rG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{xt(Ic,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(xt(Ic,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new wc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(i){const r=eI(i,"Failed to shutdown persistence");t.reject(r)}}),t.promise}}async function eT(e,t){e.asyncQueue.verifyOperationInProgress(),xt(Ic,"Initializing OfflineComponentProvider");const i=e.configuration;await t.initialize(i);let r=i.initialUser;e.setCredentialChangeListener(async n=>{r.isEqual(n)||(await qG(t.localStore,n),r=n)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function fF(e,t){e.asyncQueue.verifyOperationInProgress();const i=await FAe(e);xt(Ic,"Initializing OnlineComponentProvider"),await t.initialize(i,e.configuration),e.setCredentialChangeListener(r=>oF(t.remoteStore,r)),e.setAppCheckTokenChangeListener((r,n)=>oF(t.remoteStore,n)),e._onlineComponents=t}async function FAe(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){xt(Ic,"Using user provided OfflineComponentProvider");try{await eT(e,e._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!function(n){return n.name==="FirebaseError"?n.code===Je.FAILED_PRECONDITION||n.code===Je.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}(i))throw i;Sm("Error using user provided cache. Falling back to memory cache: "+i),await eT(e,new s_)}}else xt(Ic,"Using default OfflineComponentProvider"),await eT(e,new zAe(void 0));return e._offlineComponents}async function h9(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(xt(Ic,"Using user provided OnlineComponentProvider"),await fF(e,e._uninitializedComponentsProvider._online)):(xt(Ic,"Using default OnlineComponentProvider"),await fF(e,new DP))),e._onlineComponents}function UAe(e){return h9(e).then(t=>t.syncEngine)}async function VAe(e){const t=await h9(e),i=t.eventManager;return i.onListen=SAe.bind(null,t.syncEngine),i.onUnlisten=CAe.bind(null,t.syncEngine),i.onFirstRemoteStoreListen=EAe.bind(null,t.syncEngine),i.onLastRemoteStoreUnlisten=TAe.bind(null,t.syncEngine),i}function jAe(e,t,i={}){const r=new wc;return e.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const h=new NAe({next:f=>{h.su(),a.enqueueAndForget(()=>mAe(s,c));const m=f.docs.has(o);!m&&f.fromCache?u.reject(new Qt(Je.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?u.reject(new Qt(Je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),c=new yAe(UD(o.path),h,{includeMetadataChanges:!0,Ta:!0});return pAe(s,c)}(await VAe(e),e.asyncQueue,t,i,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c9(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pF=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HAe(e,t,i){if(!i)throw new Qt(Je.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function GAe(e,t,i,r){if(t===!0&&r===!0)throw new Qt(Je.INVALID_ARGUMENT,`${e} and ${i} cannot be used together.`)}function mF(e){if(!Kt.isDocumentKey(e))throw new Qt(Je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function nI(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=function(r){return r.constructor?r.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":ai()}function Oy(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Qt(Je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=nI(e);throw new Qt(Je.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${i}`)}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d9="firestore.googleapis.com",gF=!0;class vF{constructor(t){var i,r;if(t.host===void 0){if(t.ssl!==void 0)throw new Qt(Je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=d9,this.ssl=gF}else this.host=t.host,this.ssl=(i=t.ssl)!==null&&i!==void 0?i:gF;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=GG;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<gEe)throw new Qt(Je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}GAe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=c9((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Qt(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Qt(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Qt(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,n){return r.timeoutSeconds===n.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class sI{constructor(t,i,r,n){this._authCredentials=t,this._appCheckCredentials=i,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vF({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Qt(Je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Qt(Je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vF(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new X_e;switch(r.type){case"firstParty":return new Z_e(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Qt(Je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const r=pF.get(i);r&&(xt("ComponentProvider","Removing Datastore"),pF.delete(i),r.terminate())}(this),Promise.resolve()}}function WAe(e,t,i,r={}){var n;const s=(e=Oy(e,sI))._getSettings(),a=Object.assign(Object.assign({},s),{emulatorOptions:e._getEmulatorOptions()}),o=`${t}:${i}`;s.host!==d9&&s.host!==o&&Sm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},s),{host:o,ssl:!1,emulatorOptions:r});if(!Xd(l,a)&&(e._setSettings(l),r.mockUserToken)){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=gs.MOCK_USER;else{u=nxe(r.mockUserToken,(n=e._app)===null||n===void 0?void 0:n.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new Qt(Je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new gs(c)}e._authCredentials=new Y_e(new tG(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(t,i,r){this.converter=i,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new aI(this.firestore,t,this._query)}}class io{constructor(t,i,r){this.converter=i,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ky(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new io(this.firestore,t,this._key)}}class ky extends aI{constructor(t,i,r){super(t,i,UD(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new io(this.firestore,null,new Kt(t))}withConverter(t){return new ky(this.firestore,t,this._path)}}function Ly(e,t,...i){if(e=Hs(e),arguments.length===1&&(t=rG.newId()),HAe("doc","path",t),e instanceof sI){const r=Rr.fromString(t,...i);return mF(r),new io(e,null,new Kt(r))}{if(!(e instanceof io||e instanceof ky))throw new Qt(Je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Rr.fromString(t,...i));return mF(r),new io(e.firestore,e instanceof ky?e.converter:null,new Kt(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF="AsyncQueue";class xF{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new YG(this,"async_queue_retry"),this.Su=()=>{const r=$C();r&&xt(yF,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=t;const i=$C();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const i=$C();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const i=new wc;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!Zm(t))throw t;xt(yF,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const i=this.bu.then(()=>(this.pu=!0,t().catch(r=>{this.gu=r,this.pu=!1;const n=function(a){let o=a.message||"";return a.stack&&(o=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),o}(r);throw Ju("INTERNAL UNHANDLED ERROR: ",n),r}).then(r=>(this.pu=!1,r))));return this.bu=i,i}enqueueAfterDelay(t,i,r){this.Du(),this.wu.indexOf(t)>-1&&(i=0);const n=$D.createAndSchedule(this,t,i,r,s=>this.Fu(s));return this.fu.push(n),n}Du(){this.gu&&ai()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const i of this.fu)if(i.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((i,r)=>i.targetTimeMs-r.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),t!=="all"&&i.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const i=this.fu.indexOf(t);this.fu.splice(i,1)}}class oI extends sI{constructor(t,i,r,n){super(t,i,r,n),this.type="firestore",this._queue=new xF,this._persistenceKey=(n==null?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new xF(t),this._firestoreClient=void 0,await t}}}function qAe(e,t){const i=typeof e=="object"?e:cH(),r=typeof e=="string"?e:Kw,n=ED(i,"firestore").getImmediate({identifier:r});if(!n._initialized){const s=ixe("firestore");s&&WAe(n,...s)}return n}function f9(e){if(e._terminated)throw new Qt(Je.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||XAe(e),e._firestoreClient}function XAe(e){var t,i,r;const n=e._freezeSettings(),s=function(o,l,u,h){return new dSe(o,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,c9(h.experimentalLongPollingOptions),h.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._componentsProvider||!((i=n.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((r=n.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(e._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),e._firestoreClient=new BAe(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(o){const l=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(l),_online:l}}(e._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Mm(ss.fromBase64String(t))}catch(i){throw new Qt(Je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(t){return new Mm(ss.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{constructor(...t){for(let i=0;i<t.length;++i)if(t[i].length===0)throw new Qt(Je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new es(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p9{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(t,i){if(!isFinite(t)||t<-90||t>90)throw new Qt(Je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new Qt(Je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return yi(this._lat,t._lat)||yi(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{constructor(t){this._values=(t||[]).map(i=>i)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,n){if(r.length!==n.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==n[s])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YAe=/^__.*__$/;class QAe{constructor(t,i,r){this.data=t,this.fieldMask=i,this.fieldTransforms=r}toMutation(t,i){return this.fieldMask!==null?new uf(t,this.data,this.fieldMask,i,this.fieldTransforms):new l0(t,this.data,i,this.fieldTransforms)}}function m9(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ai()}}class cI{constructor(t,i,r,n,s,a){this.settings=t,this.databaseId=i,this.serializer=r,this.ignoreUndefinedProperties=n,s===void 0&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new cI(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var i;const r=(i=this.path)===null||i===void 0?void 0:i.child(t),n=this.ku({path:r,Qu:!1});return n.$u(t),n}Uu(t){var i;const r=(i=this.path)===null||i===void 0?void 0:i.child(t),n=this.ku({path:r,Qu:!1});return n.Bu(),n}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return a_(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(i=>t.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>t.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(m9(this.Lu)&&YAe.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class KAe{constructor(t,i,r){this.databaseId=t,this.ignoreUndefinedProperties=i,this.serializer=r||$_(t)}ju(t,i,r,n=!1){return new cI({Lu:t,methodName:i,zu:r,path:es.emptyPath(),Qu:!1,Gu:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ZAe(e){const t=e._freezeSettings(),i=$_(e._databaseId);return new KAe(e._databaseId,!!t.ignoreUndefinedProperties,i)}function JAe(e,t,i,r,n,s={}){const a=e.ju(s.merge||s.mergeFields?2:0,t,i,n);x9("Data must be an object, but it was:",a,r);const o=v9(r,a);let l,u;if(s.merge)l=new No(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const h=[];for(const c of s.mergeFields){const f=$Ae(t,c,i);if(!a.contains(f))throw new Qt(Je.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);tCe(h,f)||h.push(f)}l=new No(h),u=a.fieldTransforms.filter(c=>l.covers(c.field))}else l=null,u=a.fieldTransforms;return new QAe(new Za(o),l,u)}function g9(e,t){if(y9(e=Hs(e)))return x9("Unsupported field value:",t,e),v9(e,t);if(e instanceof p9)return function(r,n){if(!m9(n.Lu))throw n.Wu(`${r._methodName}() can only be used with update() and set()`);if(!n.path)throw n.Wu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(n);s&&n.fieldTransforms.push(s)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(r,n){const s=[];let a=0;for(const o of r){let l=g9(o,n.Ku(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(e,t)}return function(r,n){if((r=Hs(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return LSe(n.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=gn.fromDate(r);return{timestampValue:i_(n.serializer,s)}}if(r instanceof gn){const s=new gn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:i_(n.serializer,s)}}if(r instanceof uI)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Mm)return{bytesValue:NG(n.serializer,r._byteString)};if(r instanceof io){const s=n.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw n.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:GD(r.firestore._databaseId||n.databaseId,r._key.path)}}if(r instanceof hI)return function(a,o){return{mapValue:{fields:{[cG]:{stringValue:fG},[Zw]:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw o.Wu("VectorValues must only contain numeric values.");return VD(o.serializer,u)})}}}}}}(r,n);throw n.Wu(`Unsupported field value: ${nI(r)}`)}(e,t)}function v9(e,t){const i={};return sG(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):of(e,(r,n)=>{const s=g9(n,t.qu(r));s!=null&&(i[r]=s)}),{mapValue:{fields:i}}}function y9(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof gn||e instanceof uI||e instanceof Mm||e instanceof io||e instanceof p9||e instanceof hI)}function x9(e,t,i){if(!y9(i)||!function(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}(i)){const r=nI(i);throw r==="an object"?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function $Ae(e,t,i){if((t=Hs(t))instanceof lI)return t._internalPath;if(typeof t=="string")return b9(e,t);throw a_("Field path arguments must be of type string or ",e,!1,void 0,i)}const eCe=new RegExp("[~\\*/\\[\\]]");function b9(e,t,i){if(t.search(eCe)>=0)throw a_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,i);try{return new lI(...t.split("."))._internalPath}catch{throw a_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,i)}}function a_(e,t,i,r,n){const s=r&&!r.isEmpty(),a=n!==void 0;let o=`Function ${t}() called with invalid data`;i&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${n}`),l+=")"),new Qt(Je.INVALID_ARGUMENT,o+e+l)}function tCe(e,t){return e.some(i=>i.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w9{constructor(t,i,r,n,s){this._firestore=t,this._userDataWriter=i,this._key=r,this._document=n,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new io(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new iCe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const i=this._document.data.field(_9("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i)}}}class iCe extends w9{data(){return super.data()}}function _9(e,t){return typeof t=="string"?b9(e,t):t instanceof lI?t._internalPath:t._delegate._internalPath}class rCe{convertValue(t,i="none"){switch(Mc(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Fr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(Pc(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 11:return this.convertObject(t.mapValue,i);case 10:return this.convertVectorValue(t.mapValue);default:throw ai()}}convertObject(t,i){return this.convertObjectMap(t.fields,i)}convertObjectMap(t,i="none"){const r={};return of(t,(n,s)=>{r[n]=this.convertValue(s,i)}),r}convertVectorValue(t){var i,r,n;const s=(n=(r=(i=t.fields)===null||i===void 0?void 0:i[Zw].arrayValue)===null||r===void 0?void 0:r.values)===null||n===void 0?void 0:n.map(a=>Fr(a.doubleValue));return new hI(s)}convertGeoPoint(t){return new uI(Fr(t.latitude),Fr(t.longitude))}convertArray(t,i){return(t.values||[]).map(r=>this.convertValue(r,i))}convertServerTimestamp(t,i){switch(i){case"previous":const r=q_(t);return r==null?null:this.convertValue(r,i);case"estimate":return this.convertTimestamp(Py(t));default:return null}}convertTimestamp(t){const i=Tc(t);return new gn(i.seconds,i.nanos)}convertDocumentKey(t,i){const r=Rr.fromString(t);Xi(HG(r));const n=new My(r.get(1),r.get(3)),s=new Kt(r.popFirst(5));return n.isEqual(i)||Ju(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nCe(e,t,i){let r;return r=e?i&&(i.merge||i.mergeFields)?e.toFirestore(t,i):e.toFirestore(t):t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sCe{constructor(t,i){this.hasPendingWrites=t,this.fromCache=i}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class S9 extends w9{constructor(t,i,r,n,s,a){super(t,i,r,n,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const i=new aCe(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,i={}){if(this._document){const r=this._document.data.field(_9("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,i.serverTimestamps)}}}class aCe extends S9{data(t={}){return super.data(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iS(e){e=Oy(e,io);const t=Oy(e.firestore,oI);return jAe(f9(t),e._key).then(i=>uCe(t,e,i))}class oCe extends rCe{constructor(t){super(),this.firestore=t}convertBytes(t){return new Mm(t)}convertReference(t){const i=this.convertDocumentKey(t,this.firestore._databaseId);return new io(this.firestore,null,i)}}function IP(e,t,i){e=Oy(e,io);const r=Oy(e.firestore,oI),n=nCe(e.converter,t,i);return lCe(r,[JAe(ZAe(r),"setDoc",e._key,n,e.converter!==null,i).toMutation(e._key,ju.none())])}function lCe(e,t){return function(r,n){const s=new wc;return r.asyncQueue.enqueueAndForget(async()=>PAe(await UAe(r),n,s)),s.promise}(f9(e),t)}function uCe(e,t,i){const r=i.docs.get(t._key),n=new oCe(e);return new S9(e,n,t._key,r,new sCe(i.hasPendingWrites,i.fromCache),t.converter)}(function(t,i=!0){(function(n){Qm=n})(Xm),_m(new Yd("firestore",(r,{instanceIdentifier:n,options:s})=>{const a=r.getProvider("app").getImmediate(),o=new oI(new Q_e(r.getProvider("auth-internal")),new J_e(a,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Qt(Je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new My(u.options.projectId,h)}(a,n),a);return s=Object.assign({useFetchStreams:i},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),xc(C4,T4,t),xc(C4,T4,"esm2017")})();const hCe={apiKey:"AIzaSyDnoWR5VrC-ZTnDX4yuTmT9PtCFj7vMHO0",authDomain:"money-saver-app-f9d5e.firebaseapp.com",projectId:"money-saver-app-f9d5e",storageBucket:"money-saver-app-f9d5e.firebasestorage.app",messagingSenderId:"863400519457",appId:"1:863400519457:web:89a28e5e84c31afdaac060"},E9=hH(hCe),cCe=H_e(E9),zy=qAe(E9),rS={budget:"0",goal:"0",expenses:0,expenseData:{rent:0,food:0,car:0,hobby:0,fun:0,other:0},currency:"eur"},A9=Ae.createContext(void 0),dCe=({children:e})=>{const[t,i]=Ae.useState(null),[r,n]=Ae.useState(null),[s,a]=Ae.useState(!1),[o,l]=Ae.useState(!0),u=rS;Ae.useEffect(()=>{const f=Rwe(cCe,h);return()=>f()},[]);async function h(f){const m=async g=>{const y=Ly(zy,"users",g),v=await iS(y);if(!v.exists())await IP(y,{budget:u.budget,goal:u.goal,expenses:u.expenses,expenseData:u.expenseData,currency:u.currency});else{const b=v.data(),S={};b.budget===void 0&&(S.budget=u.budget),b.goal===void 0&&(S.goal=u.goal),b.expenses===void 0&&(S.expenses=u.expenses),b.expenseData===void 0&&(S.expenseData=u.expenseData),b.currency===void 0&&(S.currency=u.currency),Object.keys(S).length>0&&await IP(y,S,{merge:!0})}};if(f){l(!0);const g=f.uid;try{await m(g),i(f),a(!0),n(g)}catch(y){console.error("Error initializing user:",y)}finally{l(!1)}}else i(null),a(!1),n(null),l(!1)}const c={currentUser:t,userLoggedIn:s,loading:o,userId:r};return Jt.jsx(A9.Provider,{value:c,children:!o&&e})},nS=()=>{const e=Ae.useContext(A9);if(!e)throw new Error("useAuthContext must be used within an AuthProvider");return e},C9=Ae.createContext(void 0),fCe=({children:e})=>{const t=rS,{userId:i,loading:r}=nS(),[n,s]=Ae.useState(t.currency);return Ae.useEffect(()=>{if(!i||r)return;(async()=>{try{const o=Ly(zy,"users",i),l=await iS(o);if(l.exists()){const u=l.data();s(u.currency??"eur")}}catch(o){console.error("Failed Fetching Currency Data:",o)}})()},[i,r]),Jt.jsx(C9.Provider,{value:{currency:n,setCurrency:s},children:e})},LPe=()=>{const e=Ae.useContext(C9);if(!e)throw new Error("useCurrencyDataContext must be used within a CurrencyDataContextProvider");return e},T9=Ae.createContext(void 0),pCe=({children:e})=>{const t=rS,{userId:i}=nS(),[r,n]=Ae.useState(t.expenseData),s=(a,o)=>{if(!i||o===void 0||o<0)return;const l=Ly(zy,"users",i);IP(l,{expenseData:{[a]:o}},{merge:!0}),n(u=>({...u,[a]:o}))};return Ae.useEffect(()=>{if(!i)return;const a=Ly(zy,"users",i);(async()=>{const l=await iS(a);if(l.exists()){const u=l.data();n(u.expenseData||{})}})()},[i]),Jt.jsx(T9.Provider,{value:{updateExpense:s,expenses:r,setExpenses:n},children:e})},zPe=()=>{const e=Ae.useContext(T9);if(!e)throw new Error("useExpensesAndResultsDataContext must be used within a ExpensesAndResultsDataContextProvider");return e},P9=Ae.createContext(void 0),mCe=({children:e})=>{const t=rS,{userId:i,loading:r}=nS(),[n,s]=Ae.useState(t.budget),[a,o]=Ae.useState(t.goal),[l,u]=Ae.useState(t.expenses);Ae.useEffect(()=>{if(!i||r)return;(async()=>{try{const y=Ly(zy,"users",i),v=await iS(y);if(v.exists()){const b=v.data();u(b.expenses??t.expenses),s(b.budget??t.budget),o(b.goal??t.goal)}}catch(y){console.error("Error fetching data:",y)}})()},[i,r]);const[h,c]=Ae.useState(null),f=Ae.useCallback(g=>{c(g)},[]),m=Ae.useCallback(()=>{c(null)},[]);return Jt.jsx(P9.Provider,{value:{expensesSum:l,setExpensesSum:u,budget:n,setBudget:s,goal:a,setGoal:o,activeModal:h,openModal:f,closeModal:m},children:e})},NPe=()=>{const e=Ae.useContext(P9);if(e===void 0)throw new Error("useFinanceDataContext must be used with a FinanceDataContext");return e};var dv={},bF;function gCe(){if(bF)return dv;bF=1,Object.defineProperty(dv,"__esModule",{value:!0}),dv.parse=a,dv.serialize=u;const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,n=Object.prototype.toString,s=(()=>{const f=function(){};return f.prototype=Object.create(null),f})();function a(f,m){const g=new s,y=f.length;if(y<2)return g;const v=(m==null?void 0:m.decode)||h;let b=0;do{const S=f.indexOf("=",b);if(S===-1)break;const _=f.indexOf(";",b),T=_===-1?y:_;if(S>T){b=f.lastIndexOf(";",S-1)+1;continue}const M=o(f,b,S),C=l(f,S,M),P=f.slice(M,C);if(g[P]===void 0){let E=o(f,S+1,T),D=l(f,T,E);const I=v(f.slice(E,D));g[P]=I}b=T+1}while(b<y);return g}function o(f,m,g){do{const y=f.charCodeAt(m);if(y!==32&&y!==9)return m}while(++m<g);return g}function l(f,m,g){for(;m>g;){const y=f.charCodeAt(--m);if(y!==32&&y!==9)return m+1}return g}function u(f,m,g){const y=(g==null?void 0:g.encode)||encodeURIComponent;if(!e.test(f))throw new TypeError(`argument name is invalid: ${f}`);const v=y(m);if(!t.test(v))throw new TypeError(`argument val is invalid: ${m}`);let b=f+"="+v;if(!g)return b;if(g.maxAge!==void 0){if(!Number.isInteger(g.maxAge))throw new TypeError(`option maxAge is invalid: ${g.maxAge}`);b+="; Max-Age="+g.maxAge}if(g.domain){if(!i.test(g.domain))throw new TypeError(`option domain is invalid: ${g.domain}`);b+="; Domain="+g.domain}if(g.path){if(!r.test(g.path))throw new TypeError(`option path is invalid: ${g.path}`);b+="; Path="+g.path}if(g.expires){if(!c(g.expires)||!Number.isFinite(g.expires.valueOf()))throw new TypeError(`option expires is invalid: ${g.expires}`);b+="; Expires="+g.expires.toUTCString()}if(g.httpOnly&&(b+="; HttpOnly"),g.secure&&(b+="; Secure"),g.partitioned&&(b+="; Partitioned"),g.priority)switch(typeof g.priority=="string"?g.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${g.priority}`)}if(g.sameSite)switch(typeof g.sameSite=="string"?g.sameSite.toLowerCase():g.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${g.sameSite}`)}return b}function h(f){if(f.indexOf("%")===-1)return f;try{return decodeURIComponent(f)}catch{return f}}function c(f){return n.call(f)==="[object Date]"}return dv}gCe();/**
 * react-router v7.2.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var wF="popstate";function vCe(e={}){function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return RP("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:Ny(n)}return xCe(t,i,null,e)}function wr(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Wo(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function yCe(){return Math.random().toString(36).substring(2,10)}function _F(e,t){return{usr:e.state,key:e.key,idx:t}}function RP(e,t,i=null,r){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?$m(t):t,state:i,key:t&&t.key||r||yCe()}}function Ny({pathname:e="/",search:t="",hash:i=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function $m(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substring(i),e=e.substring(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function xCe(e,t,i,r={}){let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o="POP",l=null,u=h();u==null&&(u=0,a.replaceState({...a.state,idx:u},""));function h(){return(a.state||{idx:null}).idx}function c(){o="POP";let v=h(),b=v==null?null:v-u;u=v,l&&l({action:o,location:y.location,delta:b})}function f(v,b){o="PUSH";let S=RP(y.location,v,b);u=h()+1;let _=_F(S,u),T=y.createHref(S);try{a.pushState(_,"",T)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;n.location.assign(T)}s&&l&&l({action:o,location:y.location,delta:1})}function m(v,b){o="REPLACE";let S=RP(y.location,v,b);u=h();let _=_F(S,u),T=y.createHref(S);a.replaceState(_,"",T),s&&l&&l({action:o,location:y.location,delta:0})}function g(v){let b=n.location.origin!=="null"?n.location.origin:n.location.href,S=typeof v=="string"?v:Ny(v);return S=S.replace(/ $/,"%20"),wr(b,`No window.location.(origin|href) available to create URL for href: ${S}`),new URL(S,b)}let y={get action(){return o},get location(){return e(n,a)},listen(v){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(wF,c),l=v,()=>{n.removeEventListener(wF,c),l=null}},createHref(v){return t(n,v)},createURL:g,encodeLocation(v){let b=g(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:f,replace:m,go(v){return a.go(v)}};return y}function M9(e,t,i="/"){return bCe(e,t,i,!1)}function bCe(e,t,i,r){let n=typeof t=="string"?$m(t):t,s=Rc(n.pathname||"/",i);if(s==null)return null;let a=D9(e);wCe(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=RCe(s);o=DCe(a[l],u,r)}return o}function D9(e,t=[],i=[],r=""){let n=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(wr(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let u=Hu([r,l.relativePath]),h=i.concat(l);s.children&&s.children.length>0&&(wr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),D9(s.children,t,h,u)),!(s.path==null&&!s.index)&&t.push({path:u,score:PCe(u,s.index),routesMeta:h})};return e.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))n(s,a);else for(let l of I9(s.path))n(s,a,l)}),t}function I9(e){let t=e.split("/");if(t.length===0)return[];let[i,...r]=t,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=I9(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function wCe(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:MCe(t.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}var _Ce=/^:[\w-]+$/,SCe=3,ECe=2,ACe=1,CCe=10,TCe=-2,SF=e=>e==="*";function PCe(e,t){let i=e.split("/"),r=i.length;return i.some(SF)&&(r+=TCe),t&&(r+=ECe),i.filter(n=>!SF(n)).reduce((n,s)=>n+(_Ce.test(s)?SCe:s===""?ACe:CCe),r)}function MCe(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function DCe(e,t,i=!1){let{routesMeta:r}=e,n={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,h=s==="/"?t:t.slice(s.length)||"/",c=o_({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),f=l.route;if(!c&&u&&i&&!r[r.length-1].route.index&&(c=o_({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!c)return null;Object.assign(n,c.params),a.push({params:n,pathname:Hu([s,c.pathname]),pathnameBase:zCe(Hu([s,c.pathnameBase])),route:f}),c.pathnameBase!=="/"&&(s=Hu([s,c.pathnameBase]))}return a}function o_(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=ICe(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((u,{paramName:h,isOptional:c},f)=>{if(h==="*"){let g=o[f]||"";a=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const m=o[f];return c&&!m?u[h]=void 0:u[h]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:e}}function ICe(e,t=!1,i=!0){Wo(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),r]}function RCe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wo(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Rc(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}function OCe(e,t="/"){let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?$m(e):e;return{pathname:i?i.startsWith("/")?i:kCe(i,t):t,search:NCe(r),hash:BCe(n)}}function kCe(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function tT(e,t,i,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function LCe(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function dI(e){let t=LCe(e);return t.map((i,r)=>r===t.length-1?i.pathname:i.pathnameBase)}function fI(e,t,i,r=!1){let n;typeof e=="string"?n=$m(e):(n={...e},wr(!n.pathname||!n.pathname.includes("?"),tT("?","pathname","search",n)),wr(!n.pathname||!n.pathname.includes("#"),tT("#","pathname","hash",n)),wr(!n.search||!n.search.includes("#"),tT("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let c=t.length-1;if(!r&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),c-=1;n.pathname=f.join("/")}o=c>=0?t[c]:"/"}let l=OCe(n,o),u=a&&a!=="/"&&a.endsWith("/"),h=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}var Hu=e=>e.join("/").replace(/\/\/+/g,"/"),zCe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),NCe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,BCe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function FCe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var R9=["POST","PUT","PATCH","DELETE"];new Set(R9);var UCe=["GET",...R9];new Set(UCe);var eg=Ae.createContext(null);eg.displayName="DataRouter";var sS=Ae.createContext(null);sS.displayName="DataRouterState";var O9=Ae.createContext({isTransitioning:!1});O9.displayName="ViewTransition";var VCe=Ae.createContext(new Map);VCe.displayName="Fetchers";var jCe=Ae.createContext(null);jCe.displayName="Await";var Qo=Ae.createContext(null);Qo.displayName="Navigation";var d0=Ae.createContext(null);d0.displayName="Location";var Ko=Ae.createContext({outlet:null,matches:[],isDataRoute:!1});Ko.displayName="Route";var pI=Ae.createContext(null);pI.displayName="RouteError";function HCe(e,{relative:t}={}){wr(tg(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:r}=Ae.useContext(Qo),{hash:n,pathname:s,search:a}=f0(e,{relative:t}),o=s;return i!=="/"&&(o=s==="/"?i:Hu([i,s])),r.createHref({pathname:o,search:a,hash:n})}function tg(){return Ae.useContext(d0)!=null}function nh(){return wr(tg(),"useLocation() may be used only in the context of a <Router> component."),Ae.useContext(d0).location}var k9="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function L9(e){Ae.useContext(Qo).static||Ae.useLayoutEffect(e)}function z9(){let{isDataRoute:e}=Ae.useContext(Ko);return e?nTe():GCe()}function GCe(){wr(tg(),"useNavigate() may be used only in the context of a <Router> component.");let e=Ae.useContext(eg),{basename:t,navigator:i}=Ae.useContext(Qo),{matches:r}=Ae.useContext(Ko),{pathname:n}=nh(),s=JSON.stringify(dI(r)),a=Ae.useRef(!1);return L9(()=>{a.current=!0}),Ae.useCallback((l,u={})=>{if(Wo(a.current,k9),!a.current)return;if(typeof l=="number"){i.go(l);return}let h=fI(l,JSON.parse(s),n,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:Hu([t,h.pathname])),(u.replace?i.replace:i.push)(h,u.state,u)},[t,i,s,n,e])}var WCe=Ae.createContext(null);function qCe(e){let t=Ae.useContext(Ko).outlet;return t&&Ae.createElement(WCe.Provider,{value:e},t)}function f0(e,{relative:t}={}){let{matches:i}=Ae.useContext(Ko),{pathname:r}=nh(),n=JSON.stringify(dI(i));return Ae.useMemo(()=>fI(e,JSON.parse(n),r,t==="path"),[e,n,r,t])}function XCe(e,t){return N9(e,t)}function N9(e,t,i,r){var S;wr(tg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n,static:s}=Ae.useContext(Qo),{matches:a}=Ae.useContext(Ko),o=a[a.length-1],l=o?o.params:{},u=o?o.pathname:"/",h=o?o.pathnameBase:"/",c=o&&o.route;{let _=c&&c.path||"";B9(u,!c||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let f=nh(),m;if(t){let _=typeof t=="string"?$m(t):t;wr(h==="/"||((S=_.pathname)==null?void 0:S.startsWith(h)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${_.pathname}" was given in the \`location\` prop.`),m=_}else m=f;let g=m.pathname||"/",y=g;if(h!=="/"){let _=h.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(_.length).join("/")}let v=!s&&i&&i.matches&&i.matches.length>0?i.matches:M9(e,{pathname:y});Wo(c||v!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),Wo(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=JCe(v&&v.map(_=>Object.assign({},_,{params:Object.assign({},l,_.params),pathname:Hu([h,n.encodeLocation?n.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?h:Hu([h,n.encodeLocation?n.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),a,i,r);return t&&b?Ae.createElement(d0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},b):b}function YCe(){let e=rTe(),t=FCe(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=Ae.createElement(Ae.Fragment,null,Ae.createElement("p",null," Hey developer "),Ae.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ae.createElement("code",{style:s},"ErrorBoundary")," or"," ",Ae.createElement("code",{style:s},"errorElement")," prop on your route.")),Ae.createElement(Ae.Fragment,null,Ae.createElement("h2",null,"Unexpected Application Error!"),Ae.createElement("h3",{style:{fontStyle:"italic"}},t),i?Ae.createElement("pre",{style:n},i):null,a)}var QCe=Ae.createElement(YCe,null),KCe=class extends Ae.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Ae.createElement(Ko.Provider,{value:this.props.routeContext},Ae.createElement(pI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ZCe({routeContext:e,match:t,children:i}){let r=Ae.useContext(eg);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),Ae.createElement(Ko.Provider,{value:e},i)}function JCe(e,t=[],i=null,r=null){if(e==null){if(!i)return null;if(i.errors)e=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let n=e,s=i==null?void 0:i.errors;if(s!=null){let l=n.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);wr(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),n=n.slice(0,Math.min(n.length,l+1))}let a=!1,o=-1;if(i)for(let l=0;l<n.length;l++){let u=n[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(o=l),u.route.id){let{loaderData:h,errors:c}=i,f=u.route.loader&&!h.hasOwnProperty(u.route.id)&&(!c||c[u.route.id]===void 0);if(u.route.lazy||f){a=!0,o>=0?n=n.slice(0,o+1):n=[n[0]];break}}}return n.reduceRight((l,u,h)=>{let c,f=!1,m=null,g=null;i&&(c=s&&u.route.id?s[u.route.id]:void 0,m=u.route.errorElement||QCe,a&&(o<0&&h===0?(B9("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),f=!0,g=null):o===h&&(f=!0,g=u.route.hydrateFallbackElement||null)));let y=t.concat(n.slice(0,h+1)),v=()=>{let b;return c?b=m:f?b=g:u.route.Component?b=Ae.createElement(u.route.Component,null):u.route.element?b=u.route.element:b=l,Ae.createElement(ZCe,{match:u,routeContext:{outlet:l,matches:y,isDataRoute:i!=null},children:b})};return i&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?Ae.createElement(KCe,{location:i.location,revalidation:i.revalidation,component:m,error:c,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}function mI(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $Ce(e){let t=Ae.useContext(eg);return wr(t,mI(e)),t}function eTe(e){let t=Ae.useContext(sS);return wr(t,mI(e)),t}function tTe(e){let t=Ae.useContext(Ko);return wr(t,mI(e)),t}function gI(e){let t=tTe(e),i=t.matches[t.matches.length-1];return wr(i.route.id,`${e} can only be used on routes that contain a unique "id"`),i.route.id}function iTe(){return gI("useRouteId")}function rTe(){var r;let e=Ae.useContext(pI),t=eTe("useRouteError"),i=gI("useRouteError");return e!==void 0?e:(r=t.errors)==null?void 0:r[i]}function nTe(){let{router:e}=$Ce("useNavigate"),t=gI("useNavigate"),i=Ae.useRef(!1);return L9(()=>{i.current=!0}),Ae.useCallback(async(n,s={})=>{Wo(i.current,k9),i.current&&(typeof n=="number"?e.navigate(n):await e.navigate(n,{fromRouteId:t,...s}))},[e,t])}var EF={};function B9(e,t,i){!t&&!EF[e]&&(EF[e]=!0,Wo(!1,i))}Ae.memo(sTe);function sTe({routes:e,future:t,state:i}){return N9(e,void 0,i,t)}function aTe({to:e,replace:t,state:i,relative:r}){wr(tg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=Ae.useContext(Qo);Wo(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=Ae.useContext(Ko),{pathname:a}=nh(),o=z9(),l=fI(e,dI(s),a,r==="path"),u=JSON.stringify(l);return Ae.useEffect(()=>{o(JSON.parse(u),{replace:t,state:i,relative:r})},[o,u,r,t,i]),null}function oTe(e){return qCe(e.context)}function bl(e){wr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function lTe({basename:e="/",children:t=null,location:i,navigationType:r="POP",navigator:n,static:s=!1}){wr(!tg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=e.replace(/^\/*/,"/"),o=Ae.useMemo(()=>({basename:a,navigator:n,static:s,future:{}}),[a,n,s]);typeof i=="string"&&(i=$m(i));let{pathname:l="/",search:u="",hash:h="",state:c=null,key:f="default"}=i,m=Ae.useMemo(()=>{let g=Rc(l,a);return g==null?null:{location:{pathname:g,search:u,hash:h,state:c,key:f},navigationType:r}},[a,l,u,h,c,f,r]);return Wo(m!=null,`<Router basename="${a}"> is not able to match the URL "${l}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:Ae.createElement(Qo.Provider,{value:o},Ae.createElement(d0.Provider,{children:t,value:m}))}function uTe({children:e,location:t}){return XCe(OP(e),t)}function OP(e,t=[]){let i=[];return Ae.Children.forEach(e,(r,n)=>{if(!Ae.isValidElement(r))return;let s=[...t,n];if(r.type===Ae.Fragment){i.push.apply(i,OP(r.props.children,s));return}wr(r.type===bl,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),wr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=OP(r.props.children,s)),i.push(a)}),i}var Ob="get",kb="application/x-www-form-urlencoded";function aS(e){return e!=null&&typeof e.tagName=="string"}function hTe(e){return aS(e)&&e.tagName.toLowerCase()==="button"}function cTe(e){return aS(e)&&e.tagName.toLowerCase()==="form"}function dTe(e){return aS(e)&&e.tagName.toLowerCase()==="input"}function fTe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function pTe(e,t){return e.button===0&&(!t||t==="_self")&&!fTe(e)}var Zx=null;function mTe(){if(Zx===null)try{new FormData(document.createElement("form"),0),Zx=!1}catch{Zx=!0}return Zx}var gTe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function iT(e){return e!=null&&!gTe.has(e)?(Wo(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${kb}"`),null):e}function vTe(e,t){let i,r,n,s,a;if(cTe(e)){let o=e.getAttribute("action");r=o?Rc(o,t):null,i=e.getAttribute("method")||Ob,n=iT(e.getAttribute("enctype"))||kb,s=new FormData(e)}else if(hTe(e)||dTe(e)&&(e.type==="submit"||e.type==="image")){let o=e.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=e.getAttribute("formaction")||o.getAttribute("action");if(r=l?Rc(l,t):null,i=e.getAttribute("formmethod")||o.getAttribute("method")||Ob,n=iT(e.getAttribute("formenctype"))||iT(o.getAttribute("enctype"))||kb,s=new FormData(o,e),!mTe()){let{name:u,type:h,value:c}=e;if(h==="image"){let f=u?`${u}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else u&&s.append(u,c)}}else{if(aS(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=Ob,r=null,n=kb,a=e}return s&&n==="text/plain"&&(a=s,s=void 0),{action:r,method:i.toLowerCase(),encType:n,formData:s,body:a}}function vI(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}async function yTe(e,t){if(e.id in t)return t[e.id];try{let i=await import(e.module);return t[e.id]=i,i}catch(i){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function xTe(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function bTe(e,t,i){let r=await Promise.all(e.map(async n=>{let s=t.routes[n.route.id];if(s){let a=await yTe(s,i);return a.links?a.links():[]}return[]}));return ETe(r.flat(1).filter(xTe).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function AF(e,t,i,r,n,s){let a=(l,u)=>i[u]?l.route.id!==i[u].route.id:!0,o=(l,u)=>{var h;return i[u].pathname!==l.pathname||((h=i[u].route.path)==null?void 0:h.endsWith("*"))&&i[u].params["*"]!==l.params["*"]};return s==="assets"?t.filter((l,u)=>a(l,u)||o(l,u)):s==="data"?t.filter((l,u)=>{var c;let h=r.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(a(l,u)||o(l,u))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:((c=i[0])==null?void 0:c.params)||{},nextUrl:new URL(e,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function wTe(e,t,{includeHydrateFallback:i}={}){return _Te(e.map(r=>{let n=t.routes[r.route.id];if(!n)return[];let s=[n.module];return n.clientActionModule&&(s=s.concat(n.clientActionModule)),n.clientLoaderModule&&(s=s.concat(n.clientLoaderModule)),i&&n.hydrateFallbackModule&&(s=s.concat(n.hydrateFallbackModule)),n.imports&&(s=s.concat(n.imports)),s}).flat(1))}function _Te(e){return[...new Set(e)]}function STe(e){let t={},i=Object.keys(e).sort();for(let r of i)t[r]=e[r];return t}function ETe(e,t){let i=new Set;return new Set(t),e.reduce((r,n)=>{let s=JSON.stringify(STe(n));return i.has(s)||(i.add(s),r.push({key:s,link:n})),r},[])}function ATe(e){let t=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return t.pathname==="/"?t.pathname="_root.data":t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function CTe(){let e=Ae.useContext(eg);return vI(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function TTe(){let e=Ae.useContext(sS);return vI(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var yI=Ae.createContext(void 0);yI.displayName="FrameworkContext";function F9(){let e=Ae.useContext(yI);return vI(e,"You must render this element inside a <HydratedRouter> element"),e}function PTe(e,t){let i=Ae.useContext(yI),[r,n]=Ae.useState(!1),[s,a]=Ae.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:u,onMouseLeave:h,onTouchStart:c}=t,f=Ae.useRef(null);Ae.useEffect(()=>{if(e==="render"&&a(!0),e==="viewport"){let y=b=>{b.forEach(S=>{a(S.isIntersecting)})},v=new IntersectionObserver(y,{threshold:.5});return f.current&&v.observe(f.current),()=>{v.disconnect()}}},[e]),Ae.useEffect(()=>{if(r){let y=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(y)}}},[r]);let m=()=>{n(!0)},g=()=>{n(!1),a(!1)};return i?e!=="intent"?[s,f,{}]:[s,f,{onFocus:fv(o,m),onBlur:fv(l,g),onMouseEnter:fv(u,m),onMouseLeave:fv(h,g),onTouchStart:fv(c,m)}]:[!1,f,{}]}function fv(e,t){return i=>{e&&e(i),i.defaultPrevented||t(i)}}function MTe({page:e,...t}){let{router:i}=CTe(),r=Ae.useMemo(()=>M9(i.routes,e,i.basename),[i.routes,e,i.basename]);return r?Ae.createElement(ITe,{page:e,matches:r,...t}):null}function DTe(e){let{manifest:t,routeModules:i}=F9(),[r,n]=Ae.useState([]);return Ae.useEffect(()=>{let s=!1;return bTe(e,t,i).then(a=>{s||n(a)}),()=>{s=!0}},[e,t,i]),r}function ITe({page:e,matches:t,...i}){let r=nh(),{manifest:n,routeModules:s}=F9(),{loaderData:a,matches:o}=TTe(),l=Ae.useMemo(()=>AF(e,t,o,n,r,"data"),[e,t,o,n,r]),u=Ae.useMemo(()=>AF(e,t,o,n,r,"assets"),[e,t,o,n,r]),h=Ae.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let m=new Set,g=!1;if(t.forEach(v=>{var S;let b=n.routes[v.route.id];!b||!b.hasLoader||(!l.some(_=>_.route.id===v.route.id)&&v.route.id in a&&((S=s[v.route.id])!=null&&S.shouldRevalidate)||b.hasClientLoader?g=!0:m.add(v.route.id))}),m.size===0)return[];let y=ATe(e);return g&&m.size>0&&y.searchParams.set("_routes",t.filter(v=>m.has(v.route.id)).map(v=>v.route.id).join(",")),[y.pathname+y.search]},[a,r,n,l,t,e,s]),c=Ae.useMemo(()=>wTe(u,n),[u,n]),f=DTe(u);return Ae.createElement(Ae.Fragment,null,h.map(m=>Ae.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...i})),c.map(m=>Ae.createElement("link",{key:m,rel:"modulepreload",href:m,...i})),f.map(({key:m,link:g})=>Ae.createElement("link",{key:m,...g})))}function RTe(...e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var U9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{U9&&(window.__reactRouterVersion="7.2.0")}catch{}function OTe({basename:e,children:t,window:i}){let r=Ae.useRef();r.current==null&&(r.current=vCe({window:i,v5Compat:!0}));let n=r.current,[s,a]=Ae.useState({action:n.action,location:n.location}),o=Ae.useCallback(l=>{Ae.startTransition(()=>a(l))},[a]);return Ae.useLayoutEffect(()=>n.listen(o),[n,o]),Ae.createElement(lTe,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:n})}var V9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,j9=Ae.forwardRef(function({onClick:t,discover:i="render",prefetch:r="none",relative:n,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:h,viewTransition:c,...f},m){let{basename:g}=Ae.useContext(Qo),y=typeof u=="string"&&V9.test(u),v,b=!1;if(typeof u=="string"&&y&&(v=u,U9))try{let D=new URL(window.location.href),I=u.startsWith("//")?new URL(D.protocol+u):new URL(u),O=Rc(I.pathname,g);I.origin===D.origin&&O!=null?u=O+I.search+I.hash:b=!0}catch{Wo(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let S=HCe(u,{relative:n}),[_,T,M]=PTe(r,f),C=NTe(u,{replace:a,state:o,target:l,preventScrollReset:h,relative:n,viewTransition:c});function P(D){t&&t(D),D.defaultPrevented||C(D)}let E=Ae.createElement("a",{...f,...M,href:v||S,onClick:b||s?t:P,ref:RTe(m,T),target:l,"data-discover":!y&&i==="render"?"true":void 0});return _&&!y?Ae.createElement(Ae.Fragment,null,E,Ae.createElement(MTe,{page:S})):E});j9.displayName="Link";var kTe=Ae.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:r="",end:n=!1,style:s,to:a,viewTransition:o,children:l,...u},h){let c=f0(a,{relative:u.relative}),f=nh(),m=Ae.useContext(sS),{navigator:g,basename:y}=Ae.useContext(Qo),v=m!=null&&jTe(c)&&o===!0,b=g.encodeLocation?g.encodeLocation(c).pathname:c.pathname,S=f.pathname,_=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;i||(S=S.toLowerCase(),_=_?_.toLowerCase():null,b=b.toLowerCase()),_&&y&&(_=Rc(_,y)||_);const T=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let M=S===b||!n&&S.startsWith(b)&&S.charAt(T)==="/",C=_!=null&&(_===b||!n&&_.startsWith(b)&&_.charAt(b.length)==="/"),P={isActive:M,isPending:C,isTransitioning:v},E=M?t:void 0,D;typeof r=="function"?D=r(P):D=[r,M?"active":null,C?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let I=typeof s=="function"?s(P):s;return Ae.createElement(j9,{...u,"aria-current":E,className:D,ref:h,style:I,to:a,viewTransition:o},typeof l=="function"?l(P):l)});kTe.displayName="NavLink";var LTe=Ae.forwardRef(({discover:e="render",fetcherKey:t,navigate:i,reloadDocument:r,replace:n,state:s,method:a=Ob,action:o,onSubmit:l,relative:u,preventScrollReset:h,viewTransition:c,...f},m)=>{let g=UTe(),y=VTe(o,{relative:u}),v=a.toLowerCase()==="get"?"get":"post",b=typeof o=="string"&&V9.test(o),S=_=>{if(l&&l(_),_.defaultPrevented)return;_.preventDefault();let T=_.nativeEvent.submitter,M=(T==null?void 0:T.getAttribute("formmethod"))||a;g(T||_.currentTarget,{fetcherKey:t,method:M,navigate:i,replace:n,state:s,relative:u,preventScrollReset:h,viewTransition:c})};return Ae.createElement("form",{ref:m,method:v,action:y,onSubmit:r?l:S,...f,"data-discover":!b&&e==="render"?"true":void 0})});LTe.displayName="Form";function zTe(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function H9(e){let t=Ae.useContext(eg);return wr(t,zTe(e)),t}function NTe(e,{target:t,replace:i,state:r,preventScrollReset:n,relative:s,viewTransition:a}={}){let o=z9(),l=nh(),u=f0(e,{relative:s});return Ae.useCallback(h=>{if(pTe(h,t)){h.preventDefault();let c=i!==void 0?i:Ny(l)===Ny(u);o(e,{replace:c,state:r,preventScrollReset:n,relative:s,viewTransition:a})}},[l,o,u,i,r,t,e,n,s,a])}var BTe=0,FTe=()=>`__${String(++BTe)}__`;function UTe(){let{router:e}=H9("useSubmit"),{basename:t}=Ae.useContext(Qo),i=iTe();return Ae.useCallback(async(r,n={})=>{let{action:s,method:a,encType:o,formData:l,body:u}=vTe(r,t);if(n.navigate===!1){let h=n.fetcherKey||FTe();await e.fetch(h,i,n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:u,formMethod:n.method||a,formEncType:n.encType||o,flushSync:n.flushSync})}else await e.navigate(n.action||s,{preventScrollReset:n.preventScrollReset,formData:l,body:u,formMethod:n.method||a,formEncType:n.encType||o,replace:n.replace,state:n.state,fromRouteId:i,flushSync:n.flushSync,viewTransition:n.viewTransition})},[e,t,i])}function VTe(e,{relative:t}={}){let{basename:i}=Ae.useContext(Qo),r=Ae.useContext(Ko);wr(r,"useFormAction must be used inside a RouteContext");let[n]=r.matches.slice(-1),s={...f0(e||".",{relative:t})},a=nh();if(e==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(h=>h==="")){o.delete("index"),l.filter(c=>c).forEach(c=>o.append("index",c));let h=o.toString();s.search=h?`?${h}`:""}}return(!e||e===".")&&n.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(s.pathname=s.pathname==="/"?i:Hu([i,s.pathname])),Ny(s)}function jTe(e,t={}){let i=Ae.useContext(O9);wr(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=H9("useViewTransitionState"),n=f0(e,{relative:t.relative});if(!i.isTransitioning)return!1;let s=Rc(i.currentLocation.pathname,r)||i.currentLocation.pathname,a=Rc(i.nextLocation.pathname,r)||i.nextLocation.pathname;return o_(n.pathname,a)!=null||o_(n.pathname,s)!=null}new TextEncoder;const HTe=()=>{const{pathname:e}=nh();return Ae.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[e]),null},GTe=()=>{const{userLoggedIn:e}=nS();return e?Jt.jsx(oTe,{}):Jt.jsx(aTe,{to:"/"})},hi=e=>typeof e=="string",pv=()=>{let e,t;const i=new Promise((r,n)=>{e=r,t=n});return i.resolve=e,i.reject=t,i},CF=e=>e==null?"":""+e,WTe=(e,t,i)=>{e.forEach(r=>{t[r]&&(i[r]=t[r])})},qTe=/###/g,TF=e=>e&&e.indexOf("###")>-1?e.replace(qTe,"."):e,PF=e=>!e||hi(e),ty=(e,t,i)=>{const r=hi(t)?t.split("."):t;let n=0;for(;n<r.length-1;){if(PF(e))return{};const s=TF(r[n]);!e[s]&&i&&(e[s]=new i),Object.prototype.hasOwnProperty.call(e,s)?e=e[s]:e={},++n}return PF(e)?{}:{obj:e,k:TF(r[n])}},MF=(e,t,i)=>{const{obj:r,k:n}=ty(e,t,Object);if(r!==void 0||t.length===1){r[n]=i;return}let s=t[t.length-1],a=t.slice(0,t.length-1),o=ty(e,a,Object);for(;o.obj===void 0&&a.length;)s=`${a[a.length-1]}.${s}`,a=a.slice(0,a.length-1),o=ty(e,a,Object),o!=null&&o.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=i},XTe=(e,t,i,r)=>{const{obj:n,k:s}=ty(e,t,Object);n[s]=n[s]||[],n[s].push(i)},l_=(e,t)=>{const{obj:i,k:r}=ty(e,t);if(i&&Object.prototype.hasOwnProperty.call(i,r))return i[r]},YTe=(e,t,i)=>{const r=l_(e,i);return r!==void 0?r:l_(t,i)},G9=(e,t,i)=>{for(const r in t)r!=="__proto__"&&r!=="constructor"&&(r in e?hi(e[r])||e[r]instanceof String||hi(t[r])||t[r]instanceof String?i&&(e[r]=t[r]):G9(e[r],t[r],i):e[r]=t[r]);return e},bp=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var QTe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const KTe=e=>hi(e)?e.replace(/[&<>"'\/]/g,t=>QTe[t]):e;class ZTe{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const i=this.regExpMap.get(t);if(i!==void 0)return i;const r=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,r),this.regExpQueue.push(t),r}}const JTe=[" ",",","?","!",";"],$Te=new ZTe(20),e2e=(e,t,i)=>{t=t||"",i=i||"";const r=JTe.filter(a=>t.indexOf(a)<0&&i.indexOf(a)<0);if(r.length===0)return!0;const n=$Te.getRegExp(`(${r.map(a=>a==="?"?"\\?":a).join("|")})`);let s=!n.test(e);if(!s){const a=e.indexOf(i);a>0&&!n.test(e.substring(0,a))&&(s=!0)}return s},kP=function(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const r=t.split(i);let n=e;for(let s=0;s<r.length;){if(!n||typeof n!="object")return;let a,o="";for(let l=s;l<r.length;++l)if(l!==s&&(o+=i),o+=r[l],a=n[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<r.length-1)continue;s+=l-s+1;break}n=a}return n},u_=e=>e==null?void 0:e.replace("_","-"),t2e={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var i,r;(r=(i=console==null?void 0:console[e])==null?void 0:i.apply)==null||r.call(i,console,t)}};class h_{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(t,i)}init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=i.prefix||"i18next:",this.logger=t||t2e,this.options=i,this.debug=i.debug}log(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.forward(i,"log","",!0)}warn(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.forward(i,"warn","",!0)}error(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.forward(i,"error","")}deprecate(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.forward(i,"warn","WARNING DEPRECATED: ",!0)}forward(t,i,r,n){return n&&!this.debug?null:(hi(t[0])&&(t[0]=`${r}${this.prefix} ${t[0]}`),this.logger[i](t))}create(t){return new h_(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new h_(this.logger,t)}}var Il=new h_;class oS{constructor(){this.observers={}}on(t,i){return t.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const n=this.observers[r].get(i)||0;this.observers[r].set(i,n+1)}),this}off(t,i){if(this.observers[t]){if(!i){delete this.observers[t];return}this.observers[t].delete(i)}}emit(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];this.observers[t]&&Array.from(this.observers[t].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o.apply(o,[t,...r])})}}class DF extends oS{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=t||{},this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const i=this.options.ns.indexOf(t);i>-1&&this.options.ns.splice(i,1)}getResource(t,i,r){var u,h;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,a=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;t.indexOf(".")>-1?o=t.split("."):(o=[t,i],r&&(Array.isArray(r)?o.push(...r):hi(r)&&s?o.push(...r.split(s)):o.push(r)));const l=l_(this.data,o);return!l&&!i&&!r&&t.indexOf(".")>-1&&(t=o[0],i=o[1],r=o.slice(2).join(".")),l||!a||!hi(r)?l:kP((h=(u=this.data)==null?void 0:u[t])==null?void 0:h[i],r,s)}addResource(t,i,r,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[t,i];r&&(o=o.concat(a?r.split(a):r)),t.indexOf(".")>-1&&(o=t.split("."),n=i,i=o[1]),this.addNamespaces(i),MF(this.data,o,n),s.silent||this.emit("added",t,i,r,n)}addResources(t,i,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in r)(hi(r[s])||Array.isArray(r[s]))&&this.addResource(t,i,s,r[s],{silent:!0});n.silent||this.emit("added",t,i,r)}addResourceBundle(t,i,r,n,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[t,i];t.indexOf(".")>-1&&(o=t.split("."),n=r,r=i,i=o[1]),this.addNamespaces(i);let l=l_(this.data,o)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),n?G9(l,r,s):l={...l,...r},MF(this.data,o,l),a.silent||this.emit("added",t,i,r)}removeResourceBundle(t,i){this.hasResourceBundle(t,i)&&delete this.data[t][i],this.removeNamespaces(i),this.emit("removed",t,i)}hasResourceBundle(t,i){return this.getResource(t,i)!==void 0}getResourceBundle(t,i){return i||(i=this.options.defaultNS),this.getResource(t,i)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const i=this.getDataByLanguage(t);return!!(i&&Object.keys(i)||[]).find(n=>i[n]&&Object.keys(i[n]).length>0)}toJSON(){return this.data}}var W9={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,r,n){return e.forEach(s=>{var a;t=((a=this.processors[s])==null?void 0:a.process(t,i,r,n))??t}),t}};const IF={};class c_ extends oS{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),WTe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Il.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(t==null)return!1;const r=this.resolve(t,i);return(r==null?void 0:r.res)!==void 0}extractFromKey(t,i){let r=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const n=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let s=i.ns||this.options.defaultNS||[];const a=r&&t.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!i.keySeparator&&!this.options.userDefinedNsSeparator&&!i.nsSeparator&&!e2e(t,r,n);if(a&&!o){const l=t.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:t,namespaces:hi(s)?[s]:s};const u=t.split(r);(r!==n||r===n&&this.options.ns.indexOf(u[0])>-1)&&(s=u.shift()),t=u.join(n)}return{key:t,namespaces:hi(s)?[s]:s}}translate(t,i,r){if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof i=="object"&&(i={...i}),i||(i={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const n=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(t[t.length-1],i),l=o[o.length-1],u=i.lng||this.language,h=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((u==null?void 0:u.toLowerCase())==="cimode"){if(h){const T=i.nsSeparator||this.options.nsSeparator;return n?{res:`${l}${T}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:`${l}${T}${a}`}return n?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:a}const c=this.resolve(t,i);let f=c==null?void 0:c.res;const m=(c==null?void 0:c.usedKey)||a,g=(c==null?void 0:c.exactUsedKey)||a,y=Object.prototype.toString.apply(f),v=["[object Number]","[object Function]","[object RegExp]"],b=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,_=!hi(f)&&typeof f!="boolean"&&typeof f!="number";if(S&&f&&_&&v.indexOf(y)<0&&!(hi(b)&&Array.isArray(f))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,f,{...i,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return n?(c.res=T,c.usedParams=this.getUsedParamsDetails(i),c):T}if(s){const T=Array.isArray(f),M=T?[]:{},C=T?g:m;for(const P in f)if(Object.prototype.hasOwnProperty.call(f,P)){const E=`${C}${s}${P}`;M[P]=this.translate(E,{...i,joinArrays:!1,ns:o}),M[P]===E&&(M[P]=f[P])}f=M}}else if(S&&hi(b)&&Array.isArray(f))f=f.join(b),f&&(f=this.extendTranslation(f,t,i,r));else{let T=!1,M=!1;const C=i.count!==void 0&&!hi(i.count),P=c_.hasDefaultValue(i),E=C?this.pluralResolver.getSuffix(u,i.count,i):"",D=i.ordinal&&C?this.pluralResolver.getSuffix(u,i.count,{ordinal:!1}):"",I=C&&!i.ordinal&&i.count===0,O=I&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${E}`]||i[`defaultValue${D}`]||i.defaultValue;!this.isValidLookup(f)&&P&&(T=!0,f=O),this.isValidLookup(f)||(M=!0,f=a);const k=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&M?void 0:f,U=P&&O!==f&&this.options.updateMissing;if(M||T||U){if(this.logger.log(U?"updateKey":"missingKey",u,l,a,U?O:f),s){const H=this.resolve(a,{...i,keySeparator:!1});H&&H.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Q=[];const se=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&se&&se[0])for(let H=0;H<se.length;H++)Q.push(se[H]);else this.options.saveMissingTo==="all"?Q=this.languageUtils.toResolveHierarchy(i.lng||this.language):Q.push(i.lng||this.language);const K=(H,ie,$)=>{var X;const V=P&&$!==f?$:k;this.options.missingKeyHandler?this.options.missingKeyHandler(H,l,ie,V,U,i):(X=this.backendConnector)!=null&&X.saveMissing&&this.backendConnector.saveMissing(H,l,ie,V,U,i),this.emit("missingKey",H,l,ie,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&C?Q.forEach(H=>{const ie=this.pluralResolver.getSuffixes(H,i);I&&i[`defaultValue${this.options.pluralSeparator}zero`]&&ie.indexOf(`${this.options.pluralSeparator}zero`)<0&&ie.push(`${this.options.pluralSeparator}zero`),ie.forEach($=>{K([H],a+$,i[`defaultValue${$}`]||O)})}):K(Q,a,O))}f=this.extendTranslation(f,t,i,c,r),M&&f===a&&this.options.appendNamespaceToMissingKey&&(f=`${l}:${a}`),(M||T)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,T?f:void 0))}return n?(c.res=f,c.usedParams=this.getUsedParamsDetails(i),c):f}extendTranslation(t,i,r,n,s){var u,h;var a=this;if((u=this.i18nFormat)!=null&&u.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const c=hi(t)&&(((h=r==null?void 0:r.interpolation)==null?void 0:h.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let f;if(c){const g=t.match(this.interpolator.nestingRegexp);f=g&&g.length}let m=r.replace&&!hi(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),t=this.interpolator.interpolate(t,m,r.lng||this.language||n.usedLng,r),c){const g=t.match(this.interpolator.nestingRegexp),y=g&&g.length;f<y&&(r.nest=!1)}!r.lng&&n&&n.res&&(r.lng=this.language||n.usedLng),r.nest!==!1&&(t=this.interpolator.nest(t,function(){for(var g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return(s==null?void 0:s[0])===y[0]&&!r.context?(a.logger.warn(`It seems you are nesting recursively key: ${y[0]} in key: ${i[0]}`),null):a.translate(...y,i)},r)),r.interpolation&&this.interpolator.reset()}const o=r.postProcess||this.options.postProcess,l=hi(o)?[o]:o;return t!=null&&(l!=null&&l.length)&&r.applyPostProcessor!==!1&&(t=W9.handle(l,t,i,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),t}resolve(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,n,s,a,o;return hi(t)&&(t=[t]),t.forEach(l=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(l,i),h=u.key;n=h;let c=u.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const f=i.count!==void 0&&!hi(i.count),m=f&&!i.ordinal&&i.count===0,g=i.context!==void 0&&(hi(i.context)||typeof i.context=="number")&&i.context!=="",y=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);c.forEach(v=>{var b,S;this.isValidLookup(r)||(o=v,!IF[`${y[0]}-${v}`]&&((b=this.utils)!=null&&b.hasLoadedNamespace)&&!((S=this.utils)!=null&&S.hasLoadedNamespace(o))&&(IF[`${y[0]}-${v}`]=!0,this.logger.warn(`key "${n}" for languages "${y.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),y.forEach(_=>{var C;if(this.isValidLookup(r))return;a=_;const T=[h];if((C=this.i18nFormat)!=null&&C.addLookupKeys)this.i18nFormat.addLookupKeys(T,h,_,v,i);else{let P;f&&(P=this.pluralResolver.getSuffix(_,i.count,i));const E=`${this.options.pluralSeparator}zero`,D=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(T.push(h+P),i.ordinal&&P.indexOf(D)===0&&T.push(h+P.replace(D,this.options.pluralSeparator)),m&&T.push(h+E)),g){const I=`${h}${this.options.contextSeparator}${i.context}`;T.push(I),f&&(T.push(I+P),i.ordinal&&P.indexOf(D)===0&&T.push(I+P.replace(D,this.options.pluralSeparator)),m&&T.push(I+E))}}let M;for(;M=T.pop();)this.isValidLookup(r)||(s=M,r=this.getResource(_,v,M,i))}))})}),{res:r,usedKey:n,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,i,r){var s;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(s=this.i18nFormat)!=null&&s.getResource?this.i18nFormat.getResource(t,i,r,n):this.resourceStore.getResource(t,i,r,n)}getUsedParamsDetails(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=t.replace&&!hi(t.replace);let n=r?t.replace:t;if(r&&typeof t.count<"u"&&(n.count=t.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!r){n={...n};for(const s of i)delete n[s]}return n}static hasDefaultValue(t){const i="defaultValue";for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&i===r.substring(0,i.length)&&t[r]!==void 0)return!0;return!1}}class RF{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Il.create("languageUtils")}getScriptPartFromCode(t){if(t=u_(t),!t||t.indexOf("-")<0)return null;const i=t.split("-");return i.length===2||(i.pop(),i[i.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(i.join("-"))}getLanguagePartFromCode(t){if(t=u_(t),!t||t.indexOf("-")<0)return t;const i=t.split("-");return this.formatLanguageCode(i[0])}formatLanguageCode(t){if(hi(t)&&t.indexOf("-")>-1){let i;try{i=Intl.getCanonicalLocales(t)[0]}catch{}return i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let i;return t.forEach(r=>{if(i)return;const n=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(n))&&(i=n)}),!i&&this.options.supportedLngs&&t.forEach(r=>{if(i)return;const n=this.getLanguagePartFromCode(r);if(this.isSupportedCode(n))return i=n;i=this.options.supportedLngs.find(s=>{if(s===n)return s;if(!(s.indexOf("-")<0&&n.indexOf("-")<0)&&(s.indexOf("-")>0&&n.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===n||s.indexOf(n)===0&&n.length>1))return s})}),i||(i=this.getFallbackCodes(this.options.fallbackLng)[0]),i}getFallbackCodes(t,i){if(!t)return[];if(typeof t=="function"&&(t=t(i)),hi(t)&&(t=[t]),Array.isArray(t))return t;if(!i)return t.default||[];let r=t[i];return r||(r=t[this.getScriptPartFromCode(i)]),r||(r=t[this.formatLanguageCode(i)]),r||(r=t[this.getLanguagePartFromCode(i)]),r||(r=t.default),r||[]}toResolveHierarchy(t,i){const r=this.getFallbackCodes(i||this.options.fallbackLng||[],t),n=[],s=a=>{a&&(this.isSupportedCode(a)?n.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return hi(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(t))):hi(t)&&s(this.formatLanguageCode(t)),r.forEach(a=>{n.indexOf(a)<0&&s(this.formatLanguageCode(a))}),n}}const OF={zero:0,one:1,two:2,few:3,many:4,other:5},kF={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class i2e{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=t,this.options=i,this.logger=Il.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,i){this.rules[t]=i}clearCache(){this.pluralRulesCache={}}getRule(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=u_(t==="dev"?"en":t),n=i.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let a;try{a=new Intl.PluralRules(r,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),kF;if(!t.match(/-|_/))return kF;const l=this.languageUtils.getLanguagePartFromCode(t);a=this.getRule(l,i)}return this.pluralRulesCache[s]=a,a}needsPlural(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(t,i);return r||(r=this.getRule("dev",i)),(r==null?void 0:r.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(t,r).map(n=>`${i}${n}`)}getSuffixes(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(t,i);return r||(r=this.getRule("dev",i)),r?r.resolvedOptions().pluralCategories.sort((n,s)=>OF[n]-OF[s]).map(n=>`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=this.getRule(t,r);return n?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n.select(i)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",i,r))}}const LF=function(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=YTe(e,t,i);return!s&&n&&hi(i)&&(s=kP(e,i,r),s===void 0&&(s=kP(t,i,r))),s},rT=e=>e.replace(/\$/g,"$$$$");class r2e{constructor(){var i;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Il.create("interpolator"),this.options=t,this.format=((i=t==null?void 0:t.interpolation)==null?void 0:i.format)||(r=>r),this.init(t)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});const{escape:i,escapeValue:r,useRawValueToEscape:n,prefix:s,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:h,unescapePrefix:c,nestingPrefix:f,nestingPrefixEscaped:m,nestingSuffix:g,nestingSuffixEscaped:y,nestingOptionsSeparator:v,maxReplaces:b,alwaysFormat:S}=t.interpolation;this.escape=i!==void 0?i:KTe,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=s?bp(s):a||"{{",this.suffix=o?bp(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=h?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":h||"",this.nestingPrefix=f?bp(f):m||bp("$t("),this.nestingSuffix=g?bp(g):y||bp(")"),this.nestingOptionsSeparator=v||",",this.maxReplaces=b||1e3,this.alwaysFormat=S!==void 0?S:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(i,r)=>(i==null?void 0:i.source)===r?(i.lastIndex=0,i):new RegExp(r,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(t,i,r,n){var m;let s,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=g=>{if(g.indexOf(this.formatSeparator)<0){const S=LF(i,l,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(S,void 0,r,{...n,...i,interpolationkey:g}):S}const y=g.split(this.formatSeparator),v=y.shift().trim(),b=y.join(this.formatSeparator).trim();return this.format(LF(i,l,v,this.options.keySeparator,this.options.ignoreJSONStructure),b,r,{...n,...i,interpolationkey:v})};this.resetRegExp();const h=(n==null?void 0:n.missingInterpolationHandler)||this.options.missingInterpolationHandler,c=((m=n==null?void 0:n.interpolation)==null?void 0:m.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>rT(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?rT(this.escape(g)):rT(g)}].forEach(g=>{for(o=0;s=g.regex.exec(t);){const y=s[1].trim();if(a=u(y),a===void 0)if(typeof h=="function"){const b=h(t,s,n);a=hi(b)?b:""}else if(n&&Object.prototype.hasOwnProperty.call(n,y))a="";else if(c){a=s[0];continue}else this.logger.warn(`missed to pass in variable ${y} for interpolating ${t}`),a="";else!hi(a)&&!this.useRawValueToEscape&&(a=CF(a));const v=g.safeValue(a);if(t=t.replace(s[0],v),c?(g.regex.lastIndex+=a.length,g.regex.lastIndex-=s[0].length):g.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),t}nest(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n,s,a;const o=(l,u)=>{const h=this.nestingOptionsSeparator;if(l.indexOf(h)<0)return l;const c=l.split(new RegExp(`${h}[ ]*{`));let f=`{${c[1]}`;l=c[0],f=this.interpolate(f,a);const m=f.match(/'/g),g=f.match(/"/g);(((m==null?void 0:m.length)??0)%2===0&&!g||g.length%2!==0)&&(f=f.replace(/'/g,'"'));try{a=JSON.parse(f),u&&(a={...u,...a})}catch(y){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,y),`${l}${h}${f}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;n=this.nestingRegexp.exec(t);){let l=[];a={...r},a=a.replace&&!hi(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let u=!1;if(n[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(n[1])){const h=n[1].split(this.formatSeparator).map(c=>c.trim());n[1]=h.shift(),l=h,u=!0}if(s=i(o.call(this,n[1].trim(),a),a),s&&n[0]===t&&!hi(s))return s;hi(s)||(s=CF(s)),s||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${t}`),s=""),u&&(s=l.reduce((h,c)=>this.format(h,c,r.lng,{...r,interpolationkey:n[1].trim()}),s.trim())),t=t.replace(n[0],s),this.regexp.lastIndex=0}return t}}const n2e=e=>{let t=e.toLowerCase().trim();const i={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const n=r[1].substring(0,r[1].length-1);t==="currency"&&n.indexOf(":")<0?i.currency||(i.currency=n.trim()):t==="relativetime"&&n.indexOf(":")<0?i.range||(i.range=n.trim()):n.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),h=o.trim();i[h]||(i[h]=u),u==="false"&&(i[h]=!1),u==="true"&&(i[h]=!0),isNaN(u)||(i[h]=parseInt(u,10))}})}return{formatName:t,formatOptions:i}},wp=e=>{const t={};return(i,r,n)=>{let s=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(s={...s,[n.interpolationkey]:void 0});const a=r+JSON.stringify(s);let o=t[a];return o||(o=e(u_(r),n),t[a]=o),o(i)}};class s2e{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Il.create("formatter"),this.options=t,this.formats={number:wp((i,r)=>{const n=new Intl.NumberFormat(i,{...r});return s=>n.format(s)}),currency:wp((i,r)=>{const n=new Intl.NumberFormat(i,{...r,style:"currency"});return s=>n.format(s)}),datetime:wp((i,r)=>{const n=new Intl.DateTimeFormat(i,{...r});return s=>n.format(s)}),relativetime:wp((i,r)=>{const n=new Intl.RelativeTimeFormat(i,{...r});return s=>n.format(s,r.range||"day")}),list:wp((i,r)=>{const n=new Intl.ListFormat(i,{...r});return s=>n.format(s)})},this.init(t)}init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=i.interpolation.formatSeparator||","}add(t,i){this.formats[t.toLowerCase().trim()]=i}addCached(t,i){this.formats[t.toLowerCase().trim()]=wp(i)}format(t,i,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=i.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{var c;const{formatName:u,formatOptions:h}=n2e(l);if(this.formats[u]){let f=o;try{const m=((c=n==null?void 0:n.formatParams)==null?void 0:c[n.interpolationkey])||{},g=m.locale||m.lng||n.locale||n.lng||r;f=this.formats[u](o,g,{...h,...n,...m})}catch(m){this.logger.warn(m)}return f}else this.logger.warn(`there was no format function for ${u}`);return o},t)}}const a2e=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class o2e extends oS{constructor(t,i,r){var s,a;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=t,this.store=i,this.services=r,this.languageUtils=r.languageUtils,this.options=n,this.logger=Il.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],(a=(s=this.backend)==null?void 0:s.init)==null||a.call(s,r,n.backend,n)}queueLoad(t,i,r,n){const s={},a={},o={},l={};return t.forEach(u=>{let h=!0;i.forEach(c=>{const f=`${u}|${c}`;!r.reload&&this.store.hasResourceBundle(u,c)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?a[f]===void 0&&(a[f]=!0):(this.state[f]=1,h=!1,a[f]===void 0&&(a[f]=!0),s[f]===void 0&&(s[f]=!0),l[c]===void 0&&(l[c]=!0)))}),h||(o[u]=!0)}),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(t,i,r){const n=t.split("|"),s=n[0],a=n[1];i&&this.emit("failedLoading",s,a,i),!i&&r&&this.store.addResourceBundle(s,a,r,void 0,void 0,{skipCopy:!0}),this.state[t]=i?-1:2,i&&r&&(this.state[t]=0);const o={};this.queue.forEach(l=>{XTe(l.loaded,[s],a),a2e(l,t),i&&l.errors.push(i),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const h=l.loaded[u];h.length&&h.forEach(c=>{o[u][c]===void 0&&(o[u][c]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(t,i,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!t.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:i,fcName:r,tried:n,wait:s,callback:a});return}this.readingCalls++;const o=(u,h)=>{if(this.readingCalls--,this.waitingReads.length>0){const c=this.waitingReads.shift();this.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}if(u&&h&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,t,i,r,n+1,s*2,a)},s);return}a(u,h)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const u=l(t,i);u&&typeof u.then=="function"?u.then(h=>o(null,h)).catch(o):o(null,u)}catch(u){o(u)}return}return l(t,i,o)}prepareLoading(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();hi(t)&&(t=this.languageUtils.toResolveHierarchy(t)),hi(i)&&(i=[i]);const s=this.queueLoad(t,i,r,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach(a=>{this.loadOne(a)})}load(t,i,r){this.prepareLoading(t,i,{},r)}reload(t,i,r){this.prepareLoading(t,i,{reload:!0},r)}loadOne(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=t.split("|"),n=r[0],s=r[1];this.read(n,s,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${i}loading namespace ${s} for language ${n} failed`,a),!a&&o&&this.logger.log(`${i}loaded namespace ${s} for language ${n}`,o),this.loaded(t,a,o)})}saveMissing(t,i,r,n,s){var l,u,h,c,f;let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((u=(l=this.services)==null?void 0:l.utils)!=null&&u.hasLoadedNamespace&&!((c=(h=this.services)==null?void 0:h.utils)!=null&&c.hasLoadedNamespace(i))){this.logger.warn(`did not save key "${r}" as the namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if((f=this.backend)!=null&&f.create){const m={...a,isUpdate:s},g=this.backend.create.bind(this.backend);if(g.length<6)try{let y;g.length===5?y=g(t,i,r,n,m):y=g(t,i,r,n),y&&typeof y.then=="function"?y.then(v=>o(null,v)).catch(o):o(null,y)}catch(y){o(y)}else g(t,i,r,n,o,m)}!t||!t[0]||this.store.addResource(t[0],i,r,n)}}}const zF=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),hi(e[1])&&(t.defaultValue=e[1]),hi(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const i=e[3]||e[2];Object.keys(i).forEach(r=>{t[r]=i[r]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),NF=e=>{var t,i;return hi(e.ns)&&(e.ns=[e.ns]),hi(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),hi(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((i=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:i.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},Jx=()=>{},l2e=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(i=>{typeof e[i]=="function"&&(e[i]=e[i].bind(e))})};class By extends oS{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(super(),this.options=NF(t),this.services={},this.logger=Il,this.modules={external:[]},l2e(this),i&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,i),this;setTimeout(()=>{this.init(t,i)},0)}}init(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof i=="function"&&(r=i,i={}),i.defaultNS==null&&i.ns&&(hi(i.ns)?i.defaultNS=i.ns:i.ns.indexOf("translation")<0&&(i.defaultNS=i.ns[0]));const n=zF();this.options={...n,...this.options,...NF(i)},this.options.interpolation={...n.interpolation,...this.options.interpolation},i.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=i.keySeparator),i.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=i.nsSeparator);const s=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?Il.init(s(this.modules.logger),this.options):Il.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:h=s2e;const c=new RF(this.options);this.store=new DF(this.options.resources,this.options);const f=this.services;f.logger=Il,f.resourceStore=this.store,f.languageUtils=c,f.pluralResolver=new i2e(c,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),h&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(f.formatter=s(h),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new r2e(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new o2e(s(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(m){for(var g=arguments.length,y=new Array(g>1?g-1:0),v=1;v<g;v++)y[v-1]=arguments[v];t.emit(m,...y)}),this.modules.languageDetector&&(f.languageDetector=s(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=s(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new c_(this.services,this.options),this.translator.on("*",function(m){for(var g=arguments.length,y=new Array(g>1?g-1:0),v=1;v<g;v++)y[v-1]=arguments[v];t.emit(m,...y)}),this.modules.external.forEach(m=>{m.init&&m.init(this)})}if(this.format=this.options.interpolation.format,r||(r=Jx),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=function(){return t.store[h](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=function(){return t.store[h](...arguments),t}});const l=pv(),u=()=>{const h=(c,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(f),r(c,f)};if(this.languages&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initAsync?u():setTimeout(u,0),l}loadResources(t){var s,a;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jx;const n=hi(t)?t:this.language;if(typeof t=="function"&&(r=t),!this.options.resources||this.options.partialBundledLanguages){if((n==null?void 0:n.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const o=[],l=u=>{if(!u||u==="cimode")return;this.services.languageUtils.toResolveHierarchy(u).forEach(c=>{c!=="cimode"&&o.indexOf(c)<0&&o.push(c)})};n?l(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(h=>l(h)),(a=(s=this.options.preload)==null?void 0:s.forEach)==null||a.call(s,u=>l(u)),this.services.backendConnector.load(o,this.options.ns,u=>{!u&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(u)})}else r(null)}reloadResources(t,i,r){const n=pv();return typeof t=="function"&&(r=t,t=void 0),typeof i=="function"&&(r=i,i=void 0),t||(t=this.languages),i||(i=this.options.ns),r||(r=Jx),this.services.backendConnector.reload(t,i,s=>{n.resolve(),r(s)}),n}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&W9.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1))for(let i=0;i<this.languages.length;i++){const r=this.languages[i];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(t,i){var r=this;this.isLanguageChangingTo=t;const n=pv();this.emit("languageChanging",t);const s=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,u)=>{u?(s(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,n.resolve(function(){return r.t(...arguments)}),i&&i(l,function(){return r.t(...arguments)})},o=l=>{var h,c;!t&&!l&&this.services.languageDetector&&(l=[]);const u=hi(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||s(u),this.translator.language||this.translator.changeLanguage(u),(c=(h=this.services.languageDetector)==null?void 0:h.cacheUserLanguage)==null||c.call(h,u)),this.loadResources(u,f=>{a(f,u)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(t),n}getFixedT(t,i,r){var n=this;const s=function(a,o){let l;if(typeof o!="object"){for(var u=arguments.length,h=new Array(u>2?u-2:0),c=2;c<u;c++)h[c-2]=arguments[c];l=n.options.overloadTranslationOptionHandler([a,o].concat(h))}else l={...o};l.lng=l.lng||s.lng,l.lngs=l.lngs||s.lngs,l.ns=l.ns||s.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||s.keyPrefix);const f=n.options.keySeparator||".";let m;return l.keyPrefix&&Array.isArray(a)?m=a.map(g=>`${l.keyPrefix}${f}${g}`):m=l.keyPrefix?`${l.keyPrefix}${f}${a}`:a,n.t(m,l)};return hi(t)?s.lng=t:s.lngs=t,s.ns=i,s.keyPrefix=r,s}t(){var n;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(n=this.translator)==null?void 0:n.translate(...i)}exists(){var n;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(n=this.translator)==null?void 0:n.exists(...i)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=i.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===0||u===2};if(i.precheck){const o=i.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(r,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,t)&&(!n||a(s,t)))}loadNamespaces(t,i){const r=pv();return this.options.ns?(hi(t)&&(t=[t]),t.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{r.resolve(),i&&i(n)}),r):(i&&i(),Promise.resolve())}loadLanguages(t,i){const r=pv();hi(t)&&(t=[t]);const n=this.options.preload||[],s=t.filter(a=>n.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return s.length?(this.options.preload=n.concat(s),this.loadResources(a=>{r.resolve(),i&&i(a)}),r):(i&&i(),Promise.resolve())}dir(t){var n,s;if(t||(t=this.resolvedLanguage||(((n=this.languages)==null?void 0:n.length)>0?this.languages[0]:this.language)),!t)return"rtl";const i=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=((s=this.services)==null?void 0:s.languageUtils)||new RF(zF());return i.indexOf(r.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;return new By(t,i)}cloneInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jx;const r=t.forkResourceStore;r&&delete t.forkResourceStore;const n={...this.options,...t,isClone:!0},s=new By(n);if((t.debug!==void 0||t.prefix!==void 0)&&(s.logger=s.logger.clone(t)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const o=Object.keys(this.store.data).reduce((l,u)=>(l[u]={...this.store.data[u]},Object.keys(l[u]).reduce((h,c)=>(h[c]={...l[u][c]},h),{})),{});s.store=new DF(o,n),s.services.resourceStore=s.store}return s.translator=new c_(s.services,n),s.translator.on("*",function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),h=1;h<l;h++)u[h-1]=arguments[h];s.emit(o,...u)}),s.init(n,i),s.translator.options=n,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Cs=By.createInstance();Cs.createInstance=By.createInstance;Cs.createInstance;Cs.dir;Cs.init;Cs.loadResources;Cs.reloadResources;Cs.use;Cs.changeLanguage;Cs.getFixedT;const u2e=Cs.t;Cs.exists;Cs.setDefaultNamespace;Cs.hasLoadedNamespace;Cs.loadNamespaces;Cs.loadLanguages;function wn(e,t){t===void 0&&(t={});var i=t.insertAt;if(e&&typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",i==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}wn(`.react-loading-indicator-normalize,
[class$=rli-bounding-box] {
  font-size: 1rem;
  display: inline-block;
  box-sizing: border-box;
  text-align: unset;
  isolation: isolate;
}

.rli-d-i-b {
  display: inline-block;
}

.rli-text-format {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
  width: 90%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.7em;
  letter-spacing: 0.5px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Avenir Next", "Avenir", "Segoe UI", "Lucida Grande", "Helvetica Neue", "Helvetica", "Fira Sans", "Roboto", "Noto", "Droid Sans", "Cantarell", "Oxygen", "Ubuntu", "Franklin Gothic Medium", "Century Gothic", "Liberation Sans", sans-serif;
}`);var gi=function(){return gi=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},gi.apply(this,arguments)};function d_(e){return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d_(e)}var h2e=/^\s+/,c2e=/\s+$/;function Mt(e,t){if(t=t||{},(e=e||"")instanceof Mt)return e;if(!(this instanceof Mt))return new Mt(e,t);var i=function(r){var n={r:0,g:0,b:0},s=1,a=null,o=null,l=null,u=!1,h=!1;typeof r=="string"&&(r=function(g){g=g.replace(h2e,"").replace(c2e,"").toLowerCase();var y,v=!1;if(LP[g])g=LP[g],v=!0;else if(g=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(y=Do.rgb.exec(g))?{r:y[1],g:y[2],b:y[3]}:(y=Do.rgba.exec(g))?{r:y[1],g:y[2],b:y[3],a:y[4]}:(y=Do.hsl.exec(g))?{h:y[1],s:y[2],l:y[3]}:(y=Do.hsla.exec(g))?{h:y[1],s:y[2],l:y[3],a:y[4]}:(y=Do.hsv.exec(g))?{h:y[1],s:y[2],v:y[3]}:(y=Do.hsva.exec(g))?{h:y[1],s:y[2],v:y[3],a:y[4]}:(y=Do.hex8.exec(g))?{r:Ca(y[1]),g:Ca(y[2]),b:Ca(y[3]),a:HF(y[4]),format:v?"name":"hex8"}:(y=Do.hex6.exec(g))?{r:Ca(y[1]),g:Ca(y[2]),b:Ca(y[3]),format:v?"name":"hex"}:(y=Do.hex4.exec(g))?{r:Ca(y[1]+""+y[1]),g:Ca(y[2]+""+y[2]),b:Ca(y[3]+""+y[3]),a:HF(y[4]+""+y[4]),format:v?"name":"hex8"}:(y=Do.hex3.exec(g))?{r:Ca(y[1]+""+y[1]),g:Ca(y[2]+""+y[2]),b:Ca(y[3]+""+y[3]),format:v?"name":"hex"}:!1}(r)),d_(r)=="object"&&(xu(r.r)&&xu(r.g)&&xu(r.b)?(c=r.r,f=r.g,m=r.b,n={r:255*xr(c,255),g:255*xr(f,255),b:255*xr(m,255)},u=!0,h=String(r.r).substr(-1)==="%"?"prgb":"rgb"):xu(r.h)&&xu(r.s)&&xu(r.v)?(a=Ov(r.s),o=Ov(r.v),n=function(g,y,v){g=6*xr(g,360),y=xr(y,100),v=xr(v,100);var b=Math.floor(g),S=g-b,_=v*(1-y),T=v*(1-S*y),M=v*(1-(1-S)*y),C=b%6,P=[v,T,_,_,M,v][C],E=[M,v,v,T,_,_][C],D=[_,_,M,v,v,T][C];return{r:255*P,g:255*E,b:255*D}}(r.h,a,o),u=!0,h="hsv"):xu(r.h)&&xu(r.s)&&xu(r.l)&&(a=Ov(r.s),l=Ov(r.l),n=function(g,y,v){var b,S,_;function T(P,E,D){return D<0&&(D+=1),D>1&&(D-=1),D<1/6?P+6*(E-P)*D:D<.5?E:D<2/3?P+(E-P)*(2/3-D)*6:P}if(g=xr(g,360),y=xr(y,100),v=xr(v,100),y===0)b=S=_=v;else{var M=v<.5?v*(1+y):v+y-v*y,C=2*v-M;b=T(C,M,g+1/3),S=T(C,M,g),_=T(C,M,g-1/3)}return{r:255*b,g:255*S,b:255*_}}(r.h,a,l),u=!0,h="hsl"),r.hasOwnProperty("a")&&(s=r.a));var c,f,m;return s=q9(s),{ok:u,format:r.format||h,r:Math.min(255,Math.max(n.r,0)),g:Math.min(255,Math.max(n.g,0)),b:Math.min(255,Math.max(n.b,0)),a:s}}(e);this._originalInput=e,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||i.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function BF(e,t,i){e=xr(e,255),t=xr(t,255),i=xr(i,255);var r,n,s=Math.max(e,t,i),a=Math.min(e,t,i),o=(s+a)/2;if(s==a)r=n=0;else{var l=s-a;switch(n=o>.5?l/(2-s-a):l/(s+a),s){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,l:o}}function FF(e,t,i){e=xr(e,255),t=xr(t,255),i=xr(i,255);var r,n,s=Math.max(e,t,i),a=Math.min(e,t,i),o=s,l=s-a;if(n=s===0?0:l/s,s==a)r=0;else{switch(s){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,v:o}}function UF(e,t,i,r){var n=[Bo(Math.round(e).toString(16)),Bo(Math.round(t).toString(16)),Bo(Math.round(i).toString(16))];return r&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function VF(e,t,i,r){return[Bo(X9(r)),Bo(Math.round(e).toString(16)),Bo(Math.round(t).toString(16)),Bo(Math.round(i).toString(16))].join("")}function d2e(e,t){t=t===0?0:t||10;var i=Mt(e).toHsl();return i.s-=t/100,i.s=lS(i.s),Mt(i)}function f2e(e,t){t=t===0?0:t||10;var i=Mt(e).toHsl();return i.s+=t/100,i.s=lS(i.s),Mt(i)}function p2e(e){return Mt(e).desaturate(100)}function m2e(e,t){t=t===0?0:t||10;var i=Mt(e).toHsl();return i.l+=t/100,i.l=lS(i.l),Mt(i)}function g2e(e,t){t=t===0?0:t||10;var i=Mt(e).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),Mt(i)}function v2e(e,t){t=t===0?0:t||10;var i=Mt(e).toHsl();return i.l-=t/100,i.l=lS(i.l),Mt(i)}function y2e(e,t){var i=Mt(e).toHsl(),r=(i.h+t)%360;return i.h=r<0?360+r:r,Mt(i)}function x2e(e){var t=Mt(e).toHsl();return t.h=(t.h+180)%360,Mt(t)}function jF(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var i=Mt(e).toHsl(),r=[Mt(e)],n=360/t,s=1;s<t;s++)r.push(Mt({h:(i.h+s*n)%360,s:i.s,l:i.l}));return r}function b2e(e){var t=Mt(e).toHsl(),i=t.h;return[Mt(e),Mt({h:(i+72)%360,s:t.s,l:t.l}),Mt({h:(i+216)%360,s:t.s,l:t.l})]}function w2e(e,t,i){t=t||6,i=i||30;var r=Mt(e).toHsl(),n=360/i,s=[Mt(e)];for(r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,s.push(Mt(r));return s}function _2e(e,t){t=t||6;for(var i=Mt(e).toHsv(),r=i.h,n=i.s,s=i.v,a=[],o=1/t;t--;)a.push(Mt({h:r,s:n,v:s})),s=(s+o)%1;return a}Mt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,i,r=this.toRgb();return e=r.r/255,t=r.g/255,i=r.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},setAlpha:function(e){return this._a=q9(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=FF(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=FF(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.v);return this._a==1?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=BF(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=BF(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.l);return this._a==1?"hsl("+t+", "+i+"%, "+r+"%)":"hsla("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return UF(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(t,i,r,n,s){var a=[Bo(Math.round(t).toString(16)),Bo(Math.round(i).toString(16)),Bo(Math.round(r).toString(16)),Bo(X9(n))];return s&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*xr(this._r,255))+"%",g:Math.round(100*xr(this._g,255))+"%",b:Math.round(100*xr(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*xr(this._r,255))+"%, "+Math.round(100*xr(this._g,255))+"%, "+Math.round(100*xr(this._b,255))+"%)":"rgba("+Math.round(100*xr(this._r,255))+"%, "+Math.round(100*xr(this._g,255))+"%, "+Math.round(100*xr(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(S2e[UF(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+VF(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var n=Mt(e);i="#"+VF(n._r,n._g,n._b,n._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0;return t||!r||e!=="hex"&&e!=="hex6"&&e!=="hex3"&&e!=="hex4"&&e!=="hex8"&&e!=="name"?(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),e!=="hex"&&e!=="hex6"||(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString()):e==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return Mt(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(m2e,arguments)},brighten:function(){return this._applyModification(g2e,arguments)},darken:function(){return this._applyModification(v2e,arguments)},desaturate:function(){return this._applyModification(d2e,arguments)},saturate:function(){return this._applyModification(f2e,arguments)},greyscale:function(){return this._applyModification(p2e,arguments)},spin:function(){return this._applyModification(y2e,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(w2e,arguments)},complement:function(){return this._applyCombination(x2e,arguments)},monochromatic:function(){return this._applyCombination(_2e,arguments)},splitcomplement:function(){return this._applyCombination(b2e,arguments)},triad:function(){return this._applyCombination(jF,[3])},tetrad:function(){return this._applyCombination(jF,[4])}},Mt.fromRatio=function(e,t){if(d_(e)=="object"){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=r==="a"?e[r]:Ov(e[r]));e=i}return Mt(e,t)},Mt.equals=function(e,t){return!(!e||!t)&&Mt(e).toRgbString()==Mt(t).toRgbString()},Mt.random=function(){return Mt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},Mt.mix=function(e,t,i){i=i===0?0:i||50;var r=Mt(e).toRgb(),n=Mt(t).toRgb(),s=i/100;return Mt({r:(n.r-r.r)*s+r.r,g:(n.g-r.g)*s+r.g,b:(n.b-r.b)*s+r.b,a:(n.a-r.a)*s+r.a})},Mt.readability=function(e,t){var i=Mt(e),r=Mt(t);return(Math.max(i.getLuminance(),r.getLuminance())+.05)/(Math.min(i.getLuminance(),r.getLuminance())+.05)},Mt.isReadable=function(e,t,i){var r,n,s=Mt.readability(e,t);switch(n=!1,(r=function(a){var o,l;return o=((a=a||{level:"AA",size:"small"}).level||"AA").toUpperCase(),l=(a.size||"small").toLowerCase(),o!=="AA"&&o!=="AAA"&&(o="AA"),l!=="small"&&l!=="large"&&(l="small"),{level:o,size:l}}(i)).level+r.size){case"AAsmall":case"AAAlarge":n=s>=4.5;break;case"AAlarge":n=s>=3;break;case"AAAsmall":n=s>=7}return n},Mt.mostReadable=function(e,t,i){var r,n,s,a,o=null,l=0;n=(i=i||{}).includeFallbackColors,s=i.level,a=i.size;for(var u=0;u<t.length;u++)(r=Mt.readability(e,t[u]))>l&&(l=r,o=Mt(t[u]));return Mt.isReadable(e,o,{level:s,size:a})||!n?o:(i.includeFallbackColors=!1,Mt.mostReadable(e,["#fff","#000"],i))};var LP=Mt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},S2e=Mt.hexNames=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}(LP);function q9(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function xr(e,t){(function(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1})(e)&&(e="100%");var i=function(r){return typeof r=="string"&&r.indexOf("%")!=-1}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function lS(e){return Math.min(1,Math.max(0,e))}function Ca(e){return parseInt(e,16)}function Bo(e){return e.length==1?"0"+e:""+e}function Ov(e){return e<=1&&(e=100*e+"%"),e}function X9(e){return Math.round(255*parseFloat(e)).toString(16)}function HF(e){return Ca(e)/255}var Hh,$x,eb,Do=($x="[\\s|\\(]+("+(Hh="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Hh+")[,|\\s]+("+Hh+")\\s*\\)?",eb="[\\s|\\(]+("+Hh+")[,|\\s]+("+Hh+")[,|\\s]+("+Hh+")[,|\\s]+("+Hh+")\\s*\\)?",{CSS_UNIT:new RegExp(Hh),rgb:new RegExp("rgb"+$x),rgba:new RegExp("rgba"+eb),hsl:new RegExp("hsl"+$x),hsla:new RegExp("hsla"+eb),hsv:new RegExp("hsv"+$x),hsva:new RegExp("hsva"+eb),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function xu(e){return!!Do.CSS_UNIT.exec(e)}var ig=function(e,t){var i=(typeof e=="string"?parseInt(e):e)||0;if(i>=-5&&i<=5){var r=i,n=parseFloat(t),s=n+r*(n/5)*-1;return(s==0||s<=Number.EPSILON)&&(s=.1),{animationPeriod:s+"s"}}return{animationPeriod:t}},rg=function(e,t){var i=e||{},r="";switch(t){case"small":r="12px";break;case"medium":r="16px";break;case"large":r="20px";break;default:r=void 0}var n={};if(i.fontSize){var s=i.fontSize;n=function(a,o){var l={};for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&o.indexOf(u)<0&&(l[u]=a[u]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var h=0;for(u=Object.getOwnPropertySymbols(a);h<u.length;h++)o.indexOf(u[h])<0&&Object.prototype.propertyIsEnumerable.call(a,u[h])&&(l[u[h]]=a[u[h]])}return l}(i,["fontSize"]),r=s}return{fontSize:r,styles:n}},E2e={color:"currentColor",mixBlendMode:"difference",width:"unset",display:"block",paddingTop:"2px"},ng=function(e){var t=e.className,i=e.text,r=e.textColor,n=e.staticText,s=e.style;return i?Fi.createElement("span",{className:"rli-d-i-b rli-text-format ".concat(t||"").trim(),style:gi(gi(gi({},n&&E2e),r&&{color:r,mixBlendMode:"unset"}),s&&s)},typeof i=="string"&&i.length?i:"loading"):null},Rl="rgb(50, 205, 50)";function sg(e,t){t===void 0&&(t=0);var i=[];return function r(n,s){return s===void 0&&(s=0),i.push.apply(i,n),i.length<s&&r(i,s),i.slice(0,s)}(e,t)}wn(`.atom-rli-bounding-box {
  --atom-phase1-rgb: 50, 205, 50;
  color: rgba(var(--atom-phase1-rgb), 1);
  font-size: 16px;
  position: relative;
  text-align: unset;
  isolation: isolate;
}
.atom-rli-bounding-box .atom-indicator {
  width: 6em;
  height: 6em;
  position: relative;
  perspective: 6em;
  overflow: hidden;
  color: rgba(var(--atom-phase1-rgb), 1);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6fj;
}
.atom-rli-bounding-box .atom-indicator::after, .atom-rli-bounding-box .atom-indicator::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 0.48em;
  height: 0.48em;
  margin: auto;
  border-radius: 50%;
  background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6de;
}
.atom-rli-bounding-box .atom-indicator::before {
  filter: drop-shadow(0px 0px 0.0625em currentColor);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit {
  color: rgba(var(--atom-phase1-rgb), 0.85);
  border: 0;
  border-left: 0.4em solid currentColor;
  box-sizing: border-box;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 4.8em;
  height: 4.8em;
  background-color: transparent;
  border-radius: 50%;
  transform-style: preserve-3d;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite u1qz6ex, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6g6;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  color: rgba(var(--atom-phase1-rgb), 0.18);
  animation: calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6h4;
  border: 0.125em solid currentColor;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit::before {
  content: "";
  width: 0.192em;
  height: 0.192em;
  position: absolute;
  border-radius: 50%;
  top: -0.096em;
  right: 0;
  bottom: 0;
  left: 0;
  margin: 0 auto;
  color: rgba(var(--atom-phase1-rgb), 1);
  box-shadow: 0px 0px 0.0625em 0.0625em currentColor, 0px 0px 0.0625em 0.125em currentColor;
  background-color: currentColor;
  transform: rotateY(-70deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite u1qz6e7, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6fj;
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(1) {
  --orbit-vector-factor: -1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(2) {
  --orbit-vector-factor: 1;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3) {
  --orbit-vector-factor: 0;
  transform: rotateY(65deg) rotateX(calc(54deg * var(--orbit-vector-factor)));
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-indicator .electron-orbit:nth-of-type(3)::before {
  animation-delay: calc(var(--rli-animation-duration, 1s) * 0.5 * -1), calc(var(--rli-animation-duration, 1s) * 4 * -1);
}
.atom-rli-bounding-box .atom-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --atom-phase1-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase2-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase3-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --atom-phase4-rgb {
  syntax: "<number>#";
  inherits: true;
  initial-value: 50, 205, 50;
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes u1qz6ex {
  from {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(0deg);
  }
  to {
    transform: rotateY(70deg) rotateX(calc(54deg * var(--orbit-vector-factor))) rotateZ(360deg);
  }
}
@keyframes u1qz6e7 {
  from {
    transform: rotateY(-70deg) rotateX(0deg);
  }
  to {
    transform: rotateY(-70deg) rotateX(-360deg);
  }
}
@keyframes u1qz6de {
  100%, 0% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  20% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase1-rgb), 0.1), rgba(var(--atom-phase1-rgb), 0.3) 37%, rgba(var(--atom-phase1-rgb), 1) 100%);
  }
  25% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  45% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  50% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  70% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  75% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
  95% {
    background-image: radial-gradient(circle at 35% 15%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.1), rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.3) 37%, rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1) 100%);
  }
}
@keyframes u1qz6fj {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 1);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 1);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 1);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 1);
  }
}
@keyframes u1qz6g6 {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.85);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.85);
  }
}
@keyframes u1qz6h4 {
  100%, 0% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  20% {
    color: rgba(var(--atom-phase1-rgb), 0.18);
  }
  25% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  45% {
    color: rgba(var(--atom-phase2-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  50% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  70% {
    color: rgba(var(--atom-phase3-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  75% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
  95% {
    color: rgba(var(--atom-phase4-rgb, var(--atom-phase1-rgb)), 0.18);
  }
}`);Mt(Rl).toRgb();Array.from({length:4},function(e,t){return"--atom-phase".concat(t+1,"-rgb")});wn(`.commet-rli-bounding-box {
  --commet-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  width: 6.85em;
  height: 6.85em;
  overflow: hidden;
  display: inline-block;
  box-sizing: border-box;
  position: relative;
  isolation: isolate;
}
.commet-rli-bounding-box .commet-indicator {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  box-sizing: border-box;
  width: 6em;
  height: 6em;
  color: var(--commet-phase1-color);
  display: inline-block;
  isolation: isolate;
  position: absolute;
  z-index: 0;
  animation: calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite u1qz6k3;
}
.commet-rli-bounding-box .commet-indicator .commet-box {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  animation: u1qz6j2 var(--rli-animation-duration, 1.2s) var(--rli-animation-function, cubic-bezier(0.08, 0.03, 0.91, 0.93)) infinite;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(1) {
  width: 100%;
  height: 100%;
  animation-direction: normal;
}
.commet-rli-bounding-box .commet-indicator .commet-box:nth-of-type(2) {
  width: 70%;
  height: 70%;
  animation-direction: reverse;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  display: inline-block;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commetball-box::before {
  content: "";
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  background-color: currentColor;
  position: absolute;
  top: -0.125em;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 0 0.2em 0em currentColor, 0 0 0.6em 0em currentColor;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  bottom: 0;
  left: 0;
  border-radius: 50%;
  box-sizing: border-box;
  border-style: solid;
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail1 {
  border-color: currentColor transparent transparent currentColor;
  border-width: 0.25em 0.25em 0 0;
  transform: rotateZ(-45deg);
}
.commet-rli-bounding-box .commet-indicator .commet-box .commet-trail.trail2 {
  border-color: currentColor currentColor transparent transparent;
  border-width: 0.25em 0 0 0.25em;
  transform: rotateZ(45deg);
}
.commet-rli-bounding-box .commet-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--commet-phase1-color);
}

@property --commet-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --commet-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6j2 {
  to {
    transform: rotate(1turn);
  }
}
@keyframes u1qz6k3 {
  100%, 0% {
    color: var(--commet-phase1-color);
  }
  20% {
    color: var(--commet-phase1-color);
  }
  25% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  45% {
    color: var(--commet-phase2-color, var(--commet-phase1-color));
  }
  50% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  70% {
    color: var(--commet-phase3-color, var(--commet-phase1-color));
  }
  75% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
  95% {
    color: var(--commet-phase4-color, var(--commet-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--commet-phase".concat(t+1,"-color")});wn(`.OP-annulus-rli-bounding-box {
  --OP-annulus-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .whirl {
  animation: u1qz6pz calc(var(--rli-animation-duration, 1.5s) * 1.33) linear infinite;
  height: 100%;
  transform-origin: center center;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
}
.OP-annulus-rli-bounding-box .OP-annulus-indicator .path {
  stroke-dasharray: 1, 125;
  stroke-dashoffset: 0;
  animation: var(--rli-animation-duration, 1.5s) var(--rli-animation-function, ease-in-out) infinite u1qz6r6, calc(var(--rli-animation-duration, 1.5s) * 4) var(--rli-animation-function, ease-in-out) infinite u1qz6sy;
  stroke-linecap: round;
}
.OP-annulus-rli-bounding-box .OP-annulus-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes u1qz6pz {
  100% {
    transform: rotate(360deg);
  }
}
@keyframes u1qz6r6 {
  0% {
    stroke-dasharray: 1, 125;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -35px;
  }
  100% {
    stroke-dasharray: 98, 125;
    stroke-dashoffset: -124px;
  }
}
@keyframes u1qz6sy {
  100%, 0% {
    stroke: var(--OP-annulus-phase1-color);
  }
  22% {
    stroke: var(--OP-annulus-phase1-color);
  }
  25% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  42% {
    stroke: var(--OP-annulus-phase2-color, var(--OP-annulus-phase1-color));
  }
  50% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  72% {
    stroke: var(--OP-annulus-phase3-color, var(--OP-annulus-phase1-color));
  }
  75% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
  97% {
    stroke: var(--OP-annulus-phase4-color, var(--OP-annulus-phase1-color));
  }
}`);var tb=Array.from({length:4},function(e,t){return"--OP-annulus-phase".concat(t+1,"-color")}),A2e=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"1.5s").animationPeriod,o=function(u){var h={},c=tb.length;if(u instanceof Array){for(var f=sg(u,c),m=0;m<f.length&&!(m>=4);m++)h[tb[m]]=f[m];return h}try{if(typeof u!="string")throw new Error("Color String expected");for(var g=0;g<c;g++)h[tb[g]]=u}catch(y){for(y instanceof Error?console.warn("[".concat(y.message,']: Received "').concat(typeof u,'" instead with value, ').concat(JSON.stringify(u))):console.warn("".concat(JSON.stringify(u),' received in <OrbitProgress variant="disc" /> indicator cannot be processed. Using default instead!')),g=0;g<c;g++)h[tb[g]]=Rl}return h}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:""),l=e!=null&&e.dense?4.3:2.9;return Fi.createElement("span",{className:"rli-d-i-b OP-annulus-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b OP-annulus-indicator"},Fi.createElement("svg",{className:"whirl",viewBox:"25 25 50 50"},Fi.createElement("circle",{className:"path",cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:l,strokeMiterlimit:"10"})),Fi.createElement(ng,{className:"OP-annulus-text",text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor})))};function nT(e){return e&&e.Math===Math&&e}wn(`.OP-dotted-rli-bounding-box {
  --OP-dotted-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-dotted-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .OP-dotted-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder .dot {
  display: block;
  margin: 0 auto;
  width: 15%;
  height: 15%;
  background-color: currentColor;
  border-radius: 50%;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) infinite u1qz6qy, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite u1qz6s0;
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) {
  transform: rotate(0deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(1) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 12 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) {
  transform: rotate(30deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(2) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 11 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) {
  transform: rotate(60deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(3) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 10 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) {
  transform: rotate(90deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(4) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 9 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) {
  transform: rotate(120deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(5) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 8 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) {
  transform: rotate(150deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(6) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 7 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) {
  transform: rotate(180deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(7) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 6 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) {
  transform: rotate(210deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(8) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 5 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) {
  transform: rotate(240deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(9) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 4 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) {
  transform: rotate(270deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(10) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 3 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) {
  transform: rotate(300deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(11) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 2 * -1);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) {
  transform: rotate(330deg);
}
.OP-dotted-rli-bounding-box .OP-dotted-indicator .dot-shape-holder:nth-of-type(12) .dot {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) / 12 * 1 * -1);
}

@property --OP-dotted-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-dotted-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6qy {
  0%, 39%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
@keyframes u1qz6s0 {
  100%, 0% {
    background-color: var(--OP-dotted-phase1-color);
  }
  22% {
    background-color: var(--OP-dotted-phase1-color);
  }
  25% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  47% {
    background-color: var(--OP-dotted-phase2-color, var(--OP-dotted-phase1-color));
  }
  50% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  72% {
    background-color: var(--OP-dotted-phase3-color, var(--OP-dotted-phase1-color));
  }
  75% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
  97% {
    background-color: var(--OP-dotted-phase4-color, var(--OP-dotted-phase1-color));
  }
}`);var _p=nT(typeof window=="object"&&window)||nT(typeof self=="object"&&self)||nT(typeof global=="object"&&global)||function(){return this}()||Function("return this")();function Y9(){var e,t;return!((e=_p==null?void 0:_p.crypto)===null||e===void 0)&&e.randomUUID?_p.crypto.randomUUID():!((t=_p==null?void 0:_p.btoa)===null||t===void 0)&&t.name?_p.btoa(new Date(Math.ceil(1e13*Math.random())).getTime()+""):Date.now().toString(36)+Math.random().toString(36).substring(0)}var ib=Array.from({length:4},function(e,t){return"--OP-dotted-phase".concat(t+1,"-color")}),C2e=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"1.2s").animationPeriod,o=function(u){var h={},c=ib.length;if(u instanceof Array){for(var f=sg(u,c),m=0;m<f.length&&!(m>=4);m++)h[ib[m]]=f[m];return h}try{if(typeof u!="string")throw new Error("Color String expected");for(var g=0;g<c;g++)h[ib[g]]=u}catch(y){for(y instanceof Error?console.warn("[".concat(y.message,']: Received "').concat(typeof u,'" with value, ').concat(JSON.stringify(u))):console.warn("".concat(JSON.stringify(u),' received in <OrbitProgress variant="dotted" /> indicator cannot be processed. Using default instead!')),g=0;g<c;g++)h[ib[g]]=Rl}return h}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:""),l=e!=null&&e.dense?16:12;return Fi.createElement("span",{className:"rli-d-i-b OP-dotted-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b OP-dotted-indicator"},Array.from({length:l}).map(function(u,h){var c=function(g,y,v){if(y===16){var b=360*g/y,S=y-g,_=Number.parseFloat(v)/y*S*-1;return{transform:"rotate(".concat(b,"deg)"),animationDelay:"".concat(_,"s")}}return{transform:"",animationDelay:""}}(h,l,a),f=c.animationDelay,m=c.transform;return Fi.createElement("span",{key:Y9(),className:"rli-d-i-b dot-shape-holder",style:m?{transform:m}:void 0},Fi.createElement("span",{className:"dot",style:f?{animationDelay:f}:void 0}))}),Fi.createElement(ng,{className:"OP-dotted-text",text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor})))};wn(`.OP-spokes-rli-bounding-box {
  --OP-spokes-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  position: relative;
  color: var(--OP-spokes-phase1-color);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator {
  width: 4.8em;
  height: 4.8em;
  display: block;
  position: relative;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke {
  position: absolute;
  height: 1.2em;
  width: 0.4em;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto auto auto 50%;
  background-color: var(--OP-spokes-phase1-color);
  border-radius: 0.24em;
  opacity: 0;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) backwards infinite u1qz6sz, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) infinite u1qz6t3;
  transform-origin: left center;
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(1) {
  transform: rotate(calc(0 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(11 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(2) {
  transform: rotate(calc(1 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(10 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(3) {
  transform: rotate(calc(2 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(9 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(4) {
  transform: rotate(calc(3 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(8 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(5) {
  transform: rotate(calc(4 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(7 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(6) {
  transform: rotate(calc(5 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(6 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(7) {
  transform: rotate(calc(6 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(5 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(8) {
  transform: rotate(calc(7 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(4 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(9) {
  transform: rotate(calc(8 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(3 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(10) {
  transform: rotate(calc(9 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(2 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(11) {
  transform: rotate(calc(10 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(1 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator .spoke:nth-of-type(12) {
  transform: rotate(calc(11 * 360deg / 12)) translate(-50%, -1.56em);
  animation-delay: calc(0 * var(--rli-animation-duration, 1.2s) / 12 * -1);
}
.OP-spokes-rli-bounding-box .OP-spokes-indicator-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--OP-spokes-phase1-color);
  z-index: -2;
}

@property --OP-spokes-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-spokes-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6sz {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@keyframes u1qz6t3 {
  100%, 0% {
    background-color: var(--OP-spokes-phase1-color);
  }
  22% {
    background-color: var(--OP-spokes-phase1-color);
  }
  25% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  42% {
    background-color: var(--OP-spokes-phase2-color, var(--OP-spokes-phase1-color));
  }
  50% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  72% {
    background-color: var(--OP-spokes-phase3-color, var(--OP-spokes-phase1-color));
  }
  75% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
  97% {
    background-color: var(--OP-spokes-phase4-color, var(--OP-spokes-phase1-color));
  }
}`);var rb=Array.from({length:4},function(e,t){return"--OP-spokes-phase".concat(t+1,"-color")}),T2e=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"1.2s").animationPeriod,o=function(u){var h={},c=rb.length;if(u instanceof Array){for(var f=sg(u,c),m=0;m<f.length&&!(m>=4);m++)h[rb[m]]=f[m];return h}try{if(typeof u!="string")throw new Error("Color String expected");for(var g=0;g<c;g++)h[rb[g]]=u}catch(y){for(y instanceof Error?console.warn("[".concat(y.message,']: Received "').concat(typeof u,'" instead with value, ').concat(JSON.stringify(u))):console.warn("".concat(JSON.stringify(u),' received in <OrbitProgress variant="spokes" /> indicator cannot be processed. Using default instead!')),g=0;g<c;g++)h[rb[g]]=Rl}return h}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:""),l=e!=null&&e.dense?16:12;return Fi.createElement("span",{className:"rli-d-i-b OP-spokes-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b OP-spokes-indicator"},Array.from({length:l},function(u,h){return Fi.createElement("span",{key:Y9(),className:"rli-d-i-b spoke",style:P2e(h,l,a)})})),Fi.createElement(ng,{text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor}))};function P2e(e,t,i){if(t===16){var r=t-e,n=Number.parseFloat(i)/t;return{transform:"rotate(".concat(360*e/t,"deg) translate(-50%, ").concat("-1.56em",")"),animationDelay:"".concat((r-1)*n*-1,"s")}}}wn(`.OP-annulus-dual-sectors-rli-bounding-box {
  --OP-annulus-dual-sectors-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  display: inline-block;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator {
  width: 5em;
  height: 5em;
  display: inline-block;
  position: relative;
  z-index: 0;
  color: var(--OP-annulus-dual-sectors-phase1-color);
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .annulus-sectors {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border-width: 0.34em;
  border-style: solid;
  border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent var(--OP-annulus-dual-sectors-phase1-color) transparent;
  background-color: transparent;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) infinite u1qz6t5, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) infinite u1qz6uw;
}
.OP-annulus-dual-sectors-rli-bounding-box .OP-annulus-dual-sectors-indicator .OP-annulus-dual-sectors-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-dual-sectors-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-dual-sectors-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6t5 {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes u1qz6uw {
  100%, 0% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  20% {
    border-color: var(--OP-annulus-dual-sectors-phase1-color) transparent;
  }
  25% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  45% {
    border-color: var(--OP-annulus-dual-sectors-phase2-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  50% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  70% {
    border-color: var(--OP-annulus-dual-sectors-phase3-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  75% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
  95% {
    border-color: var(--OP-annulus-dual-sectors-phase4-color, var(--OP-annulus-dual-sectors-phase1-color)) transparent;
  }
}`);var nb=Array.from({length:4},function(e,t){return"--OP-annulus-dual-sectors-phase".concat(t+1,"-color")}),M2e=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"1.2s").animationPeriod,o=function(u){var h={},c=nb.length;if(u instanceof Array){for(var f=sg(u,c),m=0;m<f.length&&!(m>=4);m++)h[nb[m]]=f[m];return h}try{if(typeof u!="string")throw new Error("Color String expected");for(var g=0;g<c;g++)h[nb[g]]=u}catch(y){for(y instanceof Error?console.warn("[".concat(y.message,']: Received "').concat(typeof u,'" with value, ').concat(JSON.stringify(u))):console.warn("".concat(JSON.stringify(u),' received in <OrbitProgress variant="annulus-splits" /> indicator cannot be processed. Using default instead!')),g=0;g<c;g++)h[nb[g]]=Rl}return h}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:""),l=e.dense?"0.45em":"";return Fi.createElement("span",{className:"rli-d-i-b OP-annulus-dual-sectors-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b OP-annulus-dual-sectors-indicator"},Fi.createElement("span",{className:"rli-d-i-b annulus-sectors",style:gi({},l&&{borderWidth:l})}),Fi.createElement(ng,{className:"OP-annulus-dual-sectors-text",text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor})))};wn(`.OP-annulus-sector-track-rli-bounding-box {
  --OP-annulus-track-phase1-color: rgba(50, 205, 50, 0.22);
  --OP-annulus-sector-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator {
  width: 5em;
  height: 5em;
  color: var(--OP-annulus-sector-phase1-color);
  display: inline-block;
  position: relative;
  z-index: 0;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .annulus-track-ring {
  width: 100%;
  height: 100%;
  border-width: 0.34em;
  border-style: solid;
  border-radius: 50%;
  box-sizing: border-box;
  border-color: var(--OP-annulus-track-phase1-color);
  border-top-color: var(--OP-annulus-sector-phase1-color);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, linear) infinite u1qz6tq, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, linear) infinite u1qz6v8;
}
.OP-annulus-sector-track-rli-bounding-box .OP-annulus-sector-track-indicator .OP-annulus-sector-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --OP-annulus-track-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-track-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgba(50, 205, 50, 0.22);
}
@property --OP-annulus-sector-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --OP-annulus-sector-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes u1qz6tq {
  to {
    transform: rotate(1turn);
  }
}
@keyframes u1qz6v8 {
  100%, 0% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  18% {
    border-color: var(--OP-annulus-track-phase1-color);
    border-top-color: var(--OP-annulus-sector-phase1-color);
  }
  25% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  43% {
    border-color: var(--OP-annulus-track-phase2-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase2-color, var(--OP-annulus-sector-phase1-color));
  }
  50% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  68% {
    border-color: var(--OP-annulus-track-phase3-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase3-color, var(--OP-annulus-sector-phase1-color));
  }
  75% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
  93% {
    border-color: var(--OP-annulus-track-phase4-color, var(--OP-annulus-track-phase1-color));
    border-top-color: var(--OP-annulus-sector-phase4-color, var(--OP-annulus-sector-phase1-color));
  }
}`);var mv=Array.from({length:4},function(e,t){return["--OP-annulus-track-phase".concat(t+1,"-color"),"--OP-annulus-sector-phase".concat(t+1,"-color")]}),sb=function(e){return e===void 0&&(e=1),.25*e},D2e=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"1s").animationPeriod,o=function(u){var h={},c=mv.length;if(u instanceof Array){for(var f=sg(u,c),m=0;m<f.length&&!(m>=4);m++){var g=mv[m];try{if(!(b=Mt(f[m])).isValid())throw new Error("Invalid Color: ".concat(b.getOriginalInput()));var y=b.setAlpha(sb(b.getAlpha())).toRgbString(),v=f[m];h[g[0]]=y,h[g[1]]=v}catch{v=Rl,y=(b=Mt(Rl)).setAlpha(sb(b.getAlpha())).toRgbString(),h[g[0]]=y,h[g[1]]=v}}return h}try{var b=Mt(u);if(typeof u!="string")throw new Error("Color String expected");if(!b.isValid())throw new Error("Invalid Color: ".concat(b.getOriginalInput()));v=u,y=b.setAlpha(sb(b.getAlpha())).toRgbString();for(var S=0;S<c;S++)h[(g=mv[S])[0]]=y,h[g[1]]=v}catch(_){for(_ instanceof Error?console.warn("[".concat(_.message,']: Received "').concat(typeof u,'" with value, ').concat(JSON.stringify(u))):console.warn("".concat(JSON.stringify(u),' received in <OrbitProgress variant="annulus-track" /> indicator cannot be processed. Using default instead!')),v=Rl,y=(b=Mt(Rl)).setAlpha(sb(b.getAlpha())).toRgbString(),S=0;S<mv.length;S++)h[(g=mv[S])[0]]=y,h[g[1]]=v}return h}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:""),l=e.dense?"0.45em":"";return Fi.createElement("span",{className:"rli-d-i-b OP-annulus-sector-track-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b OP-annulus-sector-track-indicator"},Fi.createElement("span",{className:"rli-d-i-b annulus-track-ring",style:gi({},l&&{borderWidth:l})}),Fi.createElement(ng,{className:"OP-annulus-sector-text",text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor})))},I2e=function(e){var t=Object(e).variant,i=t===void 0?"disc":t;return i==="dotted"?Fi.createElement(C2e,gi({},e)):i==="spokes"?Fi.createElement(T2e,gi({},e)):i==="disc"?Fi.createElement(A2e,gi({},e)):i==="split-disc"?Fi.createElement(M2e,gi({},e)):i==="track-disc"?Fi.createElement(D2e,gi({},e)):null};wn(`.foursquare-rli-bounding-box {
  --four-square-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  box-sizing: border-box;
  color: var(--four-square-phase1-color);
  display: inline-block;
  overflow: hidden;
}
.foursquare-rli-bounding-box .foursquare-indicator {
  height: 5.3033008589em;
  width: 5.3033008589em;
  position: relative;
  display: block;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container {
  position: absolute;
  z-index: 0;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  height: 2.5em;
  width: 2.5em;
  color: inherit;
  will-change: color, width, height;
  transform: rotate(45deg);
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite u1qz6cv, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) infinite u1qz6e3;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square {
  position: absolute;
  width: 1.25em;
  height: 1.25em;
  border-radius: 0.1875em;
  background-color: currentColor;
  animation: u1qz6cr var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0.05, 0.28, 0.79, 0.98)) both infinite;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square1 {
  top: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square2 {
  top: 0;
  right: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square3 {
  bottom: 0;
  left: 0;
}
.foursquare-rli-bounding-box .foursquare-indicator .squares-container .square.square4 {
  bottom: 0;
  right: 0;
}

@property --four-square-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --four-square-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes u1qz6cv {
  0% {
    width: 2.5em;
    height: 2.5em;
  }
  10% {
    width: 2.5em;
    height: 2.5em;
  }
  50% {
    width: 3.75em;
    height: 3.75em;
  }
  90% {
    width: 2.5em;
    height: 2.5em;
  }
  100% {
    width: 2.5em;
    height: 2.5em;
  }
}
@keyframes u1qz6cr {
  0% {
    transform: rotateZ(0deg);
  }
  10% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(90deg);
  }
  90% {
    transform: rotateZ(90deg);
  }
  100% {
    transform: rotateZ(90deg);
  }
}
@keyframes u1qz6e3 {
  100%, 0% {
    color: var(--four-square-phase1-color);
  }
  20% {
    color: var(--four-square-phase1-color);
  }
  25% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  45% {
    color: var(--four-square-phase2-color, var(--four-square-phase1-color));
  }
  50% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  70% {
    color: var(--four-square-phase3-color, var(--four-square-phase1-color));
  }
  75% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
  95% {
    color: var(--four-square-phase4-color, var(--four-square-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--four-square-phase".concat(t+1,"-color")});wn(`.mosaic-rli-bounding-box {
  --mosaic-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  color: var(--mosaic-phase1-color);
}
.mosaic-rli-bounding-box .mosaic-indicator {
  width: 5em;
  height: 5em;
  color: currentColor;
  display: grid;
  gap: 0.125em;
  grid-template-columns: repeat(3, 1fr);
  grid-template-areas: "a b c" "d e f" "g h i";
  position: relative;
  z-index: 0;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 105%;
  left: 50%;
  transform: translateX(-50%);
  z-index: -2;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube {
  background-color: var(--mosaic-phase1-color);
  animation-name: u1qz6bl, u1qz6c9;
  animation-duration: var(--rli-animation-duration, 1.5s), calc(var(--rli-animation-duration, 1.5s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in-out);
  animation-iteration-count: infinite;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube1 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
  grid-area: a;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube2 {
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
  grid-area: b;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube3 {
  grid-area: c;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 4);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube4 {
  grid-area: d;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube5 {
  grid-area: e;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube6 {
  grid-area: f;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 3);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube7 {
  grid-area: g;
  animation-delay: 0s;
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube8 {
  grid-area: h;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 1);
}
.mosaic-rli-bounding-box .mosaic-indicator .mosaic-cube9 {
  grid-area: i;
  animation-delay: calc(var(--mosaic-skip-interval, 0.1s) * 2);
}

@property --mosaic-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --mosaic-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.5s;
}
@keyframes u1qz6bl {
  0%, 60%, 100% {
    transform: scale3D(1, 1, 1);
  }
  30% {
    transform: scale3D(0, 0, 1);
  }
}
@keyframes u1qz6c9 {
  100%, 0% {
    background-color: var(--mosaic-phase1-color);
  }
  25% {
    background-color: var(--mosaic-phase2-color, var(--mosaic-phase1-color));
  }
  50% {
    background-color: var(--mosaic-phase3-color, var(--mosaic-phase1-color));
  }
  75% {
    background-color: var(--mosaic-phase4-color, var(--mosaic-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--mosaic-phase".concat(t+1,"-color")});wn(`.riple-rli-bounding-box {
  --riple-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--riple-phase1-color);
}
.riple-rli-bounding-box .riple-indicator {
  display: inline-block;
  width: 5em;
  height: 5em;
  position: relative;
  z-index: 0;
}
.riple-rli-bounding-box .riple-indicator .riple-text {
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}
.riple-rli-bounding-box .riple-indicator .riple {
  --border-width: 0.25em;
  position: absolute;
  border: var(--border-width) solid var(--riple-phase1-color);
  opacity: 1;
  border-radius: 50%;
  will-change: top, right, left, bottom, border-color;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite u1qz6mm, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, cubic-bezier(0, 0.2, 0.8, 1)) infinite u1qz6og;
}
.riple-rli-bounding-box .riple-indicator .riple:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 1s) / 2 * -1);
}

@property --riple-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --riple-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes u1qz6mm {
  0% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  4.9% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 0;
  }
  5% {
    top: calc(50% - var(--border-width));
    left: calc(50% - var(--border-width));
    right: calc(50% - var(--border-width));
    bottom: calc(50% - var(--border-width));
    opacity: 1;
  }
  100% {
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
  }
}
@keyframes u1qz6og {
  100%, 0% {
    border-color: var(--riple-phase1-color);
  }
  24.9% {
    border-color: var(--riple-phase1-color);
  }
  25% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  49.9% {
    border-color: var(--riple-phase2-color, var(--riple-phase1-color));
  }
  50% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  74.9% {
    border-color: var(--riple-phase3-color, var(--riple-phase1-color));
  }
  75% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
  99.9% {
    border-color: var(--riple-phase4-color, var(--riple-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--riple-phase".concat(t+1,"-color")});wn(`.pulsate-rli-bounding-box {
  --TD-pulsate-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  display: inline-block;
  box-sizing: border-box;
  color: var(--TD-pulsate-phase1-color);
}
.pulsate-rli-bounding-box .pulsate-indicator {
  width: 4.4em;
  height: 1.1em;
  text-align: center;
  position: relative;
  z-index: 0;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  align-items: center;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot {
  width: 1.1em;
  height: 1.1em;
  border-radius: 50%;
  background-color: var(--TD-pulsate-phase1-color);
  transform: scale(0);
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, ease-in-out) var(--delay) infinite u1qz6uj, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, ease-in-out) var(--delay) infinite u1qz6vi;
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(1) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15 * -1);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(2) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
}
.pulsate-rli-bounding-box .pulsate-indicator .pulsate-dot:nth-of-type(3) {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.15);
}
.pulsate-rli-bounding-box .pulsate-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 80%;
  text-transform: uppercase;
  text-align: center;
  font-size: 0.6em;
  letter-spacing: 0.5px;
  font-family: sans-serif;
  mix-blend-mode: difference;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: -2;
}

@property --TD-pulsate-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-pulsate-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6uj {
  0%, 90%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}
@keyframes u1qz6vi {
  0%, 100% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  24.9% {
    background-color: var(--TD-pulsate-phase1-color);
  }
  25% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  49.9% {
    background-color: var(--TD-pulsate-phase2-color, var(--TD-pulsate-phase1-color));
  }
  50% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  74.9% {
    background-color: var(--TD-pulsate-phase3-color, var(--TD-pulsate-phase1-color));
  }
  75% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
  99.9% {
    background-color: var(--TD-pulsate-phase4-color, var(--TD-pulsate-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--TD-pulsate-phase".concat(t+1,"-color")});wn(`.brick-stack-rli-bounding-box {
  --TD-brick-stack-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-brick-stack-phase1-color);
}
.brick-stack-rli-bounding-box .brick-stack-indicator {
  width: 2.8em;
  height: 2.8em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.brick-stack-rli-bounding-box .brick-stack {
  width: 100%;
  height: 100%;
  background: radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 0/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 0 100%/40% 40% no-repeat, radial-gradient(circle closest-side, currentColor 0% 95%, rgba(0, 0, 0, 0) calc(95% + 1px)) 100% 100%/40% 40% no-repeat;
  animation: var(--rli-animation-duration, 1s) var(--rli-animation-function, ease-out) infinite u1qz6w1, calc(var(--rli-animation-duration, 1s) * 4) var(--rli-animation-function, ease-out) infinite u1qz6x5;
}

@property --TD-brick-stack-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-brick-stack-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1s;
}
@keyframes u1qz6w1 {
  0% {
    background-position: 0 0, 0 100%, 100% 100%;
  }
  25% {
    background-position: 100% 0, 0 100%, 100% 100%;
  }
  50% {
    background-position: 100% 0, 0 0, 100% 100%;
  }
  75% {
    background-position: 100% 0, 0 0, 0 100%;
  }
  100% {
    background-position: 100% 100%, 0 0, 0 100%;
  }
}
@keyframes u1qz6x5 {
  100%, 0% {
    color: var(--TD-brick-stack-phase1-color);
  }
  20% {
    color: var(--TD-brick-stack-phase1-color);
  }
  25% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  45% {
    color: var(--TD-brick-stack-phase2-color, var(--TD-brick-stack-phase1-color));
  }
  50% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  70% {
    color: var(--TD-brick-stack-phase3-color, var(--TD-brick-stack-phase1-color));
  }
  75% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
  95% {
    color: var(--TD-brick-stack-phase4-color, var(--TD-brick-stack-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--TD-brick-stack-phase".concat(t+1,"-color")});wn(`.bob-rli-bounding-box {
  --TD-bob-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  display: inline-block;
  color: var(--TD-bob-phase1-color);
}
.bob-rli-bounding-box .bob-indicator {
  width: 4.4em;
  height: 2.2em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bob-rli-bounding-box .bob-indicator .bobbing,
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  width: 1.1em;
  height: 100%;
  display: grid;
  animation: var(--rli-animation-duration, 1.2s) var(--rli-animation-function, linear) var(--delay) infinite u1qz6wd, calc(var(--rli-animation-duration, 1.2s) * 4) var(--rli-animation-function, linear) var(--delay) infinite u1qz6xx;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before,
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  content: "";
  grid-area: 1/1;
}
.bob-rli-bounding-box .bob-indicator .bobbing {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12 * -1);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::before {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0);
  transform: translateX(150%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}
.bob-rli-bounding-box .bob-indicator .bobbing::after {
  --delay: calc(var(--rli-animation-duration, 1.2s) * 0.12);
  transform: translateX(300%);
  background: radial-gradient(circle closest-side at center, currentColor 0% 92%, rgba(0, 0, 0, 0) calc(92% + 1px)) 50% 50%/100% 50% no-repeat;
}

@property --TD-bob-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bob-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6wd {
  100%, 0% {
    background-position: 50% 50%;
  }
  15% {
    background-position: 50% 10%;
  }
  30% {
    background-position: 50% 100%;
  }
  40% {
    background-position: 50% 0%;
  }
  50% {
    background-position: 50% 90%;
  }
  70% {
    background-position: 50% 10%;
  }
  98% {
    background-position: 50% 50%;
  }
}
@keyframes u1qz6xx {
  100%, 0% {
    color: var(--TD-bob-phase1-color);
  }
  22% {
    color: var(--TD-bob-phase1-color);
  }
  25% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  47% {
    color: var(--TD-bob-phase2-color, var(--TD-bob-phase1-color));
  }
  50% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  72% {
    color: var(--TD-bob-phase3-color, var(--TD-bob-phase1-color));
  }
  75% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
  97% {
    color: var(--TD-bob-phase4-color, var(--TD-bob-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--TD-bob-phase".concat(t+1,"-color")});wn(`.bounce-rli-bounding-box {
  --TD-bounce-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--TD-bounce-phase1-color);
  display: inline-block;
  padding-bottom: 0.25125em;
}
.bounce-rli-bounding-box .wrapper {
  --dot1-delay: 0s;
  --dot1-x-offset: 0.55em;
  --dot2-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.75) * -1);
  --dot2-x-offset: 2.2em;
  --dot3-delay: calc((var(--rli-animation-duration, 0.5s) + var(--rli-animation-duration, 0.5s) * 0.5) * -1);
  --dot3-x-offset: 3.85em;
  width: 5.5em;
  height: 3.125em;
  position: relative;
  display: block;
  margin: 0 auto;
}
.bounce-rli-bounding-box .wrapper .group {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.bounce-rli-bounding-box .wrapper .group .dot {
  width: 1.1em;
  height: 1.1em;
  position: absolute;
  border-radius: 50%;
  background-color: var(--TD-bounce-phase1-color);
  transform-origin: 50%;
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite u1qz6yl, calc(var(--rli-animation-duration, 0.5s) * 4) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) infinite u1qz6zs;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .dot:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay), 0s;
}
.bounce-rli-bounding-box .wrapper .group .shadow {
  width: 1.1em;
  height: 0.22em;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.5);
  position: absolute;
  top: 101%;
  transform-origin: 50%;
  z-index: -1;
  filter: blur(1px);
  animation: var(--rli-animation-duration, 0.5s) var(--rli-animation-function, cubic-bezier(0.74, 0.1, 0.74, 1)) alternate infinite u1qz6z4;
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(1) {
  left: var(--dot1-x-offset);
  animation-delay: var(--dot1-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(2) {
  left: var(--dot2-x-offset);
  animation-delay: var(--dot2-delay);
}
.bounce-rli-bounding-box .wrapper .group .shadow:nth-of-type(3) {
  left: var(--dot3-x-offset);
  animation-delay: var(--dot3-delay);
}

@property --TD-bounce-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --TD-bounce-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 0.5s;
}
@keyframes u1qz6yl {
  0% {
    top: 0%;
  }
  60% {
    height: 1.25em;
    border-radius: 50%;
    transform: scaleX(1);
  }
  100% {
    top: 100%;
    height: 0.22em;
    transform: scaleX(1.5);
    filter: blur(0.4px);
  }
}
@keyframes u1qz6z4 {
  0% {
    transform: scaleX(0.2);
    opacity: 0.2;
  }
  60% {
    opacity: 0.4;
  }
  100% {
    transform: scaleX(1.5);
    opacity: 0.6;
  }
}
@keyframes u1qz6zs {
  0%, 100% {
    background-color: var(--TD-bounce-phase1-color);
  }
  20% {
    background-color: var(--TD-bounce-phase1-color);
  }
  25% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  45% {
    background-color: var(--TD-bounce-phase2-color, var(--TD-bounce-phase1-color));
  }
  50% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  70% {
    background-color: var(--TD-bounce-phase3-color, var(--TD-bounce-phase1-color));
  }
  75% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
  95% {
    background-color: var(--TD-bounce-phase4-color, var(--TD-bounce-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--TD-bounce-phase".concat(t+1,"-color")});wn(`.blink-blur-rli-bounding-box {
  --shape-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--shape-phase1-color);
}
.blink-blur-rli-bounding-box .blink-blur-indicator {
  isolation: isolate;
  display: flex;
  flex-direction: row;
  -moz-column-gap: 0.4em;
       column-gap: 0.4em;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape {
  --x-deg: -20deg;
  width: 1.8em;
  height: 2.25em;
  border-radius: 0.25em;
  color: inherit;
  transform: skewX(var(--x-deg));
  background-color: var(--shape-phase1-color);
  animation-name: u1qz6i2, u1qz6js;
  animation-duration: var(--rli-animation-duration, 1.2s), calc(var(--rli-animation-duration, 1.2s) * 4);
  animation-timing-function: var(--rli-animation-function, ease-in);
  animation-iteration-count: infinite;
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape1 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.5 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape2 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.4 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape3 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.3 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape4 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.2 * -1);
}
.blink-blur-rli-bounding-box .blink-blur-indicator .blink-blur-shape.blink-blur-shape5 {
  animation-delay: calc(var(--rli-animation-duration, 1.2s) * 0.1 * -1);
}

@property --shape-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --shape-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 1.2s;
}
@keyframes u1qz6i2 {
  100%, 0% {
    opacity: 0.3;
    filter: blur(0.0675em) drop-shadow(0 0 0.0625em);
    transform: skewX(var(--x-deg)) scale(1.2, 1.45);
  }
  39% {
    opacity: 0.8;
  }
  40%, 41%, 42% {
    opacity: 0;
  }
  43% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
    filter: blur(0em) drop-shadow(0 0 0em);
    transform: skewX(var(--x-deg)) scale(1, 1);
  }
}
@keyframes u1qz6js {
  100%, 0% {
    color: var(--shape-phase1-color);
    background-color: var(--shape-phase1-color);
  }
  25% {
    color: var(--shape-phase2-color, var(--shape-phase1-color));
    background-color: var(--shape-phase2-color, var(--shape-phase1-color));
  }
  50% {
    color: var(--shape-phase3-color, var(--shape-phase1-color));
    background-color: var(--shape-phase3-color, var(--shape-phase1-color));
  }
  75% {
    color: var(--shape-phase4-color, var(--shape-phase1-color));
    background-color: var(--shape-phase4-color, var(--shape-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--shape-phase".concat(t+1,"-color")});wn(`.trophy-spin-rli-bounding-box {
  --trophySpin-phase1-color: rgb(50, 205, 50);
  box-sizing: border-box;
  font-size: 16px;
  position: relative;
  isolation: isolate;
  color: var(--trophySpin-phase1-color);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator {
  width: 4em;
  perspective: 1000px;
  transform-style: preserve-3d;
  display: block;
  margin: 0 auto;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade {
  display: block;
  width: 4em;
  height: 0.5em;
  background: var(--trophySpin-phase1-color);
  animation: u1qz6nk var(--rli-animation-duration, 2.5s) var(--rli-animation-function, linear) infinite, u1qz6op calc(var(--rli-animation-duration, 2.5s) * 0.5) var(--rli-animation-function, linear) infinite, u1qz6pg calc(var(--rli-animation-duration, 2.5s) * 4) var(--rli-animation-function, linear) infinite;
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(8) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 0 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(7) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 1 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(6) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 2 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(5) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 3 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(4) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 4 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(3) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 5 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(2) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 6 * -1);
}
.trophy-spin-rli-bounding-box .trophy-spin-indicator .blade:nth-of-type(1) {
  animation-delay: calc(var(--rli-animation-duration, 2.5s) / 2 / 8 * 7 * -1);
}

@property --trophySpin-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --trophySpin-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2.5s;
}
@keyframes u1qz6nk {
  to {
    transform: rotateY(1turn) rotateX(-25deg);
  }
}
@keyframes u1qz6op {
  100%, 0% {
    filter: brightness(1);
    opacity: 1;
  }
  15% {
    filter: brightness(1);
  }
  25% {
    opacity: 0.96;
  }
  30% {
    filter: brightness(0.92);
  }
  50% {
    filter: brightness(0.7);
    opacity: 1;
  }
  75% {
    filter: brightness(0.92);
    opacity: 0.96;
  }
  90% {
    filter: brightness(1);
  }
}
@keyframes u1qz6pg {
  100%, 0% {
    background-color: var(--trophySpin-phase1-color);
  }
  18% {
    background-color: var(--trophySpin-phase1-color);
  }
  25% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  43% {
    background-color: var(--trophySpin-phase2-color, var(--trophySpin-phase1-color));
  }
  50% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  68% {
    background-color: var(--trophySpin-phase3-color, var(--trophySpin-phase1-color));
  }
  75% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
  93% {
    background-color: var(--trophySpin-phase4-color, var(--trophySpin-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--trophySpin-phase".concat(t+1,"-color")});wn(`.slab-rli-bounding-box {
  --slab-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  color: var(--slab-phase1-color);
  position: relative;
}
.slab-rli-bounding-box .slab-indicator {
  position: relative;
  display: block;
  width: 7em;
  height: 4em;
  margin: 0 auto;
  overflow: hidden;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper {
  width: 4em;
  height: 4em;
  transform: perspective(15em) rotateX(66deg) rotateZ(-25deg);
  transform-style: preserve-3d;
  transform-origin: 50% 100%;
  display: block;
  position: absolute;
  bottom: 0;
  right: 0;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--slab-phase1-color);
  opacity: 0;
  box-shadow: -0.08em 0.15em 0 rgba(0, 0, 0, 0.45);
  transform-origin: 0% 0%;
  animation: calc(var(--rli-animation-duration-unitless, 3) * 1s) var(--rli-animation-function, linear) infinite u1qz6km, calc(var(--rli-animation-duration-unitless, 3) * 4s) var(--rli-animation-function, linear) infinite u1qz6lk;
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(1) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 3 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(2) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * 2 * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(3) {
  animation-delay: calc(4 / (16 / var(--rli-animation-duration-unitless, 3)) * -1 * 1s);
}
.slab-rli-bounding-box .slab-indicator .slabs-wrapper .slab:nth-child(4) {
  animation-delay: 0s;
}

@property --slab-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --slab-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration-unitless {
  syntax: "<number>";
  inherits: true;
  initial-value: 3;
}
@keyframes u1qz6km {
  0% {
    transform: translateY(0) rotateX(30deg);
    opacity: 0;
  }
  10% {
    transform: translateY(-40%) rotateX(0deg);
    opacity: 1;
  }
  25% {
    opacity: 1;
  }
  100% {
    transform: translateY(-400%) rotateX(0deg);
    opacity: 0;
  }
}
@keyframes u1qz6lk {
  100%, 0% {
    background-color: var(--slab-phase1-color);
  }
  24.9% {
    background-color: var(--slab-phase1-color);
  }
  25% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  49.9% {
    background-color: var(--slab-phase2-color, var(--slab-phase1-color));
  }
  50% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  74.9% {
    background-color: var(--slab-phase3-color, var(--slab-phase1-color));
  }
  75% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
  99.9% {
    background-color: var(--slab-phase4-color, var(--slab-phase1-color));
  }
}`);Array.from({length:4},function(e,t){return"--slab-phase".concat(t+1,"-color")});wn(`.lifeline-rli-bounding-box {
  --life-line-phase1-color: rgb(50, 205, 50);
  font-size: 16px;
  isolation: isolate;
  color: var(--life-line-phase1-color);
}
.lifeline-rli-bounding-box .lifeline-indicator {
  position: relative;
  text-align: center;
}
.lifeline-rli-bounding-box .lifeline-indicator path.rli-lifeline {
  stroke-dasharray: 474.7616760254 30.3039367676;
  animation: var(--rli-animation-duration, 2s) var(--rli-animation-function, linear) infinite u1qz6lr, calc(var(--rli-animation-duration, 2s) * 4) var(--rli-animation-function, linear) infinite u1qz6m8;
}
.lifeline-rli-bounding-box .lifeline-text {
  color: currentColor;
  mix-blend-mode: difference;
  width: unset;
  display: block;
}

@property --life-line-phase1-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase2-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase3-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --life-line-phase4-color {
  syntax: "<color>";
  inherits: true;
  initial-value: rgb(50, 205, 50);
}
@property --rli-animation-duration {
  syntax: "<time>";
  inherits: true;
  initial-value: 2s;
}
@keyframes u1qz6lr {
  to {
    stroke-dashoffset: -1010.1312255859;
  }
}
@keyframes u1qz6m8 {
  100%, 0% {
    color: var(--life-line-phase1-color);
  }
  20% {
    color: var(--life-line-phase1-color);
  }
  25% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  45% {
    color: var(--life-line-phase2-color, var(--life-line-phase1-color));
  }
  50% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  70% {
    color: var(--life-line-phase3-color, var(--life-line-phase1-color));
  }
  75% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
  95% {
    color: var(--life-line-phase4-color, var(--life-line-phase1-color));
  }
}`);var Sp=Array.from({length:4},function(e,t){return"--life-line-phase".concat(t+1,"-color")}),BPe=function(e){var t,i=rg(e==null?void 0:e.style,e==null?void 0:e.size),r=i.styles,n=i.fontSize,s=e==null?void 0:e.easing,a=ig(e==null?void 0:e.speedPlus,"2s").animationPeriod,o=function(l){var u={};if(l instanceof Array){for(var h=sg(l,Sp.length),c=0;c<h.length&&!(c>=4);c++)u[Sp[c]]=h[c];return u}try{if(typeof l!="string")throw new Error("Color String expected");for(var f=0;f<Sp.length;f++)u[Sp[f]]=l}catch(m){for(m instanceof Error?console.warn("[".concat(m.message,']: Received "').concat(typeof l,'" instead with value, ').concat(JSON.stringify(l))):console.warn("".concat(JSON.stringify(l)," received in <LifeLine /> indicator cannot be processed. Using default instead!")),f=0;f<Sp.length;f++)u[Sp[f]]=Rl}return u}((t=e==null?void 0:e.color)!==null&&t!==void 0?t:"");return Fi.createElement("span",{className:"rli-d-i-b lifeline-rli-bounding-box",style:gi(gi(gi(gi(gi({},n&&{fontSize:n}),a&&{"--rli-animation-duration":a}),s&&{"--rli-animation-function":s}),o),r),role:"status","aria-live":"polite","aria-label":"Loading"},Fi.createElement("span",{className:"rli-d-i-b lifeline-indicator"},Fi.createElement("svg",{width:"14em",height:"6.825000001em",xmlns:"http://www.w3.org/2000/svg",version:"1.2",viewBox:"0 0 350 50",preserveAspectRatio:"xMinYMin meet"},Fi.createElement("path",{className:"rli-lifeline",stroke:"currentColor",fill:"none",strokeLinejoin:"round",strokeWidth:"4px",d:"M-113 70h250q8-30 12-3t5 8 3-7 3 4 6 35 8-55 6 40 8-3s2-11 10-10 1 1 8-10l4 8c6 4 8-6 10-17s2 10 9 11h210"}))),Fi.createElement(ng,{staticText:!0,text:e==null?void 0:e.text,textColor:e==null?void 0:e.textColor}))};const R2e=()=>Jt.jsx("div",{className:"w-full h-[100vh] flex justify-center items-center bg-[#0f041ff8]",children:Jt.jsxs("div",{className:"flex justify-center items-center flex-col gap-6",children:[Jt.jsx("h1",{className:"text-[#7c46f1] text-4xl font-medium md:block hidden",children:u2e("loadingPage.title")}),Jt.jsx(I2e,{color:"#7c46f1",size:"medium",text:"",textColor:""})]})}),O2e=Ae.lazy(()=>Es(()=>import("./HomePage-DXI_Uhko.js"),__vite__mapDeps([0,1,2,3,4]))),k2e=Ae.lazy(()=>Es(()=>import("./InfoPage-BNnvH7Vu.js"),__vite__mapDeps([5,2,1]))),L2e=Ae.lazy(()=>Es(()=>import("./LoginPage-BZ61SxH2.js"),__vite__mapDeps([6,3,7,8,9,2,10]))),z2e=Ae.lazy(()=>Es(()=>import("./RegisterPage-BtbOYOEu.js"),__vite__mapDeps([11,3,7,9,2]))),N2e=Ae.lazy(()=>Es(()=>import("./ForgotPasswordPage-CUWA0ci8.js"),__vite__mapDeps([12,7,3,8]))),B2e=Ae.lazy(()=>Es(()=>import("./NotFoundPage-CUmQrd_r.js"),[])),F2e=Ae.lazy(()=>Es(()=>import("./PasswordChangePage-D3YUOhh2.js"),[])),U2e=Ae.lazy(()=>Es(()=>import("./SetNewPassword-CoBpU-3P.js"),__vite__mapDeps([13,8,7,3,9,2]))),V2e=()=>Jt.jsx(Ae.Suspense,{fallback:Jt.jsx(R2e,{}),children:Jt.jsxs(uTe,{children:[Jt.jsx(bl,{path:"/",element:Jt.jsx(L2e,{})}),Jt.jsx(bl,{path:"register",element:Jt.jsx(z2e,{})}),Jt.jsx(bl,{path:"forgot-password",element:Jt.jsx(N2e,{})}),Jt.jsxs(bl,{element:Jt.jsx(GTe,{}),children:[Jt.jsx(bl,{path:"home",element:Jt.jsx(O2e,{})}),Jt.jsx(bl,{path:"info",element:Jt.jsx(k2e,{})}),Jt.jsx(bl,{path:"change-password",element:Jt.jsx(F2e,{}),children:Jt.jsx(bl,{path:"verify",element:Jt.jsx(U2e,{})})})]}),Jt.jsx(bl,{path:"*",element:Jt.jsx(B2e,{})})]})});function j2e(){return Jt.jsx(Jt.Fragment,{children:Jt.jsx(dCe,{children:Jt.jsx(mCe,{children:Jt.jsx(pCe,{children:Jt.jsxs(fCe,{children:[Jt.jsx(HTe,{}),Jt.jsx(X1e,{}),Jt.jsx(V2e,{})]})})})})})}const H2e=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,G2e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},W2e=e=>G2e[e],q2e=e=>e.replace(H2e,W2e);let zP={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:q2e};const X2e=(e={})=>{zP={...zP,...e}},FPe=()=>zP;let Q9;const Y2e=e=>{Q9=e},UPe=()=>Q9,Q2e={type:"3rdParty",init(e){X2e(e.options.react),Y2e(e)}},{slice:K2e,forEach:Z2e}=[];function J2e(e){return Z2e.call(K2e.call(arguments,1),t=>{if(t)for(const i in t)e[i]===void 0&&(e[i]=t[i])}),e}const GF=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,$2e=function(e,t){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},n=encodeURIComponent(t);let s=`${e}=${n}`;if(r.maxAge>0){const a=r.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(a)}`}if(r.domain){if(!GF.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!GF.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s},WF={create(e,t,i,r){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};i&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+i*60*1e3)),r&&(n.domain=r),document.cookie=$2e(e,encodeURIComponent(t),n)},read(e){const t=`${e}=`,i=document.cookie.split(";");for(let r=0;r<i.length;r++){let n=i[r];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(t)===0)return n.substring(t.length,n.length)}return null},remove(e){this.create(e,"",-1)}};var ePe={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return WF.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:i,cookieMinutes:r,cookieDomain:n,cookieOptions:s}=t;i&&typeof document<"u"&&WF.create(i,e,r,n,s)}},tPe={name:"querystring",lookup(e){var r;let{lookupQuerystring:t}=e,i;if(typeof window<"u"){let{search:n}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));const a=n.substring(1).split("&");for(let o=0;o<a.length;o++){const l=a[o].indexOf("=");l>0&&a[o].substring(0,l)===t&&(i=a[o].substring(l+1))}}return i}};let gv=null;const qF=()=>{if(gv!==null)return gv;try{gv=window!=="undefined"&&window.localStorage!==null;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{gv=!1}return gv};var iPe={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&qF())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:i}=t;i&&qF()&&window.localStorage.setItem(i,e)}};let vv=null;const XF=()=>{if(vv!==null)return vv;try{vv=window!=="undefined"&&window.sessionStorage!==null;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{vv=!1}return vv};var rPe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&XF())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:i}=t;i&&XF()&&window.sessionStorage.setItem(i,e)}},nPe={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:i,userLanguage:r,language:n}=navigator;if(i)for(let s=0;s<i.length;s++)t.push(i[s]);r&&t.push(r),n&&t.push(n)}return t.length>0?t:void 0}},sPe={name:"htmlTag",lookup(e){let{htmlTag:t}=e,i;const r=t||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(i=r.getAttribute("lang")),i}},aPe={name:"path",lookup(e){var n;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const i=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?(n=i[typeof t=="number"?t:0])==null?void 0:n.replace("/",""):void 0}},oPe={name:"subdomain",lookup(e){var n,s;let{lookupFromSubdomainIndex:t}=e;const i=typeof t=="number"?t+1:1,r=typeof window<"u"&&((s=(n=window.location)==null?void 0:n.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[i]}};let K9=!1;try{document.cookie,K9=!0}catch{}const Z9=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];K9||Z9.splice(1,1);const lPe=()=>({order:Z9,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class J9{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,i)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=J2e(i,this.options||{},lPe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=n=>n.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(ePe),this.addDetector(tPe),this.addDetector(iPe),this.addDetector(rPe),this.addDetector(nPe),this.addDetector(sPe),this.addDetector(aPe),this.addDetector(oPe)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,i=[];return t.forEach(r=>{if(this.detectors[r]){let n=this.detectors[r].lookup(this.options);n&&typeof n=="string"&&(n=[n]),n&&(i=i.concat(n))}}),i=i.map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?i:i.length>0?i[0]:null}cacheUserLanguage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;i&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||i.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(t,this.options)}))}}J9.type="languageDetector";const uPe={en:{translation:{components:{navbar:{accountButton:{title:"User"},restartButton:{title:"Restart"}},explainBtn:{text:"See More"},resetModal:{title:"You are about to reset all values! Are you sure you want to do this?",desc:"By pressing the destructive button, you will reset all your values. Budget, Goal, Expenses, Results, and Stats will have a value of zero.",leftBtn:"Delay self-destruction",rightBtn:"Yes, Destroy everything"},missingBudgetModal:{title:"Do you want to spend from your budget without having a budget?",desc:"Don't worry, Captain, this can happen to the best of us. Please enter the coordinates for your budget so you can continue managing your finances.",leftBtn:"Roger that, over",rightBtn:"What?! Tell me more"}},auth:{buttons:{logIn:"Log In",goBack:"Go Back",signUp:"Sign Up",sendIt:"Send It",forgotPassword:"Forgot Password",createNewAccount:"Create New Account",haveAnAccount:"I have an account",user:"User",changePassword:"Change Password",logOut:"Log Out"},placeholders:{name:"Name...",email:"Email...",password:"Password...",enterEmail:"Enter your email...",createPassword:"Create a password...",confirmPassword:"Confirm your password...",enterCurrentPassword:"Enter your current password...",setNewPassword:"Set new Password...",confirmYourCurrPassword:"Confirm your new password..."},labels:{currPassword:"Current Password",newPassword:"New Password",confirmPassword:"Confirm Password"},messages:{errors:{enterEmailAndPassword:"Please enter your email and password.",enterEmail:"Please enter a valid email.",passwordIsTooWeak:"Password is too weak.",wrongEmailOrPassword:"Wrong email or password.",returnToLoginPage:"Return to the Login page?",noUserFound:"No user found with this email",incorrectPassword:"Incorrect password.",fillAllInformation:"Please fill in all the required information.",passwordsDoNotMatch:"Passwords do not match.",emailsIsInUse:"This email is already in use.",weakPassword:"Password should be at least 6 characters.",unknownError:"Something went wrong, please try again later.",unknownErrorChangePassword:"Something went wrong. Is your current password correct?"},success:{resetPasswordSent:"Email was sent. If nothing arrives in 5 minutes, please check your spam or try again.",passwordResetEmailSent:"Password reset email send.",passwordWasChanged:"The password was successfully changed."}}},loginPage:{title:"Money Saver",desc:"Your money. Your mission. Lets launch it into something greater."},forgotPasswordPage:{title:"Forgot Your Password?",desc:"Don't worry. Please enter your email and we will send you a message to reset your password."},registerPage:{title:"Creating New Account"},changePasswordPage:{title:"Change Password"},notFoundPage:{title:"Page Not Found",desc:"Oops! The page you're looking for doesn't exist. It might have been moved or deleted.",button:"Go To Homepage"},loadingPage:{title:"Loading..."},hero:{title:"Greetings",subTitle1:"Today's Mission:",subTitle2:"Save Your Money",desc:"This app is here to help you improve your saving habits, boost your financial literacy, and provide you with essential everyday info. Join us on a journey where we'll take your finances to the next level and save money on an intergalactic scale!"},info:{title:"Core Coords",desc:"Today, were in the perfect position and at the right level to kick off a successful savings plan."},saverSection:{title:"Let's Set Goals",desc:"On the left side, write down your budget for the savings period. On the right side, write your financial goal that you want to achieve by the end of your deadline.",subDesc:"This step is essential for achieving your goal and gaining a strong dose of motivation."},financeBars:{title:"Here you enter your expenses and income.",bars:{},caption:"What you choose to input is up to you."},financeResults:{subTitle:"your steps and",title:"<span>Mission</span> results:",desc:"Mission results speak loud and clearkeep up the great work! And if you havent met your expectations just yet, dont give up. Youre capable of extraordinary thingsyouve got this!"},explainSection:{subTitle:"explanation",title:"Protocols for Your Intergalactic Voyage"},explainData:{1:{title:"Budget and Goal",desc:"A section where you can record your budget and goal to achieve financial savings."},2:{title:"Add & Save",desc:"Your journey begins here. You categorize expenses into different groups, giving you a clear overview of what you're spending your money on and how much."},3:{title:"Mission Results",desc:"The results of your achievements are displayed in this table, providing you with a detailed overview of the path your expenses are taking."},4:{title:"Stats and Percentages",desc:"Provide a more mathematical insight into how well youve met your expectations. The first percentage shows how much youve saved, the second percentage displays the cost of essential investments, and the third percentage highlights how much youre spending on Fun and Other activities."}},infoPage:{hero:{title:"Instructions for Starting <br/> Your Saving Adventure",desc:"Greetings, Captain! Here youll find all the instructions and information youll need on your journey. Ill be at your service for the entire ride until the very end of your saving days."},infoCarts:{coreCoordsInfo:{title:"Core Coords Section",desc:"This is your go-to motivational and info hub, packed with key-details for every great adventure. Alongside inspiring quotes, youll also find a handy way to keep track of days and date because every captains journey runs on perfect timing!"},budgetGoalInfo:{title:"Budget And Goal",desc:"This is where the foundation of your savings journey begins! In the 'Your Budget' section, set the amount you plan to stick to for your chosen saving period. This is your financial anchorthe key detail that shapes everything else on your path. Next, in the 'Your Goal' section, set your savings target. Decide how much you want to save and what you're aiming for."},financeBarsInfo:{title:"Expenses Setter",desc:"In this section, you'll be tracking all your expenses. The expense tracker is divided into six categories based on priority and purpose, making it easy to see where your money is going. Simply enter the amount you've spent and hit the '+ button' to add it to the corresponding category. Made a mistake? No worries! Just use the '- button' to remove the amount and adjust your records effortlessly."},expensesResultsInfo:{title:"Mission results are in!",desc:"Based on the records from the previous section, you now have a clear overview of your expenses. See exactly where your money went and how much you spent in each category. Anything you add or remove in the Expenses Setter will instantly update in this table, keeping your budget tracking seamless and up to date!"}},expensesReviewsCart:{savedBar:{title:"Saved",desc:"The Saved bar shows you how much money you've saved from your original budget, both as a percentage and a numerical value."},spentBar:{title:"Spent",desc:"The Spent bar displays the total amount of money you've spent from your budget, both as a percentage and a numerical value."},funOtherBar:{title:"Fun/Other",desc:"The Fun/Other bar shows the amount of money you've spent specifically on entertainment and other expenses from the Spent bar. This value is displayed both as a number and as a percentage, reflecting its share of the total Spent bar amount."}},resetButtonInfo:{title:"Self-Destruction Button",desc:"If you have successfully completed your mission and a new savings period begins, you can easily delete all data by clicking this button. <span>WARNING</span>, once you confirm self-destruction, none of the data will be recoverable."}},data:{barsContentData:{rent:"Rent",food:"Food",car:"Car",hobby:"Hobby",fun:"Fun",other:"Other"}}}},sk:{translation:{components:{navbar:{accountButton:{title:"et"},restartButton:{title:"Retart"}},explainBtn:{text:"Pozrie viac"},resetModal:{title:"Chystte sa resetova vetky hodnoty! Ste si ist, e to chcete urobi?",desc:"Stlaenm detruktvneho tlaidla resetujete vetky svoje hodnoty. Rozpoet, cie, vdavky, vsledky a tatistiky bud ma hodnotu nula.",leftBtn:"Oneskori sebadetrukciu",rightBtn:"no, vetko znii"},missingBudgetModal:{title:"Chcete ma zo svojho rozpotu bez toho, aby ste mali rozpoet?",desc:"Nebojte sa, kapitn, toto sa me sta aj tm najlepm z ns. Zadajte sradnice svojho rozpotu, aby ste mohli pokraova v sprve svojich financi.",leftBtn:"Rozumiem, koniec.",rightBtn:"o?! Povedz mi viac"}},auth:{buttons:{logIn:"Prihlsi sa",goBack:"Sp",signUp:"Zaregistrova sa",sendIt:"Odosla",forgotPassword:"Zabudnut heslo",createNewAccount:"Vytvori nov et",haveAnAccount:"U mm et",user:"Pouvate",changePassword:"Zmeni heslo",logOut:"Odhlsi sa"},placeholders:{name:"Meno...",email:"Email...",password:"Heslo...",enterEmail:"Zadajte svoj email...",createPassword:"Vytvorte heslo...",confirmPassword:"Potvrte heslo...",enterCurrentPassword:"Zadajte aktulne heslo...",setNewPassword:"Nastavte nov heslo...",confirmYourCurrPassword:"Potvrte nov heslo..."},labels:{currPassword:"Aktulne heslo",newPassword:"Nov heslo",confirmPassword:"Potvrdenie hesla"},messages:{errors:{enterEmailAndPassword:"Zadajte, prosm, email a heslo.",enterEmail:"Zadajte platn email.",passwordIsTooWeak:"Heslo je prli slab.",wrongEmailOrPassword:"Nesprvny email alebo heslo.",ReturnToLoginPage:"Vrti sa na prihlasovaciu strnku?",noUserFound:"Pouvate s tmto emailom neexistuje.",incorrectPassword:"Nesprvne heslo.",fillAllInformation:"Vyplte, prosm, vetky poadovan daje.",passwordsDoNotMatch:"Hesl sa nezhoduj.",emailsIsInUse:"Tento email sa u pouva.",weakPassword:"Heslo mus ma aspo 6 znakov.",unknownError:"Nieo sa pokazilo. Skste to neskr.",unknownErrorChangePassword:"Nieo sa pokazilo. Je vae aktulne heslo sprvne?"},success:{resetPasswordSent:"Email bol odoslan. Ak nedoraz do 5 mint, skontrolujte spam alebo skste znova.",passwordResetEmailSent:"Email na obnovenie hesla bol odoslan.",passwordWasChanged:"Heslo bolo spene zmenen."}}},loginPage:{title:"Money Saver",desc:"Tvoje peniaze. Tvoja misia. Pome ich posun na vyiu rove."},forgotPasswordPage:{title:"Zabudli ste heslo?",desc:"iadny problm. Zadajte svoj email a poleme vm sprvu na obnovenie hesla."},registerPage:{title:"Vytvorenie novho tu"},changePasswordPage:{title:"Zmena hesla"},notFoundPage:{title:"Strnka nebola njden",desc:"Ups! Strnka, ktor hadte, neexistuje. Mono bola presunut alebo vymazan.",button:"Prejs na domovsk strnku"},loadingPage:{title:"Natava sa..."},hero:{title:"Zdravm, kapitn.",subTitle1:"Dnen misia:",subTitle2:"Uetri Vae peniaze.",desc:"Tto aplikcia je tu, aby vm pomohla zlepi vae nvyky v etren, zvi vau finann gramotnos a poskytn vm dleit kadodenn informcie. Pripojte sa k nm na ceste, kde vae financie posunieme na aliu rove a uetrme peniaze na medzihviezdnej rovni!"},info:{title:"Hlavn sradnice",desc:"Dnes sme v dokonalnej pozcii a na sprvnej rovni, aby sme zaali spen pln etrenia."},saverSection:{title:"Nastavme ciele.",desc:"Na avej strane si zapte svoj rozpoet na obdobie etrenia. Na pravej strane si zapte svoj finann cie, ktor chcete dosiahnu do konca stanovenho termnu.",subDesc:"Tento krok je kov pre dosiahnutie vho ciea a zskanie silnej dvky motivcie."},financeBars:{title:"Sem zadte svoje vdavky a prjmy.",bars:{},caption:"To, o sa rozhodnete zada, zvis od vs."},financeResults:{subTitle:"vae kroky a",title:"<span>Vsledky</span> misie:",desc:"Vsledky misie hovoria jasne a nahlas  pokraujte v skvelej prci! A ak ste ete nenaplnili svoje oakvania, nevzdvajte sa. Ste schopn dosiahnu vnimon veci  zvldnete to!"},explainSection:{subTitle:"Vysvetlenie",title:"Protokoly pre vau medzihviezdnu cestu"},explainData:{1:{title:"Rozpoet a Cie",desc:"Sekcia, kde si mete zaznamena svoj rozpoet a cie na dosiahnutie finannch spor."},2:{title:"Prida & Uloi",desc:"Vaa cesta zana tu. Kategorizujete vdavky do rznych skupn, o vm poskytne jasn prehad o tom, na o mate peniaze a koko."},3:{title:"Vsledky Misie",desc:"Vsledky vaich dosiahnutch cieov s zobrazen v tejto tabuke, ktor vm poskytuje podrobn prehad o ceste, ktorou vae vdavky smeruj."},4:{title:"tatistiky a Percent",desc:"Poskytuj matematick pohad na to, ako dobre ste splnili svoje oakvania. Prv percento ukazuje, koko ste uetrili, druh percento zobrazuje nklady na nevyhnutn investcie a tretie percento zdrazuje, koko mate na zbavu a in aktivity."}},infoPage:{hero:{title:"Intrukcie na zaatie <br/> vaej etriacej dobrodrunej cesty",desc:"Zdravm, kapitn! Tu njdete vetky intrukcie a informcie, ktor budete potrebova na svojej ceste. Budem vm k slubm po cel dobu vaej jazdy a do plnho konca vaich etriacich dn."},infoCarts:{coreCoordsInfo:{title:"Sekcia hlavn sradnice",desc:"Toto je v motivan a informan hub, pln kovch informci pre kad vek dobrodrustvo. Okrem inpirujcich cittov tu njdete aj praktick spsob, ako sledova dni a dtum, pretoe kad kapitnova cesta sa riadi dokonalm naasovanm!"},budgetGoalInfo:{title:"Rozpoet A Cie",desc:"Toto je miesto, kde zana zklad vho etriaceho dobrodrustva! V sekcii V rozpoet nastavte sumu, ktor plnujete dodriava poas zvolenho obdobia etrenia. Toto je vaa finann kov informcia, ktor formuje vetko ostatn na vaej ceste. alej, v sekcii Vae ciele, nastavte svoj cie etrenia. Rozhodnite sa, koko chcete uetri a na o sa zameriavate."},financeBarsInfo:{title:"Nastavenie Vdavkov",desc:"V tejto sekcii budete sledova vetky svoje vdavky. Sledova vdavkov je rozdelen do iestich kategri poda priority a elu, o vm uah zisti, kam vae peniaze id. Jednoducho zadajte sumu, ktor ste minuli, a stlate tlaidlo '+' na jej pridanie do prslunej kategrie. Urobili ste chybu? iadny problm! Sta poui tlaidlo '-' na odstrnenie sumy a ahko upravit vae zznamy."},expensesResultsInfo:{title:"Vsledky misie s tu!",desc:"Na zklade zznamov z predchdzajcej sekcie teraz mte jasn prehad o svojich vdavkoch. Uvidte presne, kam vae peniaze ili a koko ste minuli v kadej kategrii. okovek pridte alebo odstrnite v Nastaven vdavkov, sa okamite aktualizuje v tejto tabuke, m sa zabezpe, e vae sledovanie rozpotu bude plynul a aktulne!"}},expensesReviewsCart:{savedBar:{title:"Uetren",desc:"Sekcia Uetren vm uke, koko peaz ste uetrili zo svojho pvodnho rozpotu, a to ako v percentch, tak aj v selnej hodnote."},spentBar:{title:"Minut",desc:"Sekcia Minut zobrazuje celkov sumu peaz, ktor ste minuli zo svojho rozpotu, a to ako v percentch, tak aj v selnej hodnote."},funOtherBar:{title:"Zbava/In",desc:"Sekcia Zbava/In zobrazuje sumu peaz, ktor ste minuli konkrtne na zbavu a in vdavky zo sekcie Minut. Tto hodnota je zobrazen ako slo aj ako percento, ktor odra podiel tejto sumy na celkovej sume sekcie Minul."}},resetButtonInfo:{title:"Tlaidlo sebadetrukcie",desc:"Ak ste spene dokonili svoju misiu a zana nov obdobie etrenia, mete jednoducho vymaza vetky daje kliknutm na toto tlaidlo. <span>UPOZORNENIE</span>, po potvrden sebadetrukcie u nebude mon obnovi iadne daje."}},data:{barsContentData:{rent:"Njom",food:"Jedlo",car:"Auto",hobby:"Zuby",fun:"Zbava",other:"Ostatn"}}}}};Cs.use(J9).use(Q2e).init({resources:uPe,fallbackLng:"en",interpolation:{escapeValue:!1},detection:{order:["navigator"],caches:["localStorage"]}});u8.createRoot(document.getElementById("root")).render(Jt.jsx(Ae.StrictMode,{children:Jt.jsx(OTe,{basename:"/Money_Saver_App/",children:Jt.jsx(j2e,{})})}));export{BPe as D,Ym as E,ih as F,j9 as L,aTe as N,oTe as O,Fi as R,NPe as a,zy as b,zPe as c,Ly as d,LPe as e,rS as f,z9 as g,YF as h,FPe as i,Jt as j,UPe as k,cCe as l,PPe as m,DPe as n,RPe as o,IPe as p,OPe as q,Ae as r,IP as s,u2e as t,nS as u,MPe as v,b1 as w};
